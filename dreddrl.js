/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.1.2 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */
//Not using strict: uneven strict support in browsers, #392, and causes
//problems with requirejs.exec()/transpiler plugins that may not be strict.
/*jslint regexp: true, nomen: true, sloppy: true */
/*global window, navigator, document, importScripts, jQuery, setTimeout, opera */

var requirejs, require, define;
(function (global) {
    var req, s, head, baseElement, dataMain, src,
        interactiveScript, currentlyAddingScript, mainScript, subPath,
        version = '2.1.2',
        commentRegExp = /(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,
        cjsRequireRegExp = /[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,
        jsSuffixRegExp = /\.js$/,
        currDirRegExp = /^\.\//,
        op = Object.prototype,
        ostring = op.toString,
        hasOwn = op.hasOwnProperty,
        ap = Array.prototype,
        aps = ap.slice,
        apsp = ap.splice,
        isBrowser = !!(typeof window !== 'undefined' && navigator && document),
        isWebWorker = !isBrowser && typeof importScripts !== 'undefined',
        //PS3 indicates loaded and complete, but need to wait for complete
        //specifically. Sequence is 'loading', 'loaded', execution,
        // then 'complete'. The UA check is unfortunate, but not sure how
        //to feature test w/o causing perf issues.
        readyRegExp = isBrowser && navigator.platform === 'PLAYSTATION 3' ?
                      /^complete$/ : /^(complete|loaded)$/,
        defContextName = '_',
        //Oh the tragedy, detecting opera. See the usage of isOpera for reason.
        isOpera = typeof opera !== 'undefined' && opera.toString() === '[object Opera]',
        contexts = {},
        cfg = {},
        globalDefQueue = [],
        useInteractive = false;

    function isFunction(it) {
        return ostring.call(it) === '[object Function]';
    }

    function isArray(it) {
        return ostring.call(it) === '[object Array]';
    }

    /**
     * Helper function for iterating over an array. If the func returns
     * a true value, it will break out of the loop.
     */
    function each(ary, func) {
        if (ary) {
            var i;
            for (i = 0; i < ary.length; i += 1) {
                if (ary[i] && func(ary[i], i, ary)) {
                    break;
                }
            }
        }
    }

    /**
     * Helper function for iterating over an array backwards. If the func
     * returns a true value, it will break out of the loop.
     */
    function eachReverse(ary, func) {
        if (ary) {
            var i;
            for (i = ary.length - 1; i > -1; i -= 1) {
                if (ary[i] && func(ary[i], i, ary)) {
                    break;
                }
            }
        }
    }

    function hasProp(obj, prop) {
        return hasOwn.call(obj, prop);
    }

    function getOwn(obj, prop) {
        return hasProp(obj, prop) && obj[prop];
    }

    /**
     * Cycles over properties in an object and calls a function for each
     * property value. If the function returns a truthy value, then the
     * iteration is stopped.
     */
    function eachProp(obj, func) {
        var prop;
        for (prop in obj) {
            if (hasProp(obj, prop)) {
                if (func(obj[prop], prop)) {
                    break;
                }
            }
        }
    }

    /**
     * Simple function to mix in properties from source into target,
     * but only if target does not already have a property of the same name.
     */
    function mixin(target, source, force, deepStringMixin) {
        if (source) {
            eachProp(source, function (value, prop) {
                if (force || !hasProp(target, prop)) {
                    if (deepStringMixin && typeof value !== 'string') {
                        if (!target[prop]) {
                            target[prop] = {};
                        }
                        mixin(target[prop], value, force, deepStringMixin);
                    } else {
                        target[prop] = value;
                    }
                }
            });
        }
        return target;
    }

    //Similar to Function.prototype.bind, but the 'this' object is specified
    //first, since it is easier to read/figure out what 'this' will be.
    function bind(obj, fn) {
        return function () {
            return fn.apply(obj, arguments);
        };
    }

    function scripts() {
        return document.getElementsByTagName('script');
    }

    //Allow getting a global that expressed in
    //dot notation, like 'a.b.c'.
    function getGlobal(value) {
        if (!value) {
            return value;
        }
        var g = global;
        each(value.split('.'), function (part) {
            g = g[part];
        });
        return g;
    }

    /**
     * Constructs an error with a pointer to an URL with more information.
     * @param {String} id the error ID that maps to an ID on a web page.
     * @param {String} message human readable error.
     * @param {Error} [err] the original error, if there is one.
     *
     * @returns {Error}
     */
    function makeError(id, msg, err, requireModules) {
        var e = new Error(msg + '\nhttp://requirejs.org/docs/errors.html#' + id);
        e.requireType = id;
        e.requireModules = requireModules;
        if (err) {
            e.originalError = err;
        }
        return e;
    }

    if (typeof define !== 'undefined') {
        //If a define is already in play via another AMD loader,
        //do not overwrite.
        return;
    }

    if (typeof requirejs !== 'undefined') {
        if (isFunction(requirejs)) {
            //Do not overwrite and existing requirejs instance.
            return;
        }
        cfg = requirejs;
        requirejs = undefined;
    }

    //Allow for a require config object
    if (typeof require !== 'undefined' && !isFunction(require)) {
        //assume it is a config object.
        cfg = require;
        require = undefined;
    }

    function newContext(contextName) {
        var inCheckLoaded, Module, context, handlers,
            checkLoadedTimeoutId,
            config = {
                waitSeconds: 7,
                baseUrl: './',
                paths: {},
                pkgs: {},
                shim: {},
                map: {},
                config: {}
            },
            registry = {},
            undefEvents = {},
            defQueue = [],
            defined = {},
            urlFetched = {},
            requireCounter = 1,
            unnormalizedCounter = 1;

        /**
         * Trims the . and .. from an array of path segments.
         * It will keep a leading path segment if a .. will become
         * the first path segment, to help with module name lookups,
         * which act like paths, but can be remapped. But the end result,
         * all paths that use this function should look normalized.
         * NOTE: this method MODIFIES the input array.
         * @param {Array} ary the array of path segments.
         */
        function trimDots(ary) {
            var i, part;
            for (i = 0; ary[i]; i += 1) {
                part = ary[i];
                if (part === '.') {
                    ary.splice(i, 1);
                    i -= 1;
                } else if (part === '..') {
                    if (i === 1 && (ary[2] === '..' || ary[0] === '..')) {
                        //End of the line. Keep at least one non-dot
                        //path segment at the front so it can be mapped
                        //correctly to disk. Otherwise, there is likely
                        //no path mapping for a path starting with '..'.
                        //This can still fail, but catches the most reasonable
                        //uses of ..
                        break;
                    } else if (i > 0) {
                        ary.splice(i - 1, 2);
                        i -= 2;
                    }
                }
            }
        }

        /**
         * Given a relative module name, like ./something, normalize it to
         * a real name that can be mapped to a path.
         * @param {String} name the relative name
         * @param {String} baseName a real name that the name arg is relative
         * to.
         * @param {Boolean} applyMap apply the map config to the value. Should
         * only be done if this normalization is for a dependency ID.
         * @returns {String} normalized name
         */
        function normalize(name, baseName, applyMap) {
            var pkgName, pkgConfig, mapValue, nameParts, i, j, nameSegment,
                foundMap, foundI, foundStarMap, starI,
                baseParts = baseName && baseName.split('/'),
                normalizedBaseParts = baseParts,
                map = config.map,
                starMap = map && map['*'];

            //Adjust any relative paths.
            if (name && name.charAt(0) === '.') {
                //If have a base name, try to normalize against it,
                //otherwise, assume it is a top-level require that will
                //be relative to baseUrl in the end.
                if (baseName) {
                    if (getOwn(config.pkgs, baseName)) {
                        //If the baseName is a package name, then just treat it as one
                        //name to concat the name with.
                        normalizedBaseParts = baseParts = [baseName];
                    } else {
                        //Convert baseName to array, and lop off the last part,
                        //so that . matches that 'directory' and not name of the baseName's
                        //module. For instance, baseName of 'one/two/three', maps to
                        //'one/two/three.js', but we want the directory, 'one/two' for
                        //this normalization.
                        normalizedBaseParts = baseParts.slice(0, baseParts.length - 1);
                    }

                    name = normalizedBaseParts.concat(name.split('/'));
                    trimDots(name);

                    //Some use of packages may use a . path to reference the
                    //'main' module name, so normalize for that.
                    pkgConfig = getOwn(config.pkgs, (pkgName = name[0]));
                    name = name.join('/');
                    if (pkgConfig && name === pkgName + '/' + pkgConfig.main) {
                        name = pkgName;
                    }
                } else if (name.indexOf('./') === 0) {
                    // No baseName, so this is ID is resolved relative
                    // to baseUrl, pull off the leading dot.
                    name = name.substring(2);
                }
            }

            //Apply map config if available.
            if (applyMap && (baseParts || starMap) && map) {
                nameParts = name.split('/');

                for (i = nameParts.length; i > 0; i -= 1) {
                    nameSegment = nameParts.slice(0, i).join('/');

                    if (baseParts) {
                        //Find the longest baseName segment match in the config.
                        //So, do joins on the biggest to smallest lengths of baseParts.
                        for (j = baseParts.length; j > 0; j -= 1) {
                            mapValue = getOwn(map, baseParts.slice(0, j).join('/'));

                            //baseName segment has config, find if it has one for
                            //this name.
                            if (mapValue) {
                                mapValue = getOwn(mapValue, nameSegment);
                                if (mapValue) {
                                    //Match, update name to the new value.
                                    foundMap = mapValue;
                                    foundI = i;
                                    break;
                                }
                            }
                        }
                    }

                    if (foundMap) {
                        break;
                    }

                    //Check for a star map match, but just hold on to it,
                    //if there is a shorter segment match later in a matching
                    //config, then favor over this star map.
                    if (!foundStarMap && starMap && getOwn(starMap, nameSegment)) {
                        foundStarMap = getOwn(starMap, nameSegment);
                        starI = i;
                    }
                }

                if (!foundMap && foundStarMap) {
                    foundMap = foundStarMap;
                    foundI = starI;
                }

                if (foundMap) {
                    nameParts.splice(0, foundI, foundMap);
                    name = nameParts.join('/');
                }
            }

            return name;
        }

        function removeScript(name) {
            if (isBrowser) {
                each(scripts(), function (scriptNode) {
                    if (scriptNode.getAttribute('data-requiremodule') === name &&
                            scriptNode.getAttribute('data-requirecontext') === context.contextName) {
                        scriptNode.parentNode.removeChild(scriptNode);
                        return true;
                    }
                });
            }
        }

        function hasPathFallback(id) {
            var pathConfig = getOwn(config.paths, id);
            if (pathConfig && isArray(pathConfig) && pathConfig.length > 1) {
                removeScript(id);
                //Pop off the first array value, since it failed, and
                //retry
                pathConfig.shift();
                context.require.undef(id);
                context.require([id]);
                return true;
            }
        }

        //Turns a plugin!resource to [plugin, resource]
        //with the plugin being undefined if the name
        //did not have a plugin prefix.
        function splitPrefix(name) {
            var prefix,
                index = name ? name.indexOf('!') : -1;
            if (index > -1) {
                prefix = name.substring(0, index);
                name = name.substring(index + 1, name.length);
            }
            return [prefix, name];
        }

        /**
         * Creates a module mapping that includes plugin prefix, module
         * name, and path. If parentModuleMap is provided it will
         * also normalize the name via require.normalize()
         *
         * @param {String} name the module name
         * @param {String} [parentModuleMap] parent module map
         * for the module name, used to resolve relative names.
         * @param {Boolean} isNormalized: is the ID already normalized.
         * This is true if this call is done for a define() module ID.
         * @param {Boolean} applyMap: apply the map config to the ID.
         * Should only be true if this map is for a dependency.
         *
         * @returns {Object}
         */
        function makeModuleMap(name, parentModuleMap, isNormalized, applyMap) {
            var url, pluginModule, suffix, nameParts,
                prefix = null,
                parentName = parentModuleMap ? parentModuleMap.name : null,
                originalName = name,
                isDefine = true,
                normalizedName = '';

            //If no name, then it means it is a require call, generate an
            //internal name.
            if (!name) {
                isDefine = false;
                name = '_@r' + (requireCounter += 1);
            }

            nameParts = splitPrefix(name);
            prefix = nameParts[0];
            name = nameParts[1];

            if (prefix) {
                prefix = normalize(prefix, parentName, applyMap);
                pluginModule = getOwn(defined, prefix);
            }

            //Account for relative paths if there is a base name.
            if (name) {
                if (prefix) {
                    if (pluginModule && pluginModule.normalize) {
                        //Plugin is loaded, use its normalize method.
                        normalizedName = pluginModule.normalize(name, function (name) {
                            return normalize(name, parentName, applyMap);
                        });
                    } else {
                        normalizedName = normalize(name, parentName, applyMap);
                    }
                } else {
                    //A regular module.
                    normalizedName = normalize(name, parentName, applyMap);

                    //Normalized name may be a plugin ID due to map config
                    //application in normalize. The map config values must
                    //already be normalized, so do not need to redo that part.
                    nameParts = splitPrefix(normalizedName);
                    prefix = nameParts[0];
                    normalizedName = nameParts[1];
                    isNormalized = true;

                    url = context.nameToUrl(normalizedName);
                }
            }

            //If the id is a plugin id that cannot be determined if it needs
            //normalization, stamp it with a unique ID so two matching relative
            //ids that may conflict can be separate.
            suffix = prefix && !pluginModule && !isNormalized ?
                     '_unnormalized' + (unnormalizedCounter += 1) :
                     '';

            return {
                prefix: prefix,
                name: normalizedName,
                parentMap: parentModuleMap,
                unnormalized: !!suffix,
                url: url,
                originalName: originalName,
                isDefine: isDefine,
                id: (prefix ?
                        prefix + '!' + normalizedName :
                        normalizedName) + suffix
            };
        }

        function getModule(depMap) {
            var id = depMap.id,
                mod = getOwn(registry, id);

            if (!mod) {
                mod = registry[id] = new context.Module(depMap);
            }

            return mod;
        }

        function on(depMap, name, fn) {
            var id = depMap.id,
                mod = getOwn(registry, id);

            if (hasProp(defined, id) &&
                    (!mod || mod.defineEmitComplete)) {
                if (name === 'defined') {
                    fn(defined[id]);
                }
            } else {
                getModule(depMap).on(name, fn);
            }
        }

        function onError(err, errback) {
            var ids = err.requireModules,
                notified = false;

            if (errback) {
                errback(err);
            } else {
                each(ids, function (id) {
                    var mod = getOwn(registry, id);
                    if (mod) {
                        //Set error on module, so it skips timeout checks.
                        mod.error = err;
                        if (mod.events.error) {
                            notified = true;
                            mod.emit('error', err);
                        }
                    }
                });

                if (!notified) {
                    req.onError(err);
                }
            }
        }

        /**
         * Internal method to transfer globalQueue items to this context's
         * defQueue.
         */
        function takeGlobalQueue() {
            //Push all the globalDefQueue items into the context's defQueue
            if (globalDefQueue.length) {
                //Array splice in the values since the context code has a
                //local var ref to defQueue, so cannot just reassign the one
                //on context.
                apsp.apply(defQueue,
                           [defQueue.length - 1, 0].concat(globalDefQueue));
                globalDefQueue = [];
            }
        }

        handlers = {
            'require': function (mod) {
                if (mod.require) {
                    return mod.require;
                } else {
                    return (mod.require = context.makeRequire(mod.map));
                }
            },
            'exports': function (mod) {
                mod.usingExports = true;
                if (mod.map.isDefine) {
                    if (mod.exports) {
                        return mod.exports;
                    } else {
                        return (mod.exports = defined[mod.map.id] = {});
                    }
                }
            },
            'module': function (mod) {
                if (mod.module) {
                    return mod.module;
                } else {
                    return (mod.module = {
                        id: mod.map.id,
                        uri: mod.map.url,
                        config: function () {
                            return (config.config && getOwn(config.config, mod.map.id)) || {};
                        },
                        exports: defined[mod.map.id]
                    });
                }
            }
        };

        function cleanRegistry(id) {
            //Clean up machinery used for waiting modules.
            delete registry[id];
        }

        function breakCycle(mod, traced, processed) {
            var id = mod.map.id;

            if (mod.error) {
                mod.emit('error', mod.error);
            } else {
                traced[id] = true;
                each(mod.depMaps, function (depMap, i) {
                    var depId = depMap.id,
                        dep = getOwn(registry, depId);

                    //Only force things that have not completed
                    //being defined, so still in the registry,
                    //and only if it has not been matched up
                    //in the module already.
                    if (dep && !mod.depMatched[i] && !processed[depId]) {
                        if (getOwn(traced, depId)) {
                            mod.defineDep(i, defined[depId]);
                            mod.check(); //pass false?
                        } else {
                            breakCycle(dep, traced, processed);
                        }
                    }
                });
                processed[id] = true;
            }
        }

        function checkLoaded() {
            var map, modId, err, usingPathFallback,
                waitInterval = config.waitSeconds * 1000,
                //It is possible to disable the wait interval by using waitSeconds of 0.
                expired = waitInterval && (context.startTime + waitInterval) < new Date().getTime(),
                noLoads = [],
                reqCalls = [],
                stillLoading = false,
                needCycleCheck = true;

            //Do not bother if this call was a result of a cycle break.
            if (inCheckLoaded) {
                return;
            }

            inCheckLoaded = true;

            //Figure out the state of all the modules.
            eachProp(registry, function (mod) {
                map = mod.map;
                modId = map.id;

                //Skip things that are not enabled or in error state.
                if (!mod.enabled) {
                    return;
                }

                if (!map.isDefine) {
                    reqCalls.push(mod);
                }

                if (!mod.error) {
                    //If the module should be executed, and it has not
                    //been inited and time is up, remember it.
                    if (!mod.inited && expired) {
                        if (hasPathFallback(modId)) {
                            usingPathFallback = true;
                            stillLoading = true;
                        } else {
                            noLoads.push(modId);
                            removeScript(modId);
                        }
                    } else if (!mod.inited && mod.fetched && map.isDefine) {
                        stillLoading = true;
                        if (!map.prefix) {
                            //No reason to keep looking for unfinished
                            //loading. If the only stillLoading is a
                            //plugin resource though, keep going,
                            //because it may be that a plugin resource
                            //is waiting on a non-plugin cycle.
                            return (needCycleCheck = false);
                        }
                    }
                }
            });

            if (expired && noLoads.length) {
                //If wait time expired, throw error of unloaded modules.
                err = makeError('timeout', 'Load timeout for modules: ' + noLoads, null, noLoads);
                err.contextName = context.contextName;
                return onError(err);
            }

            //Not expired, check for a cycle.
            if (needCycleCheck) {
                each(reqCalls, function (mod) {
                    breakCycle(mod, {}, {});
                });
            }

            //If still waiting on loads, and the waiting load is something
            //other than a plugin resource, or there are still outstanding
            //scripts, then just try back later.
            if ((!expired || usingPathFallback) && stillLoading) {
                //Something is still waiting to load. Wait for it, but only
                //if a timeout is not already in effect.
                if ((isBrowser || isWebWorker) && !checkLoadedTimeoutId) {
                    checkLoadedTimeoutId = setTimeout(function () {
                        checkLoadedTimeoutId = 0;
                        checkLoaded();
                    }, 50);
                }
            }

            inCheckLoaded = false;
        }

        Module = function (map) {
            this.events = getOwn(undefEvents, map.id) || {};
            this.map = map;
            this.shim = getOwn(config.shim, map.id);
            this.depExports = [];
            this.depMaps = [];
            this.depMatched = [];
            this.pluginMaps = {};
            this.depCount = 0;

            /* this.exports this.factory
               this.depMaps = [],
               this.enabled, this.fetched
            */
        };

        Module.prototype = {
            init: function (depMaps, factory, errback, options) {
                options = options || {};

                //Do not do more inits if already done. Can happen if there
                //are multiple define calls for the same module. That is not
                //a normal, common case, but it is also not unexpected.
                if (this.inited) {
                    return;
                }

                this.factory = factory;

                if (errback) {
                    //Register for errors on this module.
                    this.on('error', errback);
                } else if (this.events.error) {
                    //If no errback already, but there are error listeners
                    //on this module, set up an errback to pass to the deps.
                    errback = bind(this, function (err) {
                        this.emit('error', err);
                    });
                }

                //Do a copy of the dependency array, so that
                //source inputs are not modified. For example
                //"shim" deps are passed in here directly, and
                //doing a direct modification of the depMaps array
                //would affect that config.
                this.depMaps = depMaps && depMaps.slice(0);

                this.errback = errback;

                //Indicate this module has be initialized
                this.inited = true;

                this.ignore = options.ignore;

                //Could have option to init this module in enabled mode,
                //or could have been previously marked as enabled. However,
                //the dependencies are not known until init is called. So
                //if enabled previously, now trigger dependencies as enabled.
                if (options.enabled || this.enabled) {
                    //Enable this module and dependencies.
                    //Will call this.check()
                    this.enable();
                } else {
                    this.check();
                }
            },

            defineDep: function (i, depExports) {
                //Because of cycles, defined callback for a given
                //export can be called more than once.
                if (!this.depMatched[i]) {
                    this.depMatched[i] = true;
                    this.depCount -= 1;
                    this.depExports[i] = depExports;
                }
            },

            fetch: function () {
                if (this.fetched) {
                    return;
                }
                this.fetched = true;

                context.startTime = (new Date()).getTime();

                var map = this.map;

                //If the manager is for a plugin managed resource,
                //ask the plugin to load it now.
                if (this.shim) {
                    context.makeRequire(this.map, {
                        enableBuildCallback: true
                    })(this.shim.deps || [], bind(this, function () {
                        return map.prefix ? this.callPlugin() : this.load();
                    }));
                } else {
                    //Regular dependency.
                    return map.prefix ? this.callPlugin() : this.load();
                }
            },

            load: function () {
                var url = this.map.url;

                //Regular dependency.
                if (!urlFetched[url]) {
                    urlFetched[url] = true;
                    context.load(this.map.id, url);
                }
            },

            /**
             * Checks is the module is ready to define itself, and if so,
             * define it.
             */
            check: function () {
                if (!this.enabled || this.enabling) {
                    return;
                }

                var err, cjsModule,
                    id = this.map.id,
                    depExports = this.depExports,
                    exports = this.exports,
                    factory = this.factory;

                if (!this.inited) {
                    this.fetch();
                } else if (this.error) {
                    this.emit('error', this.error);
                } else if (!this.defining) {
                    //The factory could trigger another require call
                    //that would result in checking this module to
                    //define itself again. If already in the process
                    //of doing that, skip this work.
                    this.defining = true;

                    if (this.depCount < 1 && !this.defined) {
                        if (isFunction(factory)) {
                            //If there is an error listener, favor passing
                            //to that instead of throwing an error.
                            if (this.events.error) {
                                try {
                                    exports = context.execCb(id, factory, depExports, exports);
                                } catch (e) {
                                    err = e;
                                }
                            } else {
                                exports = context.execCb(id, factory, depExports, exports);
                            }

                            if (this.map.isDefine) {
                                //If setting exports via 'module' is in play,
                                //favor that over return value and exports. After that,
                                //favor a non-undefined return value over exports use.
                                cjsModule = this.module;
                                if (cjsModule &&
                                        cjsModule.exports !== undefined &&
                                        //Make sure it is not already the exports value
                                        cjsModule.exports !== this.exports) {
                                    exports = cjsModule.exports;
                                } else if (exports === undefined && this.usingExports) {
                                    //exports already set the defined value.
                                    exports = this.exports;
                                }
                            }

                            if (err) {
                                err.requireMap = this.map;
                                err.requireModules = [this.map.id];
                                err.requireType = 'define';
                                return onError((this.error = err));
                            }

                        } else {
                            //Just a literal value
                            exports = factory;
                        }

                        this.exports = exports;

                        if (this.map.isDefine && !this.ignore) {
                            defined[id] = exports;

                            if (req.onResourceLoad) {
                                req.onResourceLoad(context, this.map, this.depMaps);
                            }
                        }

                        //Clean up
                        delete registry[id];

                        this.defined = true;
                    }

                    //Finished the define stage. Allow calling check again
                    //to allow define notifications below in the case of a
                    //cycle.
                    this.defining = false;

                    if (this.defined && !this.defineEmitted) {
                        this.defineEmitted = true;
                        this.emit('defined', this.exports);
                        this.defineEmitComplete = true;
                    }

                }
            },

            callPlugin: function () {
                var map = this.map,
                    id = map.id,
                    //Map already normalized the prefix.
                    pluginMap = makeModuleMap(map.prefix);

                //Mark this as a dependency for this plugin, so it
                //can be traced for cycles.
                this.depMaps.push(pluginMap);

                on(pluginMap, 'defined', bind(this, function (plugin) {
                    var load, normalizedMap, normalizedMod,
                        name = this.map.name,
                        parentName = this.map.parentMap ? this.map.parentMap.name : null,
                        localRequire = context.makeRequire(map.parentMap, {
                            enableBuildCallback: true,
                            skipMap: true
                        });

                    //If current map is not normalized, wait for that
                    //normalized name to load instead of continuing.
                    if (this.map.unnormalized) {
                        //Normalize the ID if the plugin allows it.
                        if (plugin.normalize) {
                            name = plugin.normalize(name, function (name) {
                                return normalize(name, parentName, true);
                            }) || '';
                        }

                        //prefix and name should already be normalized, no need
                        //for applying map config again either.
                        normalizedMap = makeModuleMap(map.prefix + '!' + name,
                                                      this.map.parentMap);
                        on(normalizedMap,
                            'defined', bind(this, function (value) {
                                this.init([], function () { return value; }, null, {
                                    enabled: true,
                                    ignore: true
                                });
                            }));

                        normalizedMod = getOwn(registry, normalizedMap.id);
                        if (normalizedMod) {
                            //Mark this as a dependency for this plugin, so it
                            //can be traced for cycles.
                            this.depMaps.push(normalizedMap);

                            if (this.events.error) {
                                normalizedMod.on('error', bind(this, function (err) {
                                    this.emit('error', err);
                                }));
                            }
                            normalizedMod.enable();
                        }

                        return;
                    }

                    load = bind(this, function (value) {
                        this.init([], function () { return value; }, null, {
                            enabled: true
                        });
                    });

                    load.error = bind(this, function (err) {
                        this.inited = true;
                        this.error = err;
                        err.requireModules = [id];

                        //Remove temp unnormalized modules for this module,
                        //since they will never be resolved otherwise now.
                        eachProp(registry, function (mod) {
                            if (mod.map.id.indexOf(id + '_unnormalized') === 0) {
                                cleanRegistry(mod.map.id);
                            }
                        });

                        onError(err);
                    });

                    //Allow plugins to load other code without having to know the
                    //context or how to 'complete' the load.
                    load.fromText = bind(this, function (text, textAlt) {
                        /*jslint evil: true */
                        var moduleName = map.name,
                            moduleMap = makeModuleMap(moduleName),
                            hasInteractive = useInteractive;

                        //As of 2.1.0, support just passing the text, to reinforce
                        //fromText only being called once per resource. Still
                        //support old style of passing moduleName but discard
                        //that moduleName in favor of the internal ref.
                        if (textAlt) {
                            text = textAlt;
                        }

                        //Turn off interactive script matching for IE for any define
                        //calls in the text, then turn it back on at the end.
                        if (hasInteractive) {
                            useInteractive = false;
                        }

                        //Prime the system by creating a module instance for
                        //it.
                        getModule(moduleMap);

                        //Transfer any config to this other module.
                        if (hasProp(config.config, id)) {
                            config.config[moduleName] = config.config[id];
                        }

                        try {
                            req.exec(text);
                        } catch (e) {
                            throw new Error('fromText eval for ' + moduleName +
                                            ' failed: ' + e);
                        }

                        if (hasInteractive) {
                            useInteractive = true;
                        }

                        //Mark this as a dependency for the plugin
                        //resource
                        this.depMaps.push(moduleMap);

                        //Support anonymous modules.
                        context.completeLoad(moduleName);

                        //Bind the value of that module to the value for this
                        //resource ID.
                        localRequire([moduleName], load);
                    });

                    //Use parentName here since the plugin's name is not reliable,
                    //could be some weird string with no path that actually wants to
                    //reference the parentName's path.
                    plugin.load(map.name, localRequire, load, config);
                }));

                context.enable(pluginMap, this);
                this.pluginMaps[pluginMap.id] = pluginMap;
            },

            enable: function () {
                this.enabled = true;

                //Set flag mentioning that the module is enabling,
                //so that immediate calls to the defined callbacks
                //for dependencies do not trigger inadvertent load
                //with the depCount still being zero.
                this.enabling = true;

                //Enable each dependency
                each(this.depMaps, bind(this, function (depMap, i) {
                    var id, mod, handler;

                    if (typeof depMap === 'string') {
                        //Dependency needs to be converted to a depMap
                        //and wired up to this module.
                        depMap = makeModuleMap(depMap,
                                               (this.map.isDefine ? this.map : this.map.parentMap),
                                               false,
                                               !this.skipMap);
                        this.depMaps[i] = depMap;

                        handler = getOwn(handlers, depMap.id);

                        if (handler) {
                            this.depExports[i] = handler(this);
                            return;
                        }

                        this.depCount += 1;

                        on(depMap, 'defined', bind(this, function (depExports) {
                            this.defineDep(i, depExports);
                            this.check();
                        }));

                        if (this.errback) {
                            on(depMap, 'error', this.errback);
                        }
                    }

                    id = depMap.id;
                    mod = registry[id];

                    //Skip special modules like 'require', 'exports', 'module'
                    //Also, don't call enable if it is already enabled,
                    //important in circular dependency cases.
                    if (!hasProp(handlers, id) && mod && !mod.enabled) {
                        context.enable(depMap, this);
                    }
                }));

                //Enable each plugin that is used in
                //a dependency
                eachProp(this.pluginMaps, bind(this, function (pluginMap) {
                    var mod = getOwn(registry, pluginMap.id);
                    if (mod && !mod.enabled) {
                        context.enable(pluginMap, this);
                    }
                }));

                this.enabling = false;

                this.check();
            },

            on: function (name, cb) {
                var cbs = this.events[name];
                if (!cbs) {
                    cbs = this.events[name] = [];
                }
                cbs.push(cb);
            },

            emit: function (name, evt) {
                each(this.events[name], function (cb) {
                    cb(evt);
                });
                if (name === 'error') {
                    //Now that the error handler was triggered, remove
                    //the listeners, since this broken Module instance
                    //can stay around for a while in the registry.
                    delete this.events[name];
                }
            }
        };

        function callGetModule(args) {
            //Skip modules already defined.
            if (!hasProp(defined, args[0])) {
                getModule(makeModuleMap(args[0], null, true)).init(args[1], args[2]);
            }
        }

        function removeListener(node, func, name, ieName) {
            //Favor detachEvent because of IE9
            //issue, see attachEvent/addEventListener comment elsewhere
            //in this file.
            if (node.detachEvent && !isOpera) {
                //Probably IE. If not it will throw an error, which will be
                //useful to know.
                if (ieName) {
                    node.detachEvent(ieName, func);
                }
            } else {
                node.removeEventListener(name, func, false);
            }
        }

        /**
         * Given an event from a script node, get the requirejs info from it,
         * and then removes the event listeners on the node.
         * @param {Event} evt
         * @returns {Object}
         */
        function getScriptData(evt) {
            //Using currentTarget instead of target for Firefox 2.0's sake. Not
            //all old browsers will be supported, but this one was easy enough
            //to support and still makes sense.
            var node = evt.currentTarget || evt.srcElement;

            //Remove the listeners once here.
            removeListener(node, context.onScriptLoad, 'load', 'onreadystatechange');
            removeListener(node, context.onScriptError, 'error');

            return {
                node: node,
                id: node && node.getAttribute('data-requiremodule')
            };
        }

        function intakeDefines() {
            var args;

            //Any defined modules in the global queue, intake them now.
            takeGlobalQueue();

            //Make sure any remaining defQueue items get properly processed.
            while (defQueue.length) {
                args = defQueue.shift();
                if (args[0] === null) {
                    return onError(makeError('mismatch', 'Mismatched anonymous define() module: ' + args[args.length - 1]));
                } else {
                    //args are id, deps, factory. Should be normalized by the
                    //define() function.
                    callGetModule(args);
                }
            }
        }

        context = {
            config: config,
            contextName: contextName,
            registry: registry,
            defined: defined,
            urlFetched: urlFetched,
            defQueue: defQueue,
            Module: Module,
            makeModuleMap: makeModuleMap,
            nextTick: req.nextTick,

            /**
             * Set a configuration for the context.
             * @param {Object} cfg config object to integrate.
             */
            configure: function (cfg) {
                //Make sure the baseUrl ends in a slash.
                if (cfg.baseUrl) {
                    if (cfg.baseUrl.charAt(cfg.baseUrl.length - 1) !== '/') {
                        cfg.baseUrl += '/';
                    }
                }

                //Save off the paths and packages since they require special processing,
                //they are additive.
                var pkgs = config.pkgs,
                    shim = config.shim,
                    objs = {
                        paths: true,
                        config: true,
                        map: true
                    };

                eachProp(cfg, function (value, prop) {
                    if (objs[prop]) {
                        if (prop === 'map') {
                            mixin(config[prop], value, true, true);
                        } else {
                            mixin(config[prop], value, true);
                        }
                    } else {
                        config[prop] = value;
                    }
                });

                //Merge shim
                if (cfg.shim) {
                    eachProp(cfg.shim, function (value, id) {
                        //Normalize the structure
                        if (isArray(value)) {
                            value = {
                                deps: value
                            };
                        }
                        if ((value.exports || value.init) && !value.exportsFn) {
                            value.exportsFn = context.makeShimExports(value);
                        }
                        shim[id] = value;
                    });
                    config.shim = shim;
                }

                //Adjust packages if necessary.
                if (cfg.packages) {
                    each(cfg.packages, function (pkgObj) {
                        var location;

                        pkgObj = typeof pkgObj === 'string' ? { name: pkgObj } : pkgObj;
                        location = pkgObj.location;

                        //Create a brand new object on pkgs, since currentPackages can
                        //be passed in again, and config.pkgs is the internal transformed
                        //state for all package configs.
                        pkgs[pkgObj.name] = {
                            name: pkgObj.name,
                            location: location || pkgObj.name,
                            //Remove leading dot in main, so main paths are normalized,
                            //and remove any trailing .js, since different package
                            //envs have different conventions: some use a module name,
                            //some use a file name.
                            main: (pkgObj.main || 'main')
                                  .replace(currDirRegExp, '')
                                  .replace(jsSuffixRegExp, '')
                        };
                    });

                    //Done with modifications, assing packages back to context config
                    config.pkgs = pkgs;
                }

                //If there are any "waiting to execute" modules in the registry,
                //update the maps for them, since their info, like URLs to load,
                //may have changed.
                eachProp(registry, function (mod, id) {
                    //If module already has init called, since it is too
                    //late to modify them, and ignore unnormalized ones
                    //since they are transient.
                    if (!mod.inited && !mod.map.unnormalized) {
                        mod.map = makeModuleMap(id);
                    }
                });

                //If a deps array or a config callback is specified, then call
                //require with those args. This is useful when require is defined as a
                //config object before require.js is loaded.
                if (cfg.deps || cfg.callback) {
                    context.require(cfg.deps || [], cfg.callback);
                }
            },

            makeShimExports: function (value) {
                function fn() {
                    var ret;
                    if (value.init) {
                        ret = value.init.apply(global, arguments);
                    }
                    return ret || (value.exports && getGlobal(value.exports));
                }
                return fn;
            },

            makeRequire: function (relMap, options) {
                options = options || {};

                function localRequire(deps, callback, errback) {
                    var id, map, requireMod;

                    if (options.enableBuildCallback && callback && isFunction(callback)) {
                        callback.__requireJsBuild = true;
                    }

                    if (typeof deps === 'string') {
                        if (isFunction(callback)) {
                            //Invalid call
                            return onError(makeError('requireargs', 'Invalid require call'), errback);
                        }

                        //If require|exports|module are requested, get the
                        //value for them from the special handlers. Caveat:
                        //this only works while module is being defined.
                        if (relMap && hasProp(handlers, deps)) {
                            return handlers[deps](registry[relMap.id]);
                        }

                        //Synchronous access to one module. If require.get is
                        //available (as in the Node adapter), prefer that.
                        if (req.get) {
                            return req.get(context, deps, relMap);
                        }

                        //Normalize module name, if it contains . or ..
                        map = makeModuleMap(deps, relMap, false, true);
                        id = map.id;

                        if (!hasProp(defined, id)) {
                            return onError(makeError('notloaded', 'Module name "' +
                                        id +
                                        '" has not been loaded yet for context: ' +
                                        contextName +
                                        (relMap ? '' : '. Use require([])')));
                        }
                        return defined[id];
                    }

                    //Grab defines waiting in the global queue.
                    intakeDefines();

                    //Mark all the dependencies as needing to be loaded.
                    context.nextTick(function () {
                        //Some defines could have been added since the
                        //require call, collect them.
                        intakeDefines();

                        requireMod = getModule(makeModuleMap(null, relMap));

                        //Store if map config should be applied to this require
                        //call for dependencies.
                        requireMod.skipMap = options.skipMap;

                        requireMod.init(deps, callback, errback, {
                            enabled: true
                        });

                        checkLoaded();
                    });

                    return localRequire;
                }

                mixin(localRequire, {
                    isBrowser: isBrowser,

                    /**
                     * Converts a module name + .extension into an URL path.
                     * *Requires* the use of a module name. It does not support using
                     * plain URLs like nameToUrl.
                     */
                    toUrl: function (moduleNamePlusExt) {
                        var index = moduleNamePlusExt.lastIndexOf('.'),
                            ext = null;

                        if (index !== -1) {
                            ext = moduleNamePlusExt.substring(index, moduleNamePlusExt.length);
                            moduleNamePlusExt = moduleNamePlusExt.substring(0, index);
                        }

                        return context.nameToUrl(normalize(moduleNamePlusExt,
                                                relMap && relMap.id, true), ext);
                    },

                    defined: function (id) {
                        return hasProp(defined, makeModuleMap(id, relMap, false, true).id);
                    },

                    specified: function (id) {
                        id = makeModuleMap(id, relMap, false, true).id;
                        return hasProp(defined, id) || hasProp(registry, id);
                    }
                });

                //Only allow undef on top level require calls
                if (!relMap) {
                    localRequire.undef = function (id) {
                        //Bind any waiting define() calls to this context,
                        //fix for #408
                        takeGlobalQueue();

                        var map = makeModuleMap(id, relMap, true),
                            mod = getOwn(registry, id);

                        delete defined[id];
                        delete urlFetched[map.url];
                        delete undefEvents[id];

                        if (mod) {
                            //Hold on to listeners in case the
                            //module will be attempted to be reloaded
                            //using a different config.
                            if (mod.events.defined) {
                                undefEvents[id] = mod.events;
                            }

                            cleanRegistry(id);
                        }
                    };
                }

                return localRequire;
            },

            /**
             * Called to enable a module if it is still in the registry
             * awaiting enablement. parent module is passed in for context,
             * used by the optimizer.
             */
            enable: function (depMap, parent) {
                var mod = getOwn(registry, depMap.id);
                if (mod) {
                    getModule(depMap).enable();
                }
            },

            /**
             * Internal method used by environment adapters to complete a load event.
             * A load event could be a script load or just a load pass from a synchronous
             * load call.
             * @param {String} moduleName the name of the module to potentially complete.
             */
            completeLoad: function (moduleName) {
                var found, args, mod,
                    shim = getOwn(config.shim, moduleName) || {},
                    shExports = shim.exports;

                takeGlobalQueue();

                while (defQueue.length) {
                    args = defQueue.shift();
                    if (args[0] === null) {
                        args[0] = moduleName;
                        //If already found an anonymous module and bound it
                        //to this name, then this is some other anon module
                        //waiting for its completeLoad to fire.
                        if (found) {
                            break;
                        }
                        found = true;
                    } else if (args[0] === moduleName) {
                        //Found matching define call for this script!
                        found = true;
                    }

                    callGetModule(args);
                }

                //Do this after the cycle of callGetModule in case the result
                //of those calls/init calls changes the registry.
                mod = getOwn(registry, moduleName);

                if (!found && !hasProp(defined, moduleName) && mod && !mod.inited) {
                    if (config.enforceDefine && (!shExports || !getGlobal(shExports))) {
                        if (hasPathFallback(moduleName)) {
                            return;
                        } else {
                            return onError(makeError('nodefine',
                                             'No define call for ' + moduleName,
                                             null,
                                             [moduleName]));
                        }
                    } else {
                        //A script that does not call define(), so just simulate
                        //the call for it.
                        callGetModule([moduleName, (shim.deps || []), shim.exportsFn]);
                    }
                }

                checkLoaded();
            },

            /**
             * Converts a module name to a file path. Supports cases where
             * moduleName may actually be just an URL.
             * Note that it **does not** call normalize on the moduleName,
             * it is assumed to have already been normalized. This is an
             * internal API, not a public one. Use toUrl for the public API.
             */
            nameToUrl: function (moduleName, ext) {
                var paths, pkgs, pkg, pkgPath, syms, i, parentModule, url,
                    parentPath;

                //If a colon is in the URL, it indicates a protocol is used and it is just
                //an URL to a file, or if it starts with a slash, contains a query arg (i.e. ?)
                //or ends with .js, then assume the user meant to use an url and not a module id.
                //The slash is important for protocol-less URLs as well as full paths.
                if (req.jsExtRegExp.test(moduleName)) {
                    //Just a plain path, not module name lookup, so just return it.
                    //Add extension if it is included. This is a bit wonky, only non-.js things pass
                    //an extension, this method probably needs to be reworked.
                    url = moduleName + (ext || '');
                } else {
                    //A module that needs to be converted to a path.
                    paths = config.paths;
                    pkgs = config.pkgs;

                    syms = moduleName.split('/');
                    //For each module name segment, see if there is a path
                    //registered for it. Start with most specific name
                    //and work up from it.
                    for (i = syms.length; i > 0; i -= 1) {
                        parentModule = syms.slice(0, i).join('/');
                        pkg = getOwn(pkgs, parentModule);
                        parentPath = getOwn(paths, parentModule);
                        if (parentPath) {
                            //If an array, it means there are a few choices,
                            //Choose the one that is desired
                            if (isArray(parentPath)) {
                                parentPath = parentPath[0];
                            }
                            syms.splice(0, i, parentPath);
                            break;
                        } else if (pkg) {
                            //If module name is just the package name, then looking
                            //for the main module.
                            if (moduleName === pkg.name) {
                                pkgPath = pkg.location + '/' + pkg.main;
                            } else {
                                pkgPath = pkg.location;
                            }
                            syms.splice(0, i, pkgPath);
                            break;
                        }
                    }

                    //Join the path parts together, then figure out if baseUrl is needed.
                    url = syms.join('/');
                    url += (ext || (/\?/.test(url) ? '' : '.js'));
                    url = (url.charAt(0) === '/' || url.match(/^[\w\+\.\-]+:/) ? '' : config.baseUrl) + url;
                }

                return config.urlArgs ? url +
                                        ((url.indexOf('?') === -1 ? '?' : '&') +
                                         config.urlArgs) : url;
            },

            //Delegates to req.load. Broken out as a separate function to
            //allow overriding in the optimizer.
            load: function (id, url) {
                req.load(context, id, url);
            },

            /**
             * Executes a module callack function. Broken out as a separate function
             * solely to allow the build system to sequence the files in the built
             * layer in the right sequence.
             *
             * @private
             */
            execCb: function (name, callback, args, exports) {
                return callback.apply(exports, args);
            },

            /**
             * callback for script loads, used to check status of loading.
             *
             * @param {Event} evt the event from the browser for the script
             * that was loaded.
             */
            onScriptLoad: function (evt) {
                //Using currentTarget instead of target for Firefox 2.0's sake. Not
                //all old browsers will be supported, but this one was easy enough
                //to support and still makes sense.
                if (evt.type === 'load' ||
                        (readyRegExp.test((evt.currentTarget || evt.srcElement).readyState))) {
                    //Reset interactive script so a script node is not held onto for
                    //to long.
                    interactiveScript = null;

                    //Pull out the name of the module and the context.
                    var data = getScriptData(evt);
                    context.completeLoad(data.id);
                }
            },

            /**
             * Callback for script errors.
             */
            onScriptError: function (evt) {
                var data = getScriptData(evt);
                if (!hasPathFallback(data.id)) {
                    return onError(makeError('scripterror', 'Script error', evt, [data.id]));
                }
            }
        };

        context.require = context.makeRequire();
        return context;
    }

    /**
     * Main entry point.
     *
     * If the only argument to require is a string, then the module that
     * is represented by that string is fetched for the appropriate context.
     *
     * If the first argument is an array, then it will be treated as an array
     * of dependency string names to fetch. An optional function callback can
     * be specified to execute when all of those dependencies are available.
     *
     * Make a local req variable to help Caja compliance (it assumes things
     * on a require that are not standardized), and to give a short
     * name for minification/local scope use.
     */
    req = requirejs = function (deps, callback, errback, optional) {

        //Find the right context, use default
        var context, config,
            contextName = defContextName;

        // Determine if have config object in the call.
        if (!isArray(deps) && typeof deps !== 'string') {
            // deps is a config object
            config = deps;
            if (isArray(callback)) {
                // Adjust args if there are dependencies
                deps = callback;
                callback = errback;
                errback = optional;
            } else {
                deps = [];
            }
        }

        if (config && config.context) {
            contextName = config.context;
        }

        context = getOwn(contexts, contextName);
        if (!context) {
            context = contexts[contextName] = req.s.newContext(contextName);
        }

        if (config) {
            context.configure(config);
        }

        return context.require(deps, callback, errback);
    };

    /**
     * Support require.config() to make it easier to cooperate with other
     * AMD loaders on globally agreed names.
     */
    req.config = function (config) {
        return req(config);
    };

    /**
     * Execute something after the current tick
     * of the event loop. Override for other envs
     * that have a better solution than setTimeout.
     * @param  {Function} fn function to execute later.
     */
    req.nextTick = typeof setTimeout !== 'undefined' ? function (fn) {
        setTimeout(fn, 4);
    } : function (fn) { fn(); };

    /**
     * Export require as a global, but only if it does not already exist.
     */
    if (!require) {
        require = req;
    }

    req.version = version;

    //Used to filter out dependencies that are already paths.
    req.jsExtRegExp = /^\/|:|\?|\.js$/;
    req.isBrowser = isBrowser;
    s = req.s = {
        contexts: contexts,
        newContext: newContext
    };

    //Create default context.
    req({});

    //Exports some context-sensitive methods on global require.
    each([
        'toUrl',
        'undef',
        'defined',
        'specified'
    ], function (prop) {
        //Reference from contexts instead of early binding to default context,
        //so that during builds, the latest instance of the default context
        //with its config gets used.
        req[prop] = function () {
            var ctx = contexts[defContextName];
            return ctx.require[prop].apply(ctx, arguments);
        };
    });

    if (isBrowser) {
        head = s.head = document.getElementsByTagName('head')[0];
        //If BASE tag is in play, using appendChild is a problem for IE6.
        //When that browser dies, this can be removed. Details in this jQuery bug:
        //http://dev.jquery.com/ticket/2709
        baseElement = document.getElementsByTagName('base')[0];
        if (baseElement) {
            head = s.head = baseElement.parentNode;
        }
    }

    /**
     * Any errors that require explicitly generates will be passed to this
     * function. Intercept/override it if you want custom error handling.
     * @param {Error} err the error object.
     */
    req.onError = function (err) {
        throw err;
    };

    /**
     * Does the request to load a module for the browser case.
     * Make this a separate function to allow other environments
     * to override it.
     *
     * @param {Object} context the require context to find state.
     * @param {String} moduleName the name of the module.
     * @param {Object} url the URL to the module.
     */
    req.load = function (context, moduleName, url) {
        var config = (context && context.config) || {},
            node;
        if (isBrowser) {
            //In the browser so use a script tag
            node = config.xhtml ?
                    document.createElementNS('http://www.w3.org/1999/xhtml', 'html:script') :
                    document.createElement('script');
            node.type = config.scriptType || 'text/javascript';
            node.charset = 'utf-8';
            node.async = true;

            node.setAttribute('data-requirecontext', context.contextName);
            node.setAttribute('data-requiremodule', moduleName);

            //Set up load listener. Test attachEvent first because IE9 has
            //a subtle issue in its addEventListener and script onload firings
            //that do not match the behavior of all other browsers with
            //addEventListener support, which fire the onload event for a
            //script right after the script execution. See:
            //https://connect.microsoft.com/IE/feedback/details/648057/script-onload-event-is-not-fired-immediately-after-script-execution
            //UNFORTUNATELY Opera implements attachEvent but does not follow the script
            //script execution mode.
            if (node.attachEvent &&
                    //Check if node.attachEvent is artificially added by custom script or
                    //natively supported by browser
                    //read https://github.com/jrburke/requirejs/issues/187
                    //if we can NOT find [native code] then it must NOT natively supported.
                    //in IE8, node.attachEvent does not have toString()
                    //Note the test for "[native code" with no closing brace, see:
                    //https://github.com/jrburke/requirejs/issues/273
                    !(node.attachEvent.toString && node.attachEvent.toString().indexOf('[native code') < 0) &&
                    !isOpera) {
                //Probably IE. IE (at least 6-8) do not fire
                //script onload right after executing the script, so
                //we cannot tie the anonymous define call to a name.
                //However, IE reports the script as being in 'interactive'
                //readyState at the time of the define call.
                useInteractive = true;

                node.attachEvent('onreadystatechange', context.onScriptLoad);
                //It would be great to add an error handler here to catch
                //404s in IE9+. However, onreadystatechange will fire before
                //the error handler, so that does not help. If addEvenListener
                //is used, then IE will fire error before load, but we cannot
                //use that pathway given the connect.microsoft.com issue
                //mentioned above about not doing the 'script execute,
                //then fire the script load event listener before execute
                //next script' that other browsers do.
                //Best hope: IE10 fixes the issues,
                //and then destroys all installs of IE 6-9.
                //node.attachEvent('onerror', context.onScriptError);
            } else {
                node.addEventListener('load', context.onScriptLoad, false);
                node.addEventListener('error', context.onScriptError, false);
            }
            node.src = url;

            //For some cache cases in IE 6-8, the script executes before the end
            //of the appendChild execution, so to tie an anonymous define
            //call to the module name (which is stored on the node), hold on
            //to a reference to this node, but clear after the DOM insertion.
            currentlyAddingScript = node;
            if (baseElement) {
                head.insertBefore(node, baseElement);
            } else {
                head.appendChild(node);
            }
            currentlyAddingScript = null;

            return node;
        } else if (isWebWorker) {
            //In a web worker, use importScripts. This is not a very
            //efficient use of importScripts, importScripts will block until
            //its script is downloaded and evaluated. However, if web workers
            //are in play, the expectation that a build has been done so that
            //only one script needs to be loaded anyway. This may need to be
            //reevaluated if other use cases become common.
            importScripts(url);

            //Account for anonymous modules
            context.completeLoad(moduleName);
        }
    };

    function getInteractiveScript() {
        if (interactiveScript && interactiveScript.readyState === 'interactive') {
            return interactiveScript;
        }

        eachReverse(scripts(), function (script) {
            if (script.readyState === 'interactive') {
                return (interactiveScript = script);
            }
        });
        return interactiveScript;
    }

    //Look for a data-main script attribute, which could also adjust the baseUrl.
    if (isBrowser) {
        //Figure out baseUrl. Get it from the script tag with require.js in it.
        eachReverse(scripts(), function (script) {
            //Set the 'head' where we can append children by
            //using the script's parent.
            if (!head) {
                head = script.parentNode;
            }

            //Look for a data-main attribute to set main script for the page
            //to load. If it is there, the path to data main becomes the
            //baseUrl, if it is not already set.
            dataMain = script.getAttribute('data-main');
            if (dataMain) {
                //Set final baseUrl if there is not already an explicit one.
                if (!cfg.baseUrl) {
                    //Pull off the directory of data-main for use as the
                    //baseUrl.
                    src = dataMain.split('/');
                    mainScript = src.pop();
                    subPath = src.length ? src.join('/')  + '/' : './';

                    cfg.baseUrl = subPath;
                    dataMain = mainScript;
                }

                //Strip off any trailing .js since dataMain is now
                //like a module name.
                dataMain = dataMain.replace(jsSuffixRegExp, '');

                //Put the data-main script in the files to load.
                cfg.deps = cfg.deps ? cfg.deps.concat(dataMain) : [dataMain];

                return true;
            }
        });
    }

    /**
     * The function that handles definitions of modules. Differs from
     * require() in that a string for the module should be the first argument,
     * and the function to execute after dependencies are loaded should
     * return a value to define the module corresponding to the first argument's
     * name.
     */
    define = function (name, deps, callback) {
        var node, context;

        //Allow for anonymous modules
        if (typeof name !== 'string') {
            //Adjust args appropriately
            callback = deps;
            deps = name;
            name = null;
        }

        //This module may not have dependencies
        if (!isArray(deps)) {
            callback = deps;
            deps = [];
        }

        //If no name, and callback is a function, then figure out if it a
        //CommonJS thing with dependencies.
        if (!deps.length && isFunction(callback)) {
            //Remove comments from the callback string,
            //look for require calls, and pull them into the dependencies,
            //but only if there are function args.
            if (callback.length) {
                callback
                    .toString()
                    .replace(commentRegExp, '')
                    .replace(cjsRequireRegExp, function (match, dep) {
                        deps.push(dep);
                    });

                //May be a CommonJS thing even without require calls, but still
                //could use exports, and module. Avoid doing exports and module
                //work though if it just needs require.
                //REQUIRES the function to expect the CommonJS variables in the
                //order listed below.
                deps = (callback.length === 1 ? ['require'] : ['require', 'exports', 'module']).concat(deps);
            }
        }

        //If in IE 6-8 and hit an anonymous define() call, do the interactive
        //work.
        if (useInteractive) {
            node = currentlyAddingScript || getInteractiveScript();
            if (node) {
                if (!name) {
                    name = node.getAttribute('data-requiremodule');
                }
                context = contexts[node.getAttribute('data-requirecontext')];
            }
        }

        //Always save off evaluating the def call until the script onload handler.
        //This allows multiple modules to be in a file without prematurely
        //tracing dependencies, and allows for anonymous module support,
        //where the module name is not known until the script onload event
        //occurs. If no context, use the global queue, and get it processed
        //in the onscript load callback.
        (context ? context.defQueue : globalDefQueue).push([name, deps, callback]);
    };

    define.amd = {
        jQuery: true
    };


    /**
     * Executes the text. Normally just uses eval, but can be modified
     * to use a better, environment-specific call. Only used for transpiling
     * loader plugins, not for plain JS modules.
     * @param {String} text the text to execute/evaluate.
     */
    req.exec = function (text) {
        /*jslint evil: true */
        return eval(text);
    };

    //Set up with config info.
    req(cfg);
}(this));

/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.1.4 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

/*!
 * jQuery JavaScript Library v1.9.0
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2012 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2013-1-14
 */

/*!
 * Sizzle CSS Selector Engine
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://sizzlejs.com/
 */

/*
The MIT License

Copyright (c) 2010-2011-2012 Ibon Tolosana [@hyperandroid]

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

Version: 0.6 build: 49

Created on:
DATE: 2013-04-03
TIME: 21:50:58
*/

/*

  Javascript State Machine Library - https://github.com/jakesgordon/javascript-state-machine

  Copyright (c) 2012, 2013 Jake Gordon and contributors
  Released under the MIT license - https://github.com/jakesgordon/javascript-state-machine/blob/master/LICENSE

*/

//     Underscore.js 1.4.4
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore may be freely distributed under the MIT license.

/*! Hammer.JS - v1.0.6dev - 2013-04-10
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2013 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */

function proxyFunction(e,t,n,r,i){return function(){var s=Array.prototype.slice.call(arguments);n&&n({object:e,method:t,arguments:s});var o=null;try{o=e[t].apply(e,s);if(r){var u=r({object:e,method:t,arguments:s});u&&(o=u)}}catch(a){if(!i)throw a;o=i({object:e,method:t,arguments:s,exception:a})}return o}}function proxyAttribute(e,t,n,r,i){e.__defineGetter__(n,function(){return r&&r(t,n),t[n]}),e.__defineSetter__(n,function(e){t[n]=e,i&&i(t,n,e)})}function proxyObject(e,t,n,r,i,s){if(typeof e!="object"||isArray(e)||isString(e)||e.$proxy)return e;var o={};o.$proxy=!0,o.$proxy_delegate=e;for(var u in e){if(u==="constructor")continue;typeof e[u]=="function"?o[u]=proxyFunction(e,u,t,n,r):proxyAttribute(o,e,u,i,s)}return o}var requirejs,require,define;(function(global){function isFunction(e){return ostring.call(e)==="[object Function]"}function isArray(e){return ostring.call(e)==="[object Array]"}function each(e,t){if(e){var n;for(n=0;n<e.length;n+=1)if(e[n]&&t(e[n],n,e))break}}function eachReverse(e,t){if(e){var n;for(n=e.length-1;n>-1;n-=1)if(e[n]&&t(e[n],n,e))break}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var n;for(n in e)if(hasProp(e,n)&&t(e[n],n))break}function mixin(e,t,n,r){return t&&eachProp(t,function(t,i){if(n||!hasProp(e,i))r&&typeof t!="string"?(e[i]||(e[i]={}),mixin(e[i],t,n,r)):e[i]=t}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,n,r){var i=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return i.requireType=e,i.requireModules=r,n&&(i.originalError=n),i}function newContext(e){function d(e){var t,n;for(t=0;e[t];t+=1){n=e[t];if(n===".")e.splice(t,1),t-=1;else if(n===".."){if(t===1&&(e[2]===".."||e[0]===".."))break;t>0&&(e.splice(t-1,2),t-=2)}}}function v(e,t,n){var r,i,s,u,a,f,l,c,h,p,v,m=t&&t.split("/"),g=m,y=o.map,b=y&&y["*"];e&&e.charAt(0)==="."&&(t?(getOwn(o.pkgs,t)?g=m=[t]:g=m.slice(0,m.length-1),e=g.concat(e.split("/")),d(e),i=getOwn(o.pkgs,r=e[0]),e=e.join("/"),i&&e===r+"/"+i.main&&(e=r)):e.indexOf("./")===0&&(e=e.substring(2)));if(n&&(m||b)&&y){u=e.split("/");for(a=u.length;a>0;a-=1){l=u.slice(0,a).join("/");if(m)for(f=m.length;f>0;f-=1){s=getOwn(y,m.slice(0,f).join("/"));if(s){s=getOwn(s,l);if(s){c=s,h=a;break}}}if(c)break;!p&&b&&getOwn(b,l)&&(p=getOwn(b,l),v=a)}!c&&p&&(c=p,h=v),c&&(u.splice(0,h,c),e=u.join("/"))}return e}function m(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===r.contextName)return t.parentNode.removeChild(t),!0})}function g(e){var t=getOwn(o.paths,e);if(t&&isArray(t)&&t.length>1)return m(e),t.shift(),r.require.undef(e),r.require([e]),!0}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e,t,n,i){var s,o,u,a,f=null,c=t?t.name:null,d=e,m=!0,g="";return e||(m=!1,e="_@r"+(h+=1)),a=y(e),f=a[0],e=a[1],f&&(f=v(f,c,i),o=getOwn(l,f)),e&&(f?o&&o.normalize?g=o.normalize(e,function(e){return v(e,c,i)}):g=v(e,c,i):(g=v(e,c,i),a=y(g),f=a[0],g=a[1],n=!0,s=r.nameToUrl(g))),u=f&&!o&&!n?"_unnormalized"+(p+=1):"",{prefix:f,name:g,parentMap:t,unnormalized:!!u,url:s,originalName:d,isDefine:m,id:(f?f+"!"+g:g)+u}}function w(e){var t=e.id,n=getOwn(u,t);return n||(n=u[t]=new r.Module(e)),n}function E(e,t,n){var r=e.id,i=getOwn(u,r);hasProp(l,r)&&(!i||i.defineEmitComplete)?t==="defined"&&n(l[r]):w(e).on(t,n)}function S(e,t){var n=e.requireModules,r=!1;t?t(e):(each(n,function(t){var n=getOwn(u,t);n&&(n.error=e,n.events.error&&(r=!0,n.emit("error",e)))}),r||req.onError(e))}function x(){globalDefQueue.length&&(apsp.apply(f,[f.length-1,0].concat(globalDefQueue)),globalDefQueue=[])}function T(e){delete u[e]}function N(e,t,n){var r=e.map.id;e.error?e.emit("error",e.error):(t[r]=!0,each(e.depMaps,function(r,i){var s=r.id,o=getOwn(u,s);o&&!e.depMatched[i]&&!n[s]&&(getOwn(t,s)?(e.defineDep(i,l[s]),e.check()):N(o,t,n))}),n[r]=!0)}function C(){var e,n,i,a,f=o.waitSeconds*1e3,l=f&&r.startTime+f<(new Date).getTime(),c=[],h=[],p=!1,d=!0;if(t)return;t=!0,eachProp(u,function(t){e=t.map,n=e.id;if(!t.enabled)return;e.isDefine||h.push(t);if(!t.error)if(!t.inited&&l)g(n)?(a=!0,p=!0):(c.push(n),m(n));else if(!t.inited&&t.fetched&&e.isDefine){p=!0;if(!e.prefix)return d=!1}});if(l&&c.length)return i=makeError("timeout","Load timeout for modules: "+c,null,c),i.contextName=r.contextName,S(i);d&&each(h,function(e){N(e,{},{})}),(!l||a)&&p&&(isBrowser||isWebWorker)&&!s&&(s=setTimeout(function(){s=0,C()},50)),t=!1}function k(e){hasProp(l,e[0])||w(b(e[0],null,!0)).init(e[1],e[2])}function L(e,t,n,r){e.detachEvent&&!isOpera?r&&e.detachEvent(r,t):e.removeEventListener(n,t,!1)}function A(e){var t=e.currentTarget||e.srcElement;return L(t,r.onScriptLoad,"load","onreadystatechange"),L(t,r.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function O(){var e;x();while(f.length){e=f.shift();if(e[0]===null)return S(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));k(e)}}var t,n,r,i,s,o={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},map:{},config:{}},u={},a={},f=[],l={},c={},h=1,p=1;return i={require:function(e){return e.require?e.require:e.require=r.makeRequire(e.map)},exports:function(e){e.usingExports=!0;if(e.map.isDefine)return e.exports?e.exports:e.exports=l[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return o.config&&getOwn(o.config,e.map.id)||{}},exports:l[e.map.id]}}},n=function(e){this.events=getOwn(a,e.id)||{},this.map=e,this.shim=getOwn(o.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},n.prototype={init:function(e,t,n,r){r=r||{};if(this.inited)return;this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=n,this.inited=!0,this.ignore=r.ignore,r.enabled||this.enabled?this.enable():this.check()},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(this.fetched)return;this.fetched=!0,r.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();r.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()}))},load:function(){var e=this.map.url;c[e]||(c[e]=!0,r.load(this.map.id,e))},check:function(){if(!this.enabled||this.enabling)return;var e,t,n=this.map.id,i=this.depExports,s=this.exports,o=this.factory;if(!this.inited)this.fetch();else if(this.error)this.emit("error",this.error);else if(!this.defining){this.defining=!0;if(this.depCount<1&&!this.defined){if(isFunction(o)){if(this.events.error)try{s=r.execCb(n,o,i,s)}catch(a){e=a}else s=r.execCb(n,o,i,s);this.map.isDefine&&(t=this.module,t&&t.exports!==undefined&&t.exports!==this.exports?s=t.exports:s===undefined&&this.usingExports&&(s=this.exports));if(e)return e.requireMap=this.map,e.requireModules=[this.map.id],e.requireType="define",S(this.error=e)}else s=o;this.exports=s,this.map.isDefine&&!this.ignore&&(l[n]=s,req.onResourceLoad&&req.onResourceLoad(r,this.map,this.depMaps)),delete u[n],this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}},callPlugin:function(){var e=this.map,t=e.id,n=b(e.prefix);this.depMaps.push(n),E(n,"defined",bind(this,function(n){var i,s,a,f=this.map.name,l=this.map.parentMap?this.map.parentMap.name:null,c=r.makeRequire(e.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){n.normalize&&(f=n.normalize(f,function(e){return v(e,l,!0)})||""),s=b(e.prefix+"!"+f,this.map.parentMap),E(s,"defined",bind(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),a=getOwn(u,s.id),a&&(this.depMaps.push(s),this.events.error&&a.on("error",bind(this,function(e){this.emit("error",e)})),a.enable());return}i=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),i.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(u,function(e){e.map.id.indexOf(t+"_unnormalized")===0&&T(e.map.id)}),S(e)}),i.fromText=bind(this,function(n,s){var u=e.name,a=b(u),f=useInteractive;s&&(n=s),f&&(useInteractive=!1),w(a),hasProp(o.config,t)&&(o.config[u]=o.config[t]);try{req.exec(n)}catch(l){return S(makeError("fromtexteval","fromText eval for "+t+" failed: "+l,l,[t]))}f&&(useInteractive=!0),this.depMaps.push(a),r.completeLoad(u),c([u],i)}),n.load(e.name,c,i,o)})),r.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var n,s,o;if(typeof e=="string"){e=b(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,o=getOwn(i,e.id);if(o){this.depExports[t]=o(this);return}this.depCount+=1,E(e,"defined",bind(this,function(e){this.defineDep(t,e),this.check()})),this.errback&&E(e,"error",this.errback)}n=e.id,s=u[n],!hasProp(i,n)&&s&&!s.enabled&&r.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(u,e.id);t&&!t.enabled&&r.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),e==="error"&&delete this.events[e]}},r={config:o,contextName:e,registry:u,defined:l,urlFetched:c,defQueue:f,Module:n,makeModuleMap:b,nextTick:req.nextTick,configure:function(e){e.baseUrl&&e.baseUrl.charAt(e.baseUrl.length-1)!=="/"&&(e.baseUrl+="/");var t=o.pkgs,n=o.shim,i={paths:!0,config:!0,map:!0};eachProp(e,function(e,t){i[t]?t==="map"?mixin(o[t],e,!0,!0):mixin(o[t],e,!0):o[t]=e}),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),(e.exports||e.init)&&!e.exportsFn&&(e.exportsFn=r.makeShimExports(e)),n[t]=e}),o.shim=n),e.packages&&(each(e.packages,function(e){var n;e=typeof e=="string"?{name:e}:e,n=e.location,t[e.name]={name:e.name,location:n||e.name,main:(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}}),o.pkgs=t),eachProp(u,function(e,t){!e.inited&&!e.map.unnormalized&&(e.map=b(t))}),(e.deps||e.callback)&&r.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,n){function s(o,a,f){var c,h,p;return n.enableBuildCallback&&a&&isFunction(a)&&(a.__requireJsBuild=!0),typeof o=="string"?isFunction(a)?S(makeError("requireargs","Invalid require call"),f):t&&hasProp(i,o)?i[o](u[t.id]):req.get?req.get(r,o,t):(h=b(o,t,!1,!0),c=h.id,hasProp(l,c)?l[c]:S(makeError("notloaded",'Module name "'+c+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(O(),r.nextTick(function(){O(),p=w(b(null,t)),p.skipMap=n.skipMap,p.init(o,a,f,{enabled:!0}),C()}),s)}return n=n||{},mixin(s,{isBrowser:isBrowser,toUrl:function(e){var n,i,s=e.lastIndexOf("."),o=e.split("/")[0],u=o==="."||o==="..";return s!==-1&&(!u||s>1)&&(n=e.substring(s,e.length),e=e.substring(0,s)),i=r.nameToUrl(v(e,t&&t.id,!0),n||".fake"),n?i:i.substring(0,i.length-5)},defined:function(e){return hasProp(l,b(e,t,!1,!0).id)},specified:function(e){return e=b(e,t,!1,!0).id,hasProp(l,e)||hasProp(u,e)}}),t||(s.undef=function(e){x();var n=b(e,t,!0),r=getOwn(u,e);delete l[e],delete c[n.url],delete a[e],r&&(r.events.defined&&(a[e]=r.events),T(e))}),s},enable:function(e){var t=getOwn(u,e.id);t&&w(e).enable()},completeLoad:function(e){var t,n,r,i=getOwn(o.shim,e)||{},s=i.exports;x();while(f.length){n=f.shift();if(n[0]===null){n[0]=e;if(t)break;t=!0}else n[0]===e&&(t=!0);k(n)}r=getOwn(u,e);if(!t&&!hasProp(l,e)&&r&&!r.inited){if(o.enforceDefine&&(!s||!getGlobal(s))){if(g(e))return;return S(makeError("nodefine","No define call for "+e,null,[e]))}k([e,i.deps||[],i.exportsFn])}C()},nameToUrl:function(e,t){var n,r,i,s,u,a,f,l,c;if(req.jsExtRegExp.test(e))l=e+(t||"");else{n=o.paths,r=o.pkgs,u=e.split("/");for(a=u.length;a>0;a-=1){f=u.slice(0,a).join("/"),i=getOwn(r,f),c=getOwn(n,f);if(c){isArray(c)&&(c=c[0]),u.splice(0,a,c);break}if(i){e===i.name?s=i.location+"/"+i.main:s=i.location,u.splice(0,a,s);break}}l=u.join("/"),l+=t||(/\?/.test(l)?"":".js"),l=(l.charAt(0)==="/"||l.match(/^[\w\+\.\-]+:/)?"":o.baseUrl)+l}return o.urlArgs?l+((l.indexOf("?")===-1?"?":"&")+o.urlArgs):l},load:function(e,t){req.load(r,e,t)},execCb:function(e,t,n,r){return t.apply(r,n)},onScriptLoad:function(e){if(e.type==="load"||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=A(e);r.completeLoad(t.id)}},onScriptError:function(e){var t=A(e);if(!g(t.id))return S(makeError("scripterror","Script error",e,[t.id]))}},r.require=r.makeRequire(),r}function getInteractiveScript(){return interactiveScript&&interactiveScript.readyState==="interactive"?interactiveScript:(eachReverse(scripts(),function(e){if(e.readyState==="interactive")return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.4",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=typeof window!="undefined"&&!!navigator&&!!document,isWebWorker=!isBrowser&&typeof importScripts!="undefined",readyRegExp=isBrowser&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera=typeof opera!="undefined"&&opera.toString()==="[object Opera]",contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(typeof define!="undefined")return;if(typeof requirejs!="undefined"){if(isFunction(requirejs))return;cfg=requirejs,requirejs=undefined}typeof require!="undefined"&&!isFunction(require)&&(cfg=require,require=undefined),req=requirejs=function(e,t,n,r){var i,s,o=defContextName;return!isArray(e)&&typeof e!="string"&&(s=e,isArray(t)?(e=t,t=n,n=r):e=[]),s&&s.context&&(o=s.context),i=getOwn(contexts,o),i||(i=contexts[o]=req.s.newContext(o)),s&&i.configure(s),i.require(e,t,n)},req.config=function(e){return req(e)},req.nextTick=typeof setTimeout!="undefined"?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=function(e){throw e},req.load=function(e,t,n){var r=e&&e.config||{},i;if(isBrowser)return i=r.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),i.type=r.scriptType||"text/javascript",i.charset="utf-8",i.async=!0,i.setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),i.attachEvent&&!(i.attachEvent.toString&&i.attachEvent.toString().indexOf("[native code")<0)&&!isOpera?(useInteractive=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)):(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)),i.src=n,currentlyAddingScript=i,baseElement?head.insertBefore(i,baseElement):head.appendChild(i),currentlyAddingScript=null,i;isWebWorker&&(importScripts(n),e.completeLoad(t))},isBrowser&&eachReverse(scripts(),function(e){head||(head=e.parentNode),dataMain=e.getAttribute("data-main");if(dataMain)return cfg.baseUrl||(src=dataMain.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath,dataMain=mainScript),dataMain=dataMain.replace(jsSuffixRegExp,""),cfg.deps=cfg.deps?cfg.deps.concat(dataMain):[dataMain],!0}),define=function(e,t,n){var r,i;typeof e!="string"&&(n=t,t=e,e=null),isArray(t)||(n=t,t=[]),!t.length&&isFunction(n)&&n.length&&(n.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(n.length===1?["require"]:["require","exports","module"]).concat(t)),useInteractive&&(r=currentlyAddingScript||getInteractiveScript(),r&&(e||(e=r.getAttribute("data-requiremodule")),i=contexts[r.getAttribute("data-requirecontext")])),(i?i.defQueue:globalDefQueue).push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)})(this),function(e,t){function _(e){var t=e.length,n=y.type(e);return y.isWindow(e)?!1:e.nodeType===1&&t?!0:n==="array"||n!=="function"&&(t===0||typeof t=="number"&&t>0&&t-1 in e)}function P(e){var t=D[e]={};return y.each(e.match(w)||[],function(e,n){t[n]=!0}),t}function j(e,n,r,i){if(!y.acceptData(e))return;var s,o,u=y.expando,a=typeof n=="string",l=e.nodeType,c=l?y.cache:e,h=l?e[u]:e[u]&&u;if((!h||!c[h]||!i&&!c[h].data)&&a&&r===t)return;h||(l?e[u]=h=f.pop()||y.guid++:h=u),c[h]||(c[h]={},l||(c[h].toJSON=y.noop));if(typeof n=="object"||typeof n=="function")i?c[h]=y.extend(c[h],n):c[h].data=y.extend(c[h].data,n);return s=c[h],i||(s.data||(s.data={}),s=s.data),r!==t&&(s[y.camelCase(n)]=r),a?(o=s[n],o==null&&(o=s[y.camelCase(n)])):o=s,o}function F(e,t,n){if(!y.acceptData(e))return;var r,i,s,o=e.nodeType,u=o?y.cache:e,a=o?e[y.expando]:y.expando;if(!u[a])return;if(t){r=n?u[a]:u[a].data;if(r){y.isArray(t)?t=t.concat(y.map(t,y.camelCase)):t in r?t=[t]:(t=y.camelCase(t),t in r?t=[t]:t=t.split(" "));for(i=0,s=t.length;i<s;i++)delete r[t[i]];if(!(n?q:y.isEmptyObject)(r))return}}if(!n){delete u[a].data;if(!q(u[a]))return}o?y.cleanData([e],!0):y.support.deleteExpando||u!=u.window?delete u[a]:u[a]=null}function I(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(B,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:+r+""===r?+r:H.test(r)?y.parseJSON(r):r}catch(s){}y.data(e,n,r)}else r=t}return r}function q(e){var t;for(t in e){if(t==="data"&&y.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function nt(){return!0}function rt(){return!1}function ft(e,t){do e=e[t];while(e&&e.nodeType!==1);return e}function lt(e,t,n){t=t||0;if(y.isFunction(t))return y.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return y.grep(e,function(e){return e===t===n});if(typeof t=="string"){var r=y.grep(e,function(e){return e.nodeType===1});if(ot.test(t))return y.filter(t,r,!n);t=y.filter(t,r)}return y.grep(e,function(e){return y.inArray(e,t)>=0===n})}function ct(e){var t=ht.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function At(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function Ot(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function Mt(e){var t=Tt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function _t(e,t){var n,r=0;for(;(n=e[r])!=null;r++)y._data(n,"globalEval",!t||y._data(t[r],"globalEval"))}function Dt(e,t){if(t.nodeType!==1||!y.hasData(e))return;var n,r,i,s=y._data(e),o=y._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;r<i;r++)y.event.add(t,n,u[n][r])}o.data&&(o.data=y.extend({},o.data))}function Pt(e,t){var n,r,i;if(t.nodeType!==1)return;n=t.nodeName.toLowerCase();if(!y.support.noCloneEvent&&t[y.expando]){r=y._data(t);for(i in r.events)y.removeEvent(t,i,r.handle);t.removeAttribute(y.expando)}if(n==="script"&&t.text!==e.text)Ot(t).text=e.text,Mt(t);else if(n==="object")t.parentNode&&(t.outerHTML=e.outerHTML),y.support.html5Clone&&e.innerHTML&&!y.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML);else if(n==="input"&&Et.test(e.type))t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value);else if(n==="option")t.defaultSelected=t.selected=e.defaultSelected;else if(n==="input"||n==="textarea")t.defaultValue=e.defaultValue}function Ht(e,n){var r,i,s=0,o=typeof e.getElementsByTagName!="undefined"?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!="undefined"?e.querySelectorAll(n||"*"):t;if(!o)for(o=[],r=e.childNodes||e;(i=r[s])!=null;s++)!n||y.nodeName(i,n)?o.push(i):y.merge(o,Ht(i,n));return n===t||n&&y.nodeName(e,n)?y.merge([e],o):o}function Bt(e){Et.test(e.type)&&(e.defaultChecked=e.checked)}function Zt(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Yt.length;while(i--){t=Yt[i]+n;if(t in e)return t}return r}function en(e,t){return e=t||e,y.css(e,"display")==="none"||!y.contains(e.ownerDocument,e)}function tn(e,t){var n,r=[],i=0,s=e.length;for(;i<s;i++){n=e[i];if(!n.style)continue;r[i]=y._data(n,"olddisplay"),t?(!r[i]&&n.style.display==="none"&&(n.style.display=""),n.style.display===""&&en(n)&&(r[i]=y._data(n,"olddisplay",on(n.nodeName)))):!r[i]&&!en(n)&&y._data(n,"olddisplay",y.css(n,"display"))}for(i=0;i<s;i++){n=e[i];if(!n.style)continue;if(!t||n.style.display==="none"||n.style.display==="")n.style.display=t?r[i]||"":"none"}return e}function nn(e,t,n){var r=Xt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function rn(e,t,n,r,i){var s=n===(r?"border":"content")?4:t==="width"?1:0,o=0;for(;s<4;s+=2)n==="margin"&&(o+=y.css(e,n+Gt[s],!0,i)),r?(n==="content"&&(o-=y.css(e,"padding"+Gt[s],!0,i)),n!=="margin"&&(o-=y.css(e,"border"+Gt[s]+"Width",!0,i))):(o+=y.css(e,"padding"+Gt[s],!0,i),n!=="padding"&&(o+=y.css(e,"border"+Gt[s]+"Width",!0,i)));return o}function sn(e,t,n){var r=!0,i=t==="width"?e.offsetWidth:e.offsetHeight,s=Ft(e),o=y.support.boxSizing&&y.css(e,"boxSizing",!1,s)==="border-box";if(i<=0||i==null){i=jt(e,t,s);if(i<0||i==null)i=e.style[t];if(Vt.test(i))return i;r=o&&(y.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+rn(e,t,n||(o?"border":"content"),r,s)+"px"}function on(e){var t=i,n=Jt[e];if(!n){n=un(e,t);if(n==="none"||!n)It=(It||y("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(It[0].contentWindow||It[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=un(e,t),It.detach();Jt[e]=n}return n}function un(e,t){var n=y(t.createElement(e)).appendTo(t.body),r=y.css(n[0],"display");return n.remove(),r}function pn(e,t,n,r){var i;if(y.isArray(t))y.each(t,function(t,i){n||fn.test(e)?r(e,i):pn(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&y.type(t)==="object")for(i in t)pn(e+"["+i+"]",t[i],n,r);else r(e,t)}function On(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(w)||[];if(y.isFunction(n))while(r=s[i++])r[0]==="+"?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Mn(e,t,n,r){function o(u){var a;return i[u]=!0,y.each(e[u]||[],function(e,u){var f=u(t,n,r);if(typeof f=="string"&&!s&&!i[f])return t.dataTypes.unshift(f),o(f),!1;if(s)return!(a=f)}),a}var i={},s=e===kn;return o(t.dataTypes[0])||!i["*"]&&o("*")}function _n(e,n){var r,i,s=y.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((s[r]?e:i||(i={}))[r]=n[r]);return i&&y.extend(!0,e,i),e}function Dn(e,n,r){var i,s,o,u,a=e.contents,f=e.dataTypes,l=e.responseFields;for(s in l)s in r&&(n[l[s]]=r[s]);while(f[0]==="*")f.shift(),i===t&&(i=e.mimeType||n.getResponseHeader("Content-Type"));if(i)for(s in a)if(a[s]&&a[s].test(i)){f.unshift(s);break}if(f[0]in r)o=f[0];else{for(s in r){if(!f[0]||e.converters[s+" "+f[0]]){o=s;break}u||(u=s)}o=o||u}if(o)return o!==f[0]&&f.unshift(o),r[o]}function Pn(e,t){var n,r,i,s,o={},u=0,a=e.dataTypes.slice(),f=a[0];e.dataFilter&&(t=e.dataFilter(t,e.dataType));if(a[1])for(n in e.converters)o[n.toLowerCase()]=e.converters[n];for(;i=a[++u];)if(i!=="*"){if(f!=="*"&&f!==i){n=o[f+" "+i]||o["* "+i];if(!n)for(r in o){s=r.split(" ");if(s[1]===i){n=o[f+" "+s[0]]||o["* "+s[0]];if(n){n===!0?n=o[r]:o[r]!==!0&&(i=s[0],a.splice(u--,0,i));break}}}if(n!==!0)if(n&&e["throws"])t=n(t);else try{t=n(t)}catch(l){return{state:"parsererror",error:n?l:"No conversion from "+f+" to "+i}}}f=i}return{state:"success",data:t}}function Rn(){try{return new e.XMLHttpRequest}catch(t){}}function Un(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function Qn(){return setTimeout(function(){zn=t}),zn=y.now()}function Gn(e,t){y.each(t,function(t,n){var r=(Kn[t]||[]).concat(Kn["*"]),i=0,s=r.length;for(;i<s;i++)if(r[i].call(e,t,n))return})}function Yn(e,t,n){var r,i,s=0,o=Jn.length,u=y.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=zn||Qn(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;o<a;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),s<1&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:y.extend({},t),opts:y.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:zn||Qn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=y.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;i=!0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;Zn(l,f.opts.specialEasing);for(;s<o;s++){r=Jn[s].call(f,e,l,f.opts);if(r)return r}return Gn(f,l),y.isFunction(f.opts.start)&&f.opts.start.call(e,f),y.fx.timer(y.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function Zn(e,t){var n,r,i,s,o;for(n in e){r=y.camelCase(n),i=t[r],s=e[n],y.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=y.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function er(e,t,n){var r,i,s,o,u,a,f,l,c,h=this,p=e.style,d={},v=[],m=e.nodeType&&en(e);n.queue||(l=y._queueHooks(e,"fx"),l.unqueued==null&&(l.unqueued=0,c=l.empty.fire,l.empty.fire=function(){l.unqueued||c()}),l.unqueued++,h.always(function(){h.always(function(){l.unqueued--,y.queue(e,"fx").length||l.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],y.css(e,"display")==="inline"&&y.css(e,"float")==="none"&&(!y.support.inlineBlockNeedsLayout||on(e.nodeName)==="inline"?p.display="inline-block":p.zoom=1)),n.overflow&&(p.overflow="hidden",y.support.shrinkWrapBlocks||h.done(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t){s=t[r];if(Xn.exec(s)){delete t[r],a=a||s==="toggle";if(s===(m?"hide":"show"))continue;v.push(r)}}o=v.length;if(o){u=y._data(e,"fxshow")||y._data(e,"fxshow",{}),"hidden"in u&&(m=u.hidden),a&&(u.hidden=!m),m?y(e).show():h.done(function(){y(e).hide()}),h.done(function(){var t;y._removeData(e,"fxshow");for(t in d)y.style(e,t,d[t])});for(r=0;r<o;r++)i=v[r],f=h.createTween(i,m?u[i]:0),d[i]=u[i]||y.style(e,i),i in u||(u[i]=f.start,m&&(f.end=f.start,f.start=i==="width"||i==="height"?1:0))}}function tr(e,t,n,r,i){return new tr.prototype.init(e,t,n,r,i)}function nr(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=Gt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function rr(e){return y.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n,r,i=e.document,s=e.location,o=e.jQuery,u=e.$,a={},f=[],l="1.9.0",c=f.concat,h=f.push,p=f.slice,d=f.indexOf,v=a.toString,m=a.hasOwnProperty,g=l.trim,y=function(e,t){return new y.fn.init(e,t,n)},b=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,w=/\S+/g,E=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,S=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,x=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,T=/^[\],:{}\s]*$/,N=/(?:^|:|,)(?:\s*\[)+/g,C=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,k=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,L=/^-ms-/,A=/-([\da-z])/gi,O=function(e,t){return t.toUpperCase()},M=function(){i.addEventListener?(i.removeEventListener("DOMContentLoaded",M,!1),y.ready()):i.readyState==="complete"&&(i.detachEvent("onreadystatechange",M),y.ready())};y.fn=y.prototype={jquery:l,constructor:y,init:function(e,n,r){var s,o;if(!e)return this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?s=[null,e,null]:s=S.exec(e);if(s&&(s[1]||!n)){if(s[1]){n=n instanceof y?n[0]:n,y.merge(this,y.parseHTML(s[1],n&&n.nodeType?n.ownerDocument||n:i,!0));if(x.test(s[1])&&y.isPlainObject(n))for(s in n)y.isFunction(this[s])?this[s](n[s]):this.attr(s,n[s]);return this}o=i.getElementById(s[2]);if(o&&o.parentNode){if(o.id!==s[2])return r.find(e);this.length=1,this[0]=o}return this.context=i,this.selector=e,this}return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e)}return e.nodeType?(this.context=this[0]=e,this.length=1,this):y.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),y.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return p.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e){var t=y.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return y.each(this,e,t)},ready:function(e){return y.ready.promise().done(e),this},slice:function(){return this.pushStack(p.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},map:function(e){return this.pushStack(y.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:h,sort:[].sort,splice:[].splice},y.fn.init.prototype=y.fn,y.extend=y.fn.extend=function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;typeof u=="boolean"&&(l=u,u=arguments[1]||{},a=2),typeof u!="object"&&!y.isFunction(u)&&(u={}),f===a&&(u=this,--a);for(;a<f;a++)if((e=arguments[a])!=null)for(n in e){r=u[n],i=e[n];if(u===i)continue;l&&i&&(y.isPlainObject(i)||(s=y.isArray(i)))?(s?(s=!1,o=r&&y.isArray(r)?r:[]):o=r&&y.isPlainObject(r)?r:{},u[n]=y.extend(l,o,i)):i!==t&&(u[n]=i)}return u},y.extend({noConflict:function(t){return e.$===y&&(e.$=u),t&&e.jQuery===y&&(e.jQuery=o),y},isReady:!1,readyWait:1,holdReady:function(e){e?y.readyWait++:y.ready(!0)},ready:function(e){if(e===!0?--y.readyWait:y.isReady)return;if(!i.body)return setTimeout(y.ready);y.isReady=!0;if(e!==!0&&--y.readyWait>0)return;r.resolveWith(i,[y]),y.fn.trigger&&y(i).trigger("ready").off("ready")},isFunction:function(e){return y.type(e)==="function"},isArray:Array.isArray||function(e){return y.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):typeof e=="object"||typeof e=="function"?a[v.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||y.type(e)!=="object"||e.nodeType||y.isWindow(e))return!1;try{if(e.constructor&&!m.call(e,"constructor")&&!m.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||m.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(n=t,t=!1),t=t||i;var r=x.exec(e),s=!n&&[];return r?[t.createElement(r[1])]:(r=y.buildFragment([e],t,s),s&&y(s).remove(),y.merge([],r.childNodes))},parseJSON:function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(t===null)return t;if(typeof t=="string"){t=y.trim(t);if(t&&T.test(t.replace(C,"@").replace(k,"]").replace(N,"")))return(new Function("return "+t))()}y.error("Invalid JSON: "+t)},parseXML:function(n){var r,i;if(!n||typeof n!="string")return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(s){r=t}return(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&y.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&y.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(L,"ms-").replace(A,O)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=_(e);if(n)if(o)for(;i<s;i++){r=t.apply(e[i],n);if(r===!1)break}else for(i in e){r=t.apply(e[i],n);if(r===!1)break}else if(o)for(;i<s;i++){r=t.call(e[i],i,e[i]);if(r===!1)break}else for(i in e){r=t.call(e[i],i,e[i]);if(r===!1)break}return e},trim:g&&!g.call("")?function(e){return e==null?"":g.call(e)}:function(e){return e==null?"":(e+"").replace(E,"")},makeArray:function(e,t){var n=t||[];return e!=null&&(_(Object(e))?y.merge(n,typeof e=="string"?[e]:e):h.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(d)return d.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,s=0;if(typeof r=="number")for(;s<r;s++)e[i++]=n[s];else while(n[s]!==t)e[i++]=n[s++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,t,n){var r,i=0,s=e.length,o=_(e),u=[];if(o)for(;i<s;i++)r=t(e[i],i,n),r!=null&&(u[u.length]=r);else for(i in e)r=t(e[i],i,n),r!=null&&(u[u.length]=r);return c.apply([],u)},guid:1,proxy:function(e,n){var r,i,s;return typeof n=="string"&&(r=e[n],n=e,e=r),y.isFunction(e)?(i=p.call(arguments,2),s=function(){return e.apply(n||this,i.concat(p.call(arguments)))},s.guid=e.guid=e.guid||y.guid++,s):t},access:function(e,n,r,i,s,o,u){var a=0,f=e.length,l=r==null;if(y.type(r)==="object"){s=!0;for(a in r)y.access(e,n,a,r[a],!0,o,u)}else if(i!==t){s=!0,y.isFunction(i)||(u=!0),l&&(u?(n.call(e,i),n=null):(l=n,n=function(e,t,n){return l.call(y(e),n)}));if(n)for(;a<f;a++)n(e[a],r,u?i:i.call(e[a],a,n(e[a],r)))}return s?e:l?n.call(e):f?n(e[0],r):o},now:function(){return(new Date).getTime()}}),y.ready.promise=function(t){if(!r){r=y.Deferred();if(i.readyState==="complete")setTimeout(y.ready);else if(i.addEventListener)i.addEventListener("DOMContentLoaded",M,!1),e.addEventListener("load",y.ready,!1);else{i.attachEvent("onreadystatechange",M),e.attachEvent("onload",y.ready);var n=!1;try{n=e.frameElement==null&&i.documentElement}catch(s){}n&&n.doScroll&&function o(){if(!y.isReady){try{n.doScroll("left")}catch(e){return setTimeout(o,50)}y.ready()}}()}}return r.promise(t)},y.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){a["[object "+t+"]"]=t.toLowerCase()}),n=y(i);var D={};y.Callbacks=function(e){e=typeof e=="string"?D[e]||P(e):y.extend({},e);var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){n=e.memory&&t,r=!0,u=s||0,s=0,o=a.length,i=!0;for(;a&&u<o;u++)if(a[u].apply(t[0],t[1])===!1&&e.stopOnFalse){n=!1;break}i=!1,a&&(f?f.length&&l(f.shift()):n?a=[]:c.disable())},c={add:function(){if(a){var t=a.length;(function r(t){y.each(t,function(t,n){var i=y.type(n);i==="function"?(!e.unique||!c.has(n))&&a.push(n):n&&n.length&&i!=="string"&&r(n)})})(arguments),i?o=a.length:n&&(s=t,l(n))}return this},remove:function(){return a&&y.each(arguments,function(e,t){var n;while((n=y.inArray(t,a,n))>-1)a.splice(n,1),i&&(n<=o&&o--,n<=u&&u--)}),this},has:function(e){return y.inArray(e,a)>-1},empty:function(){return a=[],this},disable:function(){return a=f=n=t,this},disabled:function(){return!a},lock:function(){return f=t,n||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],a&&(!r||f)&&(i?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},y.extend({Deferred:function(e){var t=[["resolve","done",y.Callbacks("once memory"),"resolved"],["reject","fail",y.Callbacks("once memory"),"rejected"],["notify","progress",y.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return y.Deferred(function(n){y.each(t,function(t,s){var o=s[0],u=y.isFunction(e[t])&&e[t];i[s[1]](function(){var e=u&&u.apply(this,arguments);e&&y.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===r?n.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return e!=null?y.extend(e,r):r}},i={};return r.pipe=r.then,y.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=p.call(arguments),r=n.length,i=r!==1||e&&y.isFunction(e.promise)?r:0,s=i===1?e:y.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?p.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&y.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}}),y.support=function(){var t,n,r,s,o,u,a,f,l,c,h=i.createElement("div");h.setAttribute("className","t"),h.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=h.getElementsByTagName("*"),r=h.getElementsByTagName("a")[0];if(!n||!r||!n.length)return{};s=i.createElement("select"),o=s.appendChild(i.createElement("option")),u=h.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:h.className!=="t",leadingWhitespace:h.firstChild.nodeType===3,tbody:!h.getElementsByTagName("tbody").length,htmlSerialize:!!h.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:r.getAttribute("href")==="/a",opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:!!u.value,optSelected:o.selected,enctype:!!i.createElement("form").enctype,html5Clone:i.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:i.compatMode==="CSS1Compat",deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},u.checked=!0,t.noCloneChecked=u.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!o.disabled;try{delete h.test}catch(p){t.deleteExpando=!1}u=i.createElement("input"),u.setAttribute("value",""),t.input=u.getAttribute("value")==="",u.value="t",u.setAttribute("type","radio"),t.radioValue=u.value==="t",u.setAttribute("checked","t"),u.setAttribute("name","t"),a=i.createDocumentFragment(),a.appendChild(u),t.appendChecked=u.checked,t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,h.attachEvent&&(h.attachEvent("onclick",function(){t.noCloneEvent=!1}),h.cloneNode(!0).click());for(c in{submit:!0,change:!0,focusin:!0})h.setAttribute(f="on"+c,"t"),t[c+"Bubbles"]=f in e||h.attributes[f].expando===!1;return h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle=h.style.backgroundClip==="content-box",y(function(){var n,r,s,o="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",u=i.getElementsByTagName("body")[0];if(!u)return;n=i.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",u.appendChild(n).appendChild(h),h.innerHTML="<table><tr><td></td><td>t</td></tr></table>",s=h.getElementsByTagName("td"),s[0].style.cssText="padding:0;margin:0;border:0;display:none",l=s[0].offsetHeight===0,s[0].style.display="",s[1].style.display="none",t.reliableHiddenOffsets=l&&s[0].offsetHeight===0,h.innerHTML="",h.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=h.offsetWidth===4,t.doesNotIncludeMarginInBodyOffset=u.offsetTop!==1,e.getComputedStyle&&(t.pixelPosition=(e.getComputedStyle(h,null)||{}).top!=="1%",t.boxSizingReliable=(e.getComputedStyle(h,null)||{width:"4px"}).width==="4px",r=h.appendChild(i.createElement("div")),r.style.cssText=h.style.cssText=o,r.style.marginRight=r.style.width="0",h.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof h.style.zoom!="undefined"&&(h.innerHTML="",h.style.cssText=o+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=h.offsetWidth===3,h.style.display="block",h.innerHTML="<div></div>",h.firstChild.style.width="5px",t.shrinkWrapBlocks=h.offsetWidth!==3,u.style.zoom=1),u.removeChild(n),n=h=s=r=null}),n=s=a=o=r=u=null,t}();var H=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,B=/([A-Z])/g;y.extend({cache:{},expando:"jQuery"+(l+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?y.cache[e[y.expando]]:e[y.expando],!!e&&!q(e)},data:function(e,t,n){return j(e,t,n,!1)},removeData:function(e,t){return F(e,t,!1)},_data:function(e,t,n){return j(e,t,n,!0)},_removeData:function(e,t){return F(e,t,!0)},acceptData:function(e){var t=e.nodeName&&y.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),y.fn.extend({data:function(e,n){var r,i,s=this[0],o=0,u=null;if(e===t){if(this.length){u=y.data(s);if(s.nodeType===1&&!y._data(s,"parsedAttrs")){r=s.attributes;for(;o<r.length;o++)i=r[o].name,i.indexOf("data-")||(i=y.camelCase(i.substring(5)),I(s,i,u[i]));y._data(s,"parsedAttrs",!0)}}return u}return typeof e=="object"?this.each(function(){y.data(this,e)}):y.access(this,function(n){if(n===t)return s?I(s,e,y.data(s,e)):null;this.each(function(){y.data(this,e,n)})},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){y.removeData(this,e)})}}),y.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=y._data(e,t),n&&(!r||y.isArray(n)?r=y._data(e,t,y.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=y.queue(e,t),r=n.length,i=n.shift(),s=y._queueHooks(e,t),o=function(){y.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),s.cur=i,i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return y._data(e,n)||y._data(e,n,{empty:y.Callbacks("once memory").add(function(){y._removeData(e,t+"queue"),y._removeData(e,n)})})}}),y.fn.extend({queue:function(e,n){var r=2;return typeof e!="string"&&(n=e,e="fx",r--),arguments.length<r?y.queue(this[0],e):n===t?this:this.each(function(){var t=y.queue(this,e,n);y._queueHooks(this,e),e==="fx"&&t[0]!=="inprogress"&&y.dequeue(this,e)})},dequeue:function(e){return this.each(function(){y.dequeue(this,e)})},delay:function(e,t){return e=y.fx?y.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,s=y.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};typeof e!="string"&&(n=e,e=t),e=e||"fx";while(u--)r=y._data(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(n)}});var R,U,z=/[\t\r\n]/g,W=/\r/g,X=/^(?:input|select|textarea|button|object)$/i,V=/^(?:a|area)$/i,$=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,J=/^(?:checked|selected)$/i,K=y.support.getSetAttribute,Q=y.support.input;y.fn.extend({attr:function(e,t){return y.access(this,y.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){y.removeAttr(this,e)})},prop:function(e,t){return y.access(this,y.prop,e,t,arguments.length>1)},removeProp:function(e){return e=y.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=typeof e=="string"&&e;if(y.isFunction(e))return this.each(function(t){y(this).addClass(e.call(this,t,this.className))});if(a){t=(e||"").match(w)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(z," "):" ");if(r){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");n.className=y.trim(r)}}}return this},removeClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=arguments.length===0||typeof e=="string"&&e;if(y.isFunction(e))return this.each(function(t){y(this).removeClass(e.call(this,t,this.className))});if(a){t=(e||"").match(w)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(z," "):"");if(r){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?y.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return y.isFunction(e)?this.each(function(n){y(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,s=0,o=y(this),u=t,a=e.match(w)||[];while(i=a[s++])u=r?u:!o.hasClass(i),o[u?"addClass":"removeClass"](i)}else if(n==="undefined"||n==="boolean")this.className&&y._data(this,"__className__",this.className),this.className=this.className||e===!1?"":y._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(z," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,s=this[0];if(!arguments.length){if(s)return n=y.valHooks[s.type]||y.valHooks[s.nodeName.toLowerCase()],n&&"get"in n&&(r=n.get(s,"value"))!==t?r:(r=s.value,typeof r=="string"?r.replace(W,""):r==null?"":r);return}return i=y.isFunction(e),this.each(function(r){var s,o=y(this);if(this.nodeType!==1)return;i?s=e.call(this,r,o.val()):s=e,s==null?s="":typeof s=="number"?s+="":y.isArray(s)&&(s=y.map(s,function(e){return e==null?"":e+""})),n=y.valHooks[this.type]||y.valHooks[this.nodeName.toLowerCase()];if(!n||!("set"in n)||n.set(this,s,"value")===t)this.value=s})}}),y.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(y.support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!y.nodeName(n.parentNode,"optgroup"))){t=y(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n=y.makeArray(t);return y(e).find("option").each(function(){this.selected=y.inArray(y(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,r){var i,s,o,u=e.nodeType;if(!e||u===3||u===8||u===2)return;if(typeof e.getAttribute=="undefined")return y.prop(e,n,r);o=u!==1||!y.isXMLDoc(e),o&&(n=n.toLowerCase(),s=y.attrHooks[n]||($.test(n)?U:R));if(r===t)return s&&o&&"get"in s&&(i=s.get(e,n))!==null?i:(typeof e.getAttribute!="undefined"&&(i=e.getAttribute(n)),i==null?t:i);if(r!==null)return s&&o&&"set"in s&&(i=s.set(e,r,n))!==t?i:(e.setAttribute(n,r+""),r);y.removeAttr(e,n)},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(w);if(s&&e.nodeType===1)while(n=s[i++])r=y.propFix[n]||n,$.test(n)?!K&&J.test(n)?e[y.camelCase("default-"+n)]=e[r]=!1:e[r]=!1:y.attr(e,n,""),e.removeAttribute(K?n:r)},attrHooks:{type:{set:function(e,t){if(!y.support.radioValue&&t==="radio"&&y.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(!e||u===3||u===8||u===2)return;return o=u!==1||!y.isXMLDoc(e),o&&(n=y.propFix[n]||n,s=y.propHooks[n]),r!==t?s&&"set"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get"in s&&(i=s.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):X.test(e.nodeName)||V.test(e.nodeName)&&e.href?0:t}}}}),U={get:function(e,n){var r=y.prop(e,n),i=typeof r=="boolean"&&e.getAttribute(n),s=typeof r=="boolean"?Q&&K?i!=null:J.test(n)?e[y.camelCase("default-"+n)]:!!i:e.getAttributeNode(n);return s&&s.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?y.removeAttr(e,n):Q&&K||!J.test(n)?e.setAttribute(!K&&y.propFix[n]||n,n):e[y.camelCase("default-"+n)]=e[n]=!0,n}};if(!Q||!K)y.attrHooks.value={get:function(e,n){var r=e.getAttributeNode(n);return y.nodeName(e,"input")?e.defaultValue:r&&r.specified?r.value:t},set:function(e,t,n){if(!y.nodeName(e,"input"))return R&&R.set(e,t,n);e.defaultValue=t}};K||(R=y.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&(n==="id"||n==="name"||n==="coords"?r.value!=="":r.specified)?r.value:t},set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="",r==="value"||n===e.getAttribute(r)?n:t}},y.attrHooks.contenteditable={get:R.get,set:function(e,t,n){R.set(e,t===""?!1:t,n)}},y.each(["width","height"],function(e,t){y.attrHooks[t]=y.extend(y.attrHooks[t],{set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}})})),y.support.hrefNormalized||(y.each(["href","src","width","height"],function(e,n){y.attrHooks[n]=y.extend(y.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r==null?t:r}})}),y.each(["href","src"],function(e,t){y.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),y.support.style||(y.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),y.support.optSelected||(y.propHooks.selected=y.extend(y.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),y.support.enctype||(y.propFix.enctype="encoding"),y.support.checkOn||y.each(["radio","checkbox"],function(){y.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),y.each(["radio","checkbox"],function(){y.valHooks[this]=y.extend(y.valHooks[this],{set:function(e,t){if(y.isArray(t))return e.checked=y.inArray(y(e).val(),t)>=0}})});var G=/^(?:input|select|textarea)$/i,Y=/^key/,Z=/^(?:mouse|contextmenu)|click/,et=/^(?:focusinfocus|focusoutblur)$/,tt=/^([^.]*)(?:\.(.+)|)$/;y.event={global:{},add:function(e,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g=e.nodeType!==3&&e.nodeType!==8&&y._data(e);if(!g)return;r.handler&&(o=r,r=o.handler,s=o.selector),r.guid||(r.guid=y.guid++),(f=g.events)||(f=g.events={}),(u=g.handle)||(u=g.handle=function(e){return typeof y=="undefined"||!!e&&y.event.triggered===e.type?t:y.event.dispatch.apply(u.elem,arguments)},u.elem=e),n=(n||"").match(w)||[""],l=n.length;while(l--){a=tt.exec(n[l])||[],d=m=a[1],v=(a[2]||"").split(".").sort(),h=y.event.special[d]||{},d=(s?h.delegateType:h.bindType)||d,h=y.event.special[d]||{},c=y.extend({type:d,origType:m,data:i,handler:r,guid:r.guid,selector:s,needsContext:s&&y.expr.match.needsContext.test(s),namespace:v.join(".")},o);if(!(p=f[d])){p=f[d]=[],p.delegateCount=0;if(!h.setup||h.setup.call(e,i,v,u)===!1)e.addEventListener?e.addEventListener(d,u,!1):e.attachEvent&&e.attachEvent("on"+d,u)}h.add&&(h.add.call(e,c),c.handler.guid||(c.handler.guid=r.guid)),s?p.splice(p.delegateCount++,0,c):p.push(c),y.event.global[d]=!0}e=null},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=y.hasData(e)&&y._data(e);if(!m||!(a=m.events))return;t=(t||"").match(w)||[""],f=t.length;while(f--){u=tt.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p){for(p in a)y.event.remove(e,p+t[f],n,r,!0);continue}c=y.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,h=a[p]||[],u=u[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=h.length;while(s--)l=h[s],(i||v===l.origType)&&(!n||n.guid===l.guid)&&(!u||u.test(l.namespace))&&(!r||r===l.selector||r==="**"&&l.selector)&&(h.splice(s,1),l.selector&&h.delegateCount--,c.remove&&c.remove.call(e,l));o&&!h.length&&((!c.teardown||c.teardown.call(e,d,m.handle)===!1)&&y.removeEvent(e,p,m.handle),delete a[p])}y.isEmptyObject(a)&&(delete m.handle,y._removeData(e,"events"))},trigger:function(n,r,s,o){var u,a,f,l,c,h,p,d=[s||i],v=n.type||n,m=n.namespace?n.namespace.split("."):[];a=f=s=s||i;if(s.nodeType===3||s.nodeType===8)return;if(et.test(v+y.event.triggered))return;v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),c=v.indexOf(":")<0&&"on"+v,n=n[y.expando]?n:new y.Event(v,typeof n=="object"&&n),n.isTrigger=!0,n.namespace=m.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=s),r=r==null?[n]:y.makeArray(r,[n]),p=y.event.special[v]||{};if(!o&&p.trigger&&p.trigger.apply(s,r)===!1)return;if(!o&&!p.noBubble&&!y.isWindow(s)){l=p.delegateType||v,et.test(l+v)||(a=a.parentNode);for(;a;a=a.parentNode)d.push(a),f=a;f===(s.ownerDocument||i)&&d.push(f.defaultView||f.parentWindow||e)}u=0;while((a=d[u++])&&!n.isPropagationStopped())n.type=u>1?l:p.bindType||v,h=(y._data(a,"events")||{})[n.type]&&y._data(a,"handle"),h&&h.apply(a,r),h=c&&a[c],h&&y.acceptData(a)&&h.apply&&h.apply(a,r)===!1&&n.preventDefault();n.type=v;if(!o&&!n.isDefaultPrevented()&&(!p._default||p._default.apply(s.ownerDocument,r)===!1)&&(v!=="click"||!y.nodeName(s,"a"))&&y.acceptData(s)&&c&&s[v]&&!y.isWindow(s)){f=s[c],f&&(s[c]=null),y.event.triggered=v;try{s[v]()}catch(g){}y.event.triggered=t,f&&(s[c]=f)}return n.result},dispatch:function(e){e=y.event.fix(e);var n,r,i,s,o,u=[],a=p.call(arguments),f=(y._data(this,"events")||{})[e.type]||[],l=y.event.special[e.type]||{};a[0]=e,e.delegateTarget=this;if(l.preDispatch&&l.preDispatch.call(this,e)===!1)return;u=y.event.handlers.call(this,e,f),n=0;while((s=u[n++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,r=0;while((o=s.handlers[r++])&&!e.isImmediatePropagationStopped())if(!e.namespace_re||e.namespace_re.test(o.namespace))e.handleObj=o,e.data=o.data,i=((y.event.special[o.origType]||{}).handle||o.handler).apply(s.elem,a),i!==t&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation())}return l.postDispatch&&l.postDispatch.call(this,e),e.result},handlers:function(e,n){var r,i,s,o,u=[],a=n.delegateCount,f=e.target;if(a&&f.nodeType&&(!e.button||e.type!=="click"))for(;f!=this;f=f.parentNode||this)if(f.disabled!==!0||e.type!=="click"){i=[];for(r=0;r<a;r++)o=n[r],s=o.selector+" ",i[s]===t&&(i[s]=o.needsContext?y(s,this).index(f)>=0:y.find(s,this,null,[f]).length),i[s]&&i.push(o);i.length&&u.push({elem:f,handlers:i})}return a<n.length&&u.push({elem:this,handlers:n.slice(a)}),u},fix:function(e){if(e[y.expando])return e;var t,n,r=e,s=y.event.fixHooks[e.type]||{},o=s.props?this.props.concat(s.props):this.props;e=new y.Event(r),t=o.length;while(t--)n=o[t],e[n]=r[n];return e.target||(e.target=r.srcElement||i),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,r):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,s,o,u=n.button,a=n.fromElement;return e.pageX==null&&n.clientX!=null&&(r=e.target.ownerDocument||i,s=r.documentElement,o=r.body,e.pageX=n.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=n.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){if(y.nodeName(this,"input")&&this.type==="checkbox"&&this.click)return this.click(),!1}},focus:{trigger:function(){if(this!==i.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){if(this===i.activeElement&&this.blur)return this.blur(),!1},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=y.extend(new y.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?y.event.trigger(i,null,t):y.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},y.removeEvent=i.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]=="undefined"&&(e[r]=null),e.detachEvent(r,n))},y.Event=function(e,t){if(!(this instanceof y.Event))return new y.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?nt:rt):this.type=e,t&&y.extend(this,t),this.timeStamp=e&&e.timeStamp||y.now(),this[y.expando]=!0},y.Event.prototype={isDefaultPrevented:rt,isPropagationStopped:rt,isImmediatePropagationStopped:rt,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=nt;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=nt;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=nt,this.stopPropagation()}},y.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){y.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;if(!i||i!==r&&!y.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),y.support.submitBubbles||(y.event.special.submit={setup:function(){if(y.nodeName(this,"form"))return!1;y.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=y.nodeName(n,"input")||y.nodeName(n,"button")?n.form:t;r&&!y._data(r,"submitBubbles")&&(y.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),y._data(r,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&y.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(y.nodeName(this,"form"))return!1;y.event.remove(this,"._submit")}}),y.support.changeBubbles||(y.event.special.change={setup:function(){if(G.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")y.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),y.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),y.event.simulate("change",this,e,!0)});return!1}y.event.add(this,"beforeactivate._change",function(e){var t=e.target;G.test(t.nodeName)&&!y._data(t,"changeBubbles")&&(y.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&y.event.simulate("change",this.parentNode,e,!0)}),y._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return y.event.remove(this,"._change"),!G.test(this.nodeName)}}),y.support.focusinBubbles||y.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){y.event.simulate(t,e.target,y.event.fix(e),!0)};y.event.special[t]={setup:function(){n++===0&&i.addEventListener(e,r,!0)},teardown:function(){--n===0&&i.removeEventListener(e,r,!0)}}}),y.fn.extend({on:function(e,n,r,i,s){var o,u;if(typeof e=="object"){typeof n!="string"&&(r=r||n,n=t);for(u in e)this.on(u,n,r,e[u],s);return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=="string"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1)i=rt;else if(!i)return this;return s===1&&(o=i,i=function(e){return y().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=y.guid++)),this.each(function(){y.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,y(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if(typeof e=="object"){for(s in e)this.off(s,n,e[s]);return this}if(n===!1||typeof n=="function")r=n,n=t;return r===!1&&(r=rt),this.each(function(){y.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){y.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return y.event.trigger(e,t,n,!0)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),y.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){y.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)},Y.test(t)&&(y.event.fixHooks[t]=y.event.keyHooks),Z.test(t)&&(y.event.fixHooks[t]=y.event.mouseHooks)}),function(e,t){function rt(e){return J.test(e+"")}function it(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function st(e){return e[w]=!0,e}function ot(e){var t=c.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}}function ut(e,t,n,r){var i,s,o,u,a,f,h,v,m,y;(t?t.ownerDocument||t:E)!==c&&l(t),t=t||c,n=n||[];if(!e||typeof e!="string")return n;if((u=t.nodeType)!==1&&u!==9)return[];if(!p&&!r){if(i=K.exec(e))if(o=i[1]){if(u===9){s=t.getElementById(o);if(!s||!s.parentNode)return n;if(s.id===o)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(o))&&g(t,s)&&s.id===o)return n.push(s),n}else{if(i[2])return _.apply(n,D.call(t.getElementsByTagName(e),0)),n;if((o=i[3])&&S.getByClassName&&t.getElementsByClassName)return _.apply(n,D.call(t.getElementsByClassName(o),0)),n}if(S.qsa&&!d.test(e)){h=!0,v=w,m=t,y=u===9&&e;if(u===1&&t.nodeName.toLowerCase()!=="object"){f=ht(e),(h=t.getAttribute("id"))?v=h.replace(Y,"\\$&"):t.setAttribute("id",v),v="[id='"+v+"'] ",a=f.length;while(a--)f[a]=v+pt(f[a]);m=$.test(e)&&t.parentNode||t,y=f.join(",")}if(y)try{return _.apply(n,D.call(m.querySelectorAll(y),0)),n}catch(b){}finally{h||t.removeAttribute("id")}}}return Et(e.replace(R,"$1"),t,n,r)}function at(e,t){var n=e&&t&&e.nextSibling;for(;n;n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function ct(e){return st(function(t){return t=+t,st(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function ht(e,t){var n,r,s,o,u,a,f,l=C[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){if(!n||(r=U.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(s=[]);n=!1;if(r=z.exec(u))n=r.shift(),s.push({value:n,type:r[0].replace(R," ")}),u=u.slice(n.length);for(o in i.filter)(r=V[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(n=r.shift(),s.push({value:n,type:o,matches:r}),u=u.slice(n.length));if(!n)break}return t?u.length:u?ut.error(e):C(e,a).slice(0)}function pt(e){var t=0,n=e.length,r="";for(;t<n;t++)r+=e[t].value;return r}function dt(e,t,n){var i=t.dir,s=n&&t.dir==="parentNode",o=T++;return t.first?function(t,n,r){while(t=t[i])if(t.nodeType===1||s)return e(t,n,r)}:function(t,n,u){var a,f,l,c=x+" "+o;if(u){while(t=t[i])if(t.nodeType===1||s)if(e(t,n,u))return!0}else while(t=t[i])if(t.nodeType===1||s){l=t[w]||(t[w]={});if((f=l[i])&&f[0]===c){if((a=f[1])===!0||a===r)return a===!0}else{f=l[i]=[c],f[1]=e(t,n,u)||r;if(f[1]===!0)return!0}}}}function vt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function mt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function gt(e,t,n,r,i,s){return r&&!r[w]&&(r=gt(r)),i&&!i[w]&&(i=gt(i,s)),st(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||wt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?mt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=mt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?P.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=mt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):_.apply(o,g)})}function yt(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],a=o?1:0,l=dt(function(e){return e===t},u,!0),c=dt(function(e){return P.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;a<s;a++)if(n=i.relative[e[a].type])h=[dt(vt(h),n)];else{n=i.filter[e[a].type].apply(null,e[a].matches);if(n[w]){r=++a;for(;r<s;r++)if(i.relative[e[r].type])break;return gt(a>1&&vt(h),a>1&&pt(e.slice(0,a-1)).replace(R,"$1"),n,a<r&&yt(e.slice(a,r)),r<s&&yt(e=e.slice(r)),r<s&&pt(e))}h.push(n)}return vt(h)}function bt(e,t){var n=0,s=t.length>0,o=e.length>0,u=function(u,a,l,h,p){var d,v,m,g=[],y=0,b="0",w=u&&[],E=p!=null,S=f,T=u||o&&i.find.TAG("*",p&&a.parentNode||a),N=x+=S==null?1:Math.E;E&&(f=a!==c&&a,r=n);for(;(d=T[b])!=null;b++){if(o&&d){for(v=0;m=e[v];v++)if(m(d,a,l)){h.push(d);break}E&&(x=N,r=++n)}s&&((d=!m&&d)&&y--,u&&w.push(d))}y+=b;if(s&&b!==y){for(v=0;m=t[v];v++)m(w,g,a,l);if(u){if(y>0)while(b--)!w[b]&&!g[b]&&(g[b]=M.call(h));g=mt(g)}_.apply(h,g),E&&!u&&g.length>0&&y+t.length>1&&ut.uniqueSort(h)}return E&&(x=N,f=S),w};return s?st(u):u}function wt(e,t,n){var r=0,i=t.length;for(;r<i;r++)ut(e,t[r],n);return n}function Et(e,t,n,r){var s,o,a,f,l,c=ht(e);if(!r&&c.length===1){o=c[0]=c[0].slice(0);if(o.length>2&&(a=o[0]).type==="ID"&&t.nodeType===9&&!p&&i.relative[o[1].type]){t=i.find.ID(a.matches[0].replace(et,tt),t)[0];if(!t)return n;e=e.slice(o.shift().value.length)}for(s=V.needsContext.test(e)?-1:o.length-1;s>=0;s--){a=o[s];if(i.relative[f=a.type])break;if(l=i.find[f])if(r=l(a.matches[0].replace(et,tt),$.test(o[0].type)&&t.parentNode||t)){o.splice(s,1),e=r.length&&pt(o);if(!e)return _.apply(n,D.call(r,0)),n;break}}}return u(e,c)(r,t,p,n,$.test(e)),n}function St(){}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,b,w="sizzle"+ -(new Date),E=e.document,S={},x=0,T=0,N=it(),C=it(),k=it(),L=typeof t,A=1<<31,O=[],M=O.pop,_=O.push,D=O.slice,P=O.indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},H="[\\x20\\t\\r\\n\\f]",B="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",j=B.replace("w","w#"),F="([*^$|!~]?=)",I="\\["+H+"*("+B+")"+H+"*(?:"+F+H+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+j+")|)|)"+H+"*\\]",q=":("+B+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+I.replace(3,8)+")*)|.*)\\)|)",R=new RegExp("^"+H+"+|((?:^|[^\\\\])(?:\\\\.)*)"+H+"+$","g"),U=new RegExp("^"+H+"*,"+H+"*"),z=new RegExp("^"+H+"*([\\x20\\t\\r\\n\\f>+~])"+H+"*"),W=new RegExp(q),X=new RegExp("^"+j+"$"),V={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),NAME:new RegExp("^\\[name=['\"]?("+B+")['\"]?\\]"),TAG:new RegExp("^("+B.replace("w","w*")+")"),ATTR:new RegExp("^"+I),PSEUDO:new RegExp("^"+q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+H+"*(even|odd|(([+-]|)(\\d*)n|)"+H+"*(?:([+-]|)"+H+"*(\\d+)|))"+H+"*\\)|)","i"),needsContext:new RegExp("^"+H+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+H+"*((?:-\\d)?\\d*)"+H+"*\\)|)(?=[^-]|$)","i")},$=/[\x20\t\r\n\f]*[+~]/,J=/\{\s*\[native code\]\s*\}/,K=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Q=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,Y=/'|\\/g,Z=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,et=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,tt=function(e,t){var n="0x"+t-65536;return n!==n?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,n&1023|56320)};try{D.call(h.childNodes,0)[0].nodeType}catch(nt){D=function(e){var t,n=[];for(;t=this[e];e++)n.push(t);return n}}o=ut.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},l=ut.setDocument=function(e){var n=e?e.ownerDocument||e:E;if(n===c||n.nodeType!==9||!n.documentElement)return c;c=n,h=n.documentElement,p=o(n),S.tagNameNoComments=ot(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),S.attributes=ot(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return t!=="boolean"&&t!=="string"}),S.getByClassName=ot(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!e.getElementsByClassName||!e.getElementsByClassName("e").length?!1:(e.lastChild.className="e",e.getElementsByClassName("e").length===2)}),S.getByName=ot(function(e){e.id=w+0,e.innerHTML="<a name='"+w+"'></a><div name='"+w+"'></div>",h.insertBefore(e,h.firstChild);var t=n.getElementsByName&&n.getElementsByName(w).length===2+n.getElementsByName(w+0).length;return S.getIdNotName=!n.getElementById(w),h.removeChild(e),t}),i.attrHandle=ot(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==L&&e.firstChild.getAttribute("href")==="#"})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},S.getIdNotName?(i.find.ID=function(e,t){if(typeof t.getElementById!==L&&!p){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==L&&!p){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==L&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=S.tagNameNoComments?function(e,t){if(typeof t.getElementsByTagName!==L)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if(e==="*"){for(;n=s[i];i++)n.nodeType===1&&r.push(n);return r}return s},i.find.NAME=S.getByName&&function(e,t){if(typeof t.getElementsByName!==L)return t.getElementsByName(name)},i.find.CLASS=S.getByClassName&&function(e,t){if(typeof t.getElementsByClassName!==L&&!p)return t.getElementsByClassName(e)},v=[],d=[":focus"];if(S.qsa=rt(n.querySelectorAll))ot(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+H+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||d.push(":checked")}),ot(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&d.push("[*^$]="+H+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),d.push(",.*:")});return(S.matchesSelector=rt(m=h.matchesSelector||h.mozMatchesSelector||h.webkitMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ot(function(e){S.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),v.push("!=",q)}),d=new RegExp(d.join("|")),v=new RegExp(v.join("|")),g=rt(h.contains)||h.compareDocumentPosition?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&r.nodeType===1&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16)}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},b=h.compareDocumentPosition?function(e,t){var r;if(e===t)return a=!0,0;if(r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))return r&1||e.parentNode&&e.parentNode.nodeType===11?e===n||g(E,e)?-1:t===n||g(E,t)?1:0:r&4?-1:1;return e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,s=e.parentNode,o=t.parentNode,u=[e],f=[t];if(e===t)return a=!0,0;if(e.sourceIndex&&t.sourceIndex)return(~t.sourceIndex||A)-(g(E,e)&&~e.sourceIndex||A);if(!s||!o)return e===n?-1:t===n?1:s?-1:o?1:0;if(s===o)return at(e,t);r=e;while(r=r.parentNode)u.unshift(r);r=t;while(r=r.parentNode)f.unshift(r);while(u[i]===f[i])i++;return i?at(u[i],f[i]):u[i]===E?-1:f[i]===E?1:0},a=!1,[0,0].sort(b),S.detectDuplicates=a,c},ut.matches=function(e,t){return ut(e,null,null,t)},ut.matchesSelector=function(e,t){(e.ownerDocument||e)!==c&&l(e),t=t.replace(Z,"='$1']");if(S.matchesSelector&&!p&&(!v||!v.test(t))&&!d.test(t))try{var n=m.call(e,t);if(n||S.disconnectedMatch||e.document&&e.document.nodeType!==11)return n}catch(r){}return ut(t,c,null,[e]).length>0},ut.contains=function(e,t){return(e.ownerDocument||e)!==c&&l(e),g(e,t)},ut.attr=function(e,t){var n;return(e.ownerDocument||e)!==c&&l(e),p||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):p||S.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},ut.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ut.uniqueSort=function(e){var t,n=[],r=1,i=0;a=!S.detectDuplicates,e.sort(b);if(a){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e},s=ut.getText=function(e){var t,n="",r=0,i=e.nodeType;if(!i)for(;t=e[r];r++)n+=s(t);else if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(i===3||i===4)return e.nodeValue;return n},i=ut.selectors={cacheLength:50,createPseudo:st,match:V,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1].slice(0,3)==="nth"?(e[3]||ut.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd")),e[5]=+(e[7]+e[8]||e[3]==="odd")):e[3]&&ut.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return V.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&W.test(n)&&(t=ht(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return e==="*"?function(){return!0}:(e=e.replace(et,tt).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=N[e+" "];return t||(t=new RegExp("(^|"+H+")"+e+"("+H+"|$)"))&&N(e,function(e){return t.test(e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=ut.attr(r,e);return i==null?t==="!=":t?(i+="",t==="="?i===n:t==="!="?i!==n:t==="^="?n&&i.indexOf(n)===0:t==="*="?n&&i.indexOf(n)>-1:t==="$="?n&&i.substr(i.length-n.length)===n:t==="~="?(" "+i+" ").indexOf(n)>-1:t==="|="?i===n||i.substr(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",u=t==="of-type";return r===1&&i===0?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:c.nodeType===1)return!1;d=v=e==="only"&&!d&&"nextSibling"}return!0}d=[o?m.firstChild:m.lastChild];if(o&&y){l=m[w]||(m[w]={}),f=l[e]||[],p=f[0]===x&&f[1],h=f[0]===x&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(c.nodeType===1&&++h&&c===t){l[e]=[x,p,h];break}}else if(y&&(f=(t[w]||(t[w]={}))[e])&&f[0]===x)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++h){y&&((c[w]||(c[w]={}))[e]=[x,h]);if(c===t)break}return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||ut.error("unsupported pseudo: "+e);return r[w]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?st(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=P.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:st(function(e){var t=[],n=[],r=u(e.replace(R,"$1"));return r[w]?st(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:st(function(e){return function(t){return ut(e,t).length>0}}),contains:st(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),lang:st(function(e){return X.test(e||"")||ut.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do if(n=p?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return n=n.toLowerCase(),n===e||n.indexOf(e+"-")===0;while((t=t.parentNode)&&t.nodeType===1);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===c.activeElement&&(!c.hasFocus||c.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||e.nodeType===3||e.nodeType===4)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return G.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()===e.type)},first:ct(function(){return[0]}),last:ct(function(e,t){return[t-1]}),eq:ct(function(e,t,n){return[n<0?n+t:n]}),even:ct(function(e,t){var n=0;for(;n<t;n+=2)e.push(n);return e}),odd:ct(function(e,t){var n=1;for(;n<t;n+=2)e.push(n);return e}),lt:ct(function(e,t,n){var r=n<0?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:ct(function(e,t,n){var r=n<0?n+t:n;for(;++r<t;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[n]=ft(n);for(n in{submit:!0,reset:!0})i.pseudos[n]=lt(n);u=ut.compile=function(e,t){var n,r=[],i=[],s=k[e+" "];if(!s){t||(t=ht(e)),n=t.length;while(n--)s=yt(t[n]),s[w]?r.push(s):i.push(s);s=k(e,bt(i,r))}return s},i.pseudos.nth=i.pseudos.eq,i.filters=St.prototype=i.pseudos,i.setFilters=new St,l(),ut.attr=y.attr,y.find=ut,y.expr=ut.selectors,y.expr[":"]=y.expr.pseudos,y.unique=ut.uniqueSort,y.text=ut.getText,y.isXMLDoc=ut.isXML,y.contains=ut.contains}(e);var it=/Until$/,st=/^(?:parents|prev(?:Until|All))/,ot=/^.[^:#\[\.,]*$/,ut=y.expr.match.needsContext,at={children:!0,contents:!0,next:!0,prev:!0};y.fn.extend({find:function(e){var t,n,r;if(typeof e!="string")return r=this,this.pushStack(y(e).filter(function(){for(t=0;t<r.length;t++)if(y.contains(r[t],this))return!0}));n=[];for(t=0;t<this.length;t++)y.find(e,this[t],n);return n=this.pushStack(y.unique(n)),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=y(e,this),r=n.length;return this.filter(function(){for(t=0;t<r;t++)if(y.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(lt(this,e,!1))},filter:function(e){return this.pushStack(lt(this,e,!0))},is:function(e){return!!e&&(typeof e=="string"?ut.test(e)?y(e,this.context).index(this[0])>=0:y.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,s=[],o=ut.test(e)||typeof e!="string"?y(e,t||this.context):0;for(;r<i;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&n.nodeType!==11){if(o?o.index(n)>-1:y.find.matchesSelector(n,e)){s.push(n);break}n=n.parentNode}}return this.pushStack(s.length>1?y.unique(s):s)},index:function(e){return e?typeof e=="string"?y.inArray(this[0],y(e)):y.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?y(e,t):y.makeArray(e&&e.nodeType?[e]:e),r=y.merge(this.get(),n);return this.pushStack(y.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),y.fn.andSelf=y.fn.addBack,y.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return y.dir(e,"parentNode")},parentsUntil:function(e,t,n){return y.dir(e,"parentNode",n)},next:function(e){return ft(e,"nextSibling")},prev:function(e){return ft(e,"previousSibling")},nextAll:function(e){return y.dir(e,"nextSibling")},prevAll:function(e){return y.dir(e,"previousSibling")},nextUntil:function(e,t,n){return y.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return y.dir(e,"previousSibling",n)},siblings:function(e){return y.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return y.sibling(e.firstChild)},contents:function(e){return y.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:y.merge([],e.childNodes)}},function(e,t){y.fn[e]=function(n,r){var i=y.map(this,t,n);return it.test(e)||(r=n),r&&typeof r=="string"&&(i=y.filter(r,i)),i=this.length>1&&!at[e]?y.unique(i):i,this.length>1&&st.test(e)&&(i=i.reverse()),this.pushStack(i)}}),y.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),t.length===1?y.find.matchesSelector(t[0],e)?[t[0]]:[]:y.find.matches(e,t)},dir:function(e,n,r){var i=[],s=e[n];while(s&&s.nodeType!==9&&(r===t||s.nodeType!==1||!y(s).is(r)))s.nodeType===1&&i.push(s),s=s[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var ht="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",pt=/ jQuery\d+="(?:null|\d+)"/g,dt=new RegExp("<(?:"+ht+")[\\s/>]","i"),vt=/^\s+/,mt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,gt=/<([\w:]+)/,yt=/<tbody/i,bt=/<|&#?\w+;/,wt=/<(?:script|style|link)/i,Et=/^(?:checkbox|radio)$/i,St=/checked\s*(?:[^=]|=\s*.checked.)/i,xt=/^$|\/(?:java|ecma)script/i,Tt=/^true\/(.*)/,Nt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ct={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:y.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},kt=ct(i),Lt=kt.appendChild(i.createElement("div"));Ct.optgroup=Ct.option,Ct.tbody=Ct.tfoot=Ct.colgroup=Ct.caption=Ct.thead,Ct.th=Ct.td,y.fn.extend({text:function(e){return y.access(this,function(e){return e===t?y.text(this):this.empty().append((this[0]&&this[0].ownerDocument||i).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(y.isFunction(e))return this.each(function(t){y(this).wrapAll(e.call(this,t))});if(this[0]){var t=y(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return y.isFunction(e)?this.each(function(t){y(this).wrapInner(e.call(this,t))}):this.each(function(){var t=y(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=y.isFunction(e);return this.each(function(n){y(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){y.nodeName(this,"body")||y(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=0;for(;(n=this[r])!=null;r++)if(!e||y.filter(e,[n]).length>0)!t&&n.nodeType===1&&y.cleanData(Ht(n)),n.parentNode&&(t&&y.contains(n.ownerDocument,n)&&_t(Ht(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){e.nodeType===1&&y.cleanData(Ht(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&y.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return y.clone(this,e,t)})},html:function(e){return y.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return n.nodeType===1?n.innerHTML.replace(pt,""):t;if(typeof e=="string"&&!wt.test(e)&&(y.support.htmlSerialize||!dt.test(e))&&(y.support.leadingWhitespace||!vt.test(e))&&!Ct[(gt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(mt,"<$1></$2>");try{for(;r<i;r++)n=this[r]||{},n.nodeType===1&&(y.cleanData(Ht(n,!1)),n.innerHTML=e);n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=y.isFunction(e);return!t&&typeof e!="string"&&(e=y(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;if(n&&this.nodeType===1||this.nodeType===11)y(this).remove(),t?t.parentNode.insertBefore(e,t):n.appendChild(e)})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=c.apply([],e);var i,s,o,u,a,f,l=0,h=this.length,p=this,d=h-1,v=e[0],m=y.isFunction(v);if(m||!(h<=1||typeof v!="string"||y.support.checkClone||!St.test(v)))return this.each(function(i){var s=p.eq(i);m&&(e[0]=v.call(this,i,n?s.html():t)),s.domManip(e,n,r)});if(h){i=y.buildFragment(e,this[0].ownerDocument,!1,this),s=i.firstChild,i.childNodes.length===1&&(i=s);if(s){n=n&&y.nodeName(s,"tr"),o=y.map(Ht(i,"script"),Ot),u=o.length;for(;l<h;l++)a=i,l!==d&&(a=y.clone(a,!0,!0),u&&y.merge(o,Ht(a,"script"))),r.call(n&&y.nodeName(this[l],"table")?At(this[l],"tbody"):this[l],a,l);if(u){f=o[o.length-1].ownerDocument,y.map(o,Mt);for(l=0;l<u;l++)a=o[l],xt.test(a.type||"")&&!y._data(a,"globalEval")&&y.contains(f,a)&&(a.src?y.ajax({url:a.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):y.globalEval((a.text||a.textContent||a.innerHTML||"").replace(Nt,"")))}i=s=null}}return this}}),y.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){y.fn[e]=function(e){var n,r=0,i=[],s=y(e),o=s.length-1;for(;r<=o;r++)n=r===o?this:this.clone(!0),y(s[r])[t](n),h.apply(i,n.get());return this.pushStack(i)}}),y.extend({clone:function(e,t,n){var r,i,s,o,u,a=y.contains(e.ownerDocument,e);y.support.html5Clone||y.isXMLDoc(e)||!dt.test("<"+e.nodeName+">")?u=e.cloneNode(!0):(Lt.innerHTML=e.outerHTML,Lt.removeChild(u=Lt.firstChild));if((!y.support.noCloneEvent||!y.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!y.isXMLDoc(e)){r=Ht(u),i=Ht(e);for(o=0;(s=i[o])!=null;++o)r[o]&&Pt(s,r[o])}if(t)if(n){i=i||Ht(e),r=r||Ht(u);for(o=0;(s=i[o])!=null;o++)Dt(s,r[o])}else Dt(e,u);return r=Ht(u,"script"),r.length>0&&_t(r,!a&&Ht(e,"script")),r=i=s=null,u},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l,c=e.length,h=ct(t),p=[],d=0;for(;d<c;d++){s=e[d];if(s||s===0)if(y.type(s)==="object")y.merge(p,s.nodeType?[s]:s);else if(!bt.test(s))p.push(t.createTextNode(s));else{u=u||h.appendChild(t.createElement("div")),o=(gt.exec(s)||["",""])[1].toLowerCase(),a=Ct[o]||Ct._default,u.innerHTML=a[1]+s.replace(mt,"<$1></$2>")+a[2],l=a[0];while(l--)u=u.lastChild;!y.support.leadingWhitespace&&vt.test(s)&&p.push(t.createTextNode(vt.exec(s)[0]));if(!y.support.tbody){s=o==="table"&&!yt.test(s)?u.firstChild:a[1]==="<table>"&&!yt.test(s)?u:0,l=s&&s.childNodes.length;while(l--)y.nodeName(f=s.childNodes[l],"tbody")&&!f.childNodes.length&&s.removeChild(f)}y.merge(p,u.childNodes),u.textContent="";while(u.firstChild)u.removeChild(u.firstChild);u=h.lastChild}}u&&h.removeChild(u),y.support.appendChecked||y.grep(Ht(p,"input"),Bt),d=0;while(s=p[d++]){if(r&&y.inArray(s,r)!==-1)continue;i=y.contains(s.ownerDocument,s),u=Ht(h.appendChild(s),"script"),i&&_t(u);if(n){l=0;while(s=u[l++])xt.test(s.type||"")&&n.push(s)}}return u=null,h},cleanData:function(e,t){var n,r,i,s,o=0,u=y.expando,a=y.cache,l=y.support.deleteExpando,c=y.event.special;for(;(i=e[o])!=null;o++)if(t||y.acceptData(i)){r=i[u],n=r&&a[r];if(n){if(n.events)for(s in n.events)c[s]?y.event.remove(i,s):y.removeEvent(i,s,n.handle);a[r]&&(delete a[r],l?delete i[u]:typeof i.removeAttribute!="undefined"?i.removeAttribute(u):i[u]=null,f.push(r))}}}});var jt,Ft,It,qt=/alpha\([^)]*\)/i,Rt=/opacity\s*=\s*([^)]*)/,Ut=/^(top|right|bottom|left)$/,zt=/^(none|table(?!-c[ea]).+)/,Wt=/^margin/,Xt=new RegExp("^("+b+")(.*)$","i"),Vt=new RegExp("^("+b+")(?!px)[a-z%]+$","i"),$t=new RegExp("^([+-])=("+b+")","i"),Jt={BODY:"block"},Kt={position:"absolute",visibility:"hidden",display:"block"},Qt={letterSpacing:0,fontWeight:400},Gt=["Top","Right","Bottom","Left"],Yt=["Webkit","O","Moz","ms"];y.fn.extend({css:function(e,n){return y.access(this,function(e,n,r){var i,s,o={},u=0;if(y.isArray(n)){i=Ft(e),s=n.length;for(;u<s;u++)o[n[u]]=y.css(e,n[u],!1,i);return o}return r!==t?y.style(e,n,r):y.css(e,n)},e,n,arguments.length>1)},show:function(){return tn(this,!0)},hide:function(){return tn(this)},toggle:function(e){var t=typeof e=="boolean";return this.each(function(){(t?e:en(this))?y(this).show():y(this).hide()})}}),y.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=jt(e,"opacity");return n===""?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":y.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var s,o,u,a=y.camelCase(n),f=e.style;n=y.cssProps[a]||(y.cssProps[a]=Zt(f,a)),u=y.cssHooks[n]||y.cssHooks[a];if(r===t)return u&&"get"in u&&(s=u.get(e,!1,i))!==t?s:f[n];o=typeof r,o==="string"&&(s=$t.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(y.css(e,n)),o="number");if(r==null||o==="number"&&isNaN(r))return;o==="number"&&!y.cssNumber[a]&&(r+="px"),!y.support.clearCloneStyle&&r===""&&n.indexOf("background")===0&&(f[n]="inherit");if(!u||!("set"in u)||(r=u.set(e,r,i))!==t)try{f[n]=r}catch(l){}},css:function(e,n,r,i){var s,o,u,a=y.camelCase(n);return n=y.cssProps[a]||(y.cssProps[a]=Zt(e.style,a)),u=y.cssHooks[n]||y.cssHooks[a],u&&"get"in u&&(s=u.get(e,!0,r)),s===t&&(s=jt(e,n,i)),s==="normal"&&n in Qt&&(s=Qt[n]),r?(o=parseFloat(s),r===!0||y.isNumeric(o)?o||0:s):s},swap:function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i}}),e.getComputedStyle?(Ft=function(t){return e.getComputedStyle(t,null)},jt=function(e,n,r){var i,s,o,u=r||Ft(e),a=u?u.getPropertyValue(n)||u[n]:t,f=e.style;return u&&(a===""&&!y.contains(e.ownerDocument,e)&&(a=y.style(e,n)),Vt.test(a)&&Wt.test(n)&&(i=f.width,s=f.minWidth,o=f.maxWidth,f.minWidth=f.maxWidth=f.width=a,a=u.width,f.width=i,f.minWidth=s,f.maxWidth=o)),a}):i.documentElement.currentStyle&&(Ft=function(e){return e.currentStyle},jt=function(e,n,r){var i,s,o,u=r||Ft(e),a=u?u[n]:t,f=e.style;return a==null&&f&&f[n]&&(a=f[n]),Vt.test(a)&&!Ut.test(n)&&(i=f.left,s=e.runtimeStyle,o=s&&s.left,o&&(s.left=e.currentStyle.left),f.left=n==="fontSize"?"1em":a,a=f.pixelLeft+"px",f.left=i,o&&(s.left=o)),a===""?"auto":a}),y.each(["height","width"],function(e,t){y.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&zt.test(y.css(e,"display"))?y.swap(e,Kt,function(){return sn(e,t,r)}):sn(e,t,r)},set:function(e,n,r){var i=r&&Ft(e);return nn(e,n,r?rn(e,t,r,y.support.boxSizing&&y.css(e,"boxSizing",!1,i)==="border-box",i):0)}}}),y.support.opacity||(y.cssHooks.opacity={get:function(e,t){return Rt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=y.isNumeric(t)?"alpha(opacity="+t*100+")":"",s=r&&r.filter||n.filter||"";n.zoom=1;if((t>=1||t==="")&&y.trim(s.replace(qt,""))===""&&n.removeAttribute){n.removeAttribute("filter");if(t===""||r&&!r.filter)return}n.filter=qt.test(s)?s.replace(qt,i):s+" "+i}}),y(function(){y.support.reliableMarginRight||(y.cssHooks.marginRight={get:function(e,t){if(t)return y.swap(e,{display:"inline-block"},jt,[e,"marginRight"])}}),!y.support.pixelPosition&&y.fn.position&&y.each(["top","left"],function(e,t){y.cssHooks[t]={get:function(e,n){if(n)return n=jt(e,t),Vt.test(n)?y(e).position()[t]+"px":n}}})}),y.expr&&y.expr.filters&&(y.expr.filters.hidden=function(e){return e.offsetWidth===0&&e.offsetHeight===0||!y.support.reliableHiddenOffsets&&(e.style&&e.style.display||y.css(e,"display"))==="none"},y.expr.filters.visible=function(e){return!y.expr.filters.hidden(e)}),y.each({margin:"",padding:"",border:"Width"},function(e,t){y.cssHooks[e+t]={expand:function(n){var r=0,i={},s=typeof n=="string"?n.split(" "):[n];for(;r<4;r++)i[e+Gt[r]+t]=s[r]||s[r-2]||s[0];return i}},Wt.test(e)||(y.cssHooks[e+t].set=nn)});var an=/%20/g,fn=/\[\]$/,ln=/\r?\n/g,cn=/^(?:submit|button|image|reset)$/i,hn=/^(?:input|select|textarea|keygen)/i;y.fn.extend({serialize:function(){return y.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=y.prop(this,"elements");return e?y.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!y(this).is(":disabled")&&hn.test(this.nodeName)&&!cn.test(e)&&(this.checked||!Et.test(e))}).map(function(e,t){var n=y(this).val();return n==null?null:y.isArray(n)?y.map(n,function(e){return{name:t.name,value:e.replace(ln,"\r\n")}}):{name:t.name,value:n.replace(ln,"\r\n")}}).get()}}),y.param=function(e,n){var r,i=[],s=function(e,t){t=y.isFunction(t)?t():t==null?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=y.ajaxSettings&&y.ajaxSettings.traditional);if(y.isArray(e)||e.jquery&&!y.isPlainObject(e))y.each(e,function(){s(this.name,this.value)});else for(r in e)pn(r,e[r],n,s);return i.join("&").replace(an,"+")};var dn,vn,mn=y.now(),gn=/\?/,yn=/#.*$/,bn=/([?&])_=[^&]*/,wn=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,En=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Sn=/^(?:GET|HEAD)$/,xn=/^\/\//,Tn=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Nn=y.fn.load,Cn={},kn={},Ln="*/".concat("*");try{vn=s.href}catch(An){vn=i.createElement("a"),vn.href="",vn=vn.href}dn=Tn.exec(vn.toLowerCase())||[],y.fn.load=function(e,n,r){if(typeof e!="string"&&Nn)return Nn.apply(this,arguments);var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),y.isFunction(n)?(r=n,n=t):n&&typeof n=="object"&&(s="POST"),u.length>0&&y.ajax({url:e,type:s,dataType:"html",data:n}).done(function(e){o=arguments,u.html(i?y("<div>").append(y.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){u.each(r,o||[e.responseText,t,e])}),this},y.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){y.fn[t]=function(e){return this.on(t,e)}}),y.each(["get","post"],function(e,n){y[n]=function(e,r,i,s){return y.isFunction(r)&&(s=s||i,i=r,r=t),y.ajax({url:e,type:n,dataType:s,data:r,success:i})}}),y.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:vn,type:"GET",isLocal:En.test(dn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ln,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":y.parseJSON,"text xml":y.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?_n(_n(e,y.ajaxSettings),t):_n(y.ajaxSettings,e)},ajaxPrefilter:On(Cn),ajaxTransport:On(kn),ajax:function(e,n){function N(e,n,o,a){var l,g,b,w,S,T=n;if(E===2)return;E=2,u&&clearTimeout(u),r=t,s=a||"",x.readyState=e>0?4:0,o&&(w=Dn(c,x,o));if(e>=200&&e<300||e===304)c.ifModified&&(S=x.getResponseHeader("Last-Modified"),S&&(y.lastModified[i]=S),S=x.getResponseHeader("etag"),S&&(y.etag[i]=S)),e===304?(l=!0,T="notmodified"):(l=Pn(c,w),T=l.state,g=l.data,b=l.error,l=!b);else{b=T;if(e||!T)T="error",e<0&&(e=0)}x.status=e,x.statusText=(n||T)+"",l?d.resolveWith(h,[g,T,x]):d.rejectWith(h,[x,T,b]),x.statusCode(m),m=t,f&&p.trigger(l?"ajaxSuccess":"ajaxError",[x,c,l?g:b]),v.fireWith(h,[x,T]),f&&(p.trigger("ajaxComplete",[x,c]),--y.active||y.event.trigger("ajaxStop"))}typeof e=="object"&&(n=e,e=t),n=n||{};var r,i,s,o,u,a,f,l,c=y.ajaxSetup({},n),h=c.context||c,p=c.context&&(h.nodeType||h.jquery)?y(h):y.event,d=y.Deferred(),v=y.Callbacks("once memory"),m=c.statusCode||{},g={},b={},E=0,S="canceled",x={readyState:0,getResponseHeader:function(e){var t;if(E===2){if(!o){o={};while(t=wn.exec(s))o[t[1].toLowerCase()]=t[2]}t=o[e.toLowerCase()]}return t==null?null:t},getAllResponseHeaders:function(){return E===2?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return E||(e=b[n]=b[n]||e,g[e]=t),this},overrideMimeType:function(e){return E||(c.mimeType=e),this},statusCode:function(e){var t;if(e)if(E<2)for(t in e)m[t]=[m[t],e[t]];else x.always(e[x.status]);return this},abort:function(e){var t=e||S;return r&&r.abort(t),N(0,t),this}};d.promise(x).complete=v.add,x.success=x.done,x.error=x.fail,c.url=((e||c.url||vn)+"").replace(yn,"").replace(xn,dn[1]+"//"),c.type=n.method||n.type||c.method||c.type,c.dataTypes=y.trim(c.dataType||"*").toLowerCase().match(w)||[""],c.crossDomain==null&&(a=Tn.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===dn[1]&&a[2]===dn[2]&&(a[3]||(a[1]==="http:"?80:443))==(dn[3]||(dn[1]==="http:"?80:443)))),c.data&&c.processData&&typeof c.data!="string"&&(c.data=y.param(c.data,c.traditional)),Mn(Cn,c,n,x);if(E===2)return x;f=c.global,f&&y.active++===0&&y.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!Sn.test(c.type),i=c.url,c.hasContent||(c.data&&(i=c.url+=(gn.test(i)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=bn.test(i)?i.replace(bn,"$1_="+mn++):i+(gn.test(i)?"&":"?")+"_="+mn++)),c.ifModified&&(y.lastModified[i]&&x.setRequestHeader("If-Modified-Since",y.lastModified[i]),y.etag[i]&&x.setRequestHeader("If-None-Match",y.etag[i])),(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader("Content-Type",c.contentType),x.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+(c.dataTypes[0]!=="*"?", "+Ln+"; q=0.01":""):c.accepts["*"]);for(l in c.headers)x.setRequestHeader(l,c.headers[l]);if(!c.beforeSend||c.beforeSend.call(h,x,c)!==!1&&E!==2){S="abort";for(l in{success:1,error:1,complete:1})x[l](c[l]);r=Mn(kn,c,n,x);if(!r)N(-1,"No Transport");else{x.readyState=1,f&&p.trigger("ajaxSend",[x,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){x.abort("timeout")},c.timeout));try{E=1,r.send(g,N)}catch(T){if(!(E<2))throw T;N(-1,T)}}return x}return x.abort()},getScript:function(e,n){return y.get(e,t,n,"script")},getJSON:function(e,t,n){return y.get(e,t,n,"json")}}),y.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return y.globalEval(e),e}}}),y.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),y.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=i.head||y("head")[0]||i.documentElement;return{send:function(t,s){n=i.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){if(t||!n.readyState||/loaded|complete/.test(n.readyState))n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||s(200,"success")},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var Hn=[],Bn=/(=)\?(?=&|$)|\?\?/;y.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Hn.pop()||y.expando+"_"+mn++;return this[e]=!0,e}}),y.ajaxPrefilter("json jsonp",function(n,r,i){var s,o,u,a=n.jsonp!==!1&&(Bn.test(n.url)?"url":typeof n.data=="string"&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bn.test(n.data)&&"data");if(a||n.dataTypes[0]==="jsonp")return s=n.jsonpCallback=y.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,a?n[a]=n[a].replace(Bn,"$1"+s):n.jsonp!==!1&&(n.url+=(gn.test(n.url)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return u||y.error(s+" was not called"),u[0]},n.dataTypes[0]="json",o=e[s],e[s]=function(){u=arguments},i.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,Hn.push(s)),u&&y.isFunction(o)&&o(u[0]),u=o=t}),"script"});var jn,Fn,In=0,qn=e.ActiveXObject&&function(){var e;for(e in jn)jn[e](t,!0)};y.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&Rn()||Un()}:Rn,Fn=y.ajaxSettings.xhr(),y.support.cors=!!Fn&&"withCredentials"in Fn,Fn=y.support.ajax=!!Fn,Fn&&y.ajaxTransport(function(n){if(!n.crossDomain||y.support.cors){var r;return{send:function(i,s){var o,u,a=n.xhr();n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async);if(n.xhrFields)for(u in n.xhrFields)a[u]=n.xhrFields[u];n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(u in i)a.setRequestHeader(u,i[u])}catch(f){}a.send(n.hasContent&&n.data||null),r=function(e,i){var u,f,l,c,h;try{if(r&&(i||a.readyState===4)){r=t,o&&(a.onreadystatechange=y.noop,qn&&delete jn[o]);if(i)a.readyState!==4&&a.abort();else{c={},u=a.status,h=a.responseXML,l=a.getAllResponseHeaders(),h&&h.documentElement&&(c.xml=h),typeof a.responseText=="string"&&(c.text=a.responseText);try{f=a.statusText}catch(p){f=""}!u&&n.isLocal&&!n.crossDomain?u=c.text?200:404:u===1223&&(u=204)}}}catch(d){i||s(-1,d)}c&&s(u,f,c,l)},n.async?a.readyState===4?setTimeout(r):(o=++In,qn&&(jn||(jn={},y(e).unload(qn)),jn[o]=r),a.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var zn,Wn,Xn=/^(?:toggle|show|hide)$/,Vn=new RegExp("^(?:([+-])=|)("+b+")([a-z%]*)$","i"),$n=/queueHooks$/,Jn=[er],Kn={"*":[function(e,t){var n,r,i=this.createTween(e,t),s=Vn.exec(t),o=i.cur(),u=+o||0,a=1,f=20;if(s){n=+s[2],r=s[3]||(y.cssNumber[e]?"":"px");if(r!=="px"&&u){u=y.css(i.elem,e,!0)||n||1;do a=a||".5",u/=a,y.style(i.elem,e,u+r);while(a!==(a=i.cur()/o)&&a!==1&&--f)}i.unit=r,i.start=u,i.end=s[1]?u+(s[1]+1)*n:n}return i}]};y.Animation=y.extend(Yn,{tweener:function(e,t){y.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],Kn[n]=Kn[n]||[],Kn[n].unshift(t)},prefilter:function(e,t){t?Jn.unshift(e):Jn.push(e)}}),y.Tween=tr,tr.prototype={constructor:tr,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(y.cssNumber[n]?"":"px")},cur:function(){var e=tr.propHooks[this.prop];return e&&e.get?e.get(this):tr.propHooks._default.get(this)},run:function(e){var t,n=tr.propHooks[this.prop];return this.options.duration?this.pos=t=y.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):tr.propHooks._default.set(this),this}},tr.prototype.init.prototype=tr.prototype,tr.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=y.css(e.elem,e.prop,"auto"),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){y.fx.step[e.prop]?y.fx.step[e.prop](e):e.elem.style&&(e.elem.style[y.cssProps[e.prop]]!=null||y.cssHooks[e.prop])?y.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},tr.propHooks.scrollTop=tr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},y.each(["toggle","show","hide"],function(e,t){var n=y.fn[t];y.fn[t]=function(e,r,i){return e==null||typeof e=="boolean"?n.apply(this,arguments):this.animate(nr(t,!0),e,r,i)}}),y.fn.extend({fadeTo:function(e,t,n,r){return this.filter(en).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=y.isEmptyObject(e),s=y.speed(t,n,r),o=function(){var t=Yn(this,y.extend({},e),s);o.finish=function(){t.stop(!0)},(i||y._data(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return typeof e!="string"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=e!=null&&e+"queueHooks",s=y.timers,o=y._data(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&$n.test(n)&&i(o[n]);for(n=s.length;n--;)s[n].elem===this&&(e==null||s[n].queue===e)&&(s[n].anim.stop(r),t=!1,s.splice(n,1));(t||!r)&&y.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=y._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=y.timers,o=r?r.length:0;n.finish=!0,y.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this);for(t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),y.each({slideDown:nr("show"),slideUp:nr("hide"),slideToggle:nr("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){y.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),y.speed=function(e,t,n){var r=e&&typeof e=="object"?y.extend({},e):{complete:n||!n&&t||y.isFunction(e)&&e,duration:e,easing:n&&t||t&&!y.isFunction(t)&&t};r.duration=y.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in y.fx.speeds?y.fx.speeds[r.duration]:y.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){y.isFunction(r.old)&&r.old.call(this),r.queue&&y.dequeue(this,r.queue)},r},y.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},y.timers=[],y.fx=tr.prototype.init,y.fx.tick=function(){var e,n=y.timers,r=0;zn=y.now();for(;r<n.length;r++)e=n[r],!e()&&n[r]===e&&n.splice(r--,1);n.length||y.fx.stop(),zn=t},y.fx.timer=function(e){e()&&y.timers.push(e)&&y.fx.start()},y.fx.interval=13,y.fx.start=function(){Wn||(Wn=setInterval(y.fx.tick,y.fx.interval))},y.fx.stop=function(){clearInterval(Wn),Wn=null},y.fx.speeds={slow:600,fast:200,_default:400},y.fx.step={},y.expr&&y.expr.filters&&(y.expr.filters.animated=function(e){return y.grep(y.timers,function(t){return e===t.elem}).length}),y.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){y.offset.setOffset(this,e,t)});var n,r,i={top:0,left:0},s=this[0],o=s&&s.ownerDocument;if(!o)return;return n=o.documentElement,y.contains(n,s)?(typeof s.getBoundingClientRect!="undefined"&&(i=s.getBoundingClientRect()),r=rr(o),{top:i.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:i.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):i},y.offset={setOffset:function(e,t,n){var r=y.css(e,"position");r==="static"&&(e.style.position="relative");var i=y(e),s=i.offset(),o=y.css(e,"top"),u=y.css(e,"left"),a=(r==="absolute"||r==="fixed")&&y.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),y.isFunction(t)&&(t=t.call(e,n,s)),t.top!=null&&(f.top=t.top-s.top+c),t.left!=null&&(f.left=t.left-s.left+h),"using"in t?t.using.call(e,f):i.css(f)}},y.fn.extend({position:function(){if(!this[0])return;var e,t,n={top:0,left:0},r=this[0];return y.css(r,"position")==="fixed"?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),y.nodeName(e[0],"html")||(n=e.offset()),n.top+=y.css(e[0],"borderTopWidth",!0),n.left+=y.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-y.css(r,"marginTop",!0),left:t.left-n.left-y.css(r,"marginLeft",!0)}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||i.documentElement;while(e&&!y.nodeName(e,"html")&&y.css(e,"position")==="static")e=e.offsetParent;return e||i.documentElement})}}),y.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);y.fn[e]=function(i){return y.access(this,function(e,i,s){var o=rr(e);if(s===t)return o?n in o?o[n]:o.document.documentElement[i]:e[i];o?o.scrollTo(r?y(o).scrollLeft():s,r?s:y(o).scrollTop()):e[i]=s},e,i,arguments.length,null)}}),y.each({Height:"height",Width:"width"},function(e,n){y.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){y.fn[i]=function(i,s){var o=arguments.length&&(r||typeof i!="boolean"),u=r||(i===!0||s===!0?"margin":"border");return y.access(this,function(n,r,i){var s;return y.isWindow(n)?n.document.documentElement["client"+e]:n.nodeType===9?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):i===t?y.css(n,r,u):y.style(n,r,i,u)},n,o?i:t,o,null)}})}),e.jQuery=e.$=y,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return y})}(window),define("sge/config",[],function(){return{baseUrl:""}}),function(e){function o(t){var n=t.split("."),r=e;for(var i=0;i<n.length-1;i++)r[n[i]]||(r[n[i]]={}),r=r[n[i]]}function u(t,n){var r=t.split("."),i=e;for(var s=0;s<r.length-1;s++){if(!i[r[s]])return console.log("    Error assigning value to namespace :"+t+". '"+r[s]+"' does not exist."),null;i=i[r[s]]}return i[r[r.length-1]]=n,i[r[r.length-1]]}function a(t){var n=t.split("."),r=e;for(var i=0;i<n.length;i++){if(!r[n[i]])return null;r=r[n[i]]}return r}String.prototype.endsWith=function(e){return this.indexOf(e,this.length-e.length)!==-1},Function.prototype.bind=Function.prototype.bind||function(){var e=this,t=Array.prototype.slice.call(arguments),n=t.shift();return function(){return e.apply(n,t.concat(Array.prototype.slice.call(arguments)))}},e.isArray=function(e){return typeof e=="object"&&e instanceof Array},e.isString=function(e){return typeof e=="string"},e.isFunction=function(e){return typeof e=="function"};var t=!1,n=function(){};n.extend=function(e,r,i,s,a){function c(){!t&&this.__init&&this.__init.apply(this,arguments)}var f=this.prototype;t=!0;var l=new this;t=!1,c.prototype=l,c.prototype.constructor=c,c.superclass=f,c.extend=n.extend,u(i,c);if(r){r=isFunction(r)?r():r;for(var h in r)r.hasOwnProperty(h)&&(c[h]=r[h])}c.__CLASS=i;if(s){isArray(s)||(s=[s]);for(var p=0;p<s.length;p++){o(s[p]);var d=u(s[p],c);if(r)for(var h in r)r.hasOwnProperty(h)&&(d[h]=r[h])}}e=isFunction(e)?e():e;for(var v in e)l[v]=(v==="__init"||a&&a.decorated)&&isFunction(e[v])&&isFunction(f[v])?function(e,t){return function(){var n=this.__super;this.__super=f[e];var r=t.apply(this,arguments);return this.__super=n,r}}(v,e[v]):e[v];return c};var r=function(e){return this.name=e.defines,this.extendWith=e.extendsWith,this.callback=e.onCreate,this.callbackPreCreation=e.onPreCreate,this.dependencies=e.depends,this.baseClass=e.extendsClass,this.aliases=e.aliases,this.constants=e.constants,this.decorated=e.decorated,this.children=[],this};r.prototype={children:null,name:null,extendWith:null,callback:null,dependencies:null,baseClass:null,aliases:null,constants:null,decorated:!1,solved:!1,visited:!1,status:function(){console.log("  Module: "+this.name+(this.dependencies.length?" unsolved_deps:["+this.dependencies+"]":" no dependencies.")+(this.solved?" solved":" ------> NOT solved."))},removeDependency:function(e){for(var t=0;t<this.dependencies.length;t++)if(this.dependencies[t]===e){this.dependencies.splice(t,1);break}},assignDependency:function(e){var t;for(t=0;t<this.dependencies.length;t++)if(this.dependencies[t]===e.name){this.children.push(e),this.dependencies.splice(t,1);break}},isSolved:function(){return this.solved},solveDeep:function(){if(this.visited)return!0;this.visited=!0;if(this.solved)return!0;if(this.dependencies.length!==0)return!1;var e=!0;for(var t=0;t<this.children.length;t++)if(!this.children[t].solveDeep())return!1;return this.__initModule(),this.solved=!0,f.solved(this),!0},__initModule:function(){var e=null;if(this.baseClass){e=a(this.baseClass);if(!e){console.log("  "+this.name+" -> Can't extend non-existant class: "+this.baseClass);return}}else e=n;e=e.extend(this.extendWith,this.constants,this.name,this.aliases,{decorated:this.decorated}),console.log("Created module: "+this.name),this.callback&&this.callback()}};var i=function(e,t){return this.path=e,this.module=t,this};i.prototype={path:null,processed:!1,module:null,setProcessed:function(){this.processed=!0},isProcessed:function(){return this.processed}};var s=function(){return this.nodes=[],this.loadedFiles=[],this.path={},this.solveListener=[],this.orderedSolvedModules=[],this.readyListener=[],this};s.baseURL="",s.modulePath={},s.sortedModulePath=[],s.symbol={},s.prototype={nodes:null,loadedFiles:null,solveListener:null,readyListener:null,orderedSolvedModules:null,addSolvedListener:function(e,t){this.solveListener.push({name:e,callback:t})},solved:function(e){var t;for(t=0;t<this.solveListener.length;t++)this.solveListener[t].name===e.name&&this.solveListener[t].callback();this.orderedSolvedModules.push(e),this.notifyReady()},notifyReady:function(){var e;for(e=0;e<this.nodes.length;e++)if(!this.nodes[e].isSolved())return;for(e=0;e<this.loadedFiles.length;e++)if(!this.loadedFiles[e].isProcessed())return;var t=this,n=Array.prototype.slice.call(this.readyListener);setTimeout(function(){for(var e=0;e<n.length;e++)n[e]()},0),this.readyListener=[]},status:function(){for(var e=0;e<this.nodes.length;e++)this.nodes[e].status()},module:function(e){var t,n,i;if(this.isModuleScheduledToSolve(e.defines))return this;if(e.onPreCreate)try{e.onPreCreate()}catch(s){console.log("  -> catched "+s+" on module "+e.defines+" preCreation.")}e.depends||(e.depends=[]);var o=e.depends;o&&(isArray(o)||(o=[o],e.depends=o)),i=0;while(i<o.length)this.alreadySolved(o[i])?o.splice(i,1):i++;n=new r(e);for(var i=0;i<this.nodes.length;i++)this.nodes[i].assignDependency(n);this.nodes.push(n);for(i=0;i<e.depends.length;)if(this.isModuleScheduledToSolve(e.depends[i])){var u=this.findNode(e.depends[i]);null!==u?n.assignDependency(u):(alert("Module loaded and does not exist in loaded modules nodes. "+e.depends[i]),i++)}else i+=1;return function(e,t){setTimeout(function(){for(i=0;i<t.depends.length;i++)e.loadFile(t.depends[i])},0)}(this,e),this},findNode:function(e){for(var t=0;t<this.nodes.length;t++)if(this.nodes[t].name===e)return this.nodes[t];return null},alreadySolved:function(e){for(var t=0;t<this.nodes.length;t++)if(this.nodes[t].name===e&&this.nodes[t].isSolved())return!0;return!1},exists:function(t){var t=t.split("."),n=e;for(var r=0;r<t.length;r++){if(!n[t[r]])return!1;n=n[t[r]]}return!0},loadFile:function(e){if(this.exists(e))return;var t=this.getPath(e);for(var n=0;n<this.loadedFiles.length;n++)if(this.loadedFiles[n].path===t)return;var r=new i(t,e);this.loadedFiles.push(r);var s=document.createElement("script");s.type="text/javascript",s.charset="utf-8",s.async=!0,s.addEventListener("load",this.moduleLoaded.bind(this),!1),s.addEventListener("error",this.moduleErrored.bind(this),!1),s.setAttribute("module-name",e),s.src=t+(l?"":"?"+(new Date).getTime()),document.getElementsByTagName("head")[0].appendChild(s)},getPath:function(e){if(e.endsWith(".js"))return e.charAt(0)!=="/"?e=s.baseURL+e:e=e.substring(1),e;var t,n;for(n in s.symbol)if(e===n)return s.baseURL+s.symbol[n];for(t=0;t<s.sortedModulePath.length;t++){var r=s.sortedModulePath[t];if(s.modulePath.hasOwnProperty(r)){var i=s.modulePath[r];if(e.indexOf(r)===0){var o=e.substring(r.length+1);return o=o.replace(/\./g,"/"),o=i+o+".js",s.baseURL+o}}}return s.baseURL+e.replace(/\./g,"/")+".js"},isModuleScheduledToSolve:function(e){for(var t=0;t<this.nodes.length;t++)if(this.nodes[t].name===e)return!0;return!1},moduleLoaded:function(e){if(e.type==="load"){var t=e.currentTarget||e.srcElement||e.target,n=t.getAttribute("module-name");for(var r=0;r<this.loadedFiles.length;r++)if(this.loadedFiles[r].module===n){this.loadedFiles[r].setProcessed();break}for(var r=0;r<this.nodes.length;r++)this.nodes[r].removeDependency(n);for(var r=0;r<this.nodes.length;r++){for(var i=0;i<this.nodes.length;i++)this.nodes[i].visited=!1;this.nodes[r].solveDeep()}var s=this;setTimeout(function(){s.notifyReady()},0)}},moduleErrored:function(e){var t=e.currentTarget||e.srcElement;console.log("Error loading module: "+t.getAttribute("module-name"))},solvedInOrder:function(){for(var e=0;e<this.orderedSolvedModules.length;e++)console.log(this.orderedSolvedModules[e].name)},solveAll:function(){for(var e=0;e<this.nodes.length;e++)this.nodes[e].solveDeep()},onReady:function(e){this.readyListener.push(e)}};var f=new s,l=!1;e.CAAT=e.CAAT||{},CAAT.Module=function(t){if(!t.defines){console.error("Bad module definition: "+t);return}o(t.defines),f.module(t)},CAAT.ModuleManager={},CAAT.ModuleManager.baseURL=function(e){return e?(e.endsWith("/")||(e+="/"),s.baseURL=e,CAAT.ModuleManager):CAAT.Module},CAAT.ModuleManager.setModulePath=function(e,t){return t.endsWith("/")||(t+="/"),s.modulePath[e]||(s.modulePath[e]=t,s.sortedModulePath.push(e),s.sortedModulePath.sort(function(e,t){return e==t?0:e<t?1:-1})),CAAT.ModuleManager},CAAT.ModuleManager.symbol=function(e,t){return s.symbol[e]||(s.symbol[e]=t),CAAT.ModuleManager},CAAT.ModuleManager.bring=function(e){isArray(e)||(e=[e]);for(var t=0;t<e.length;t++)f.loadFile(e[t]);return CAAT.ModuleManager},CAAT.ModuleManager.status=function(){f.status()},CAAT.ModuleManager.addModuleSolvedListener=function(e,t){return f.addSolveListener(e,t),CAAT.ModuleManager},CAAT.ModuleManager.load=function(e,t,n){var r=document.createElement("script");r.type="text/javascript",r.charset="utf-8",r.async=!0,t&&r.addEventListener("load",t,!1),n&&r.addEventListener("error",n,!1),r.addEventListener("load",function(){f.solveAll()},!1),r.src=e+(l?"":"?"+(new Date).getTime()),document.getElementsByTagName("head")[0].appendChild(r)},CAAT.ModuleManager.solvedInOrder=function(){f.solvedInOrder()},CAAT.ModuleManager.onReady=function(e){return f.onReady(e),CAAT.ModuleManager},CAAT.ModuleManager.solveAll=function(){f.solveAll()},CAAT.ModuleManager.debug=function(e){return l=e,CAAT.ModuleManager},CAAT.Class=n}(this),CAAT.Module({defines:"CAAT.Core.Constants",depends:["CAAT.Math.Matrix"],extendsWith:function(){return CAAT.CLAMP=!1,CAAT.setCoordinateClamping=function(e){CAAT.CLAMP=e,CAAT.Math.Matrix.setCoordinateClamping(e)},CAAT.log=function(){window.console&&window.console.log(Array.prototype.slice.call(arguments))},CAAT.CSS_TEXT_METRICS=0,CAAT.GLRENDER=!1,CAAT.DEBUG=!1,CAAT.DEBUGBB=!1,CAAT.DEBUGBBBCOLOR="#00f",CAAT.DEBUGAABB=!1,CAAT.DEBUGAABBCOLOR="#f00",CAAT.DEBUG_DIRTYRECTS=!1,CAAT.DRAG_THRESHOLD_X=5,CAAT.DRAG_THRESHOLD_Y=5,CAAT.CACHE_SCENE_ON_CHANGE=!0,{}}}),extend=function(e,t){var n=e.prototype,r=function(){};r.prototype=t.prototype,e.prototype=new r,e.superclass=t.prototype,e.prototype.constructor=e,t.prototype.constructor===Object.prototype.constructor&&(t.prototype.constructor=t);for(var i in n)n.hasOwnProperty(i)&&(e.prototype[i]=n[i])},extendWith=function(e,t,n){var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.superclass=e.prototype,t.prototype.constructor=t,e.prototype.constructor===Object.prototype.constructor&&(e.prototype.constructor=e);if(n)for(var i in n)n.hasOwnProperty(i)&&(t.prototype[i]=n[i])},CAAT.Module({defines:"CAAT.Core.Class",extendsWith:function(){return{}}}),CAAT.Module({defines:"CAAT.Math.Bezier",depends:["CAAT.Math.Curve"],extendsClass:"CAAT.Math.Curve",aliases:["CAAT.Bezier"],extendsWith:function(){return{cubic:!1,applyAsPath:function(e){var t=this.coordlist;return this.cubic?e.ctx.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y):e.ctx.quadraticCurveTo(t[1].x,t[1].y,t[2].x,t[2].y),this},isQuadric:function(){return!this.cubic},isCubic:function(){return this.cubic},setCubic:function(e,t,n,r,i,s,o,u){return this.coordlist=[],this.coordlist.push((new CAAT.Math.Point).set(e,t)),this.coordlist.push((new CAAT.Math.Point).set(n,r)),this.coordlist.push((new CAAT.Math.Point).set(i,s)),this.coordlist.push((new CAAT.Math.Point).set(o,u)),this.cubic=!0,this.update(),this},setQuadric:function(e,t,n,r,i,s){return this.coordlist=[],this.coordlist.push((new CAAT.Math.Point).set(e,t)),this.coordlist.push((new CAAT.Math.Point).set(n,r)),this.coordlist.push((new CAAT.Math.Point).set(i,s)),this.cubic=!1,this.update(),this},setPoints:function(e){if(e.length===3)this.coordlist=e,this.cubic=!1,this.update();else{if(e.length!==4)throw"points must be an array of 3 or 4 CAAT.Point instances.";this.coordlist=e,this.cubic=!0,this.update()}return this},paint:function(e){this.cubic?this.paintCubic(e):this.paintCuadric(e),CAAT.Math.Bezier.superclass.paint.call(this,e)},paintCuadric:function(e){var t,n;t=this.coordlist[0].x,n=this.coordlist[0].y;var r=e.ctx;r.save(),r.beginPath(),r.moveTo(t,n);var i=new CAAT.Math.Point;for(var s=this.k;s<=1+this.k;s+=this.k)this.solve(i,s),r.lineTo(i.x,i.y);r.stroke(),r.restore()},paintCubic:function(e){var t,n;t=this.coordlist[0].x,n=this.coordlist[0].y;var r=e.ctx;r.save(),r.beginPath(),r.moveTo(t,n);var i=new CAAT.Math.Point;for(var s=this.k;s<=1+this.k;s+=this.k)this.solve(i,s),r.lineTo(i.x,i.y);r.stroke(),r.restore()},solve:function(e,t){return this.cubic?this.solveCubic(e,t):this.solveQuadric(e,t)},solveCubic:function(e,t){var n=t*t,r=t*n,i=this.coordlist,s=i[0],o=i[1],u=i[2],a=i[3];return e.x=s.x+t*(-s.x*3+t*(3*s.x-s.x*t))+t*(3*o.x+t*(-6*o.x+o.x*3*t))+n*(u.x*3-u.x*3*t)+a.x*r,e.y=s.y+t*(-s.y*3+t*(3*s.y-s.y*t))+t*(3*o.y+t*(-6*o.y+o.y*3*t))+n*(u.y*3-u.y*3*t)+a.y*r,e},solveQuadric:function(e,t){var n=this.coordlist,r=n[0],i=n[1],s=n[2],o=1-t;return e.x=o*o*r.x+2*o*t*i.x+t*t*s.x,e.y=o*o*r.y+2*o*t*i.y+t*t*s.y,e}}}}),CAAT.Module({defines:"CAAT.Math.CatmullRom",depends:["CAAT.Math.Curve"],extendsClass:"CAAT.Math.Curve",aliases:["CAAT.CatmullRom"],extendsWith:function(){return{setCurve:function(e,t,n,r){return this.coordlist=[],this.coordlist.push(e),this.coordlist.push(t),this.coordlist.push(n),this.coordlist.push(r),this.update(),this},paint:function(e){var t,n;t=this.coordlist[1].x,n=this.coordlist[1].y;var r=e.ctx;r.save(),r.beginPath(),r.moveTo(t,n);var i=new CAAT.Point;for(var s=this.k;s<=1+this.k;s+=this.k)this.solve(i,s),r.lineTo(i.x,i.y);r.stroke(),r.restore(),CAAT.Math.CatmullRom.superclass.paint.call(this,e)},solve:function(e,t){var n=this.coordlist,r=((-t+2)*t-1)*t*.5,i=((3*t-5)*t*t+2)*.5,s=((-3*t+4)*t+1)*t*.5,o=(t-1)*t*t*.5;return e.x=n[0].x*r+n[1].x*i+n[2].x*s+n[3].x*o,e.y=n[0].y*r+n[1].y*i+n[2].y*s+n[3].y*o,e},applyAsPath:function(e){var t=e.ctx,n=new CAAT.Math.Point;for(var r=this.k;r<=1+this.k;r+=this.k)this.solve(n,r),t.lineTo(n.x,n.y);return this},endCurvePosition:function(){return this.coordlist[this.coordlist.length-2]},startCurvePosition:function(){return this.coordlist[1]}}}}),CAAT.Module({defines:"CAAT.Math.Curve",depends:["CAAT.Math.Point"],extendsWith:function(){return{coordlist:null,k:.05,length:-1,HANDLE_SIZE:20,drawHandles:!0,paint:function(e){if(!1===this.drawHandles)return;var t=this.coordlist,n=e.ctx;n.save(),n.beginPath(),n.strokeStyle="#a0a0a0",n.moveTo(t[0].x,t[0].y),n.lineTo(t[1].x,t[1].y),n.stroke(),this.cubic&&(n.moveTo(t[2].x,t[2].y),n.lineTo(t[3].x,t[3].y),n.stroke()),n.globalAlpha=.5;for(var r=0;r<this.coordlist.length;r++){n.fillStyle="#7f7f00";var i=this.HANDLE_SIZE/2;n.beginPath(),n.arc(t[r].x,t[r].y,i,0,2*Math.PI,!1),n.fill()}n.restore()},update:function(){this.calcLength()},solve:function(e,t){},getContour:function(e){var t=[],n;for(n=0;n<=e;n++){var r=new CAAT.Math.Point;this.solve(r,n/e),t.push(r)}return t},getBoundingBox:function(e){e||(e=new CAAT.Math.Rectangle),e.setEmpty(),e.union(this.coordlist[0].x,this.coordlist[0].y);var t=new CAAT.Math.Point;for(var n=this.k;n<=1+this.k;n+=this.k)this.solve(t,n),e.union(t.x,t.y);return e},calcLength:function(){var e,t;e=this.coordlist[0].x,t=this.coordlist[0].y;var n=0,r=new CAAT.Math.Point;for(var i=this.k;i<=1+this.k;i+=this.k)this.solve(r,i),n+=Math.sqrt((r.x-e)*(r.x-e)+(r.y-t)*(r.y-t)),e=r.x,t=r.y;return this.length=n,n},getLength:function(){return this.length},endCurvePosition:function(){return this.coordlist[this.coordlist.length-1]},startCurvePosition:function(){return this.coordlist[0]},setPoints:function(e){},setPoint:function(e,t){t>=0&&t<this.coordlist.length&&(this.coordlist[t]=e)},applyAsPath:function(e){}}}}),CAAT.Module({defines:"CAAT.Math.Dimension",aliases:["CAAT.Dimension"],extendsWith:function(){return{width:0,height:0,__init:function(e,t){return this.width=e,this.height=t,this}}}}),CAAT.Module({defines:"CAAT.Math.Matrix",depends:["CAAT.Math.Point"],aliases:["CAAT.Matrix"],onCreate:function(){CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Math.Matrix.prototype.transformRenderingContext_NoClamp,CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Math.Matrix.prototype.transformRenderingContextSet_NoClamp},constants:{setCoordinateClamping:function(e){e?(CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_Clamp,CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_Clamp,CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_Clamp,CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_Clamp):(CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_NoClamp,CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_NoClamp,CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_NoClamp,CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_NoClamp)}},extendsWith:function(){return{matrix:null,__init:function(){return this.matrix=[1,0,0,0,1,0,0,0,1],typeof Float32Array!="undefined"&&(this.matrix=new Float32Array(this.matrix)),this},transformCoord:function(e){var t=e.x,n=e.y,r=this.matrix;return e.x=t*r[0]+n*r[1]+r[2],e.y=t*r[3]+n*r[4]+r[5],e},rotate:function(e){var t=new CAAT.Math.Matrix;return t.setRotation(e),t},setRotation:function(e){this.identity();var t=this.matrix,n=Math.cos(e),r=Math.sin(e);return t[0]=n,t[1]=-r,t[3]=r,t[4]=n,this},scale:function(e,t){var n=new CAAT.Math.Matrix;return n.matrix[0]=e,n.matrix[4]=t,n},setScale:function(e,t){return this.identity(),this.matrix[0]=e,this.matrix[4]=t,this},translate:function(e,t){var n=new CAAT.Math.Matrix;return n.matrix[2]=e,n.matrix[5]=t,n},setTranslate:function(e,t){return this.identity(),this.matrix[2]=e,this.matrix[5]=t,this},copy:function(e){e=e.matrix;var t=this.matrix;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this},identity:function(){var e=this.matrix;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,this},multiply:function(e){var t=this.matrix,n=e.matrix,r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8];return t[0]=r*h+i*v+s*y,t[1]=r*p+i*m+s*b,t[2]=r*d+i*g+s*w,t[3]=o*h+u*v+a*y,t[4]=o*p+u*m+a*b,t[5]=o*d+u*g+a*w,t[6]=f*h+l*v+c*y,t[7]=f*p+l*m+c*b,t[8]=f*d+l*g+c*w,this},premultiply:function(e){var t=e.matrix[0]*this.matrix[0]+e.matrix[1]*this.matrix[3]+e.matrix[2]*this.matrix[6],n=e.matrix[0]*this.matrix[1]+e.matrix[1]*this.matrix[4]+e.matrix[2]*this.matrix[7],r=e.matrix[0]*this.matrix[2]+e.matrix[1]*this.matrix[5]+e.matrix[2]*this.matrix[8],i=e.matrix[3]*this.matrix[0]+e.matrix[4]*this.matrix[3]+e.matrix[5]*this.matrix[6],s=e.matrix[3]*this.matrix[1]+e.matrix[4]*this.matrix[4]+e.matrix[5]*this.matrix[7],o=e.matrix[3]*this.matrix[2]+e.matrix[4]*this.matrix[5]+e.matrix[5]*this.matrix[8],u=e.matrix[6]*this.matrix[0]+e.matrix[7]*this.matrix[3]+e.matrix[8]*this.matrix[6],a=e.matrix[6]*this.matrix[1]+e.matrix[7]*this.matrix[4]+e.matrix[8]*this.matrix[7],f=e.matrix[6]*this.matrix[2]+e.matrix[7]*this.matrix[5]+e.matrix[8]*this.matrix[8];return this.matrix[0]=t,this.matrix[1]=n,this.matrix[2]=r,this.matrix[3]=i,this.matrix[4]=s,this.matrix[5]=o,this.matrix[6]=u,this.matrix[7]=a,this.matrix[8]=f,this},getInverse:function(){var e=this.matrix,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=new CAAT.Math.Matrix,c=t*(s*f-a*o)-i*(n*f-a*r)+u*(n*o-s*r);if(c===0)return null;var h=l.matrix;return h[0]=s*f-o*a,h[1]=r*a-n*f,h[2]=n*o-r*s,h[3]=o*u-i*f,h[4]=t*f-r*u,h[5]=r*i-t*o,h[6]=i*a-s*u,h[7]=n*u-t*a,h[8]=t*s-n*i,l.multiplyScalar(1/c),l},multiplyScalar:function(e){var t;for(t=0;t<9;t++)this.matrix[t]*=e;return this},transformRenderingContextSet_NoClamp:function(e){var t=this.matrix;return e.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),this},transformRenderingContext_NoClamp:function(e){var t=this.matrix;return e.transform(t[0],t[3],t[1],t[4],t[2],t[5]),this},transformRenderingContextSet_Clamp:function(e){var t=this.matrix;return e.setTransform(t[0],t[3],t[1],t[4],t[2]>>0,t[5]>>0),this},transformRenderingContext_Clamp:function(e){var t=this.matrix;return e.transform(t[0],t[3],t[1],t[4],t[2]>>0,t[5]>>0),this},setModelViewMatrix:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g;g=this.matrix,c=1,h=0,d=0,v=1,p=e,m=t,s=Math.cos(i),o=Math.sin(i),u=c,a=h,f=d,l=v,c=u*s+a*o,h=-u*o+a*s,d=f*s+l*o,v=-f*o+l*s,c*=this.scaleX,h*=this.scaleY,d*=this.scaleX,v*=this.scaleY,g[0]=c,g[1]=h,g[2]=p,g[3]=d,g[4]=v,g[5]=m}}}}),CAAT.Module({defines:"CAAT.Math.Matrix3",aliases:["CAAT.Matrix3"],extendsWith:function(){return{matrix:null,fmatrix:null,__init:function(){return this.matrix=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.fmatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this},transformCoord:function(e){var t=e.x,n=e.y,r=e.z;return e.x=t*this.matrix[0][0]+n*this.matrix[0][1]+r*this.matrix[0][2]+this.matrix[0][3],e.y=t*this.matrix[1][0]+n*this.matrix[1][1]+r*this.matrix[1][2]+this.matrix[1][3],e.z=t*this.matrix[2][0]+n*this.matrix[2][1]+r*this.matrix[2][2]+this.matrix[2][3],e},initialize:function(e,t,n,r,i,s,o,u,a){return this.identity(),this.matrix[0][0]=e,this.matrix[0][1]=t,this.matrix[0][2]=n,this.matrix[1][0]=r,this.matrix[1][1]=i,this.matrix[1][2]=s,this.matrix[2][0]=o,this.matrix[2][1]=u,this.matrix[2][2]=a,this},initWithMatrix:function(e){return this.matrix=e,this},flatten:function(){var e=this.fmatrix,t=this.matrix;return e[0]=t[0][0],e[1]=t[1][0],e[2]=t[2][0],e[3]=t[3][0],e[4]=t[0][1],e[5]=t[1][1],e[6]=t[2][1],e[7]=t[2][1],e[8]=t[0][2],e[9]=t[1][2],e[10]=t[2][2],e[11]=t[3][2],e[12]=t[0][3],e[13]=t[1][3],e[14]=t[2][3],e[15]=t[3][3],this.fmatrix},identity:function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++)this.matrix[e][t]=e===t?1:0;return this},getMatrix:function(){return this.matrix},rotateXY:function(e){return this.rotate(e,0,0)},rotateXZ:function(e){return this.rotate(0,e,0)},rotateYZ:function(e){return this.rotate(0,0,e)},setRotate:function(e,t,n){var r=this.rotate(e,t,n);return this.copy(r),this},rotate:function(e,t,n){var r=new CAAT.Math.Matrix3,i,s,o;return e!==0&&(o=new CAAT.Math.Math.Matrix3,i=Math.sin(e),s=Math.cos(e),o.matrix[1][1]=s,o.matrix[1][2]=-i,o.matrix[2][1]=i,o.matrix[2][2]=s,r.multiply(o)),t!==0&&(o=new CAAT.Math.Matrix3,i=Math.sin(t),s=Math.cos(t),o.matrix[0][0]=s,o.matrix[0][2]=-i,o.matrix[2][0]=i,o.matrix[2][2]=s,r.multiply(o)),n!==0&&(o=new CAAT.Math.Matrix3,i=Math.sin(n),s=Math.cos(n),o.matrix[0][0]=s,o.matrix[0][1]=-i,o.matrix[1][0]=i,o.matrix[1][1]=s,r.multiply(o)),r},getClone:function(){var e=new CAAT.Math.Matrix3;return e.copy(this),e},multiply:function(e){var t=this.getClone(),n=t.matrix,r=n[0][0],i=n[0][1],s=n[0][2],o=n[0][3],u=n[1][0],a=n[1][1],f=n[1][2],l=n[1][3],c=n[2][0],h=n[2][1],p=n[2][2],d=n[2][3],v=n[3][0],m=n[3][1],g=n[3][2],y=n[3][3],b=e.matrix,w=b[0][0],E=b[0][1],S=b[0][2],x=b[0][3],T=b[1][0],N=b[1][1],C=b[1][2],k=b[1][3],L=b[2][0],A=b[2][1],O=b[2][2],M=b[2][3],_=b[3][0],D=b[3][1],P=b[3][2],H=b[3][3];return this.matrix[0][0]=r*w+i*T+s*L+o*_,this.matrix[0][1]=r*E+i*N+s*A+o*D,this.matrix[0][2]=r*S+i*C+s*O+o*P,this.matrix[0][3]=r*x+i*k+s*M+o*H,this.matrix[1][0]=u*w+a*T+f*L+l*_,this.matrix[1][1]=u*E+a*N+f*A+l*D,this.matrix[1][2]=u*S+a*C+f*O+l*P,this.matrix[1][3]=u*x+a*k+f*M+l*H,this.matrix[2][0]=c*w+h*T+p*L+d*_,this.matrix[2][1]=c*E+h*N+p*A+d*D,this.matrix[2][2]=c*S+h*C+p*O+d*P,this.matrix[2][3]=c*x+h*k+p*M+d*H,this},premultiply:function(e){var t=this.getClone(),n=t.matrix,r=n[0][0],i=n[0][1],s=n[0][2],o=n[0][3],u=n[1][0],a=n[1][1],f=n[1][2],l=n[1][3],c=n[2][0],h=n[2][1],p=n[2][2],d=n[2][3],v=n[3][0],m=n[3][1],g=n[3][2],y=n[3][3],b=e.matrix,w=b[0][0],E=b[0][1],S=b[0][2],x=b[0][3],T=b[1][0],N=b[1][1],C=b[1][2],k=b[1][3],L=b[2][0],A=b[2][1],O=b[2][2],M=b[2][3],_=b[3][0],D=b[3][1],P=b[3][2],H=b[3][3];return this.matrix[0][0]=r*w+i*T+s*L,this.matrix[0][1]=r*E+i*N+s*A,this.matrix[0][2]=r*S+i*C+s*O,this.matrix[0][3]=r*x+i*k+s*M+o,this.matrix[1][0]=u*w+a*T+f*L,this.matrix[1][1]=u*E+a*N+f*A,this.matrix[1][2]=u*S+a*C+f*O,this.matrix[1][3]=u*x+a*k+f*M+l,this.matrix[2][0]=c*w+h*T+p*L,this.matrix[2][1]=c*E+h*N+p*A,this.matrix[2][2]=c*S+h*C+p*O,this.matrix[2][3]=c*x+h*k+p*M+d,this},setTranslate:function(e,t,n){return this.identity(),this.matrix[0][3]=e,this.matrix[1][3]=t,this.matrix[2][3]=n,this},translate:function(e,t,n){var r=new CAAT.Math.Matrix3;return r.setTranslate(e,t,n),r},setScale:function(e,t,n){return this.identity(),this.matrix[0][0]=e,this.matrix[1][1]=t,this.matrix[2][2]=n,this},scale:function(e,t,n){var r=new CAAT.Math.Matrix3;return r.setScale(e,t,n),r},rotateModelView:function(e,t,n){var r=Math.sin(e),i=Math.sin(t),s=Math.sin(n),o=Math.cos(e),u=Math.cos(t),a=Math.cos(n);return this.matrix[0][0]=u*o,this.matrix[0][1]=-u*r,this.matrix[0][2]=i,this.matrix[0][3]=0,this.matrix[1][0]=s*i*o+r*a,this.matrix[1][1]=a*o-s*i*r,this.matrix[1][2]=-s*u,this.matrix[1][3]=0,this.matrix[2][0]=s*r-a*i*o,this.matrix[2][1]=a*i*r+s*o,this.matrix[2][2]=a*u,this.matrix[2][3]=0,this.matrix[3][0]=0,this.matrix[3][1]=0,this.matrix[3][2]=0,this.matrix[3][3]=1,this},copy:function(e){for(var t=0;t<4;t++)for(var n=0;n<4;n++)this.matrix[t][n]=e.matrix[t][n];return this},calculateDeterminant:function(){var e=this.matrix,t=e[0][0],n=e[0][1],r=e[0][2],i=e[0][3],s=e[1][0],o=e[1][1],u=e[1][2],a=e[1][3],f=e[2][0],l=e[2][1],c=e[2][2],h=e[2][3],p=e[3][0],d=e[3][1],v=e[3][2],m=e[3][3];return i*o*c*p+n*a*c*p+i*u*f*d+r*a*f*d+r*s*h*d+t*u*h*d+i*s*l*v+t*a*l*v+r*o*f*m+n*u*f*m+n*s*c*m+t*o*c*m+i*u*l*p-r*a*l*p-r*o*h*p-n*u*h*p-i*s*c*d-t*a*c*d-i*o*f*v-n*a*f*v-n*s*h*v-t*o*h*v-r*s*l*m-t*u*l*m},getInverse:function(){var e=this.matrix,t=e[0][0],n=e[0][1],r=e[0][2],i=e[0][3],s=e[1][0],o=e[1][1],u=e[1][2],a=e[1][3],f=e[2][0],l=e[2][1],c=e[2][2],h=e[2][3],p=e[3][0],d=e[3][1],v=e[3][2],m=e[3][3],g=new CAAT.Math.Matrix3;return g.matrix[0][0]=u*h*d+a*l*v+o*c*m-a*c*d-o*h*v-u*l*m,g.matrix[0][1]=i*c*d+n*h*v+r*l*m-n*c*m-r*h*d-i*l*v,g.matrix[0][2]=r*a*d+n*u*m+i*o*v-n*a*v-r*o*m-i*u*d,g.matrix[0][3]=i*u*l+n*a*c+r*o*h-r*a*l-i*o*c-n*u*h,g.matrix[1][0]=a*c*p+s*h*v+u*f*m-u*h*p-a*f*v-s*c*m,g.matrix[1][1]=r*h*p+i*f*v+t*c*m-i*c*p-t*h*v-r*f*m,g.matrix[1][2]=i*u*p+t*a*v+r*s*m-r*a*p-i*s*v-t*u*m,g.matrix[1][3]=r*a*f+i*s*c+t*u*h-i*u*f-t*a*c-r*s*h,g.matrix[2][0]=o*h*p+a*f*d+s*l*m-a*l*p-s*h*d-o*f*m,g.matrix[2][1]=i*l*p+t*h*d+n*f*m-t*l*m-n*h*p-i*f*d,g.matrix[2][2]=r*a*p+i*s*d+t*o*m-i*o*p-t*a*d-n*s*m,g.matrix[2][3]=i*o*f+t*a*l+n*s*h-t*o*h-n*a*f-i*s*l,g.matrix[3][0]=u*l*p+s*c*d+o*f*v-o*c*p-u*f*d-s*l*v,g.matrix[3][1]=n*c*p+r*f*d+t*l*v-r*l*p-t*c*d-n*f*v,g.matrix[3][2]=r*o*p+t*u*d+n*s*v-t*o*v-n*u*p-r*s*d,g.matrix[3][3]=n*u*f+r*s*l+t*o*c-r*o*f-t*u*l-n*s*c,g.multiplyScalar(1/this.calculateDeterminant())},multiplyScalar:function(e){var t,n;for(t=0;t<4;t++)for(n=0;n<4;n++)this.matrix[t][n]*=e;return this}}}}),CAAT.Module({defines:"CAAT.Math.Point",aliases:["CAAT.Point"],extendsWith:function(){return{x:0,y:0,z:0,__init:function(e,t,n){return this.x=e,this.y=t,this.z=n||0,this},set:function(e,t,n){return this.x=e,this.y=t,this.z=n||0,this},clone:function(){var e=new CAAT.Math.Point(this.x,this.y,this.z);return e},translate:function(e,t,n){return this.x+=e,this.y+=t,this.z+=n,this},translatePoint:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},subtract:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},multiply:function(e){return this.x*=e,this.y*=e,this.z*=e,this},rotate:function(e){var t=this.x,n=this.y;return this.x=t*Math.cos(e)-Math.sin(e)*n,this.y=t*Math.sin(e)+Math.cos(e)*n,this.z=0,this},setAngle:function(e){var t=this.getLength();return this.x=Math.cos(e)*t,this.y=Math.sin(e)*t,this.z=0,this},setLength:function(e){var t=this.getLength();return t?this.multiply(e/t):this.x=this.y=this.z=e,this},normalize:function(){var e=this.getLength();return this.x/=e,this.y/=e,this.z/=e,this},getAngle:function(){return Math.atan2(this.y,this.x)},limit:function(e){var t=this.getLengthSquared();if(t+.01>e*e){var n=Math.sqrt(t);this.x=this.x/n*e,this.y=this.y/n*e,this.z=this.z/n*e}return this},getLength:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return e<.005&&e>-0.005?1e-6:e},getLengthSquared:function(){var e=this.x*this.x+this.y*this.y+this.z*this.z;return e<.005&&e>-0.005?0:e},getDistance:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return Math.sqrt(t*t+n*n+r*r)},getDistanceSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},toString:function(){return"(CAAT.Math.Point) x:"+String(Math.round(Math.floor(this.x*10))/10)+" y:"+String(Math.round(Math.floor(this.y*10))/10)+" z:"+String(Math.round(Math.floor(this.z*10))/10)}}}}),CAAT.Module({defines:"CAAT.Math.Rectangle",aliases:["CAAT.Rectangle"],extendsWith:function(){return{__init:function(e,t,n,r){this.setLocation(e,t),this.setDimension(n,r)},x:0,y:0,x1:0,y1:0,width:-1,height:-1,setEmpty:function(){return this.width=-1,this.height=-1,this.x=0,this.y=0,this.x1=0,this.y1=0,this},setLocation:function(e,t){return this.x=e,this.y=t,this.x1=this.x+this.width,this.y1=this.y+this.height,this},setDimension:function(e,t){return this.width=e,this.height=t,this.x1=this.x+this.width,this.y1=this.y+this.height,this},setBounds:function(e,t,n,r){return this.setLocation(e,t),this.setDimension(n,r),this},contains:function(e,t){return e>=this.x&&e<this.x1&&t>=this.y&&t<this.y1},isEmpty:function(){return this.width===-1&&this.height===-1},union:function(e,t){if(this.isEmpty()){this.x=e,this.x1=e,this.y=t,this.y1=t,this.width=0,this.height=0;return}this.x1=this.x+this.width,this.y1=this.y+this.height,t<this.y&&(this.y=t),e<this.x&&(this.x=e),t>this.y1&&(this.y1=t),e>this.x1&&(this.x1=e),this.width=this.x1-this.x,this.height=this.y1-this.y},unionRectangle:function(e){return this.union(e.x,e.y),this.union(e.x1,e.y),this.union(e.x,e.y1),this.union(e.x1,e.y1),this},intersects:function(e){return e.isEmpty()||this.isEmpty()?!1:e.x1<=this.x?!1:e.x>=this.x1?!1:e.y1<=this.y?!1:e.y<this.y1},intersectsRect:function(e,t,n,r){if(-1===n||-1===r)return!1;var i=e+n-1,s=t+r-1;return i<this.x?!1:e>this.x1?!1:s<this.y?!1:t<=this.y1},intersect:function(e,t){return typeof t=="undefined"&&(t=new CAAT.Math.Rectangle),t.x=Math.max(this.x,e.x),t.y=Math.max(this.y,e.y),t.x1=Math.min(this.x1,e.x1),t.y1=Math.min(this.y1,e.y1),t.width=t.x1-t.x,t.height=t.y1-t.y,t}}}}),CAAT.Module({defines:"CAAT.Behavior.Interpolator",depends:["CAAT.Math.Point"],aliases:["CAAT.Interpolator"],constants:{enumerateInterpolators:function(){return[(new CAAT.Behavior.Interpolator).createLinearInterpolator(!1,!1),"Linear pingpong=false, inverse=false",(new CAAT.Behavior.Interpolator).createLinearInterpolator(!0,!1),"Linear pingpong=true, inverse=false",(new CAAT.Behavior.Interpolator).createBackOutInterpolator(!1),"BackOut pingpong=true, inverse=false",(new CAAT.Behavior.Interpolator).createBackOutInterpolator(!0),"BackOut pingpong=true, inverse=true",(new CAAT.Behavior.Interpolator).createLinearInterpolator(!1,!0),"Linear pingpong=false, inverse=true",(new CAAT.Behavior.Interpolator).createLinearInterpolator(!0,!0),"Linear pingpong=true, inverse=true",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(2,!1),"ExponentialIn pingpong=false, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(2,!1),"ExponentialOut pingpong=false, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(2,!1),"ExponentialInOut pingpong=false, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(2,!0),"ExponentialIn pingpong=true, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(2,!0),"ExponentialOut pingpong=true, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(2,!0),"ExponentialInOut pingpong=true, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(4,!1),"ExponentialIn pingpong=false, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(4,!1),"ExponentialOut pingpong=false, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4,!1),"ExponentialInOut pingpong=false, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(4,!0),"ExponentialIn pingpong=true, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(4,!0),"ExponentialOut pingpong=true, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4,!0),"ExponentialInOut pingpong=true, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(6,!1),"ExponentialIn pingpong=false, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(6,!1),"ExponentialOut pingpong=false, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(6,!1),"ExponentialInOut pingpong=false, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(6,!0),"ExponentialIn pingpong=true, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(6,!0),"ExponentialOut pingpong=true, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(6,!0),"ExponentialInOut pingpong=true, exponent=6",(new CAAT.Behavior.Interpolator).createBounceInInterpolator(!1),"BounceIn pingpong=false",(new CAAT.Behavior.Interpolator).createBounceOutInterpolator(!1),"BounceOut pingpong=false",(new CAAT.Behavior.Interpolator).createBounceInOutInterpolator(!1),"BounceInOut pingpong=false",(new CAAT.Behavior.Interpolator).createBounceInInterpolator(!0),"BounceIn pingpong=true",(new CAAT.Behavior.Interpolator).createBounceOutInterpolator(!0),"BounceOut pingpong=true",(new CAAT.Behavior.Interpolator).createBounceInOutInterpolator(!0),"BounceInOut pingpong=true",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1.1,.4,!1),"ElasticIn pingpong=false, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,.4,!1),"ElasticOut pingpong=false, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1.1,.4,!1),"ElasticInOut pingpong=false, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1.1,.4,!0),"ElasticIn pingpong=true, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,.4,!0),"ElasticOut pingpong=true, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1.1,.4,!0),"ElasticInOut pingpong=true, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1,.2,!1),"ElasticIn pingpong=false, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1,.2,!1),"ElasticOut pingpong=false, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1,.2,!1),"ElasticInOut pingpong=false, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1,.2,!0),"ElasticIn pingpong=true, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1,.2,!0),"ElasticOut pingpong=true, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1,.2,!0),"ElasticInOut pingpong=true, amp=1.0, d=.2"]},parse:function(e){var t="create"+e.type+"Interpolator",n=new CAAT.Behavior.Interpolator;try{n[t].apply(n,e.params||[])}catch(r){n.createLinearInterpolator(!1,!1)}return n}},extendsWith:function(){return{interpolated:null,paintScale:90,__init:function(){return this.interpolated=new CAAT.Math.Point(0,0,0),this},createLinearInterpolator:function(e,t){return this.getPosition=function(r){var i=r;return e&&(r<.5?r*=2:r=1-(r-.5)*2),t!==null&&t&&(r=1-r),this.interpolated.set(i,r)},this},createBackOutInterpolator:function(e){return this.getPosition=function(n){var r=n;e&&(n<.5?n*=2:n=1-(n-.5)*2),n-=1;var i=1.70158;return this.interpolated.set(r,n*n*((i+1)*n+i)+1)},this},createExponentialInInterpolator:function(e,t){return this.getPosition=function(r){var i=r;return t&&(r<.5?r*=2:r=1-(r-.5)*2),this.interpolated.set(i,Math.pow(r,e))},this},createExponentialOutInterpolator:function(e,t){return this.getPosition=function(r){var i=r;return t&&(r<.5?r*=2:r=1-(r-.5)*2),this.interpolated.set(i,1-Math.pow(1-r,e))},this},createExponentialInOutInterpolator:function(e,t){return this.getPosition=function(r){var i=r;return t&&(r<.5?r*=2:r=1-(r-.5)*2),r*2<1?this.interpolated.set(i,Math.pow(r*2,e)/2):this.interpolated.set(i,1-Math.abs(Math.pow(r*2-2,e))/2)},this},createQuadricBezierInterpolator:function(e,t,n,r){return this.getPosition=function(s){var o=s;return r&&(s<.5?s*=2:s=1-(s-.5)*2),s=(1-s)*(1-s)*e.y+2*(1-s)*s*t.y+s*s*n.y,this.interpolated.set(o,s)},this},createCubicBezierInterpolator:function(e,t,n,r,i){return this.getPosition=function(o){var u=o;i&&(o<.5?o*=2:o=1-(o-.5)*2);var a=o*o,f=o*a;return o=e.y+o*(-e.y*3+o*(3*e.y-e.y*o))+o*(3*t.y+o*(-6*t.y+t.y*3*o))+a*(n.y*3-n.y*3*o)+r.y*f,this.interpolated.set(u,o)},this},createElasticOutInterpolator:function(e,t,n){return this.getPosition=function(i){n&&(i<.5?i*=2:i=1-(i-.5)*2);if(i===0)return{x:0,y:0};if(i===1)return{x:1,y:1};var s=t/(2*Math.PI)*Math.asin(1/e);return this.interpolated.set(i,e*Math.pow(2,-10*i)*Math.sin((i-s)*2*Math.PI/t)+1)},this},createElasticInInterpolator:function(e,t,n){return this.getPosition=function(i){n&&(i<.5?i*=2:i=1-(i-.5)*2);if(i===0)return{x:0,y:0};if(i===1)return{x:1,y:1};var s=t/(2*Math.PI)*Math.asin(1/e);return this.interpolated.set(i,-(e*Math.pow(2,10*(i-=1))*Math.sin((i-s)*2*Math.PI/t)))},this},createElasticInOutInterpolator:function(e,t,n){return this.getPosition=function(i){n&&(i<.5?i*=2:i=1-(i-.5)*2);var s=t/(2*Math.PI)*Math.asin(1/e);return i*=2,i<=1?this.interpolated.set(i,-0.5*e*Math.pow(2,10*(i-=1))*Math.sin((i-s)*2*Math.PI/t)):this.interpolated.set(i,1+.5*e*Math.pow(2,-10*(i-=1))*Math.sin((i-s)*2*Math.PI/t))},this},bounce:function(e){return(e/=1)<1/2.75?{x:e,y:7.5625*e*e}:e<2/2.75?{x:e,y:7.5625*(e-=1.5/2.75)*e+.75}:e<2.5/2.75?{x:e,y:7.5625*(e-=2.25/2.75)*e+.9375}:{x:e,y:7.5625*(e-=2.625/2.75)*e+.984375}},createBounceOutInterpolator:function(e){return this.getPosition=function(n){return e&&(n<.5?n*=2:n=1-(n-.5)*2),this.bounce(n)},this},createBounceInInterpolator:function(e){return this.getPosition=function(n){e&&(n<.5?n*=2:n=1-(n-.5)*2);var r=this.bounce(1-n);return r.y=1-r.y,r},this},createBounceInOutInterpolator:function(e){return this.getPosition=function(n){e&&(n<.5?n*=2:n=1-(n-.5)*2);var r;return n<.5?(r=this.bounce(1-n*2),r.y=(1-r.y)*.5,r):(r=this.bounce(n*2-1,e),r.y=r.y*.5+.5,r)},this},paint:function(e){e.save(),e.beginPath(),e.moveTo(0,this.getPosition(0).y*this.paintScale);for(var t=0;t<=this.paintScale;t++)e.lineTo(t,this.getPosition(t/this.paintScale).y*this.paintScale);e.strokeStyle="black",e.stroke(),e.restore()},getContour:function(e){var t=[];for(var n=0;n<=e;n++)t.push({x:n/e,y:this.getPosition(n/e).y});return t}}}}),CAAT.Module({defines:"CAAT.Behavior.BaseBehavior",constants:{Status:{NOT_STARTED:0,STARTED:1,EXPIRED:2},parse:function(e){function t(e){var t=e.split("."),n=window;for(var r=0;r<t.length;r++){if(!n[t[r]])return null;n=n[t[r]]}return n}try{var n=e.type.toLowerCase();n="CAAT.Behavior."+n.substr(0,1).toUpperCase()+n.substr(1)+"Behavior";var r=new t(n),i=new r;return i.parse(e),i}catch(s){console.log("Error parsing behavior: "+s)}return null}},depends:["CAAT.Behavior.Interpolator"],extendsWith:function(){var e=(new CAAT.Behavior.Interpolator).createLinearInterpolator(!1),t=(new CAAT.Behavior.Interpolator).createLinearInterpolator(!0);return{__init:function(){return this.lifecycleListenerList=[],this.setDefaultInterpolator(),this},lifecycleListenerList:null,behaviorStartTime:-1,behaviorDuration:-1,cycleBehavior:!1,status:CAAT.Behavior.BaseBehavior.Status.NOT_STARTED,interpolator:null,actor:null,id:0,timeOffset:0,doValueApplication:!0,solved:!0,discardable:!1,isRelative:!1,setRelative:function(e){return this.isRelative=e,this},setRelativeValues:function(){return this.isRelative=!0,this},parse:function(e){e.pingpong&&this.setPingPong(),e.cycle&&this.setCycle(!0);var t=e.delay||0,n=e.duration||1e3;this.setDelayTime(t,n),e.interpolator&&this.setInterpolator(CAAT.Behavior.Interpolator.parse(e.interpolator))},setValueApplication:function(e){return this.doValueApplication=e,this},setTimeOffset:function(e){return this.timeOffset=e,this},setStatus:function(e){return this.status=e,this},setId:function(e){return this.id=e,this},setDefaultInterpolator:function(){return this.interpolator=e,this},setPingPong:function(){return this.interpolator=t,this},setFrameTime:function(e,t){return this.behaviorStartTime=e,this.behaviorDuration=t,this.status=CAAT.Behavior.BaseBehavior.Status.NOT_STARTED,this},setDelayTime:function(e,t){return this.behaviorStartTime=e,this.behaviorDuration=t,this.status=CAAT.Behavior.BaseBehavior.Status.NOT_STARTED,this.solved=!1,this.expired=!1,this},setOutOfFrameTime:function(){return this.status=CAAT.Behavior.BaseBehavior.Status.EXPIRED,this.behaviorStartTime=Number.MAX_VALUE,this.behaviorDuration=0,this},setInterpolator:function(e){return this.interpolator=e,this},apply:function(e,t){this.solved||(this.behaviorStartTime+=e,this.solved=!0),e+=this.timeOffset*this.behaviorDuration;var n=e;this.isBehaviorInTime(e,t)&&(e=this.normalizeTime(e),this.fireBehaviorAppliedEvent(t,n,e,this.setForTime(e,t)))},setCycle:function(e){return this.cycleBehavior=e,this},addListener:function(e){return this.lifecycleListenerList.push(e),this},emptyListenerList:function(){return this.lifecycleListenerList=[],this},getStartTime:function(){return this.behaviorStartTime},getDuration:function(){return this.behaviorDuration},isBehaviorInTime:function(e,t){var n=CAAT.Behavior.BaseBehavior.Status;return this.status===n.EXPIRED||this.behaviorStartTime<0?!1:(this.cycleBehavior&&e>=this.behaviorStartTime&&(e=(e-this.behaviorStartTime)%this.behaviorDuration+this.behaviorStartTime),e>this.behaviorStartTime+this.behaviorDuration?(this.status!==n.EXPIRED&&this.setExpired(t,e),!1):(this.status===n.NOT_STARTED&&(this.status=n.STARTED,this.fireBehaviorStartedEvent(t,e)),this.behaviorStartTime<=e))},fireBehaviorStartedEvent:function(e,t){for(var n=0,r=this.lifecycleListenerList.length;n<r;n++){var i=this.lifecycleListenerList[n];i.behaviorStarted&&i.behaviorStarted(this,t,e)}},fireBehaviorExpiredEvent:function(e,t){for(var n=0,r=this.lifecycleListenerList.length;n<r;n++){var i=this.lifecycleListenerList[n];i.behaviorExpired&&i.behaviorExpired(this,t,e)}},fireBehaviorAppliedEvent:function(e,t,n,r){for(var i=0,s=this.lifecycleListenerList.length;i<s;i++){var o=this.lifecycleListenerList[i];o.behaviorApplied&&o.behaviorApplied(this,t,n,e,r)}},normalizeTime:function(e){return e-=this.behaviorStartTime,this.cycleBehavior&&(e%=this.behaviorDuration),this.interpolator.getPosition(e/this.behaviorDuration).y},setExpired:function(e,t){this.status=CAAT.Behavior.BaseBehavior.Status.EXPIRED,this.setForTime(this.interpolator.getPosition(1).y,e),this.fireBehaviorExpiredEvent(e,t),this.discardable&&this.actor.removeBehavior(this)},setForTime:function(e,t){},initialize:function(e){if(e)for(var t in e)this[t]=e[t];return this},getPropertyName:function(){return""},calculateKeyFrameData:function(e){},getKeyFrameDataValues:function(e){},calculateKeyFramesData:function(e,t,n){}}}}),CAAT.Module({defines:"CAAT.Behavior.AlphaBehavior",aliases:["CAAT.AlphaBehavior"],depends:["CAAT.Behavior.BaseBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{startAlpha:0,endAlpha:0,parse:function(e){CAAT.Behavior.AlphaBehavior.superclass.parse.call(this,e),this.startAlpha=e.start||0,this.endAlpha=e.end||0},getPropertyName:function(){return"opacity"},setForTime:function(e,t){CAAT.Behavior.AlphaBehavior.superclass.setForTime.call(this,e,t);var n=this.startAlpha+e*(this.endAlpha-this.startAlpha);return this.doValueApplication&&t.setAlpha(n),n},setValues:function(e,t){return this.startAlpha=e,this.endAlpha=t,this},calculateKeyFrameData:function(e){return e=this.interpolator.getPosition(e).y,this.startAlpha+e*(this.endAlpha-this.startAlpha)},getKeyFrameDataValues:function(e){return e=this.interpolator.getPosition(e).y,{alpha:this.startAlpha+e*(this.endAlpha-this.startAlpha)}},calculateKeyFramesData:function(e,t,n){typeof n=="undefined"&&(n=100),n>>=0;var r,i,s="@-"+e+"-keyframes "+t+" {";for(r=0;r<=n;r++)i=""+r/n*100+"%"+"{"+"opacity: "+this.calculateKeyFrameData(r/n)+"}",s+=i;return s+="}",s}}}}),CAAT.Module({defines:"CAAT.Behavior.ContainerBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Behavior.GenericBehavior"],aliases:["CAAT.ContainerBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{parse:function(e){if(e.behaviors&&e.behaviors.length)for(var t=0;t<e.behaviors.length;t+=1)this.addBehavior(CAAT.Behavior.BaseBehavior.parse(e.behaviors[t]));CAAT.Behavior.ContainerBehavior.superclass.parse.call(this,e)},behaviors:null,conforming:!1,__init:function(e){return this.__super(),this.behaviors=[],e&&(this.conforming=!0),this},conformToDuration:function(e){this.duration=e;var t=e/this.duration,n;for(var r=0;r<this.behaviors.length;r++)n=this.behaviors[r],n.setFrameTime(n.getStartTime()*t,n.getDuration()*t);return this},getBehaviorById:function(e){for(var t=0;t<this.behaviors.length;t++)if(this.behaviors[t].id===e)return this.behaviors[t];return null},addBehavior:function(e){this.behaviors.push(e),e.addListener(this);if(this.conforming){var t=e.behaviorDuration+e.behaviorStartTime;this.behaviorDuration<t&&(this.behaviorDuration=t,this.behaviorStartTime=0)}return this},apply:function(e,t){this.solved||(this.behaviorStartTime+=e,this.solved=!0),e+=this.timeOffset*this.behaviorDuration;if(this.isBehaviorInTime(e,t)){e-=this.behaviorStartTime,this.cycleBehavior&&(e%=this.behaviorDuration);var n=this.behaviors;for(var r=0;r<n.length;r++)n[r].apply(e,t)}},behaviorExpired:function(e,t,n){this.cycleBehavior&&e.setStatus(CAAT.Behavior.BaseBehavior.Status.STARTED)},behaviorApplied:function(e,t,n,r,i){this.fireBehaviorAppliedEvent(r,t,n,i)},setForTime:function(e,t){var n=null,r=this.behaviors;for(var i=0;i<r.length;i++)n=r[i].setForTime(e,t);return n},setExpired:function(e,t){var n=this.behaviors;for(var r=0;r<n.length;r++){var i=n[r];i.status!==CAAT.Behavior.BaseBehavior.Status.EXPIRED&&i.setExpired(e,t-this.behaviorStartTime)}return CAAT.Behavior.ContainerBehavior.superclass.setExpired.call(this,e,t),this},setFrameTime:function(e,t){CAAT.Behavior.ContainerBehavior.superclass.setFrameTime.call(this,e,t);var n=this.behaviors;for(var r=0;r<n.length;r++)n[r].setStatus(CAAT.Behavior.BaseBehavior.Status.NOT_STARTED);return this},setDelayTime:function(e,t){CAAT.Behavior.ContainerBehavior.superclass.setDelayTime.call(this,e,t);var n=this.behaviors;for(var r=0;r<n.length;r++)n[r].setStatus(CAAT.Behavior.BaseBehavior.Status.NOT_STARTED);return this},getKeyFrameDataValues:function(e){var t,n,r,i={angle:0,scaleX:1,scaleY:1,x:0,y:0};for(t=0;t<this.behaviors.length;t++){n=this.behaviors[t];if(n.status!==CAAT.Behavior.BaseBehavior.Status.EXPIRED&&!(n instanceof CAAT.Behavior.GenericBehavior)){r=e*this.behaviorDuration;if(n.behaviorStartTime<=r&&n.behaviorStartTime+n.behaviorDuration>=r){r=(r-n.behaviorStartTime)/n.behaviorDuration;var s=n.getKeyFrameDataValues(r);for(var o in s)i[o]=s[o]}}}return i},calculateKeyFrameData:function(e,t){function c(e){i[e]?f+=i[e]:prevValues&&(l=prevValues[e],l&&(f+=l,i[e]=l))}var n,r,i={},s,o,u,a;for(n=0;n<this.behaviors.length;n++)r=this.behaviors[n],r.status!==CAAT.Behavior.BaseBehavior.Status.EXPIRED&&!(r instanceof CAAT.Behavior.GenericBehavior)&&(s=e*this.behaviorDuration,r.behaviorStartTime<=s&&r.behaviorStartTime+r.behaviorDuration>=s&&(s=(s-r.behaviorStartTime)/r.behaviorDuration,o=r.calculateKeyFrameData(s),u=r.getPropertyName(t),typeof i[u]=="undefined"&&(i[u]=""),i[u]+=o+" "));var f="",l;c("translate"),c("rotate"),c("scale");var h="";return f&&(h="-"+t+"-transform: "+f+";"),f="",c("opacity"),f&&(h+=" opacity: "+f+";"),h+=" -webkit-transform-origin: 0% 0%",{rules:h,ret:i}},calculateKeyFramesData:function(e,t,n,r,i){function s(t,n){for(var s in n)t[s]||(t[s]=n[s]);var o="-"+e+"-transform:";if(t.x||t.y){var u=t.x||0,a=t.y||0;o+="translate("+u+"px,"+a+"px)"}t.angle&&(o+=" rotate("+t.angle+"rad)");if(t.scaleX!==1||t.scaleY!==1)o+=" scale("+t.scaleX+","+t.scaleY+")";o+=";",t.alpha&&(o+=" opacity: "+t.alpha+";");if(r!==.5||i!==.5)o+=" -"+e+"-transform-origin:"+r*100+"% "+i*100+"%;";return o}if(this.duration===Number.MAX_VALUE)return"";typeof r=="undefined"&&(r=.5),typeof i=="undefined"&&(i=.5),typeof n=="undefined"&&(n=100);var o,u="@-"+e+"-keyframes "+t+" {",a,f={};for(o=0;o<=n;o++){a=this.interpolator.getPosition(o/n).y;var l=this.getKeyFrameDataValues(a);u+=""+o/n*100+"%"+"{"+s(l,f)+"}\n",f=l}return u+="}\n",u}}}}),CAAT.Module({defines:"CAAT.Behavior.GenericBehavior",depends:["CAAT.Behavior.BaseBehavior"],aliases:["CAAT.GenericBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{start:0,end:0,target:null,property:null,callback:null,setForTime:function(e,t){var n=this.start+e*(this.end-this.start);this.callback&&this.callback(n,this.target,t),this.property&&(this.target[this.property]=n)},setValues:function(e,t,n,r,i){return this.start=e,this.end=t,this.target=n,this.property=r,this.callback=i,this}}}}),CAAT.Module({defines:"CAAT.Behavior.PathBehavior",aliases:["CAAT.PathBehavior"],depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.SpriteImage"],constants:{AUTOROTATE:{LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1,FREE:2},autorotate:{LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1,FREE:2}},extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{parse:function(e){CAAT.Behavior.PathBehavior.superclass.parse.call(this,e);if(e.SVG){var t=new CAAT.PathUtil.SVGPath,n=t.parsePath(e.SVG);this.setValues(n)}e.autoRotate&&(this.autoRotate=e.autoRotate)},path:null,autoRotate:!1,prevX:-1,prevY:-1,autoRotateOp:CAAT.Behavior.PathBehavior.autorotate.FREE,isOpenContour:!1,relativeX:0,relativeY:0,setOpenContour:function(e){return this.isOpenContour=e,this},getPropertyName:function(){return"translate"},setRelativeValues:function(e,t){return this.relativeX=e,this.relativeY=t,this.isRelative=!0,this},setAutoRotate:function(e,t){return this.autoRotate=e,t!==undefined&&(this.autoRotateOp=t),this},setPath:function(e){return this.path=e,this},setValues:function(e){return this.setPath(e)},setTranslation:function(e,t){return this},calculateKeyFrameData:function(e){e=this.interpolator.getPosition(e).y;var t=this.path.getPosition(e);return"translateX("+t.x+"px) translateY("+t.y+"px)"},getKeyFrameDataValues:function(e){e=this.interpolator.getPosition(e).y;var t=this.path.getPosition(e),n={x:t.x,y:t.y};if(this.autoRotate){var r=e===0?t:this.path.getPosition(e-.001),i=t.x-r.x,s=t.y-r.y,o=Math.atan2(s,i);n.angle=o}return n},calculateKeyFramesData:function(e,t,n){typeof n=="undefined"&&(n=100),n>>=0;var r,i,s,o="@-"+e+"-keyframes "+t+" {";for(r=0;r<=n;r++)i=""+r/n*100+"%"+"{"+"-"+e+"-transform:"+this.calculateKeyFrameData(r/n)+"}",o+=i;return o+="}",o},setForTime:function(e,t){if(!this.path)return{x:t.x,y:t.y};var n=this.path.getPosition(e,this.isOpenContour,.001);this.isRelative&&(n.x+=this.relativeX,n.y+=this.relativeY);if(this.autoRotate){-1===this.prevX&&-1===this.prevY&&(this.prevX=n.x,this.prevY=n.y);var r=n.x-this.prevX,i=n.y-this.prevY;if(r===0&&i===0)return t.setLocation(n.x,n.y),{x:t.x,y:t.y};var s=Math.atan2(i,r),o=CAAT.Foundation.SpriteImage,u=CAAT.Behavior.PathBehavior.AUTOROTATE;this.autoRotateOp===u.LEFT_TO_RIGHT?this.prevX<=n.x?t.setImageTransformation(o.TR_NONE):(t.setImageTransformation(o.TR_FLIP_HORIZONTAL),s+=Math.PI):this.autoRotateOp===u.RIGHT_TO_LEFT&&(this.prevX<=n.x?t.setImageTransformation(o.TR_FLIP_HORIZONTAL):(t.setImageTransformation(o.TR_NONE),s-=Math.PI)),t.setRotation(s),this.prevX=n.x,this.prevY=n.y;var a=Math.sqrt(r*r+i*i);r/=a,i/=a}return this.doValueApplication?(t.setLocation(n.x,n.y),{x:t.x,y:t.y}):{x:n.x,y:n.y}},positionOnTime:function(e){return this.isBehaviorInTime(e,null)?(e=this.normalizeTime(e),this.path.getPosition(e)):{x:-1,y:-1}}}}}),CAAT.Module({defines:"CAAT.Behavior.RotateBehavior",extendsClass:"CAAT.Behavior.BaseBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],aliases:["CAAT.RotateBehavior"],extendsWith:function(){return{__init:function(){return this.__super(),this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER,this},parse:function(e){CAAT.Behavior.RotateBehavior.superclass.parse.call(this,e),this.startAngle=e.start||0,this.endAngle=e.end||0,this.anchorX=typeof e.anchorX!="undefined"?parseInt(e.anchorX):.5,this.anchorY=typeof e.anchorY!="undefined"?parseInt(e.anchorY):.5},startAngle:0,endAngle:0,anchorX:.5,anchorY:.5,rotationRelative:0,setRelativeValues:function(e){return this.rotationRelative=e,this.isRelative=!0,this},getPropertyName:function(){return"rotate"},setForTime:function(e,t){var n=this.startAngle+e*(this.endAngle-this.startAngle);return this.isRelative&&(n+=this.rotationRelative,n>=Math.PI&&(n-=2*Math.PI),n<-2*Math.PI&&(n+=2*Math.PI)),this.doValueApplication&&t.setRotationAnchored(n,this.anchorX,this.anchorY),n},setValues:function(e,t,n,r){return this.startAngle=e,this.endAngle=t,typeof n!="undefined"&&typeof r!="undefined"&&(this.anchorX=n,this.anchorY=r),this},setAngles:function(e,t){return this.setValues(e,t)},setAnchor:function(e,t,n){return this.anchorX=t/e.width,this.anchorY=n/e.height,this},calculateKeyFrameData:function(e){return e=this.interpolator.getPosition(e).y,"rotate("+(this.startAngle+e*(this.endAngle-this.startAngle))+"rad)"},getKeyFrameDataValues:function(e){return e=this.interpolator.getPosition(e).y,{angle:this.startAngle+e*(this.endAngle-this.startAngle)}},calculateKeyFramesData:function(e,t,n){typeof n=="undefined"&&(n=100),n>>=0;var r,i,s="@-"+e+"-keyframes "+t+" {";for(r=0;r<=n;r++)i=""+r/n*100+"%"+"{"+"-"+e+"-transform:"+this.calculateKeyFrameData(r/n)+"; -"+e+"-transform-origin:"+this.anchorX*100+"% "+this.anchorY*100+"% "+"}\n",s+=i;return s+="}\n",s}}}}),CAAT.Module({defines:"CAAT.Behavior.Scale1Behavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],aliases:["CAAT.Scale1Behavior"],constants:{AXIS:{X:0,Y:1},Axis:{X:0,Y:1}},extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{__init:function(){return this.__super(),this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER,this},startScale:1,endScale:1,anchorX:.5,anchorY:.5,applyOnX:!0,parse:function(e){CAAT.Behavior.Scale1Behavior.superclass.parse.call(this,e),this.startScale=e.start||0,this.endScale=e.end||0,this.anchorX=typeof e.anchorX!="undefined"?parseInt(e.anchorX):.5,this.anchorY=typeof e.anchorY!="undefined"?parseInt(e.anchorY):.5,this.applyOnX=e.axis?e.axis.toLowerCase()==="x":!0},applyOnAxis:function(e){e===CAAT.Behavior.Scale1Behavior.AXIS.X?this.applyOnX=!1:this.applyOnX=!0},getPropertyName:function(){return"scale"},setForTime:function(e,t){var n=this.startScale+e*(this.endScale-this.startScale);return 0===n&&(n=.01),this.doValueApplication&&(this.applyOnX?t.setScaleAnchored(n,t.scaleY,this.anchorX,this.anchorY):t.setScaleAnchored(t.scaleX,n,this.anchorX,this.anchorY)),n},setValues:function(e,t,n,r,i){return this.startScale=e,this.endScale=t,this.applyOnX=!!n,typeof r!="undefined"&&typeof i!="undefined"&&(this.anchorX=r,this.anchorY=i),this},setAnchor:function(e,t,n){return this.anchorX=t/e.width,this.anchorY=n/e.height,this},calculateKeyFrameData:function(e){var t;return e=this.interpolator.getPosition(e).y,t=this.startScale+e*(this.endScale-this.startScale),this.applyOnX?"scaleX("+t+")":"scaleY("+t+")"},getKeyFrameDataValues:function(e){e=this.interpolator.getPosition(e).y;var t={};return t[this.applyOnX?"scaleX":"scaleY"]=this.startScale+e*(this.endScale-this.startScale),t},calculateKeyFramesData:function(e,t,n){typeof n=="undefined"&&(n=100),n>>=0;var r,i,s="@-"+e+"-keyframes "+t+" {";for(r=0;r<=n;r++)i=""+r/n*100+"%"+"{"+"-"+e+"-transform:"+this.calculateKeyFrameData(r/n)+"; -"+e+"-transform-origin:"+this.anchorX*100+"% "+this.anchorY*100+"% "+"}\n",s+=i;return s+="}\n",s}}}}),CAAT.Module({defines:"CAAT.Behavior.ScaleBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],extendsClass:"CAAT.Behavior.BaseBehavior",aliases:["CAAT.ScaleBehavior"],extendsWith:function(){return{__init:function(){return this.__super(),this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER,this},startScaleX:1,endScaleX:1,startScaleY:1,endScaleY:1,anchorX:.5,anchorY:.5,parse:function(e){CAAT.Behavior.ScaleBehavior.superclass.parse.call(this,e),this.startScaleX=e.scaleX&&e.scaleX.start||0,this.endScaleX=e.scaleX&&e.scaleX.end||0,this.startScaleY=e.scaleY&&e.scaleY.start||0,this.endScaleY=e.scaleY&&e.scaleY.end||0,this.anchorX=typeof e.anchorX!="undefined"?parseInt(e.anchorX):.5,this.anchorY=typeof e.anchorY!="undefined"?parseInt(e.anchorY):.5},getPropertyName:function(){return"scale"},setForTime:function(e,t){var n=this.startScaleX+e*(this.endScaleX-this.startScaleX),r=this.startScaleY+e*(this.endScaleY-this.startScaleY);return 0===n&&(n=.01),0===r&&(r=.01),this.doValueApplication&&t.setScaleAnchored(n,r,this.anchorX,this.anchorY),{scaleX:n,scaleY:r}},setValues:function(e,t,n,r,i,s){return this.startScaleX=e,this.endScaleX=t,this.startScaleY=n,this.endScaleY=r,typeof i!="undefined"&&typeof s!="undefined"&&(this.anchorX=i,this.anchorY=s),this},setAnchor:function(e,t,n){return this.anchorX=t/e.width,this.anchorY=n/e.height,this},calculateKeyFrameData:function(e){var t,n;return e=this.interpolator.getPosition(e).y,t=this.startScaleX+e*(this.endScaleX-this.startScaleX),n=this.startScaleY+e*(this.endScaleY-this.startScaleY),"scale("+t+","+n+")"},getKeyFrameDataValues:function(e){return e=this.interpolator.getPosition(e).y,{scaleX:this.startScaleX+e*(this.endScaleX-this.startScaleX),scaleY:this.startScaleY+e*(this.endScaleY-this.startScaleY)}},calculateKeyFramesData:function(e,t,n){typeof n=="undefined"&&(n=100),n>>=0;var r,i,s="@-"+e+"-keyframes "+t+" {";for(r=0;r<=n;r++)i=""+r/n*100+"%"+"{"+"-"+e+"-transform:"+this.calculateKeyFrameData(r/n)+"; -"+e+"-transform-origin:"+this.anchorX*100+"% "+this.anchorY*100+"% "+"}\n",s+=i;return s+="}\n",s}}}}),CAAT.Module({defines:"CAAT.Module.Runtime.BrowserInfo",constants:function(){function e(e){for(var t=0;t<e.length;t++){var n=e[t].string,r=e[t].prop;this.versionSearchString=e[t].versionSearch||e[t].identity;if(n){if(n.indexOf(e[t].subString)!==-1)return e[t].identity}else if(r)return e[t].identity}}function t(e){var t=e.indexOf(this.versionSearchString);if(t===-1)return;return parseFloat(e.substring(t+this.versionSearchString.length+1))}var n=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Explorer",identity:"Explorer",versionSearch:"Explorer"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],r=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],i=e(n)||"An unknown browser",s=t(navigator.userAgent)||t(navigator.appVersion)||"an unknown version",o=e(r)||"an unknown OS",u=window.devicePixelRatio||1;return{browser:i,version:s,OS:o,DevicePixelRatio:u}}}),CAAT.Module({defines:"CAAT.Module.Audio.AudioManager",depends:["CAAT.Module.Runtime.BrowserInfo"],extendsWith:function(){return{__init:function(){return this.browserInfo=CAAT.Module.Runtime.BrowserInfo,this},musicChannel:null,browserInfo:null,musicEnabled:!0,fxEnabled:!0,audioCache:null,channels:null,workingChannels:null,loopingChannels:[],audioTypes:{mp3:"audio/mpeg;",ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',mp4:'audio/mp4; codecs="mp4a.40.2"'},initialize:function(e){this.audioCache=[],this.channels=[],this.workingChannels=[];for(var t=0;t<=e;t++){var n=document.createElement("audio");if(null!==n){n.finished=-1,this.channels.push(n);var r=this;n.addEventListener("ended",function(e){var t=e.target,n;for(n=0;n<r.workingChannels.length;n++)if(r.workingChannels[n]===t){r.workingChannels.splice(n,1);break}t.caat_callback&&t.caat_callback(t.caat_id),r.channels.push(t)},!1)}}return this.musicChannel=this.channels.pop(),this},addAudioFromURL:function(e,t,n){var r=null,i=document.createElement("audio");if(null!==i){if(!i.canPlayType)return!1;r=t.substr(t.lastIndexOf(".")+1);var s=i.canPlayType(this.audioTypes[r]);if(s!==""&&s!=="no")return i.src=t,i.preload="auto",i.load(),n&&(i.caat_callback=n,i.caat_id=e),this.audioCache.push({id:e,audio:i}),!0}return!1},addAudioFromDomNode:function(e,t,n){var r=t.src.substr(t.src.lastIndexOf(".")+1);return t.canPlayType(this.audioTypes[r])?(n&&(t.caat_callback=n,t.caat_id=e),this.audioCache.push({id:e,audio:t}),!0):!1},addAudioElement:function(e,t,n){if(typeof t=="string")return this.addAudioFromURL(e,t,n);try{if(t instanceof HTMLAudioElement)return this.addAudioFromDomNode(e,t,n)}catch(r){}return!1},addAudio:function(e,t,n){if(t instanceof Array){for(var r=0;r<t.length;r++)if(this.addAudioElement(e,t[r],n))break}else this.addAudioElement(e,t,n);return this},getAudio:function(e){for(var t=0;t<this.audioCache.length;t++)if(this.audioCache[t].id===e)return this.audioCache[t].audio;return null},stopMusic:function(){this.musicChannel.pause()},playMusic:function(e){if(!this.musicEnabled)return null;var t=this.getAudio(e);if(null!==t){var n=this.musicChannel;if(null!==n)return n.src=t.src,n.preload="auto",this.browserInfo.browser==="Firefox"?n.addEventListener("ended",function(e){var t=e.target;t.currentTime=0},!1):n.loop=!0,n.load(),n.play(),n}return null},setVolume:function(e,t){var n=this.getAudio(e);return null!=n&&(n.volume=t),this},play:function(e){if(!this.fxEnabled)return null;var t=this.getAudio(e);if(null!==t&&this.channels.length>0){var n=this.channels.shift();n.src=t.src,n.volume=t.volume,n.play(),this.workingChannels.push(n)}return t},cancelPlay:function(e){for(var t=0;this.workingChannels.length;t++){var n=this.workingChannels[t];n.caat_id===e&&(n.pause(),this.channels.push(n),this.workingChannels.splice(t,1))}return this},cancelPlayByChannel:function(e){for(var t=0;this.workingChannels.length;t++)if(this.workingChannels[t]===e)return this.channels.push(e),this.workingChannels.splice(t,1),this;return this},loop:function(e){if(!this.musicEnabled)return null;var t=this.getAudio(e);if(null!==t){var n=document.createElement("audio");if(null!==n)return n.src=t.src,n.preload="auto",this.browserInfo.browser==="Firefox"?n.addEventListener("ended",function(e){var t=e.target;t.currentTime=0},!1):n.loop=!0,n.load(),n.play(),this.loopingChannels.push(n),n}return null},endSound:function(){var e;for(e=0;e<this.workingChannels.length;e++)this.workingChannels[e].pause(),this.channels.push(this.workingChannels[e]);for(e=0;e<this.loopingChannels.length;e++)this.loopingChannels[e].pause();return this.workingChannels=[],this.loopingChannels=[],this.stopMusic(),this},setSoundEffectsEnabled:function(e){this.fxEnabled=e;for(var t=0;t<this.loopingChannels.length;t++)e?this.loopingChannels[t].play():this.loopingChannels[t].pause();return this},isSoundEffectsEnabled:function(){return this.fxEnabled},setMusicEnabled:function(e){return this.musicEnabled=e,this.stopMusic(),this},isMusicEnabled:function(){return this.musicEnabled}}}}),CAAT.Module({defines:"CAAT.Module.Storage.LocalStorage",constants:{save:function(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(n){}return this},load:function(e,t){try{var n=localStorage.getItem(e);return null===n?t:JSON.parse(n)}catch(r){return null}},remove:function(e){try{localStorage.removeItem(e)}catch(t){}return this}},extendsWith:{}}),CAAT.Module({defines:"CAAT.Module.ColorUtil.Color",depends:[],constants:{RampEnumeration:{RAMP_RGBA:0,RAMP_RGB:1,RAMP_CHANNEL_RGB:2,RAMP_CHANNEL_RGBA:3,RAMP_CHANNEL_RGB_ARRAY:4,RAMP_CHANNEL_RGBA_ARRAY:5},hsvToRgb:function(e,t,n){var r,i,s,o,u,a,f,l;e=Math.max(0,Math.min(360,e)),t=Math.max(0,Math.min(100,t)),n=Math.max(0,Math.min(100,n)),t/=100,n/=100;if(t===0)return r=i=s=n,[Math.round(r*255),Math.round(i*255),Math.round(s*255)];e/=60,o=Math.floor(e),u=e-o,a=n*(1-t),f=n*(1-t*u),l=n*(1-t*(1-u));switch(o){case 0:r=n,i=l,s=a;break;case 1:r=f,i=n,s=a;break;case 2:r=a,i=n,s=l;break;case 3:r=a,i=f,s=n;break;case 4:r=l,i=a,s=n;break;default:r=n,i=a,s=f}return new CAAT.Module.ColorUtil.Color(Math.round(r*255),Math.round(i*255),Math.round(s*255))},interpolate:function(e,t,n,r,i,s,o,u){var a,f,l;return u<=0?{r:e,g:t,b:n}:u>=o?{r:r,g:i,b:s}:(a=e+(r-e)/o*u>>0,f=t+(i-t)/o*u>>0,l=n+(s-n)/o*u>>0,a>255?a=255:a<0&&(a=0),f>255?f=255:f<0&&(f=0),l>255?l=255:l<0&&(l=0),{r:a,g:f,b:l})},makeRGBColorRamp:function(e,t,n){var r=[],i=e.length-1,s=t/i,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;for(o=0;o<i;o+=1){h=e[o],p=h>>24&255,d=(h&16711680)>>16,v=(h&65280)>>8,m=h&255,g=e[o+1],y=g>>24&255,b=(g&16711680)>>16,w=(g&65280)>>8,E=g&255,S=(y-p)/s,x=(b-d)/s,T=(w-v)/s,N=(E-m)/s;for(u=0;u<s;u+=1){a=p+S*u>>0,f=d+x*u>>0,l=v+T*u>>0,c=m+N*u>>0;var C=CAAT.Module.ColorUtil.Color.RampEnumeration;switch(n){case C.RAMP_RGBA:r.push("argb("+a+","+f+","+l+","+c+")");break;case C.RAMP_RGB:r.push("rgb("+f+","+l+","+c+")");break;case C.RAMP_CHANNEL_RGB:r.push(4278190080|f<<16|l<<8|c);break;case C.RAMP_CHANNEL_RGBA:r.push(a<<24|f<<16|l<<8|c);break;case C.RAMP_CHANNEL_RGBA_ARRAY:r.push([f,l,c,a]);break;case C.RAMP_CHANNEL_RGB_ARRAY:r.push([f,l,c])}}}return r},random:function(){var e="0123456789abcdef",t="#";for(var n=0;n<3;n++)t+=e[Math.random()*e.length>>0];return t}},extendsWith:{__init:function(e,t,n){return this.r=e||255,this.g=t||255,this.b=n||255,this},r:255,g:255,b:255,toHex:function(){return("000000"+((this.r<<16)+(this.g<<8)+this.b).toString(16)).slice(-6)}}}),CAAT.Module({defines:"CAAT.Module.Debug.Debug",depends:["CAAT.Event.AnimationLoop"],extendsWith:{width:0,height:0,canvas:null,ctx:null,statistics:null,framerate:null,textContainer:null,textFPS:null,textEntitiesTotal:null,textEntitiesActive:null,textDraws:null,textDrawTime:null,textRAFTime:null,textDirtyRects:null,textDiscardDR:null,frameTimeAcc:0,frameRAFAcc:0,canDebug:!1,SCALE:60,debugTpl:'    <style type="text/css">        #caat-debug {            z-index: 10000;            position:fixed;            bottom:0;            left:0;            width:100%;            background-color: rgba(0,0,0,0.8);        }        #caat-debug.caat_debug_max {            margin-bottom: 0px;        }        .caat_debug_bullet {            display:inline-block;            background-color:#f00;            width:8px;            height:8px;            border-radius: 4px;            margin-left:10px;            margin-right:2px;        }        .caat_debug_description {            font-size:11px;            font-family: helvetica, arial;            color: #aaa;            display: inline-block;        }        .caat_debug_value {            font-size:11px;            font-family: helvetica, arial;            color: #fff;            width:25px;            text-align: right;            display: inline-block;            margin-right: .3em;        }        .caat_debug_indicator {            float: right;        }        #debug_tabs {            border-top: 1px solid #888;            height:25px;        }        .tab_max_min {            font-family: helvetica, arial;            font-size: 12px;            font-weight: bold;            color: #888;            border-right: 1px solid #888;            float: left;            cursor: pointer;            padding-left: 5px;            padding-right: 5px;            padding-top: 5px;            height: 20px;        }        .debug_tabs_content_hidden {            display: none;            width: 100%;        }        .debug_tabs_content_visible {            display: block;            width: 100%;        }        .checkbox_enabled {            display:inline-block;            background-color:#eee;            border: 1px solid #eee;            width:6px;            height:8px;            margin-left:12px;            margin-right:2px;            cursor: pointer;        }        .checkbox_disabled {            display:inline-block;            width:6px;            height:8px;            background-color: #333;            border: 1px solid #eee;            margin-left:12px;            margin-right:2px;            cursor: pointer;        }        .checkbox_description {            font-size:11px;            font-family: helvetica, arial;            color: #fff;        }        .debug_tab {            font-family: helvetica, arial;            font-size: 12px;            color: #fff;            border-right: 1px solid #888;            float: left;            padding-left: 5px;            padding-right: 5px;            height: 20px;            padding-top: 5px;            cursor: default;        }        .debug_tab_selected {            background-color: #444;            cursor: default;        }        .debug_tab_not_selected {            background-color: #000;            cursor: pointer;        }    </style>    <div id="caat-debug">        <div id="debug_tabs">            <span class="tab_max_min" onCLick="javascript: var debug = document.getElementById(\'debug_tabs_content\');if (debug.className === \'debug_tabs_content_visible\') {debug.className = \'debug_tabs_content_hidden\'} else {debug.className = \'debug_tabs_content_visible\'}"> CAAT Debug panel </span>            <span id="caat-debug-tab0" class="debug_tab debug_tab_selected">Performance</span>            <span id="caat-debug-tab1" class="debug_tab debug_tab_not_selected">Controls</span>            <span class="caat_debug_indicator">                <span class="caat_debug_bullet" style="background-color:#0f0;"></span>                <span class="caat_debug_description">Draw Time: </span>                <span class="caat_debug_value" id="textDrawTime">5.46</span>                <span class="caat_debug_description">ms.</span>            </span>            <span class="caat_debug_indicator">                <span class="caat_debug_bullet" style="background-color:#f00;"></span>                <span class="caat_debug_description">FPS: </span>                <span class="caat_debug_value" id="textFPS">48</span>            </span>        </div>        <div id="debug_tabs_content" class="debug_tabs_content_hidden">            <div id="caat-debug-tab0-content">                <canvas id="caat-debug-canvas" height="60"></canvas>                <div>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0f0;"></span>                        <span class="caat_debug_description">RAF Time:</span>                        <span class="caat_debug_value" id="textRAFTime">20.76</span>                        <span class="caat_debug_description">ms.</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0ff;"></span>                        <span class="caat_debug_description">Entities Total: </span>                        <span class="caat_debug_value" id="textEntitiesTotal">41</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0ff;"></span>                        <span class="caat_debug_description">Entities Active: </span>                        <span class="caat_debug_value" id="textEntitiesActive">37</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">Draws: </span>                        <span class="caat_debug_value" id="textDraws">0</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">DirtyRects: </span>                        <span class="caat_debug_value" id="textDirtyRects">0</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">Discard DR: </span>                        <span class="caat_debug_value" id="textDiscardDR">0</span>                    </span>                </div>            </div>            <div id="caat-debug-tab1-content">                <div>                    <div>                        <span id="control-sound"></span>                        <span class="checkbox_description">Sound</span>                    </div>                    <div>                        <span id="control-music"></span>                        <span class="checkbox_description">Music</span>                    </div>                    <div>                        <span id="control-aabb"></span>                        <span class="checkbox_description">AA Bounding Boxes</span>                    </div>                    <div>                        <span id="control-bb"></span>                        <span class="checkbox_description">Bounding Boxes</span>                    </div>                    <div>                        <span id="control-dr"></span>                        <span class="checkbox_description">Dirty Rects</span>                    </div>                </div>            </div>        </div>    </div>',setScale:function(e){return this.scale=e,this},initialize:function(w,h){w=window.innerWidth,this.width=w,this.height=h,this.framerate={refreshInterval:CAAT.FPS_REFRESH||500,frames:0,timeLastRefresh:0,fps:0,prevFps:-1,fpsMin:1e3,fpsMax:0};var debugContainer=document.getElementById("caat-debug");if(!debugContainer){var wrap=document.createElement("div");wrap.innerHTML=this.debugTpl,document.body.appendChild(wrap),eval(' var __x= CAAT;        function initCheck( name, bool, callback ) {            var elem= document.getElementById(name);            if ( elem ) {                elem.className= (bool) ? "checkbox_enabled" : "checkbox_disabled";                if ( callback ) {                    elem.addEventListener( "click", (function(elem, callback) {                        return function(e) {                            elem.__value= !elem.__value;                            elem.className= (elem.__value) ? "checkbox_enabled" : "checkbox_disabled";                            callback(e,elem.__value);                        }                    })(elem, callback), false );                }                elem.__value= bool;            }        }        function setupTabs() {            var numTabs=0;            var elem;            var elemContent;            do {                elem= document.getElementById("caat-debug-tab"+numTabs);                if ( elem ) {                    elemContent= document.getElementById("caat-debug-tab"+numTabs+"-content");                    if ( elemContent ) {                        elemContent.style.display= numTabs===0 ? \'block\' : \'none\';                        elem.className= numTabs===0 ? "debug_tab debug_tab_selected" : "debug_tab debug_tab_not_selected";                        elem.addEventListener( "click", (function(tabIndex) {                            return function(e) {                                for( var i=0; i<numTabs; i++ ) {                                    var _elem= document.getElementById("caat-debug-tab"+i);                                    var _elemContent= document.getElementById("caat-debug-tab"+i+"-content");                                    _elemContent.style.display= i===tabIndex ? \'block\' : \'none\';                                    _elem.className= i===tabIndex ? "debug_tab debug_tab_selected" : "debug_tab debug_tab_not_selected";                                }                            }                        })(numTabs), false );                    }                    numTabs++;                }            } while( elem );        }        initCheck( "control-sound", __x.director[0].isSoundEffectsEnabled(), function(e, bool) {            __x.director[0].setSoundEffectsEnabled(bool);        } );        initCheck( "control-music", __x.director[0].isMusicEnabled(), function(e, bool) {            __x.director[0].setMusicEnabled(bool);        } );        initCheck( "control-aabb", CAAT.DEBUGBB, function(e,bool) {            CAAT.DEBUGAABB= bool;            __x.director[0].currentScene.dirty= true;        } );        initCheck( "control-bb", CAAT.DEBUGBB, function(e,bool) {            CAAT.DEBUGBB= bool;            if ( bool ) {                CAAT.DEBUGAABB= true;            }            __x.director[0].currentScene.dirty= true;        } );        initCheck( "control-dr", CAAT.DEBUG_DIRTYRECTS , function( e,bool ) {            CAAT.DEBUG_DIRTYRECTS= bool;        });        setupTabs();')}this.canvas=document.getElementById("caat-debug-canvas");if(null===this.canvas){this.canDebug=!1;return}return this.canvas.width=w,this.canvas.height=h,this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.width,this.height),this.textFPS=document.getElementById("textFPS"),this.textDrawTime=document.getElementById("textDrawTime"),this.textRAFTime=document.getElementById("textRAFTime"),this.textEntitiesTotal=document.getElementById("textEntitiesTotal"),this.textEntitiesActive=document.getElementById("textEntitiesActive"),this.textDraws=document.getElementById("textDraws"),this.textDirtyRects=document.getElementById("textDirtyRects"),this.textDiscardDR=document.getElementById("textDiscardDR"),this.canDebug=!0,this},debugInfo:function(e){this.statistics=e;var t=CAAT;this.frameTimeAcc+=t.FRAME_TIME,this.frameRAFAcc+=t.REQUEST_ANIMATION_FRAME_TIME,this.framerate.frames++;var n=(new Date).getTime();if(n>this.framerate.timeLastRefresh+this.framerate.refreshInterval){this.framerate.fps=this.framerate.frames*1e3/(n-this.framerate.timeLastRefresh)|0,this.framerate.fpsMin=this.framerate.frames>0?Math.min(this.framerate.fpsMin,this.framerate.fps):this.framerate.fpsMin,this.framerate.fpsMax=Math.max(this.framerate.fpsMax,this.framerate.fps),this.textFPS.innerHTML=this.framerate.fps;var r=(this.frameTimeAcc*100/this.framerate.frames|0)/100;this.frameTimeAcc=0,this.textDrawTime.innerHTML=r;var i=(this.frameRAFAcc*100/this.framerate.frames|0)/100;this.frameRAFAcc=0,this.textRAFTime.innerHTML=i,this.framerate.timeLastRefresh=n,this.framerate.frames=0,this.paint(i)}this.textEntitiesTotal.innerHTML=this.statistics.size_total,this.textEntitiesActive.innerHTML=this.statistics.size_active,this.textDirtyRects.innerHTML=this.statistics.size_dirtyRects,this.textDraws.innerHTML=this.statistics.draws,this.textDiscardDR.innerHTML=this.statistics.size_discarded_by_dirty_rects},paint:function(e){var t=this.ctx,n=0;t.drawImage(this.canvas,1,0,this.width-1,this.height,0,0,this.width-1,this.height),t.strokeStyle="black",t.beginPath(),t.moveTo(this.width-.5,0),t.lineTo(this.width-.5,this.height),t.stroke(),t.strokeStyle="#a22",t.beginPath(),n=this.height-(20/this.SCALE*this.height>>0)-.5,t.moveTo(.5,n),t.lineTo(this.width+.5,n),t.stroke(),t.strokeStyle="#aa2",t.beginPath(),n=this.height-(30/this.SCALE*this.height>>0)-.5,t.moveTo(.5,n),t.lineTo(this.width+.5,n),t.stroke();var r=Math.min(this.height-this.framerate.fps/this.SCALE*this.height,59);-1===this.framerate.prevFps&&(this.framerate.prevFps=r|0),t.strokeStyle="#0ff",t.beginPath(),t.moveTo(this.width,(r|0)-.5),t.lineTo(this.width,this.framerate.prevFps-.5),t.stroke(),this.framerate.prevFps=r;var i=(this.height-e/this.SCALE*this.height>>0)-.5;t.strokeStyle="#ff0",t.beginPath(),t.moveTo(this.width,i),t.lineTo(this.width,i),t.stroke()}}}),CAAT.Module({defines:"CAAT.Module.Font.Font",aliases:"CAAT.Font",depends:["CAAT.Foundation.SpriteImage"],constants:{getFontMetrics:function(e){var t;if(CAAT.CSS_TEXT_METRICS)try{return t=CAAT.Module.Font.Font.getFontMetricsCSS(e),t}catch(n){}return CAAT.Module.Font.Font.getFontMetricsNoCSS(e)},getFontMetricsNoCSS:function(e){var t=/(\d+)p[x|t]/i,n=t.exec(e),r;n?r=n[1]|0:r=32;var i=r-1,s=r+r*.2|0;return{height:s,ascent:i,descent:s-i}},getFontMetricsCSS:function(e){function t(e){var t,n,r,i,s,o,u,a,f,l,c=e&&e.ownerDocument;return n=c.documentElement,t=e.getBoundingClientRect(),r=document.body,i=c.nodeType===9?c.defaultView||c.parentWindow:!1,s=n.clientTop||r.clientTop||0,o=n.clientLeft||r.clientLeft||0,u=i.pageYOffset||n.scrollTop,a=i.pageXOffset||n.scrollLeft,f=t.top+u-s,l=t.left+a-o,{top:f,left:l}}try{var n=document.createElement("span");n.style.font=e,n.innerHTML="Hg";var r=document.createElement("div");r.style.display="inline-block",r.style.width="1px",r.style.heigh="0px";var i=document.createElement("div");i.appendChild(n),i.appendChild(r);var s=document.body;s.appendChild(i);try{var o={};return r.style.verticalAlign="baseline",o.ascent=t(r).top-t(n).top,r.style.verticalAlign="bottom",o.height=t(r).top-t(n).top,o.ascent=Math.ceil(o.ascent),o.height=Math.ceil(o.height),o.descent=o.height-o.ascent,o}finally{s.removeChild(i)}}catch(u){return null}}},extendsWith:function(){var e=10;return{fontSize:10,fontSizeUnit:"px",font:"Sans-Serif",fontStyle:"",fillStyle:"#fff",strokeStyle:null,strokeSize:1,padding:0,image:null,charMap:null,height:0,ascent:0,descent:0,setPadding:function(e){return this.padding=e,this},setFontStyle:function(e){return this.fontStyle=e,this},setStrokeSize:function(e){return this.strokeSize=e,this},setFontSize:function(e){return this.fontSize=e,this.fontSizeUnit="px",this},setFont:function(e){return this.font=e,this},setFillStyle:function(e){return this.fillStyle=e,this},setStrokeStyle:function(e){return this.strokeStyle=e,this},createDefault:function(e){var t="";for(var n=32;n<128;n++)t+=String.fromCharCode(n);return this.create(t,e)},create:function(e,t){t|=0,this.padding=t;var n=document.createElement("canvas"),r=n.getContext("2d");r.textBaseline="bottom",r.font=this.fontStyle+" "+this.fontSize+""+this.fontSizeUnit+" "+this.font;var i=0,s=[],o,u,a;for(o=0;o<e.length;o++){var f=Math.max(1,(r.measureText(e.charAt(o)).width>>0)+1)+2*t;s.push(f),i+=f}var l=CAAT.Font.getFontMetrics(r.font),c="alphabetic",h,p;p=l.height,this.ascent=l.ascent,this.descent=l.descent,this.height=l.height,h=l.ascent,n.width=i,n.height=p,r=n.getContext("2d"),r.textBaseline=c,r.font=this.fontStyle+" "+this.fontSize+""+this.fontSizeUnit+" "+this.font,r.fillStyle=this.fillStyle,r.strokeStyle=this.strokeStyle,this.charMap={},u=0;for(o=0;o<e.length;o++)a=e.charAt(o),r.fillText(a,u+t,h),this.strokeStyle&&(r.beginPath(),r.lineWidth=this.strokeSize,r.strokeText(a,u+t,h)),this.charMap[a]={x:u+t,width:s[o]-2*t},u+=s[o];return this.image=n,this},setAsSpriteImage:function(){var e=[],t=0;for(var n in this.charMap){var r=n,i=this.charMap[n];e[n]={id:t++,height:this.height,xoffset:0,letter:r,yoffset:0,width:i.width,xadvance:i.width,x:i.x,y:0}}return this.spriteImage=(new CAAT.Foundation.SpriteImage).initializeAsGlyphDesigner(this.image,e),this},getAscent:function(){return this.ascent},getDescent:function(){return this.descent},stringHeight:function(){return this.height},getFontData:function(){return{height:this.height,ascent:this.ascent,descent:this.descent}},stringWidth:function(t){var n,r,i=0,s;for(n=0,r=t.length;n<r;n++)s=this.charMap[t.charAt(n)],s?i+=s.width:i+=e;return i},drawText:function(t,n,r,i){var s,o,u,a,f=this.image.height;for(s=0,o=t.length;s<o;s++)u=this.charMap[t.charAt(s)],u?(a=u.width,a>0&&u.height>0&&n.drawImage(this.image,u.x,0,a,f,r,i,a,f),r+=a):(n.strokeStyle="#f00",n.strokeRect(r,i,e,f),r+=e)},save:function(){var e="image/png",t=this.image.toDataURL(e);document.location.href=t.replace(e,"image/octet-stream")},drawSpriteText:function(e,t){this.spriteImage.drawSpriteText(e,t)}}}}),CAAT.Module({defines:"CAAT.Module.CircleManager.PackedCircle",depends:["CAAT.Module.CircleManager.PackedCircle","CAAT.Math.Point"],constants:{BOUNDS_RULE_WRAP:1,BOUNDS_RULE_CONSTRAINT:2,BOUNDS_RULE_DESTROY:4,BOUNDS_RULE_IGNORE:8},extendsWith:{__init:function(){return this.boundsRule=CAAT.Module.CircleManager.PackedCircle.BOUNDS_RULE_IGNORE,this.position=new CAAT.Math.Point(0,0,0),this.offset=new CAAT.Math.Point(0,0,0),this.targetPosition=new CAAT.Math.Point(0,0,0),this},id:0,delegate:null,position:null,offset:null,targetPosition:null,targetChaseSpeed:.02,isFixed:!1,boundsRule:0,collisionMask:0,collisionGroup:0,containsPoint:function(e){var t=this.position.getDistanceSquared(e);return t<this.radiusSquared},getDistanceSquaredFromPosition:function(e){var t=this.position.getDistanceSquared(e);return t<this.radiusSquared},intersects:function(e){var t=this.position.getDistanceSquared(e.position);return t<this.radiusSquared||t<e.radiusSquared},setPosition:function(e){return this.position=e,this},setDelegate:function(e){return this.delegate=e,this},setOffset:function(e){return this.offset=e,this},setTargetPosition:function(e){return this.targetPosition=e,this},setTargetChaseSpeed:function(e){return this.targetChaseSpeed=e,this},setIsFixed:function(e){return this.isFixed=e,this},setCollisionMask:function(e){return this.collisionMask=e,this},setCollisionGroup:function(e){return this.collisionGroup=e,this},setRadius:function(e){return this.radius=e,this.radiusSquared=this.radius*this.radius,this},initialize:function(e){if(e)for(var t in e)this[t]=e[t];return this},dealloc:function(){this.position=null,this.offset=null,this.delegate=null,this.targetPosition=null}}}),CAAT.Module({defines:"CAAT.Module.CircleManager.PackedCircleManager",depends:["CAAT.Math.Point","CAAT.Math.Rectangle"],extendsWith:{__init:function(){this.bounds=new CAAT.Math.Rectangle},allCircles:[],numberOfCollisionPasses:1,numberOfTargetingPasses:0,bounds:null,addCircle:function(e){return e.id=this.allCircles.length,this.allCircles.push(e),this},removeCircle:function(e){var t=0,n=!1,r=this.allCircles.length;if(r===0)throw"Error: (PackedCircleManager) attempting to remove circle, and allCircles.length === 0!!";while(r--)if(this.allCircles[r]===e){n=!0,t=r;break}if(!n)throw"Could not locate circle in allCircles array!";return this.allCircles[t].dealloc(),this.allCircles[t]=null,this},forceCirclesToMatchDelegatePositions:function(){var e=this.allCircles.length;for(var t=0;t<e;t++){var n=this.allCircles[t];if(!n||!n.delegate)continue;n.position.set(n.delegate.x+n.offset.x,n.delegate.y+n.offset.y)}},pushAllCirclesTowardTarget:function(e){var t=new CAAT.Math.Point(0,0,0),n=this.allCircles,r=n.length;for(var i=0;i<this.numberOfTargetingPasses;i++)for(var s=0;s<r;s++){var o=n[s];if(o.isFixed)continue;t.x=o.position.x-(o.targetPosition.x+o.offset.x),t.y=o.position.y-(o.targetPosition.y+o.offset.y),t.multiply(o.targetChaseSpeed),o.position.x-=t.x,o.position.y-=t.y}},handleCollisions:function(){this.removeExpiredElements();var e=new CAAT.Math.Point(0,0,0),t=this.allCircles,n=t.length;for(var r=0;r<this.numberOfCollisionPasses;r++)for(var i=0;i<n;i++){var s=t[i];for(var o=i+1;o<n;o++){var u=t[o];if(!this.circlesCanCollide(s,u))continue;var a=u.position.x-s.position.x,f=u.position.y-s.position.y,l=(s.radius+u.radius)*1.08,c=s.position.getDistanceSquared(u.position);if(c<l*l-.02){e.x=a,e.y=f,e.normalize();var h=(l-Math.sqrt(c))*.5;e.multiply(h),u.isFixed||(s.isFixed&&e.multiply(2.2),u.position.translatePoint(e)),s.isFixed||(u.isFixed&&e.multiply(2.2),s.position.subtract(e))}}}},handleBoundaryForCircle:function(e,t){var n=e.position.x,r=e.position.y,i=e.radius,s=i*2,o=1,u=4,a=8,f=16,l=32;t=u|a,t&o&&n-s>this.bounds.right?e.position.x=this.bounds.left+i:t&o&&n+s<this.bounds.left&&(e.position.x=this.bounds.right-i),t&u&&r-s>this.bounds.bottom?e.position.y=this.bounds.top-i:t&u&&r+s<this.bounds.top&&(e.position.y=this.bounds.bottom+i),t&a&&n+i>=this.bounds.right?e.position.x=e.position.x=this.bounds.right-i:t&a&&n-i<this.bounds.left&&(e.position.x=this.bounds.left+i),t&f&&r+i>this.bounds.bottom?e.position.y=this.bounds.bottom-i:t&f&&r-i<this.bounds.top&&(e.position.y=this.bounds.top+i)},getCircleAt:function(e,t,n){var r=this.allCircles,i=r.length,s=new CAAT.Math.Point(e,t,0),o=null,u=Number.MAX_VALUE;for(var a=0;a<i;a++){var f=r[a];if(!f)continue;var l=f.position.getDistanceSquared(s);l<u&&l<f.radiusSquared+n&&(u=l,o=f)}return o},circlesCanCollide:function(e,t){return!e||!t||e===t?!1:!0},setBounds:function(e,t,n,r){this.bounds.x=e,this.bounds.y=t,this.bounds.width=n,this.bounds.height=r},setNumberOfCollisionPasses:function(e){return this.numberOfCollisionPasses=e,this},setNumberOfTargetingPasses:function(e){return this.numberOfTargetingPasses=e,this},sortOnDistanceToTarget:function(e,t){var n=e.getDistanceSquaredFromPosition(e.targetPosition),r=t.getDistanceSquaredFromPosition(e.targetPosition),i=0;return n>r?i=-1:n<r&&(i=1),i},removeExpiredElements:function(){for(var e=this.allCircles.length;e>=0;e--)this.allCircles[e]===null&&this.allCircles.splice(e,1)},initialize:function(e){if(e)for(var t in e)this[t]=e[t];return this}}}),CAAT.Module({defines:"CAAT.Module.Preloader.Preloader",extendsWith:function(){var e=function(e,t,n){var r=this;return this.id=e,this.path=t,this.image=new Image,this.loader=n,this.image.onload=this.onload.bind(this),this.image.onerror=this.onerror.bind(this),this};return e.prototype={id:null,path:null,image:null,loader:null,onload:function(e){this.loader.__onload(this),this.image.onload=null,this.image.onerror=null},onerror:function(e){this.loader.__onerror(this)},load:function(){this.image.src=this.path},clear:function(){this.loader=null}},{__init:function(){return this.elements=[],this.baseURL="",this},currentGroup:null,elements:null,imageCounter:0,cfinished:null,cloaded:null,cerrored:null,loadedCount:0,baseURL:null,addElement:function(t,n){return this.elements.push(new e(t,this.baseURL+n,this)),this},clear:function(){for(var e=0;e<this.elements.length;e++)this.elements[e].clear();this.elements=null},__onload:function(e){this.cloaded&&this.cloaded(e.id),this.loadedCount++,this.loadedCount===this.elements.length&&this.cfinished&&this.cfinished(this.elements)},__onerror:function(e){this.cerrored&&this.cerrored(e.id)},setBaseURL:function(e){return this.baseURL=e,this},load:function(e,t,n){this.cfinished=e,this.cloaded=t,this.cerroed=n;var r;for(r=0;r<this.elements.length;r++)this.elements[r].load();return this}}}}),CAAT.Module({defines:"CAAT.Module.Preloader.ImagePreloader",aliases:["CAAT.ImagePreloader"],extendsWith:{__init:function(){return this.images=[],this},images:null,notificationCallback:null,imageCounter:0,loadImages:function(e,t,n){e||t&&t(0,[]);var r=this,i;this.notificationCallback=t,this.images=[];for(i=0;i<e.length;i++)this.images.push({id:e[i].id,image:new Image});for(i=0;i<e.length;i++)this.images[i].image.onload=function(){r.imageCounter++,r.notificationCallback(r.imageCounter,r.images)},this.images[i].image.onerror=function(e){return function(t){n&&n(t,e)}}(i),this.images[i].image.src=e[i].url;e.length===0&&t(0,[])}}}),CAAT.Module({defines:"CAAT.Module.Image.ImageUtil",depends:["CAAT.Math.Matrix"],extendsWith:{},constants:{createAlphaSpriteSheet:function(e,t,n,r,i){if(e<t){var s=e;e=t,t=s}var o=document.createElement("canvas");o.width=r.width,o.height=r.height*n;var u=o.getContext("2d");u.fillStyle=i?i:"rgba(255,255,255,0)",u.fillRect(0,0,r.width,r.height*n);var a;for(a=0;a<n;a++)u.globalAlpha=1-(e-t)/n*(a+1),u.drawImage(r,0,a*r.height);return o},rotate:function(e,t){t=t||0;if(!t)return e;var n=document.createElement("canvas");n.width=e.height,n.height=e.width;var r=n.getContext("2d");r.globalAlpha=1,r.fillStyle="rgba(0,0,0,0)",r.clearRect(0,0,n.width,n.height);var i=new CAAT.Math.Matrix;return i.multiply((new CAAT.Math.Matrix).setTranslate(n.width/2,n.width/2)),i.multiply((new CAAT.Math.Matrix).setRotation(t*Math.PI/180)),i.multiply((new CAAT.Math.Matrix).setTranslate(-n.width/2,-n.width/2)),i.transformRenderingContext(r),r.drawImage(e,0,0),n},optimize:function(e,t,n){t>>=0;var r=!0,i=!0,s=!0,o=!0;typeof n!="undefined"&&(typeof n.top!="undefined"&&(r=n.top),typeof n.bottom!="undefined"&&(i=n.bottom),typeof n.left!="undefined"&&(s=n.left),typeof n.right!="undefined"&&(o=n.right));var u=document.createElement("canvas");u.width=e.width,u.height=e.height;var a=u.getContext("2d");a.fillStyle="rgba(0,0,0,0)",a.fillRect(0,0,e.width,e.height),a.drawImage(e,0,0);var f=a.getImageData(0,0,e.width,e.height),l=f.data,c,h,p=0,d=u.height-1,v=0,m=u.width-1,g=!1;if(r){for(c=0;c<u.height;c++){for(h=0;h<u.width;h++)if(l[c*u.width*4+3+h*4]>t){g=!0;break}if(g)break}p=c}if(i){g=!1;for(c=u.height-1;c>=p;c--){for(h=0;h<u.width;h++)if(l[c*u.width*4+3+h*4]>t){g=!0;break}if(g)break}d=c}if(s){g=!1;for(h=0;h<u.width;h++){for(c=p;c<=d;c++)if(l[c*u.width*4+3+h*4]>t){g=!0;break}if(g)break}v=h}if(o){g=!1;for(h=u.width-1;h>=v;h--){for(c=p;c<=d;c++)if(l[c*u.width*4+3+h*4]>t){g=!0;break}if(g)break}m=h}if(0===v&&0===p&&u.width-1===m&&u.height-1===d)return u;var y=m-v+1,b=d-p+1,w=a.getImageData(v,p,y,b);return u.width=y,u.height=b,a=u.getContext("2d"),a.putImageData(w,0,0),u},createThumb:function(e,t,n,r){t=t||24,n=n||24;var i=document.createElement("canvas");i.width=t,i.height=n;var s=i.getContext("2d");if(r){var o=Math.max(e.width,e.height),u=e.width/o*t,a=e.height/o*n;s.drawImage(e,(t-u)/2,(n-a)/2,u,a)}else s.drawImage(e,0,0,t,n);return i}}}),CAAT.Module({defines:"CAAT.Module.Collision.QuadTree",depends:["CAAT.Math.Rectangle"],extendsClass:"CAAT.Math.Rectangle",extendsWith:function(){var e=1,t=32;return{bgActors:null,quadData:null,create:function(n,r,i,s,o,u,a){typeof u=="undefined"&&(u=t),typeof a=="undefined"&&(a=e);var f=(n+i)/2,l=(r+s)/2;return this.x=n,this.y=r,this.x1=i,this.y1=s,this.width=i-n,this.height=s-r,this.bgActors=this.__getOverlappingActorList(o),this.bgActors.length<=a||this.width<=u?this:(this.quadData=new Array(4),this.quadData[0]=(new CAAT.Module.Collision.QuadTree).create(n,r,f,l,this.bgActors),this.quadData[1]=(new CAAT.Module.Collision.QuadTree).create(f,r,i,l,this.bgActors),this.quadData[2]=(new CAAT.Module.Collision.QuadTree).create(n,l,f,s,this.bgActors),this.quadData[3]=(new CAAT.Module.Collision.QuadTree).create(f,l,i,s,this.bgActors),this)},__getOverlappingActorList:function(e){var t=[];for(var n=0,r=e.length;n<r;n++){var i=e[n];this.intersects(i.AABB)&&t.push(i)}return t},getOverlappingActors:function(e){var t,n,r,i=[],s,o=this.bgActors,u;if(this.quadData){for(t=0;t<4;t++)if(this.quadData[t].intersects(e)){s=this.quadData[t].getOverlappingActors(e);for(n=0,r=s.length;n<r;n++)i.push(s[n])}}else for(t=0,r=o.length;t<r;t++)u=o[t],e.intersects(u.AABB)&&i.push(u);return i}}}}),CAAT.Module({defines:"CAAT.Module.Collision.SpatialHash",aliases:["CAAT.SpatialHash"],depends:["CAAT.Math.Rectangle"],extendsWith:{elements:null,width:null,height:null,rows:null,columns:null,xcache:null,ycache:null,xycache:null,rectangle:null,r0:null,r1:null,initialize:function(e,t,n,r){var i,s;this.elements=[];for(i=0;i<n*r;i++)this.elements.push([]);this.width=e,this.height=t,this.rows=n,this.columns=r,this.xcache=[];for(i=0;i<e;i++)this.xcache.push(i/(e/r)>>0);this.ycache=[];for(i=0;i<t;i++)this.ycache.push(i/(t/n)>>0);this.xycache=[];for(i=0;i<this.rows;i++){this.xycache.push([]);for(s=0;s<this.columns;s++)this.xycache[i].push(s+i*r)}return this.rectangle=(new CAAT.Math.Rectangle).setBounds(0,0,e,t),this.r0=new CAAT.Math.Rectangle,this.r1=new CAAT.Math.Rectangle,this},clearObject:function(){var e;for(e=0;e<this.rows*this.columns;e++)this.elements[e]=[];return this},addObject:function(e){var t=e.x|0,n=e.y|0,r=e.width|0,i=e.height|0,s=this.__getCells(t,n,r,i);for(var o=0;o<s.length;o++)this.elements[s[o]].push(e)},__getCells:function(e,t,n,r){var i=[],s;this.rectangle.contains(e,t)&&i.push(this.xycache[this.ycache[t]][this.xcache[e]]);if(this.rectangle.contains(e+n-1,t+r-1)){var o=this.xycache[this.ycache[t+r-1]][this.xcache[e+n-1]];if(o===i[0])return i;i.push(o)}if(this.rectangle.contains(e+n-1,t)){var o=this.xycache[this.ycache[t]][this.xcache[e+n-1]];if(o===i[0]||o===i[1])return i;i.push(o)}if(this.rectangle.contains(e+n-1,t+r-1)){var o=this.xycache[this.ycache[t+r-1]][this.xcache[e]];i.push(o)}return i},solveCollision:function(e){var t,n,r;for(t=0;t<this.elements.length;t++){var i=this.elements[t];i.length>1&&this._solveCollisionCell(i,e)}},_solveCollisionCell:function(e,t){var n,r;for(n=0;n<e.length;n++){var i=e[n];this.r0.setBounds(i.x,i.y,i.width,i.height);for(r=n+1;r<e.length;r++){var s=e[r];this.r0.intersects(this.r1.setBounds(s.x,s.y,s.width,s.height))&&t(i,s)}}},collide:function(e,t,n,r,i){e|=0,t|=0,n|=0,r|=0;var s=this.__getCells(e,t,n,r),o,u,a,f=this.elements;this.r0.setBounds(e,t,n,r);for(o=0;o<s.length;o++){var l=s[o],c=f[l];for(u=0,a=c.length;u<a;u++){var h=c[u];this.r1.setBounds(h.x,h.y,h.width,h.height);if(this.r0.intersects(this.r1)&&i(h))return}}}}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureElement",extendsWith:{inverted:!1,image:null,u:0,v:0,glTexture:null}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureScan",depends:["CAAT.Module.TexturePacker.TextureElement"],extendsWith:{__init:function(e){return this.freeChunks=[{position:0,size:e||1024}],this},freeChunks:null,findWhereFits:function(e){if(this.freeChunks.length===0)return[];var t=[],n;for(n=0;n<this.freeChunks.length;n++){var r=0;while(r+e<=this.freeChunks[n].size)t.push(r+this.freeChunks[n].position),r+=e}return t},fits:function(e,t){var n=0;for(n=0;n<this.freeChunks.length;n++){var r=this.freeChunks[n];if(r.position<=e&&e+t<=r.position+r.size)return!0}return!1},substract:function(e,t){var n=0;for(n=0;n<this.freeChunks.length;n++){var r=this.freeChunks[n];if(r.position<=e&&e+t<=r.position+r.size){var i=0,s=0,o=0,u=0;return i=r.position,s=e-r.position,o=e+t,u=r.position+r.size-o,this.freeChunks.splice(n,1),s>0&&this.freeChunks.splice(n++,0,{position:i,size:s}),u>0&&this.freeChunks.splice(n,0,{position:o,size:u}),!0}}return!1},log:function(e){if(0===this.freeChunks.length)CAAT.log("index "+e+" empty");else{var t="index "+e;for(var n=0;n<this.freeChunks.length;n++){var r=this.freeChunks[n];t+="["+r.position+","+r.size+"]"}CAAT.log(t)}}}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureScanMap",depends:["CAAT.Module.TexturePacker.TextureScan"],extendsWith:{__init:function(e,t){this.scanMapHeight=t,this.scanMapWidth=e,this.scanMap=[];for(var n=0;n<this.scanMapHeight;n++)this.scanMap.push(new CAAT.Module.TexturePacker.TextureScan(this.scanMapWidth));return this},scanMap:null,scanMapWidth:0,scanMapHeight:0,whereFitsChunk:function(e,t){if(e>this.width||t>this.height)return null;var n,r,i=0;while(i<=this.scanMapHeight-t){var s=null,o=!1;for(;i<=this.scanMapHeight-t;i++){s=this.scanMap[i].findWhereFits(e);if(null!==s&&s.length>0){o=!0;break}}if(!o)return null;var u=Number.MAX_VALUE;for(r=0;r<s.length;r++){var a=!0;for(n=i;n<i+t;n++)if(!this.scanMap[n].fits(s[r],e)){a=!1;break}if(a)return{x:s[r],y:i}}i++}return null},substract:function(e,t,n,r){for(var i=0;i<r;i++)this.scanMap[i+t].substract(e,n)||CAAT.log("Error: removing chunk ",n,r," at ",e,t)},log:function(){for(var e=0;e<this.scanMapHeight;e++)this.scanMap[e].log(e)}}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TexturePage",depends:["CAAT.Module.TexturePacker.TextureScanMap"],extendsWith:{__init:function(e,t){return this.width=e||1024,this.height=t||1024,this.images=[],this},width:1024,height:1024,gl:null,texture:null,allowImagesInvertion:!1,padding:4,scan:null,images:null,criteria:"area",initialize:function(e){this.gl=e,e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA);var t=new Uint8Array(this.width*this.height*4);for(var n=0;n<4*this.width*this.height;)t[n++]=0,t[n++]=0,t[n++]=0,t[n++]=0;e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,t),e.enable(e.BLEND);for(var r=0;r<this.images.length;r++){var i=this.images[r];i.inverted&&(i=CAAT.Module.Image.ImageUtil.rotate(i,-90)),e.texSubImage2D(e.TEXTURE_2D,0,this.images[r].__tx,this.images[r].__ty,e.RGBA,e.UNSIGNED_BYTE,i)}},create:function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n].image;r.__texturePage||t.push(r)}this.createFromImages(t)},clear:function(){this.createFromImages([])},update:function(e,t,n,r){this.allowImagesInvertion=e,this.padding=t,n<100&&(n=100),r<100&&(r=100),this.width=n,this.height=r,this.createFromImages(this.images)},createFromImages:function(e){var t;this.scan=new CAAT.Module.TexturePacker.TextureScanMap(this.width,this.height),this.images=[];if(this.allowImagesInvertion)for(t=0;t<e.length;t++)e[t].inverted=this.allowImagesInvertion&&e[t].height<e[t].width;var n=this;e.sort(function(e,t){var r=e.width*e.height,i=t.width*t.height;return n.criteria==="width"?e.width<t.width?1:e.width>t.width?-1:0:n.criteria==="height"?e.height<t.height?1:e.height>t.height?-1:0:r<i?1:r>i?-1:0});for(t=0;t<e.length;t++){var r=e[t];this.packImage(r)}},addImage:function(e,t,n){this.allowImagesInvertion=t,this.padding=n,this.images.push(e),this.createFromImages(Array.prototype.slice.call(this.images))},endCreation:function(){var e=this.gl;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)},deletePage:function(){for(var e=0;e<this.images.length;e++)delete this.images[e].__texturePage,delete this.images[e].__u,delete this.images[e].__v;this.gl.deleteTexture(this.texture)},toCanvas:function(e,t){e=e||document.createElement("canvas"),e.width=this.width,e.height=this.height;var n=e.getContext("2d");n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,this.width,this.height);for(var r=0;r<this.images.length;r++)n.drawImage(this.images[r].inverted?CAAT.Modules.Image.ImageUtil.rotate(this.images[r],90):this.images[r],this.images[r].__tx,this.images[r].__ty),t&&(n.strokeStyle="red",n.strokeRect(this.images[r].__tx,this.images[r].__ty,this.images[r].__w,this.images[r].__h));return t&&(n.strokeStyle="red",n.strokeRect(0,0,this.width,this.height)),e},packImage:function(e){var t,n;e.inverted?(t=e.height,n=e.width):(t=e.width,n=e.height);var r=t,i=n,s;r&&this.padding&&(s=this.padding,r+s<=this.width&&(r+=s)),i&&this.padding&&(s=this.padding,i+s<=this.height&&(i+=s));var o=this.scan.whereFitsChunk(r,i);null!==o?(this.images.push(e),e.__tx=o.x,e.__ty=o.y,e.__u=o.x/this.width,e.__v=o.y/this.height,e.__u1=(o.x+t)/this.width,e.__v1=(o.y+n)/this.height,e.__texturePage=this,e.__w=t,e.__h=n,this.scan.substract(o.x,o.y,r,i)):CAAT.log("Imagen ",e.src," de tamano ",e.width,e.height," no cabe.")},changeHeuristic:function(e){this.criteria=e}}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TexturePageManager",depends:["CAAT.Module.TexturePacker.TexturePage"],extendsWith:{__init:function(){return this.pages=[],this},pages:null,createPages:function(e,t,n,r){var i=!1;while(!i){var s=new CAAT.Module.TexturePacker.TexturePage(t,n);s.create(r),s.initialize(e),s.endCreation(),this.pages.push(s),i=!0;for(var o=0;o<r.length;o++)if(!r[o].image.__texturePage){r[o].image.width<=t&&r[o].image.height<=n&&(i=!1);break}}},deletePages:function(){for(var e=0;e<this.pages.length;e++)this.pages[e].deletePage();this.pages=null}}}),CAAT.Module({defines:"CAAT.Module.LayoutUtils.RowLayout",constants:{Row:function(e,t,n){var r=e.width,i=0,s=0,o=0,u=0,a=-Number.MAX_VALUE,f=Number.MAX_VALUE;for(o=t.length-1;o;o-=1)f<t[o].width&&(f=t[o].width),a<t[o].height&&(a=t[o].height);n.padding_left&&(i=n.padding_left,r-=i),n.padding_right&&(r-=n.padding_right);if(n.top){var l=parseInt(n.top,10);if(!isNaN(l))s=l;else switch(n.top){case"center":s=(e.height-a)/2;break;case"top":s=0;break;case"bottom":s=e.height-a;break;default:s=0}}var c=r/t.length;for(o=0,u=t.length;o<u;o++)t[o].setLocation(i+o*c+(c-t[o].width)/2,s)}}}),CAAT.Module({defines:"CAAT.Module.Initialization.Template",depends:["CAAT.Foundation.Director","CAAT.Module.Preloader.ImagePreloader"],constants:{init:function(e,t,n,r,i){var s=document.getElementById(n),o;if(CAAT.__CSS__)s&&0==s instanceof HTMLDivElement&&(s=null),s===null&&(s=document.createElement("div"),document.body.appendChild(s)),o=(new CAAT.Foundation.Director).initialize(e||800,t||600,s);else{if(s){if(s instanceof HTMLDivElement){var u=document.createElement("canvas");s.appendChild(u),s=u}else if(0==s instanceof HTMLCanvasElement){var u=document.createElement("canvas");document.body.appendChild(u),s=u}}else s=document.createElement("canvas"),document.body.appendChild(s);o=(new CAAT.Foundation.Director).initialize(e||800,t||600,s)}(new CAAT.Module.Preloader.ImagePreloader).loadImages(r,function(t,n){t===n.length&&(o.emptyScenes(),o.setImagesCache(n),i(o),o.easeIn(0,CAAT.Foundation.Scene.EASE_SCALE,2e3,!1,CAAT.Foundation.Actor.ANCHOR_CENTER,(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(2.5,.4)),CAAT.loop(60))})}}}),CAAT.Module({defines:"CAAT.Module.Initialization.TemplateWithSplash",depends:["CAAT.Foundation.Director","CAAT.Module.Preloader.ImagePreloader"],constants:{init:function(e,t,n,r,i,s,o,u){function a(e,t,n){var r=e.getImage("spinner"),i=e.getImage("splash"),s=e.createScene(),o=t,u=(new Date).getTime();return i&&s.addChild((new CAAT.Foundation.Actor).setBackgroundImage(i,!1).setBounds(0,0,e.width,e.height).setImageTransformation(CAAT.Foundation.SpriteImage.TR_FIXED_TO_SIZE)),r&&s.addChild((new CAAT.Foundation.Actor).setBackgroundImage(r).centerAt(s.width/2,s.height/2).addBehavior((new CAAT.Behavior.RotateBehavior).setValues(0,2*Math.PI).setFrameTime(0,1e3).setCycle(!0))),s.loadedImage=function(t,r){if(!r||t===r.length){var i=(new Date).getTime()-u;i<o?(i=Math.abs(o-i),i>o&&(i=o),setTimeout(function(){f(e,r,n)},i)):f(e,r,n)}},s}function f(e,t,n){e.emptyScenes(),e.setImagesCache(t),e.setClear(!0),n(e),e.setClear(CAAT.Foundation.Director.CLEAR_ALL),e.easeIn(0,CAAT.Foundation.Scene.EASE_SCALE,2e3,!1,CAAT.Foundation.Actor.ANCHOR_CENTER,(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(2.5,.4))}var l=document.getElementById(n),c;if(CAAT.__CSS__)l&&0==l instanceof HTMLDivElement&&(l=null),l===null&&(l=document.createElement("div"),document.body.appendChild(l)),c=(new CAAT.Foundation.Director).initialize(e||800,t||600,l);else{if(l){if(l instanceof HTMLDivElement){var h=document.createElement("canvas");l.appendChild(h),l=h}else if(0==l instanceof HTMLCanvasElement){var h=document.createElement("canvas");document.body.appendChild(h),l=h}}else l=document.createElement("canvas"),document.body.appendChild(l);c=(new CAAT.Foundation.Director).initialize(e||800,t||600,l)}var p=[];o&&p.push({id:"splash",url:o}),u&&p.push({id:"spinner",url:u}),c.setClear(CAAT.Foundation.Director.CLEAR_DIRTY_RECTS),(new CAAT.Module.Preloader.ImagePreloader).loadImages(p,function(t,n){if(t===n.length){c.setImagesCache(n);var o=a(c,r||5e3,s);CAAT.loop(60),i&&i.length>0?(new CAAT.Module.Preloader.ImagePreloader).loadImages(i,o.loadedImage):o.loadedImage(0,null)}})}}}),function(){CAAT.CSS={},CAAT.CSS.PREFIX=function(){var e="",t=["WebKit","Moz","O"],n="";for(var r=0;r<t.length;r++)if(window[t[r]+"CSSKeyframeRule"]){e=t[r].toLowerCase();break}return CAAT.CSS.PROP_ANIMATION="-"+e+"-animation",e}(),CAAT.CSS.applyKeyframe=function(e,t,n,r,i){e.style[CAAT.CSS.PROP_ANIMATION]=t+" "+n/1e3+"s "+r/1e3+"s linear both "+(i?"infinite":"")},CAAT.CSS.unregisterKeyframes=function(e){var t=CAAT.CSS.getCSSKeyframesIndex(e);null!==t&&document.styleSheets[t.sheetIndex].deleteRule(t.index)},CAAT.CSS.registerKeyframes=function(e){var t=e.name,n=e.behavior,r=e.size,i=e.overwrite;if(typeof t=="undefined"||typeof n=="undefined")throw"Keyframes must be defined by a name and a CAAT.Behavior instance.";typeof r=="undefined"&&(r=100),typeof i=="undefined"&&(i=!1);var s=CAAT.CSS.getCSSKeyframesIndex(t);if(null!==s&&!i)return;var o=n.calculateKeyFramesData(CAAT.CSS.PREFIX,t,r,e.anchorX,e.anchorY);if(document.styleSheets){if(!document.styleSheets.length){var u=document.createElement("style");u.type="text/css",document.getElementsByTagName("head")[0].appendChild(u)}null!==s&&document.styleSheets[s.sheetIndex].deleteRule(s.index);var a=s?s.sheetIndex:0;document.styleSheets[a].insertRule(o,0)}return o},CAAT.CSS.getCSSKeyframesIndex=function(e){var t=document.styleSheets;for(var n=t.length-1;n>=0;n--)try{var r=t[n],i=r.cssRules?r.cssRules:r.rules?r.rules:[];for(var s=i.length-1;s>=0;s--)if((i[s].type===window.CSSRule.WEBKIT_KEYFRAMES_RULE||i[s].type===window.CSSRule.MOZ_KEYFRAMES_RULE)&&i[s].name===e)return{sheetIndex:n,index:s}}catch(o){}return null},CAAT.CSS.getCSSKeyframes=function(e){var t=document.styleSheets;for(var n=t.length-1;n>=0;n--)try{var r=t[n],i=r.cssRules?r.cssRules:r.rules?r.rules:[];for(var s=i.length-1;s>=0;s--)if((i[s].type===window.CSSRule.WEBKIT_KEYFRAMES_RULE||i[s].type===window.CSSRule.MOZ_KEYFRAMES_RULE)&&i[s].name===e)return i[s]}catch(o){}return null}}(),CAAT.Module({defines:"CAAT.PathUtil.PathSegment",depends:["CAAT.Math.Rectangle","CAAT.Math.Point","CAAT.Math.Matrix","CAAT.Math.Curve"],extendsWith:function(){return{__init:function(){return this.bbox=new CAAT.Math.Rectangle,this},color:"#000",length:0,bbox:null,parent:null,setParent:function(e){return this.parent=e,this},setColor:function(e){return e&&(this.color=e),this},endCurvePosition:function(){},startCurvePosition:function(){},setPoints:function(e){},setPoint:function(e,t){},getPosition:function(e){},getLength:function(){return this.length},getBoundingBox:function(){return this.bbox},numControlPoints:function(){},getControlPoint:function(e){},endPath:function(){},getContour:function(e){},updatePath:function(e){},applyAsPath:function(e){},transform:function(e){},drawHandle:function(e,t,n){e.beginPath(),e.arc(t,n,CAAT.Math.Curve.prototype.HANDLE_SIZE/2,0,2*Math.PI,!1),e.fill()}}}}),CAAT.Module({defines:"CAAT.PathUtil.ArcPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Rectangle"],aliases:["CAAT.ArcPath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){return this.__super(),this.points=[],this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.newPosition=new CAAT.Math.Point,this},points:null,cw:!0,newPosition:null,radius:0,startAngle:0,angle:2*Math.PI,arcTo:!1,setRadius:function(e){return this.radius=e,this},isArcTo:function(){return this.arcTo},setArcTo:function(e){return this.arcTo=e,this},initialize:function(e,t,n,r){return this.setInitialPosition(e,t),this.setFinalPosition(e+n,t),this.angle=r||2*Math.PI,this},applyAsPath:function(e){var t=e.ctx;return this.arcTo?t.arcTo(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y,this.radius):t.arc(this.points[0].x,this.points[0].y,this.radius,this.startAngle,this.angle+this.startAngle,this.cw),this},setPoint:function(e,t){t>=0&&t<this.points.length&&(this.points[t]=e)},setPoints:function(e){return this.points=[],this.points[0]=e[0],this.points[1]=e[1],this.updatePath(),this},setClockWise:function(e){return this.cw=e!==undefined?e:!0,this},isClockWise:function(){return this.cw},setInitialPosition:function(e,t){for(var n=0,r=this.points.length;n<r;n++)this.points[0].x=e,this.points[0].y=t;return this},setFinalPosition:function(e,t){return this.points[1].x=e,this.points[1].y=t,this.updatePath(this.points[1]),this},endCurvePosition:function(){return this.points[0]},startCurvePosition:function(){return this.points[0]},getPosition:function(e){if(e>1||e<0)e%=1;e<0&&(e=1+e);if(-1===this.length)this.newPosition.set(this.points[0].x,this.points[0].y);else{var t=this.angle*e*(this.cw?1:-1)+this.startAngle;this.newPosition.set(this.points[0].x+this.radius*Math.cos(t),this.points[0].y+this.radius*Math.sin(t))}return this.newPosition},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[1].x},paint:function(e,t){var n=e.ctx;n.save(),n.strokeStyle=this.color,n.beginPath(),this.arcTo?n.arcTo(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y,this.radius):n.arc(this.points[0].x,this.points[0].y,this.radius,this.startAngle,this.startAngle+this.angle,this.cw),n.stroke();if(t){n.globalAlpha=.5,n.fillStyle="#7f7f00";for(var r=0;r<this.points.length;r++)this.drawHandle(n,this.points[r].x,this.points[r].y)}n.restore()},numControlPoints:function(){return this.points.length},getControlPoint:function(e){return this.points[e]},getContour:function(e){var t=[];for(var n=0;n<e;n++)t.push({x:this.points[0].x+this.radius*Math.cos(n*Math.PI/(e/2)),y:this.points[0].y+this.radius*Math.sin(n*Math.PI/(e/2))});return t},getPositionFromLength:function(e){var t=e/this.length*(this.cw?1:-1);return this.getPosition(t)},updatePath:function(e){return this.points[1]===e?(this.arcTo||(this.radius=Math.sqrt((this.points[0].x-this.points[1].x)*(this.points[0].x-this.points[1].x)+(this.points[0].y-this.points[1].y)*(this.points[0].y-this.points[1].y))),this.length=this.angle*this.radius,this.startAngle=Math.atan2(this.points[1].y-this.points[0].y,this.points[1].x-this.points[0].x)):this.points[0]===e&&this.points[1].set(this.points[0].x+this.radius*Math.cos(this.startAngle),this.points[0].y+this.radius*Math.sin(this.startAngle)),this.bbox.setEmpty(),this.bbox.x=this.points[0].x-this.radius,this.bbox.y=this.points[0].y-this.radius,this.bbox.x1=this.points[0].x+this.radius,this.bbox.y1=this.points[0].y+this.radius,this.bbox.width=2*this.radius,this.bbox.height=2*this.radius,this}}}}),CAAT.Module({defines:"CAAT.PathUtil.CurvePath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Bezier"],aliases:["CAAT.CurvePath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){return this.__super(),this.newPosition=new CAAT.Math.Point(0,0,0),this},curve:null,newPosition:null,applyAsPath:function(e){return this.curve.applyAsPath(e),this},setPoint:function(e,t){this.curve&&this.curve.setPoint(e,t)},setPoints:function(e){var t=new CAAT.Math.Bezier;return t.setPoints(e),this.curve=t,this},setQuadric:function(e,t,n,r,i,s){var o=new CAAT.Math.Bezier;return o.setQuadric(e,t,n,r,i,s),this.curve=o,this.updatePath(),this},setCubic:function(e,t,n,r,i,s,o,u){var a=new CAAT.Math.Bezier;return a.setCubic(e,t,n,r,i,s,o,u),this.curve=a,this.updatePath(),this},updatePath:function(e){return this.curve.update(),this.length=this.curve.getLength(),this.curve.getBoundingBox(this.bbox),this},getPosition:function(e){if(e>1||e<0)e%=1;return e<0&&(e=1+e),this.curve.solve(this.newPosition,e),this.newPosition},getPositionFromLength:function(e){return this.curve.solve(this.newPosition,e/this.length),this.newPosition},initialPositionX:function(){return this.curve.coordlist[0].x},finalPositionX:function(){return this.curve.coordlist[this.curve.coordlist.length-1].x},paint:function(e,t){this.curve.drawHandles=t,e.ctx.strokeStyle=this.color,this.curve.paint(e,t)},numControlPoints:function(){return this.curve.coordlist.length},getControlPoint:function(e){return this.curve.coordlist[e]},endCurvePosition:function(){return this.curve.endCurvePosition()},startCurvePosition:function(){return this.curve.startCurvePosition()},getContour:function(e){var t=[];for(var n=0;n<=e;n++)t.push({x:n/e,y:this.getPosition(n/e).y});return t}}}}),CAAT.Module({defines:"CAAT.PathUtil.LinearPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point"],aliases:["CAAT.LinearPath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){return this.__super(),this.points=[],this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.newPosition=new CAAT.Math.Point(0,0,0),this},points:null,newPosition:null,applyAsPath:function(e){e.ctx.lineTo(this.points[1].x,this.points[1].y)},setPoint:function(e,t){t===0?this.points[0]=e:t===1&&(this.points[1]=e)},updatePath:function(e){var t=this.points[1].x-this.points[0].x,n=this.points[1].y-this.points[0].y;return this.length=Math.sqrt(t*t+n*n),this.bbox.setEmpty(),this.bbox.union(this.points[0].x,this.points[0].y),this.bbox.union(this.points[1].x,this.points[1].y),this},setPoints:function(e){return this.points[0]=e[0],this.points[1]=e[1],this.updatePath(),this},setInitialPosition:function(e,t){return this.points[0].x=e,this.points[0].y=t,this.newPosition.set(e,t),this},setFinalPosition:function(e,t){return this.points[1].x=e,this.points[1].y=t,this},endCurvePosition:function(){return this.points[1]},startCurvePosition:function(){return this.points[0]},getPosition:function(e){if(e>1||e<0)e%=1;return e<0&&(e=1+e),this.newPosition.set(this.points[0].x+(this.points[1].x-this.points[0].x)*e,this.points[0].y+(this.points[1].y-this.points[0].y)*e),this.newPosition},getPositionFromLength:function(e){return this.getPosition(e/this.length)},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[1].x},paint:function(e,t){var n=e.ctx;n.save(),n.strokeStyle=this.color,n.beginPath(),n.moveTo(this.points[0].x,this.points[0].y),n.lineTo(this.points[1].x,this.points[1].y),n.stroke(),t&&(n.globalAlpha=.5,n.fillStyle="#7f7f00",n.beginPath(),this.drawHandle(n,this.points[0].x,this.points[0].y),this.drawHandle(n,this.points[1].x,this.points[1].y)),n.restore()},numControlPoints:function(){return 2},getControlPoint:function(e){if(0===e)return this.points[0];if(1===e)return this.points[1]},getContour:function(e){var t=[];return t.push(this.getPosition(0).clone()),t.push(this.getPosition(1).clone()),t}}}}),CAAT.Module({defines:"CAAT.PathUtil.RectPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Rectangle"],aliases:["CAAT.RectPath","CAAT.ShapePath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){return this.__super(),this.points=[],this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.newPosition=new CAAT.Math.Point,this},points:null,cw:!0,newPosition:null,applyAsPath:function(e){var t=e.ctx;return this.cw?(t.lineTo(this.points[0].x,this.points[0].y),t.lineTo(this.points[1].x,this.points[1].y),t.lineTo(this.points[2].x,this.points[2].y),t.lineTo(this.points[3].x,this.points[3].y),t.lineTo(this.points[4].x,this.points[4].y)):(t.lineTo(this.points[4].x,this.points[4].y),t.lineTo(this.points[3].x,this.points[3].y),t.lineTo(this.points[2].x,this.points[2].y),t.lineTo(this.points[1].x,this.points[1].y),t.lineTo(this.points[0].x,this.points[0].y)),this},setPoint:function(e,t){t>=0&&t<this.points.length&&(this.points[t]=e)},setPoints:function(e){return this.points=[],this.points.push(e[0]),this.points.push((new CAAT.Math.Point).set(e[1].x,e[0].y)),this.points.push(e[1]),this.points.push((new CAAT.Math.Point).set(e[0].x,e[1].y)),this.points.push(e[0].clone()),this.updatePath(),this},setClockWise:function(e){return this.cw=e!==undefined?e:!0,this},isClockWise:function(){return this.cw},setInitialPosition:function(e,t){for(var n=0,r=this.points.length;n<r;n++)this.points[n].x=e,this.points[n].y=t;return this},setFinalPosition:function(e,t){return this.points[2].x=e,this.points[2].y=t,this.points[1].x=e,this.points[1].y=this.points[0].y,this.points[3].x=this.points[0].x,this.points[3].y=t,this.points[4].x=this.points[0].x,this.points[4].y=this.points[0].y,this.updatePath(),this},endCurvePosition:function(){return this.points[4]},startCurvePosition:function(){return this.points[0]},getPosition:function(e){if(e>1||e<0)e%=1;e<0&&(e=1+e);if(-1===this.length)this.newPosition.set(0,0);else{var t=this.bbox.width/this.length,n=this.bbox.height/this.length,r=0,i,s,o=0;this.cw?(s=[0,1,2,3,4],i=[t,n,t,n]):(s=[4,3,2,1,0],i=[n,t,n,t]);while(o<i.length){if(!(r+i[o]<e))break;r+=i[o],o++}e-=r;var u=s[o],a=s[o+1];this.newPosition.set(this.points[u].x+(this.points[a].x-this.points[u].x)*e/i[o],this.points[u].y+(this.points[a].y-this.points[u].y)*e/i[o])}return this.newPosition},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[2].x},paint:function(e,t){var n=e.ctx;n.save(),n.strokeStyle=this.color,n.beginPath(),n.strokeRect(this.bbox.x,this.bbox.y,this.bbox.width,this.bbox.height);if(t){n.globalAlpha=.5,n.fillStyle="#7f7f00";for(var r=0;r<this.points.length;r++)this.drawHandle(n,this.points[r].x,this.points[r].y)}n.restore()},numControlPoints:function(){return this.points.length},getControlPoint:function(e){return this.points[e]},getContour:function(){var e=[];for(var t=0;t<this.points.length;t++)e.push(this.points[t]);return e},updatePath:function(e){e&&(e===this.points[0]?(this.points[1].y=e.y,this.points[3].x=e.x):e===this.points[1]?(this.points[0].y=e.y,this.points[2].x=e.x):e===this.points[2]?(this.points[3].y=e.y,this.points[1].x=e.x):e===this.points[3]&&(this.points[0].x=e.x,this.points[2].y=e.y),this.points[4].x=this.points[0].x,this.points[4].y=this.points[0].y),this.bbox.setEmpty();for(var t=0;t<4;t++)this.bbox.union(this.points[t].x,this.points[t].y);return this.length=2*this.bbox.width+2*this.bbox.height,this.points[0].x=this.bbox.x,this.points[0].y=this.bbox.y,this.points[1].x=this.bbox.x+this.bbox.width,this.points[1].y=this.bbox.y,this.points[2].x=this.bbox.x+this.bbox.width,this.points[2].y=this.bbox.y+this.bbox.height,this.points[3].x=this.bbox.x,this.points[3].y=this.bbox.y+this.bbox.height,this.points[4].x=this.bbox.x,this.points[4].y=this.bbox.y,this},getPositionFromLength:function(e){return this.getPosition(e/(this.bbox.width*2+this.bbox.height*2))}}}}),CAAT.Module({defines:"CAAT.PathUtil.Path",aliases:["CAAT.Path"],depends:["CAAT.PathUtil.PathSegment","CAAT.PathUtil.ArcPath","CAAT.PathUtil.CurvePath","CAAT.PathUtil.LinearPath","CAAT.PathUtil.RectPath","CAAT.Math.Bezier","CAAT.Math.CatmullRom","CAAT.Math.Point","CAAT.Math.Matrix"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:{__init:function(){return this.__super(),this.newPosition=new CAAT.Math.Point(0,0,0),this.pathSegments=[],this.behaviorList=[],this.matrix=new CAAT.Math.Matrix,this.tmpMatrix=new CAAT.Math.Matrix,this},pathSegments:null,pathSegmentDurationTime:null,pathSegmentStartTime:null,newPosition:null,pathLength:-1,beginPathX:-1,beginPathY:-1,trackPathX:-1,trackPathY:-1,ax:-1,ay:-1,point:[],interactive:!0,behaviorList:null,rb_angle:0,rb_rotateAnchorX:.5,rb_rotateAnchorY:.5,sb_scaleX:1,sb_scaleY:1,sb_scaleAnchorX:.5,sb_scaleAnchorY:.5,tAnchorX:0,tAnchorY:0,tb_x:0,tb_y:0,matrix:null,tmpMatrix:null,pathPoints:null,width:0,height:0,clipOffsetX:0,clipOffsetY:0,closed:!1,applyAsPath:function(e){var t=e.ctx;e.modelViewMatrix.transformRenderingContext(t),t.globalCompositeOperation="source-out",t.moveTo(this.getFirstPathSegment().startCurvePosition().x,this.getFirstPathSegment().startCurvePosition().y);for(var n=0;n<this.pathSegments.length;n++)this.pathSegments[n].applyAsPath(e);return t.globalCompositeOperation="source-over",this},setInteractive:function(e){return this.interactive=e,this},getFirstPathSegment:function(){return this.pathSegments.length?this.pathSegments[0]:null},getLastPathSegment:function(){return this.pathSegments.length?this.pathSegments[this.pathSegments.length-1]:null},endCurvePosition:function(){return this.pathSegments.length?this.pathSegments[this.pathSegments.length-1].endCurvePosition():(new CAAT.Math.Point).set(this.beginPathX,this.beginPathY)},startCurvePosition:function(){return this.pathSegments[0].startCurvePosition()},getCurrentPathSegment:function(){return this.pathSegments[this.pathSegments.length-1]},setLinear:function(e,t,n,r){return this.pathSegments=[],this.beginPath(e,t),this.addLineTo(n,r),this.endPath(),this},setQuadric:function(e,t,n,r,i,s){return this.beginPath(e,t),this.addQuadricTo(n,r,i,s),this.endPath(),this},setCubic:function(e,t,n,r,i,s,o,u){return this.beginPath(e,t),this.addCubicTo(n,r,i,s,o,u),this.endPath(),this},setRectangle:function(e,t,n,r){return this.beginPath(e,t),this.addRectangleTo(n,r),this.endPath(),this},setCatmullRom:function(e,t){t&&(e=e.slice(0),e.unshift(e[e.length-1]),e.push(e[1]),e.push(e[2]));for(var n=1;n<e.length-2;n++){var r=(new CAAT.PathUtil.CurvePath).setColor("#000").setParent(this),i=(new CAAT.Math.CatmullRom).setCurve(e[n-1],e[n],e[n+1],e[n+2]);r.curve=i,this.pathSegments.push(r)}return this},addSegment:function(e){return e.setParent(this),this.pathSegments.push(e),this},addArcTo:function(e,t,n,r,i,s,o){var u=new CAAT.PathUtil.ArcPath;return u.setArcTo(!0),u.setRadius(i),u.setInitialPosition(e,t).setFinalPosition(n,r),u.setParent(this),u.setColor(o),this.pathSegments.push(u),this},addRectangleTo:function(e,t,n,r){var i=new CAAT.PathUtil.RectPath;return i.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(e,t)]),i.setClockWise(n),i.setColor(r),i.setParent(this),this.pathSegments.push(i),this},addQuadricTo:function(e,t,n,r,i){var s=new CAAT.Math.Bezier;s.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(e,t),(new CAAT.Math.Point).set(n,r)]),this.trackPathX=n,this.trackPathY=r;var o=(new CAAT.PathUtil.CurvePath).setColor(i).setParent(this);return o.curve=s,this.pathSegments.push(o),this},addCubicTo:function(e,t,n,r,i,s,o){var u=new CAAT.Math.Bezier;u.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(e,t),(new CAAT.Math.Point).set(n,r),(new CAAT.Math.Point).set(i,s)]),this.trackPathX=i,this.trackPathY=s;var a=(new CAAT.PathUtil.CurvePath).setColor(o).setParent(this);return a.curve=u,this.pathSegments.push(a),this},addCatmullTo:function(e,t,n,r,i,s,o){var u=(new CAAT.Math.CatmullRom).setColor(o);u.setCurve(this.trackPathX,this.trackPathY,e,t,n,r,i,s),this.trackPathX=i,this.trackPathY=s;var a=(new CAAT.PathUtil.CurvePath).setParent(this);return a.curve=u,this.pathSegments.push(a),this},addLineTo:function(e,t,n){var r=(new CAAT.PathUtil.LinearPath).setColor(n);return r.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(e,t)]),r.setParent(this),this.trackPathX=e,this.trackPathY=t,this.pathSegments.push(r),this},beginPath:function(e,t){return this.trackPathX=e,this.trackPathY=t,this.beginPathX=e,this.beginPathY=t,this},closePath:function(){return this.getLastPathSegment().setPoint(this.getFirstPathSegment().startCurvePosition(),this.getLastPathSegment().numControlPoints()-1),this.trackPathX=this.beginPathX,this.trackPathY=this.beginPathY,this.closed=!0,this.endPath(),this},endPath:function(){return this.pathSegmentStartTime=[],this.pathSegmentDurationTime=[],this.updatePath(),this},getPosition:function(e,t){if(t&&(e>=1||e<=0)){var n,r,i,s;e>=1?(n=this.__getPositionImpl(.999),r=this.endCurvePosition(),s=Math.atan2(r.y-n.y,r.x-n.x),i=e%1):(n=this.__getPositionImpl(.001),r=this.startCurvePosition(),s=Math.atan2(r.y-n.y,r.x-n.x),i=-e);var o=this.newPosition,u=this.getLength();return o.x=r.x+i*u*Math.cos(s),o.y=r.y+i*u*Math.sin(s),o}return this.__getPositionImpl(e)},__getPositionImpl:function(e){if(e>1||e<0)e%=1;e<0&&(e=1+e);var t=this.pathSegments,n=this.pathSegmentStartTime,r=this.pathSegmentDurationTime,i=0,s=t.length,o,u=this.newPosition,a;while(i!==s){o=(s+i)/2|0,a=n[o];if(a<=e&&e<=a+r[o]){e=r[o]?(e-a)/r[o]:0,e>1?e=1:e<0&&(e=0);var f=t[o].getPosition(e);return u.x=f.x,u.y=f.y,u}e<a?s=o:i=o+1}return this.endCurvePosition()},getPositionFromLength:function(e){e%=this.getLength(),e<0&&(e+=this.getLength());var t=0;for(var n=0;n<this.pathSegments.length;n++){if(t<=e&&e<=this.pathSegments[n].getLength()+t){e-=t;var r=this.pathSegments[n].getPositionFromLength(e);this.newPosition.x=r.x,this.newPosition.y=r.y;break}t+=this.pathSegments[n].getLength()}return this.newPosition},paint:function(e){for(var t=0;t<this.pathSegments.length;t++)this.pathSegments[t].paint(e,this.interactive)},release:function(){this.ax=-1,this.ay=-1},isEmpty:function(){return!this.pathSegments.length},getNumSegments:function(){return this.pathSegments.length},getSegment:function(e){return this.pathSegments[e]},numControlPoints:function(){return this.points.length},getControlPoint:function(e){return this.points[e]},updatePath:function(e,t){var n,r;this.length=0,this.bbox.setEmpty(),this.points=[];var i=Number.MAX_VALUE,s=Number.MAX_VALUE;for(n=0;n<this.pathSegments.length;n++){this.pathSegments[n].updatePath(e),this.length+=this.pathSegments[n].getLength(),this.bbox.unionRectangle(this.pathSegments[n].bbox);for(r=0;r<this.pathSegments[n].numControlPoints();r++){var o=this.pathSegments[n].getControlPoint(r);this.points.push(o),o.x<i&&(i=o.x),o.y<s&&(s=o.y)}}this.clipOffsetX=-i,this.clipOffsetY=-s,this.width=this.bbox.width,this.height=this.bbox.height,this.setLocation(this.bbox.x,this.bbox.y),this.pathSegmentStartTime=[],this.pathSegmentDurationTime=[];var n;for(n=0;n<this.pathSegments.length;n++)this.pathSegmentStartTime.push(0),this.pathSegmentDurationTime.push(0);for(n=0;n<this.pathSegments.length;n++)this.pathSegmentDurationTime[n]=this.getLength()?this.pathSegments[n].getLength()/this.getLength():0,n>0?this.pathSegmentStartTime[n]=this.pathSegmentStartTime[n-1]+this.pathSegmentDurationTime[n-1]:this.pathSegmentStartTime[0]=0,this.pathSegments[n].endPath();return this.extractPathPoints(),t&&t(this),this},press:function(e,t){if(!this.interactive)return;var n=CAAT.Math.Curve.prototype.HANDLE_SIZE/2;for(var r=0;r<this.pathSegments.length;r++)for(var i=0;i<this.pathSegments[r].numControlPoints();i++){var s=this.pathSegments[r].getControlPoint(i);if(e>=s.x-n&&t>=s.y-n&&e<s.x+n&&t<s.y+n){this.point=s;return}}this.point=null},drag:function(e,t,n){if(!this.interactive)return;if(null===this.point)return;if(-1===this.ax||-1===this.ay)this.ax=e,this.ay=t;this.point.x+=e-this.ax,this.point.y+=t-this.ay,this.ax=e,this.ay=t,this.updatePath(this.point,n)},getContour:function(e){var t=[];for(var n=0;n<=e;n++)t.push((new CAAT.Math.Point).set(n/e,this.getPosition(n/e).y,0));return t},setPoints:function(e){if(this.points.length===e.length)for(var t=0;t<e.length;t++)this.points[t].x=e[t].x,this.points[t].y=e[t].y;return this},setPoint:function(e,t){return t>=0&&t<this.points.length&&(this.points[t].x=e.x,this.points[t].y=e.y),this},emptyBehaviorList:function(){return this.behaviorList=[],this},extractPathPoints:function(){if(!this.pathPoints){var e;this.pathPoints=[];for(e=0;e<this.numControlPoints();e++)this.pathPoints.push(this.getControlPoint(e).clone())}return this},addBehavior:function(e){return this.behaviorList.push(e),this},removeBehaviour:function(e){var t=this.behaviorList.length-1;while(t)if(this.behaviorList[t]===e)return this.behaviorList.splice(t,1),this;return this},removeBehaviorById:function(e){for(var t=0;t<this.behaviorList.length;t++)this.behaviorList[t].id===e&&this.behaviorList.splice(t,1);return this},applyBehaviors:function(e){for(var t=0;t<this.behaviorList.length;t++)this.behaviorList[t].apply(e,this);this.setATMatrix();for(t=0;t<this.numControlPoints();t++)this.setPoint(this.matrix.transformCoord(this.pathPoints[t].clone().translate(this.clipOffsetX,this.clipOffsetY)),t);return this},setATMatrix:function(){this.matrix.identity();var e=this.tmpMatrix.identity(),t=this.matrix.matrix,n,r,i,s,o,u,a,f,l,c,h,p,d=this.bbox,v=d.width,m=d.height,g=d.x,y=d.y;a=1,f=0,c=0,h=1,l=this.tb_x-g-this.tAnchorX*v,p=this.tb_y-y-this.tAnchorY*m;if(this.rb_angle){var b=this.rb_rotateAnchorX*v+g,w=this.rb_rotateAnchorY*m+y;l+=a*b+f*w,p+=c*b+h*w,n=Math.cos(this.rb_angle),r=Math.sin(this.rb_angle),i=a,s=f,o=c,u=h,a=i*n+s*r,f=-i*r+s*n,c=o*n+u*r,h=-o*r+u*n,l+=-a*b-f*w,p+=-c*b-h*w}if(this.sb_scaleX!=1||this.sb_scaleY!=1){var E=this.sb_scaleAnchorX*v+g,S=this.sb_scaleAnchorY*m+y;l+=a*E+f*S,p+=c*E+h*S,a*=this.sb_scaleX,f*=this.sb_scaleY,c*=this.sb_scaleX,h*=this.sb_scaleY,l+=-a*E-f*S,p+=-c*E-h*S}return t[0]=a,t[1]=f,t[2]=l,t[3]=c,t[4]=h,t[5]=p,this},setRotationAnchored:function(e,t,n){return this.rb_angle=e,this.rb_rotateAnchorX=t,this.rb_rotateAnchorY=n,this},setRotationAnchor:function(e,t){this.rb_rotateAnchorX=e,this.rb_rotateAnchorY=t},setRotation:function(e){this.rb_angle=e},setScaleAnchored:function(e,t,n,r){return this.sb_scaleX=e,this.sb_scaleAnchorX=n,this.sb_scaleY=t,this.sb_scaleAnchorY=r,this},setScale:function(e,t){return this.sb_scaleX=e,this.sb_scaleY=t,this},setScaleAnchor:function(e,t){return this.sb_scaleAnchorX=e,this.sb_scaleAnchorY=t,this},setPositionAnchor:function(e,t){return this.tAnchorX=e,this.tAnchorY=t,this},setPositionAnchored:function(e,t,n,r){return this.tb_x=e,this.tb_y=t,this.tAnchorX=n,this.tAnchorY=r,this},setPosition:function(e,t){return this.tb_x=e,this.tb_y=t,this},setLocation:function(e,t){return this.tb_x=e,this.tb_y=t,this},flatten:function(e,t){var n=this.getPositionFromLength(0),r=(new CAAT.PathUtil.Path).beginPath(n.x,n.y);for(var i=0;i<e;i++)n=this.getPositionFromLength(i/e*this.length),r.addLineTo(n.x,n.y);return t?r.closePath():r.endPath(),r}}}),CAAT.Module({defines:"CAAT.PathUtil.SVGPath",depends:["CAAT.PathUtil.Path"],extendsWith:function(){function r(e,t){var n=t;n<0&&(n=0),console.log("parse error near ..."+e.substr(n,20))}var e=0,t=1,n=2;return{__init:function(){},c:0,bezierInfo:null,__skipBlank:function(e,t){var n=e.charAt(t);while(t<e.length&&(n==" "||n=="\n"||n=="	"||n==",")){++t;var n=e.charAt(t)}return t},__maybeNumber:function(e,t){if(t<e.length-2){var n=e.charAt(t),r=e.charAt(t+1);return n=="-"||this.__isDigit(n)||n==="."&&this.__isDigit(r)}return!1},__isDigit:function(e){return e>="0"&&e<="9"},__getNumber:function(r,i,s,o){i=this.__skipBlank(r,i);if(i<r.length){var u=this.__findNumber(r,i);if(u!==-1){s.push(parseFloat(r.substr(i,u))),i=this.__skipBlank(r,u),o.pos=i,o.result=e;return}o.result=n;return}o.result=t},____getNumbers:function(t,n,r,i,s){for(var o=0;o<i;o++){this.__getNumber(t,n,r,s);if(s.result!=e)break;n=s.pos}return n},__findNumber:function(e,t){var n;(n=e.charAt(t))=="-"&&++t;if(!this.__isDigit(n=e.charAt(t)))if((n=e.charAt(t))!="."||!this.__isDigit(e.charAt(t+1)))return-1;while(this.__isDigit(n=e.charAt(t)))++t;if((n=e.charAt(t))=="."){++t;if(!this.__isDigit(n=e.charAt(t)))return t;while(this.__isDigit(n=e.charAt(t)))++t}return t},__parseMoveTo:function(t,n,r,i,s){var o=[];n=this.____getNumbers(t,n,o,2,s);if(s.result!==e)return;r||(o[0]+=i.trackPathX,o[1]+=i.trackPathY),i.beginPath(o[0],o[1]),this.__maybeNumber(t,n)&&(n=this.parseLine(t,n,r,i,s)),s.pos=n},__parseLine:function(e,t,n,r,i){var s=[];do t=this.____getNumbers(e,t,s,2,i),n||(s[0]+=r.trackPathX,s[1]+=r.trackPathY),r.addLineTo(s[0],s[1]);while(this.__maybeNumber(e,t));i.pos=t},__parseLineH:function(e,t,n,r,i){var s=[];do t=this.____getNumbers(e,t,s,1,i),n||(s[0]+=r.trackPathX),s[1].push(r.trackPathY),r.addLineTo(s[0],s[1]);while(this.__maybeNumber(e,t));i.pos=t},__parseLineV:function(e,t,n,r,i){var s=[r.trackPathX];do t=this.____getNumbers(e,t,s,1,i),n||(s[1]+=r.trackPathY),r.addLineTo(s[0],s[1]);while(this.__maybeNumber(e,t));i.pos=t},__parseCubic:function(t,n,r,i,s){var o=[];do{n=this.____getNumbers(t,n,o,6,s);if(s.result!==e)return;r||(o[0]+=i.trackPathX,o[1]+=i.trackPathY,o[2]+=i.trackPathX,o[3]+=i.trackPathY,o[4]+=i.trackPathX,o[5]+=i.trackPathY),i.addCubicTo(o[0],o[1],o[2],o[3],o[4],o[5]),o.shift(),o.shift(),this.bezierInfo=o}while(this.__maybeNumber(t,n));s.pos=n},__parseCubicS:function(t,n,r,i,s){var o=[];do{n=this.____getNumbers(t,n,o,4,s);if(s.result!=e)return;r||(o[0]+=i.trackPathX,o[1]+=i.trackPathY,o[2]+=i.trackPathX,o[3]+=i.trackPathY);var u,a;u=this.bezierInfo[2]+(this.bezierInfo[2]-this.bezierInfo[0]),a=this.bezierInfo[3]+(this.bezierInfo[3]-this.bezierInfo[1]),i.addCubicTo(u,a,o[0],o[1],o[2],o[3]),this.bezierInfo=o}while(this.__maybeNumber(n));s.pos=n},__parseQuadricS:function(t,n,r,i,s){var o=[];do{n=this.____getNumbers(t,n,o,4,s);if(s.result!==e)return;r||(o[0]+=i.trackPathX,o[1]+=i.trackPathY);var u,a;u=this.bezierInfo[2]+(this.bezierInfo[2]-this.bezierInfo[0]),a=this.bezierInfo[3]+(this.bezierInfo[3]-this.bezierInfo[1]),i.addQuadricTo(u,a,o[0],o[1]),this.bezierInfo=[],bezierInfo.push(u),bezierInfo.push(a),bezierInfo.push(o[0]),bezierInfo.push(o[1])}while(this.__maybeNumber(n));s.pos=n},__parseQuadric:function(t,n,r,i,s){var o=[];do{n=this.____getNumbers(t,n,o,4,s);if(s.result!==e)return;r||(o[0]+=i.trackPathX,o[1]+=i.trackPathY,o[2]+=i.trackPathX,o[3]+=i.trackPathY),i.addQuadricTo(o[0],o[1],o[2],o[3]),this.bezierInfo=o}while(this.__maybeNumber(n));s.pos=n},__parseClosePath:function(e,t,n,r){n.closePath(),r.pos=t},parsePath:function(t){this.c=0,this.contours=[];var n=new CAAT.PathUtil.Path;this.contours.push(n),this.c=this.__skipBlank(t,this.c);if(this.c===t.length)return n;var i={pos:0,result:0};while(this.c!=t.length){var s=t.charAt(this.c);switch(s){case"m":this.__parseMoveTo(t,this.c+1,!1,n,i);break;case"M":this.__parseMoveTo(t,this.c+1,!0,n,i);break;case"c":this.__parseCubic(t,this.c+1,!1,n,i);break;case"C":this.__parseCubic(t,this.c+1,!0,n,i);break;case"s":this.__parseCubicS(t,this.c+1,!1,n,i);break;case"S":this.__parseCubicS(t,this.c+1,!0,n,i);break;case"q":this.__parseQuadric(t,this.c+1,!1,n,i);break;case"Q":this.__parseQuadricS(t,this.c+1,!0,n,i);break;case"t":this.__parseQuadricS(t,this.c+1,!1,n,i);break;case"T":this.__parseQuadric(t,this.c+1,!0,n,i);break;case"l":this.__parseLine(t,this.c+1,!1,n,i);break;case"L":this.__parseLine(t,this.c+1,!0,n,i);break;case"h":this.__parseLineH(t,this.c+1,!1,n,i);break;case"H":this.__parseLineH(t,this.c+1,!0,n,i);break;case"v":this.__parseLineV(t,this.c+1,!1,n,i);break;case"V":this.__parseLineV(t,this.c+1,!0,n,i);break;case"z":case"Z":this.__parseClosePath(t,this.c+1,n,i),n=new CAAT.PathUtil.Path,this.contours.push(n);break;case 0:break;default:r(t,this.c)}if(i.result!=e){r(t,this.c);break}this.c=i.pos}var o=0,u=null;for(var a=0;a<this.contours.length;a++)this.contours[a].isEmpty()||(u=this.contours[a],u.closed||u.endPath(),o++);if(o===1)return u;n=new CAAT.PathUtil.Path;for(var a=0;a<this.contours.length;a++)this.contours[a].isEmpty()||n.addSegment(this.contours[a]);return n.endPath()}}}}),CAAT.Module({defines:"CAAT.WebGL.GLU",depends:["CAAT.Math.Matrix3"],constants:{makePerspective:function(e,t,n,r,i){var s=n*Math.tan(e*Math.PI/360),o=-s,u=o*t,a=s*t;return makeFrustum(u,a,o,s,n,r,i)},makeFrustum:function(e,t,n,r,i,s,o){var u=2*i/(t-e),a=2*i/(r-n),f=(t+e)/(t-e),l=(r+n)/(r-n),c=-(s+i)/(s-i),h=-2*s*i/(s-i);return(new CAAT.Math.Matrix3).initWithMatrix([[u,0,f,-o/2],[0,-a,l,o/2],[0,0,c,h],[0,0,-1,0]])},makeOrtho:function(e,t,n,r,i,s){var o=-(t+e)/(t-e),u=-(r+n)/(r-n),a=-(s+i)/(s-i);return(new CAAT.Math.Matrix3).initWithMatrix([[2/(t-e),0,0,o],[0,2/(r-n),0,u],[0,0,-2/(s-i),a],[0,0,0,1]])}}}),CAAT.Module({defines:"CAAT.WebGL.Program",extendsWith:{__init:function(e){return this.gl=e,this},shaderProgram:null,gl:null,setAlpha:function(e){},getShader:function(e,t,n){var r;if(t==="x-shader/x-fragment")r=e.createShader(e.FRAGMENT_SHADER);else{if(t!=="x-shader/x-vertex")return null;r=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(alert(e.getShaderInfoLog(r)),null)},getDomShader:function(e,t){var n=document.getElementById(t);if(!n)return null;var r="",i=n.firstChild;while(i)i.nodeType===3&&(r+=i.textContent),i=i.nextSibling;var s;if(n.type==="x-shader/x-fragment")s=e.createShader(e.FRAGMENT_SHADER);else{if(n.type!=="x-shader/x-vertex")return null;s=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(s,r),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS)?s:(alert(e.getShaderInfoLog(s)),null)},initialize:function(){return this},getFragmentShader:function(){return null},getVertexShader:function(){return null},create:function(){var e=this.gl;return this.shaderProgram=e.createProgram(),e.attachShader(this.shaderProgram,this.getVertexShader()),e.attachShader(this.shaderProgram,this.getFragmentShader()),e.linkProgram(this.shaderProgram),e.useProgram(this.shaderProgram),this},setMatrixUniform:function(e){this.gl.uniformMatrix4fv(this.shaderProgram.pMatrixUniform,!1,new Float32Array(e.flatten()))},useProgram:function(){return this.gl.useProgram(this.shaderProgram),this}}}),CAAT.Module({defines:"CAAT.WebGL.ColorProgram",aliases:["CAAT.ColorProgram"],extendsClass:"CAAT.WebGL.Program",depends:["CAAT.WebGL.Program"],extendsWith:{__init:function(e){return this.__super(e),this},colorBuffer:null,vertexPositionBuffer:null,vertexPositionArray:null,getFragmentShader:function(){return this.getShader(this.gl,"x-shader/x-fragment","#ifdef GL_ES \nprecision highp float; \n#endif \nvarying vec4 color; \nvoid main(void) { \n  gl_FragColor = color;\n}\n")},getVertexShader:function(){return this.getShader(this.gl,"x-shader/x-vertex","attribute vec3 aVertexPosition; \nattribute vec4 aColor; \nuniform mat4 uPMatrix; \nvarying vec4 color; \nvoid main(void) { \ngl_Position = uPMatrix * vec4(aVertexPosition, 1.0); \ncolor= aColor; \n}\n")},initialize:function(){this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition"),this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute),this.shaderProgram.vertexColorAttribute=this.gl.getAttribLocation(this.shaderProgram,"aColor"),this.gl.enableVertexAttribArray(this.shaderProgram.vertexColorAttribute),this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix"),this.useProgram(),this.colorBuffer=this.gl.createBuffer(),this.setColor([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);var e=512,t;return this.vertexPositionBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer),this.vertexPositionArray=new Float32Array(e*12),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexPositionArray,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,!1,0,0),CAAT.ColorProgram.superclass.initialize.call(this)},setColor:function(e){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(e),this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.shaderProgram.vertexColorAttribute,this.colorBuffer,this.gl.FLOAT,!1,0,0)}}}),CAAT.Module({defines:"CAAT.WebGL.TextureProgram",aliases:["CAAT.TextureProgram"],extendsClass:"CAAT.WebGL.Program",depends:["CAAT.WebGL.Program"],extendsWith:{__init:function(e){return this.__super(e),this},vertexPositionBuffer:null,vertexPositionArray:null,vertexUVBuffer:null,vertexUVArray:null,vertexIndexBuffer:null,linesBuffer:null,prevAlpha:-1,prevR:-1,prevG:-1,prevB:-1,prevA:-1,prevTexture:null,getFragmentShader:function(){return this.getShader(this.gl,"x-shader/x-fragment","#ifdef GL_ES \nprecision highp float; \n#endif \nvarying vec2 vTextureCoord; \nuniform sampler2D uSampler; \nuniform float alpha; \nuniform bool uUseColor;\nuniform vec4 uColor;\nvoid main(void) { \nif ( uUseColor ) {\n  gl_FragColor= vec4(uColor.r*alpha, uColor.g*alpha, uColor.b*alpha, uColor.a*alpha);\n} else { \n  vec4 textureColor= texture2D(uSampler, vec2(vTextureCoord)); \n  gl_FragColor = vec4(textureColor.r*alpha, textureColor.g*alpha, textureColor.b*alpha, textureColor.a * alpha ); \n}\n}\n")},getVertexShader:function(){return this.getShader(this.gl,"x-shader/x-vertex","attribute vec3 aVertexPosition; \nattribute vec2 aTextureCoord; \nuniform mat4 uPMatrix; \nvarying vec2 vTextureCoord; \nvoid main(void) { \ngl_Position = uPMatrix * vec4(aVertexPosition, 1.0); \nvTextureCoord = aTextureCoord;\n}\n")},useProgram:function(){CAAT.TextureProgram.superclass.useProgram.call(this),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexUVBuffer),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)},initialize:function(){var e;this.linesBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.linesBuffer);var t=[];for(e=0;e<1024;e++)t[e]=e;this.linesBufferArray=new Uint16Array(t),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.linesBufferArray,this.gl.DYNAMIC_DRAW),this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition"),this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute),this.shaderProgram.textureCoordAttribute=this.gl.getAttribLocation(this.shaderProgram,"aTextureCoord"),this.gl.enableVertexAttribArray(this.shaderProgram.textureCoordAttribute),this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix"),this.shaderProgram.samplerUniform=this.gl.getUniformLocation(this.shaderProgram,"uSampler"),this.shaderProgram.alphaUniform=this.gl.getUniformLocation(this.shaderProgram,"alpha"),this.shaderProgram.useColor=this.gl.getUniformLocation(this.shaderProgram,"uUseColor"),this.shaderProgram.color=this.gl.getUniformLocation(this.shaderProgram,"uColor"),this.setAlpha(1),this.setUseColor(!1);var n=4096;this.vertexPositionBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer),this.vertexPositionArray=new Float32Array(n*12),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexPositionArray,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,!1,0,0),this.vertexUVBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexUVBuffer),this.vertexUVArray=new Float32Array(n*8),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexUVArray,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.shaderProgram.textureCoordAttribute,2,this.gl.FLOAT,!1,0,0),this.vertexIndexBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer);var r=[];for(e=0;e<n;e++)r.push(0+e*4),r.push(1+e*4),r.push(2+e*4),r.push(0+e*4),r.push(2+e*4),r.push(3+e*4);return this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),this.gl.DYNAMIC_DRAW),CAAT.TextureProgram.superclass.initialize.call(this)},setUseColor:function(e,t,n,r,i){this.gl.uniform1i(this.shaderProgram.useColor,e?1:0),e&&(this.prevA!==i||this.prevR!==t||this.prevG!==n||this.prevB!==r)&&(this.gl.uniform4f(this.shaderProgram.color,t,n,r,i),this.prevA=i,this.prevR=t,this.prevG=n,this.prevB=r)},setTexture:function(e){if(this.prevTexture!==e){var t=this.gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.uniform1i(this.shaderProgram.samplerUniform,0),this.prevTexture=e}return this},updateVertexBuffer:function(e){var t=this.gl;return t.bindBuffer(t.ARRAY_BUFFER,this.vertexPositionBuffer),t.bufferSubData(t.ARRAY_BUFFER,0,e),this},updateUVBuffer:function(e){var t=this.gl;return t.bindBuffer(t.ARRAY_BUFFER,this.vertexUVBuffer),t.bufferSubData(t.ARRAY_BUFFER,0,e),this},setAlpha:function(e){return this.prevAlpha!==e&&(this.gl.uniform1f(this.shaderProgram.alphaUniform,e),this.prevAlpha=e),this},drawLines:function(e,t,n,r,i,s,o){var u=this.gl;this.setAlpha(s),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,this.linesBuffer),u.lineWidth(o),this.updateVertexBuffer(e),this.setUseColor(!0,n,r,i,1),u.drawElements(u.LINES,t,u.UNSIGNED_SHORT,0),this.setAlpha(1),this.setUseColor(!1),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)},drawPolylines:function(e,t,n,r,i,s,o){var u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,this.linesBuffer),u.lineWidth(o),this.setAlpha(s),this.updateVertexBuffer(e),this.setUseColor(!0,n,r,i,1),u.drawElements(u.LINE_STRIP,t,u.UNSIGNED_SHORT,0),this.setAlpha(1),this.setUseColor(!1),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)}}}),CAAT.Module({defines:"CAAT.Event.TouchInfo",aliases:["CAAT.TouchInfo"],extendsWith:{__init:function(e,t,n,r){return this.identifier=e,this.clientX=t,this.pageX=t,this.clientY=n,this.pageY=n,this.target=r,this.time=(new Date).getTime(),this}}}),CAAT.Module({defines:"CAAT.Event.TouchEvent",aliases:["CAAT.TouchEvent"],depends:["CAAT.Event.TouchInfo"],extendsWith:{__init:function(){return this.touches=[],this.changedTouches=[],this},time:0,source:null,sourceEvent:null,shift:!1,control:!1,alt:!1,meta:!1,touches:null,changedTouches:null,init:function(e,t,n){return this.source=t,this.alt=e.altKey,this.control=e.ctrlKey,this.shift=e.shiftKey,this.meta=e.metaKey,this.sourceEvent=e,this.time=n,this},addTouch:function(e){return-1===this.touches.indexOf(e)&&this.touches.push(e),this},addChangedTouch:function(e){return-1===this.changedTouches.indexOf(e)&&this.changedTouches.push(e),this},isAltDown:function(){return this.alt},isControlDown:function(){return this.control},isShiftDown:function(){return this.shift},isMetaDown:function(){return this.meta},getSourceEvent:function(){return this.sourceEvent}}}),CAAT.Module({defines:"CAAT.Event.MouseEvent",aliases:["CAAT.MouseEvent"],depends:["CAAT.Math.Point"],extendsWith:{__init:function(){return this.point=new CAAT.Math.Point(0,0,0),this.screenPoint=new CAAT.Math.Point(0,0,0),this.touches=[],this},screenPoint:null,point:null,time:0,source:null,shift:!1,control:!1,alt:!1,meta:!1,sourceEvent:null,touches:null,init:function(e,t,n,r,i,s){return this.point.set(e,t),this.source=r,this.screenPoint=i,this.alt=n.altKey,this.control=n.ctrlKey,this.shift=n.shiftKey,this.meta=n.metaKey,this.sourceEvent=n,this.x=e,this.y=t,this.time=s,this},isAltDown:function(){return this.alt},isControlDown:function(){return this.control},isShiftDown:function(){return this.shift},isMetaDown:function(){return this.meta},getSourceEvent:function(){return this.sourceEvent}}}),CAAT.Module({defines:"CAAT.Event.KeyEvent",aliases:"CAAT.KeyEvent",extendsWith:{__init:function(e,t,n,r){this.keyCode=e,this.action=t,this.modifiers=n,this.sourceEvent=r,this.preventDefault=function(){this.sourceEvent.preventDefault()},this.getKeyCode=function(){return this.keyCode},this.getAction=function(){return this.action},this.modifiers=function(){return this.modifiers},this.isShiftPressed=function(){return this.modifiers.shift},this.isControlPressed=function(){return this.modifiers.control},this.isAltPressed=function(){return this.modifiers.alt},this.getSourceEvent=function(){return this.sourceEvent}}},onCreate:function(){CAAT.KEYS={ENTER:13,BACKSPACE:8,TAB:9,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,SELECT:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMALPOINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145,SEMICOLON:186,EQUALSIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARDSLASH:191,GRAVEACCENT:192,OPENBRACKET:219,BACKSLASH:220,CLOSEBRAKET:221,SINGLEQUOTE:222},CAAT.Keys=CAAT.KEYS,CAAT.SHIFT_KEY=16,CAAT.CONTROL_KEY=17,CAAT.ALT_KEY=18,CAAT.ENTER_KEY=13,CAAT.KEY_MODIFIERS={alt:!1,control:!1,shift:!1}}}),CAAT.Module({defines:"CAAT.Event.Input",depends:["CAAT.Event.KeyEvent","CAAT.Event.MouseEvent","CAAT.Event.TouchEvent"],onCreate:function(){CAAT.setCursor=function(e){navigator.browser!=="iOS"&&(document.body.style.cursor=e)},CAAT.TOUCH_AS_MOUSE=1,CAAT.TOUCH_AS_MULTITOUCH=2,CAAT.TOUCH_BEHAVIOR=CAAT.TOUCH_AS_MOUSE,CAAT.windowResizeListeners=[],CAAT.registerResizeListener=function(e){CAAT.windowResizeListeners.push(e)},CAAT.unregisterResizeListener=function(e){for(var t=0;t<CAAT.windowResizeListeners.length;t++)if(e===CAAT.windowResizeListeners[t]){CAAT.windowResizeListeners.splice(t,1);return}},CAAT.keyListeners=[],CAAT.registerKeyListener=function(e){CAAT.keyListeners.push(e)},CAAT.accelerationIncludingGravity={x:0,y:0,z:0},CAAT.rotationRate={alpha:0,beta:0,gamma:0},CAAT.enableDeviceMotion=function(){function e(e){CAAT.rotationRate={alpha:0,beta:e[0],gamma:e[1]}}CAAT.prevOnDeviceMotion=null,CAAT.onDeviceMotion=null,window.DeviceOrientationEvent?window.addEventListener("deviceorientation",function(t){e([t.beta,t.gamma])},!0):window.DeviceMotionEvent?window.addEventListener("devicemotion",function(t){e([t.acceleration.x*2,t.acceleration.y*2])},!0):window.addEventListener("MozOrientation",function(t){e([-t.y*45,t.x*45])},!0)},window.addEventListener("keydown",function(e){var t=e.which?e.which:e.keyCode;if(t===CAAT.SHIFT_KEY)CAAT.KEY_MODIFIERS.shift=!0;else if(t===CAAT.CONTROL_KEY)CAAT.KEY_MODIFIERS.control=!0;else if(t===CAAT.ALT_KEY)CAAT.KEY_MODIFIERS.alt=!0;else for(var n=0;n<CAAT.keyListeners.length;n++)CAAT.keyListeners[n](new CAAT.KeyEvent(t,"down",{alt:CAAT.KEY_MODIFIERS.alt,control:CAAT.KEY_MODIFIERS.control,shift:CAAT.KEY_MODIFIERS.shift},e))},!1),window.addEventListener("keyup",function(e){var t=e.which?e.which:e.keyCode;if(t===CAAT.SHIFT_KEY)CAAT.KEY_MODIFIERS.shift=!1;else if(t===CAAT.CONTROL_KEY)CAAT.KEY_MODIFIERS.control=!1;else if(t===CAAT.ALT_KEY)CAAT.KEY_MODIFIERS.alt=!1;else for(var n=0;n<CAAT.keyListeners.length;n++)CAAT.keyListeners[n](new CAAT.KeyEvent(t,"up",{alt:CAAT.KEY_MODIFIERS.alt,control:CAAT.KEY_MODIFIERS.control,shift:CAAT.KEY_MODIFIERS.shift},e))},!1),window.addEventListener("resize",function(e){for(var t=0;t<CAAT.windowResizeListeners.length;t++)CAAT.windowResizeListeners[t].windowResized(window.innerWidth,window.innerHeight)},!1)},extendsWith:{}}),CAAT.Module({defines:"CAAT.Event.AnimationLoop",onCreate:function(){CAAT.ENDRAF=!1,CAAT.INTERVAL_ID=null,CAAT.renderEnabled=!1,CAAT.FPS=60,CAAT.NO_RAF=0,CAAT.FPS_REFRESH=500,CAAT.RAF=0,CAAT.REQUEST_ANIMATION_FRAME_TIME=0,CAAT.SET_INTERVAL=0,CAAT.FRAME_TIME=0,CAAT.currentDirector=null,CAAT.director=[],CAAT.RegisterDirector=function(e){CAAT.currentDirector||(CAAT.currentDirector=e),CAAT.director.push(e)},CAAT.getCurrentScene=function(){return CAAT.currentDirector.getCurrentScene()},CAAT.getCurrentSceneTime=function(){return CAAT.currentDirector.getCurrentScene().time},CAAT.endLoop=function(){CAAT.NO_RAF?CAAT.INTERVAL_ID!==null&&clearInterval(CAAT.INTERVAL_ID):CAAT.ENDRAF=!0,CAAT.renderEnabled=!1},CAAT.loop=function(e){if(CAAT.renderEnabled)return;for(var t=0,n=CAAT.director.length;t<n;t++)CAAT.director[t].timeline=(new Date).getTime();CAAT.FPS=e||60,CAAT.renderEnabled=!0,CAAT.NO_RAF?CAAT.INTERVAL_ID=setInterval(function(){var e=(new Date).getTime();for(var t=0,n=CAAT.director.length;t<n;t++){var r=CAAT.director[t];(r.renderMode===CAAT.Foundation.Director.RENDER_MODE_CONTINUOUS||r.needsRepaint)&&r.renderFrame()}CAAT.FRAME_TIME=e-CAAT.SET_INTERVAL,CAAT.RAF&&(CAAT.REQUEST_ANIMATION_FRAME_TIME=(new Date).getTime()-CAAT.RAF),CAAT.RAF=(new Date).getTime(),CAAT.SET_INTERVAL=e},1e3/CAAT.FPS):CAAT.renderFrameRAF()},CAAT.renderFrameRAF=function(e){var t=CAAT;if(t.ENDRAF){t.ENDRAF=!1;return}e||(e=(new Date).getTime());var n=(new Date).getTime();t.REQUEST_ANIMATION_FRAME_TIME=t.RAF?e-t.RAF:16;for(var r=0,i=t.director.length;r<i;r++)t.director[r].renderFrame();t.RAF=e,t.FRAME_TIME=(new Date).getTime()-n,window.requestAnimFrame(t.renderFrameRAF,0)},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,n){window.setTimeout(t,1e3/CAAT.FPS)}}()},extendsWith:function(){return{}}}),CAAT.Module({defines:"CAAT.Foundation.Timer.TimerTask",aliases:["CAAT.TimerTask"],extendsWith:{startTime:0,duration:0,callback_timeout:null,callback_tick:null,callback_cancel:null,owner:null,scene:null,taskId:0,remove:!1,create:function(e,t,n,r,i){return this.startTime=e,this.duration=t,this.callback_timeout=n,this.callback_tick=r,this.callback_cancel=i,this},checkTask:function(e){var t=e;return t-=this.startTime,t>=this.duration?(this.remove=!0,this.callback_timeout&&this.callback_timeout(e,t,this)):this.callback_tick&&this.callback_tick(e,t,this),this},remainingTime:function(){return this.duration-(this.scene.time-this.startTime)},reset:function(e){return this.remove=!1,this.startTime=e,this.owner.ensureTimerTask(this),this},cancel:function(){return this.remove=!0,null!=this.callback_cancel&&this.callback_cancel(this.scene.time,this.scene.time-this.startTime,this),this},addTime:function(e){return this.duration+=e,this}}}),CAAT.Module({defines:"CAAT.Foundation.Timer.TimerManager",aliases:["CAAT.TimerManager"],depends:["CAAT.Foundation.Timer.TimerTask"],extendsWith:{__init:function(){return this.timerList=[],this},timerList:null,timerSequence:0,checkTimers:function(e){var t=this.timerList,n=t.length-1;while(n>=0)t[n].remove||t[n].checkTask(e),n--},ensureTimerTask:function(e){return this.hasTimer(e)||this.timerList.push(e),this},hasTimer:function(e){var t=this.timerList,n=t.length-1;while(n>=0){if(t[n]===e)return!0;n--}return!1},createTimer:function(e,t,n,r,i,s){var o=(new CAAT.Foundation.Timer.TimerTask).create(e,t,n,r,i);return o.taskId=this.timerSequence++,o.sceneTime=s.time,o.owner=this,o.scene=s,this.timerList.push(o),o},removeExpiredTimers:function(){var e,t=this.timerList;for(e=0;e<t.length;e++)t[e].remove&&t.splice(e,1)}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Layout.LayoutManager",aliases:["CAAT.UI.LayoutManager"],depends:["CAAT.Behavior.Interpolator"],constants:{AXIS:{X:0,Y:1},ALIGNMENT:{LEFT:0,RIGHT:1,CENTER:2,TOP:3,BOTTOM:4,JUSTIFY:5}},extendsWith:function(){return{__init:function(){return this.newChildren=[],this.padding={left:2,right:2,top:2,bottom:2},this},newElementInterpolator:(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,.7),moveElementInterpolator:(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(2),padding:null,invalid:!0,hgap:2,vgap:2,animated:!1,newChildren:null,setAnimated:function(e){return this.animated=e,this},setHGap:function(e){return this.hgap=e,this.invalidateLayout(),this},setVGap:function(e){return this.vgap=e,this.invalidateLayout(),this},setAllPadding:function(e){return this.padding.left=e,this.padding.right=e,this.padding.top=e,this.padding.bottom=e,this.invalidateLayout(),this},setPadding:function(e,t,n,r){return this.padding.left=e,this.padding.right=t,this.padding.top=n,this.padding.bottom=r,this.invalidateLayout(),this},addChild:function(e,t){this.newChildren.push(e)},removeChild:function(e){},doLayout:function(e){this.newChildren=[],this.invalid=!1},invalidateLayout:function(e){this.invalid=!0},getMinimumLayoutSize:function(e){},getPreferredLayoutSize:function(e){},isValid:function(){return!this.invalid},isInvalidated:function(){return this.invalid}}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Layout.BoxLayout",aliases:["CAAT.UI.BoxLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:function(){return{axis:CAAT.Foundation.UI.Layout.LayoutManager.AXIS.Y,valign:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER,halign:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER,setAxis:function(e){return this.axis=e,this.invalidateLayout(),this},setHorizontalAlignment:function(e){return this.halign=e,this.invalidateLayout(),this},setVerticalAlignment:function(e){return this.valign=e,this.invalidateLayout(),this},doLayout:function(e){this.axis===CAAT.Foundation.UI.Layout.LayoutManager.AXIS.Y?this.doLayoutVertical(e):this.doLayoutHorizontal(e),CAAT.Foundation.UI.Layout.BoxLayout.superclass.doLayout.call(this,e)},doLayoutHorizontal:function(e){var t=0,n=0,r=0,i,s,o,u;for(s=0,o=e.getNumChildren();s<o;s+=1)u=e.getChildAt(s),!u.preventLayout&&u.isVisible()&&u.isInAnimationFrame(CAAT.getCurrentSceneTime())&&(n<u.height&&(n=u.height),t+=u.width,s>0&&(t+=this.hgap));switch(this.halign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT:i=this.padding.left;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT:i=e.width-t-this.padding.right;break;default:i=(e.width-t)/2}for(s=0,o=e.getNumChildren();s<o;s+=1){u=e.getChildAt(s);if(!u.preventLayout&&u.isVisible()&&u.isInAnimationFrame(CAAT.getCurrentSceneTime())){switch(this.valign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP:r=this.padding.top;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM:r=e.height-this.padding.bottom-u.height;break;default:r=(e.height-u.height)/2}this.__setActorPosition(u,i,r),i+=u.width+this.hgap}}},__setActorPosition:function(e,t,n){this.animated?this.newChildren.indexOf(e)!==-1?(e.setPosition(t,n),e.setScale(0,0),e.scaleTo(1,1,500,0,.5,.5,this.newElementInterpolator)):e.moveTo(t,n,500,0,this.moveElementInterpolator):e.setPosition(t,n)},doLayoutVertical:function(e){var t=0,n=0,r,i,s,o,u;for(s=0,o=e.getNumChildren();s<o;s+=1)u=e.getChildAt(s),!u.preventLayout&&u.isVisible()&&u.isInAnimationFrame(CAAT.getCurrentSceneTime())&&(t<u.width&&(t=u.width),n+=u.height,s>0&&(n+=this.vgap));switch(this.valign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP:r=this.padding.top;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM:r=e.height-n-this.padding.bottom;break;default:r=(e.height-n)/2}for(s=0,o=e.getNumChildren();s<o;s+=1){u=e.getChildAt(s);if(!u.preventLayout&&u.isVisible()&&u.isInAnimationFrame(CAAT.getCurrentSceneTime())){switch(this.halign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT:i=this.padding.left;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT:i=e.width-this.padding.right-u.width;break;default:i=(e.width-u.width)/2}this.__setActorPosition(u,i,r),r+=u.height+this.vgap}}},getPreferredLayoutSize:function(e){var t=new CAAT.Math.Dimension,n=0,r=0,i,s;for(i=0,s=e.getNumChildren();i<s;i+=1){var o=e.getChildAt(i);if(!o.preventLayout&&o.isVisible()&&o.isInAnimationFrame(CAAT.getCurrentSceneTime())){var u=o.getPreferredSize();r<u.height&&(r=u.height),n+=u.width}}return t.width=n,t.height=r,t},getMinimumLayoutSize:function(e){var t=new CAAT.Math.Dimension,n=0,r=0,i,s;for(i=0,s=e.getNumChildren();i<s;i+=1){var o=e.getChildAt(i);if(!o.preventLayout&&o.isVisible()&&o.isInAnimationFrame(CAAT.getCurrentSceneTime())){var u=o.getMinimumSize();r<u.height&&(r=u.height),n+=u.width}}return t.width=n,t.height=r,t}}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Layout.BorderLayout",aliases:["CAAT.UI.BorderLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:{__init:function(){return this.__super(),this},left:null,right:null,top:null,bottom:null,center:null,addChild:function(e,t){typeof t=="undefined"&&(t="center"),CAAT.Foundation.UI.Layout.BorderLayout.superclass.addChild.call(this,e,t),t==="left"?this.left=e:t==="right"?this.right=e:t==="top"?this.top=e:t==="bottom"?this.bottom=e:this.center=e},removeChild:function(e){this.center===e?this.center=null:this.left===e?this.left=null:this.right===e?this.right=null:this.top===e?this.top=null:this.bottom===e&&(this.bottom=null)},__getChild:function(e){if(e==="center")return this.center;if(e==="left")return this.left;if(e==="right")return this.right;if(e==="top")return this.top;if(e==="bottom")return this.bottom},getMinimumLayoutSize:function(e){var t,n,r=new CAAT.Math.Dimension;return(t=this.__getChild("right"))!=null&&(n=t.getMinimumSize(),r.width+=n.width+this.hgap,r.height=Math.max(n.height,r.height)),(t=this.__getChild("left"))!=null&&(n=t.getMinimumSize(),r.width+=n.width+this.hgap,r.height=Math.max(n.height,r.height)),(t=this.__getChild("center"))!=null&&(n=t.getMinimumSize(),r.width+=n.width,r.height=Math.max(n.height,r.height)),(t=this.__getChild("top"))!=null&&(n=t.getMinimumSize(),r.width=Math.max(n.width,r.width),r.height+=n.height+this.vgap),(t=this.__getChild("bottom"))!=null&&(n=t.getMinimumSize(),r.width=Math.max(n.width,r.width),r.height+=n.height+this.vgap),r.width+=this.padding.left+this.padding.right,r.height+=this.padding.top+this.padding.bottom,r},getPreferredLayoutSize:function(e){var t,n,r=new CAAT.Dimension;return(t=this.__getChild("left"))!=null&&(n=t.getPreferredSize(),r.width+=n.width+this.hgap,r.height=Math.max(n.height,r.height)),(t=this.__getChild("right"))!=null&&(n=t.getPreferredSize(),r.width+=n.width+this.hgap,r.height=Math.max(n.height,r.height)),(t=this.__getChild("center"))!=null&&(n=t.getPreferredSize(),r.width+=n.width,r.height=Math.max(n.height,r.height)),(t=this.__getChild("top"))!=null&&(n=t.getPreferredSize(),r.width=Math.max(n.width,r.width),r.height+=n.height+this.vgap),(t=this.__getChild("bottom"))!=null&&(n=t.getPreferredSize(),r.width=Math.max(n.width,r.width),r.height+=n.height+this.vgap),r.width+=this.padding.left+this.padding.right,r.height+=this.padding.top+this.padding.bottom,r},doLayout:function(e){var t=this.padding.top,n=e.height-this.padding.bottom,r=this.padding.left,i=e.width-this.padding.right,s,o;(s=this.__getChild("top"))!=null&&(s.setSize(i-r,s.height),o=s.getPreferredSize(),s.setBounds(r,t,i-r,o.height),t+=o.height+this.vgap),(s=this.__getChild("bottom"))!=null&&(s.setSize(i-r,s.height),o=s.getPreferredSize(),s.setBounds(r,n-o.height,i-r,o.height),n-=o.height+this.vgap),(s=this.__getChild("right"))!=null&&(s.setSize(s.width,n-t),o=s.getPreferredSize(),s.setBounds(i-o.width,t,o.width,n-t),i-=o.width+this.hgap),(s=this.__getChild("left"))!=null&&(s.setSize(s.width,n-t),o=s.getPreferredSize(),s.setBounds(r,t,o.width,n-t),r+=o.width+this.hgap),(s=this.__getChild("center"))!=null&&s.setBounds(r,t,i-r,n-t),CAAT.Foundation.UI.Layout.BorderLayout.superclass.doLayout.call(this,e)}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Layout.GridLayout",aliases:["CAAT.UI.GridLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:{__init:function(e,t){return this.__super(),this.rows=e,this.columns=t,this},rows:0,columns:2,doLayout:function(e){var t=[];for(var n=0;n<e.getNumChildren();n++){var r=e.getChildAt(n);!r.preventLayout&&r.isVisible()&&r.isInAnimationFrame(CAAT.getCurrentSceneTime())&&t.push(r)}var i=t.length;if(i.length===0)return;var s=this.rows,o=this.columns;s>0?o=Math.floor((i+s-1)/s):s=Math.floor((i+o-1)/o);var u=(o-1)*this.hgap,a=e.width-(this.padding.left+this.padding.right),f=Math.floor((a-u)/o),l=Math.floor((a-(f*o+u))/2),c=(s-1)*this.vgap,h=e.height-(this.padding.top+this.padding.bottom),p=Math.floor((h-c)/s),d=Math.floor((h-(p*s+c))/2);for(var v=0,m=this.padding.left+l;v<o;v++,m+=f+this.hgap)for(var g=0,y=this.padding.top+d;g<s;g++,y+=p+this.vgap){var n=g*o+v;if(n<t.length){var r=t[n];if(!r.preventLayout&&r.isVisible()&&r.isInAnimationFrame(CAAT.getCurrentSceneTime()))if(!this.animated)r.setBounds(m+(f-r.width)/2,y,f,p);else if(r.width!==f||r.height!==p)r.setSize(f,p),this.newChildren.indexOf(r)!==-1?(r.setPosition(m+(f-r.width)/2,y),r.setScale(.01,.01),r.scaleTo(1,1,500,0,.5,.5,this.newElementInterpolator)):r.moveTo(m+(f-r.width)/2,y,500,0,this.moveElementInterpolator)}}CAAT.Foundation.UI.Layout.GridLayout.superclass.doLayout.call(this,e)},getMinimumLayoutSize:function(e){var t=this.rows,n=this.columns,r=e.getNumChildren(),i=0,s=0,o;t>0?n=Math.ceil((r+t-1)/t):t=Math.ceil((r+n-1)/n);for(o=0;o<r;o+=1){var u=e.getChildAt(o);if(!u.preventLayout&&u.isVisible()&&u.isInAnimationFrame(CAAT.getCurrentSceneTime())){var a=u.getMinimumSize();i<a.width&&(i=a.width),s<a.height&&(s=a.height)}}return new CAAT.Math.Dimension(this.padding.left+this.padding.right+n*i+(n-1)*this.hgap,this.padding.top+this.padding.bottom+t*s+(t-1)*this.vgap)},getPreferredLayoutSize:function(e){var t=this.rows,n=this.columns,r=e.getNumChildren(),i=0,s=0,o;t>0?n=Math.ceil((r+t-1)/t):t=Math.ceil((r+n-1)/n);for(o=0;o<r;o+=1){var u=e.getChildAt(o);if(!u.preventLayout&&u.isVisible()&&u.isInAnimationFrame(CAAT.getCurrentSceneTime())){var a=u.getPreferredSize();i<a.width&&(i=a.width),s<a.height&&(s=a.height)}}return new CAAT.Math.Dimension(this.padding.left+this.padding.right+n*i+(n-1)*this.hgap,this.padding.top+this.padding.bottom+t*s+(t-1)*this.vgap)}}}),CAAT.Module({defines:"CAAT.Foundation.SpriteImageHelper",extendsWith:{__init:function(e,t,n,r,i,s){return this.x=parseFloat(e),this.y=parseFloat(t),this.width=parseFloat(n),this.height=parseFloat(r),this.setGL(e/i,t/s,(e+n-1)/i,(t+r-1)/s),this},x:0,y:0,width:0,height:0,u:0,v:0,u1:0,v1:0,setGL:function(e,t,n,r){return this.u=e,this.v=t,this.u1=n,this.v1=r,this}}}),CAAT.Module({defines:"CAAT.Foundation.SpriteImageAnimationHelper",extendsWith:function(){return{__init:function(e,t,n){return this.animation=e,this.time=t,this.onEndPlayCallback=n,this},animation:null,time:0,onEndPlayCallback:null}}}),CAAT.Module({defines:"CAAT.Foundation.SpriteImage",aliases:["CAAT.SpriteImage"],depends:["CAAT.Foundation.SpriteImageHelper","CAAT.Foundation.SpriteImageAnimationHelper","CAAT.Math.Rectangle"],constants:{TR_NONE:0,TR_FLIP_HORIZONTAL:1,TR_FLIP_VERTICAL:2,TR_FLIP_ALL:3,TR_FIXED_TO_SIZE:4,TR_FIXED_WIDTH_TO_SIZE:6,TR_TILE:5},extendsWith:function(){return{__init:function(){return this.paint=this.paintN,this.setAnimationImageIndex([0]),this.mapInfo={},this.animationsMap={},arguments.length===3&&this.initialize.apply(this,arguments),this},animationImageIndex:null,prevAnimationTime:-1,changeFPS:1e3,transformation:0,spriteIndex:0,prevIndex:0,currentAnimation:null,image:null,rows:1,columns:1,width:0,height:0,singleWidth:0,singleHeight:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0,parentOffsetX:0,parentOffsetY:0,ownerActor:null,mapInfo:null,map:null,animationsMap:null,callback:null,fontScale:1,getOwnerActor:function(){return this.ownerActor},addAnimation:function(e,t,n,r){return this.animationsMap[e]=new CAAT.Foundation.SpriteImageAnimationHelper(t,n,r),this},setAnimationEndCallback:function(e){this.callback=e},playAnimation:function(e){if(e===this.currentAnimation)return this;var t=this.animationsMap[e];return t?(this.currentAnimation=e,this.setAnimationImageIndex(t.animation),this.changeFPS=t.time,this.callback=t.onEndPlayCallback,this):this},setOwner:function(e){return this.ownerActor=e,this},getRows:function(){return this.rows},getColumns:function(){return this.columns},getWidth:function(){var e=this.mapInfo[this.spriteIndex];return e.width},getHeight:function(){var e=this.mapInfo[this.spriteIndex];return e.height},getWrappedImageWidth:function(){return this.image.width},getWrappedImageHeight:function(){return this.image.height},getRef:function(){var e=new CAAT.Foundation.SpriteImage;return e.image=this.image,e.rows=this.rows,e.columns=this.columns,e.width=this.width,e.height=this.height,e.singleWidth=this.singleWidth,e.singleHeight=this.singleHeight,e.mapInfo=this.mapInfo,e.offsetX=this.offsetX,e.offsetY=this.offsetY,e.scaleX=this.scaleX,e.scaleY=this.scaleY,e.animationsMap=this.animationsMap,e.parentOffsetX=this.parentOffsetX,e.parentOffsetY=this.parentOffsetY,e.scaleFont=this.scaleFont,e},setOffsetX:function(e){return this.offsetX=e,this},setOffsetY:function(e){return this.offsetY=e,this},setOffset:function(e,t){return this.offsetX=e,this.offsetY=t,this},initialize:function(e,t,n){e||console.log("Null image for SpriteImage."),isString(e)&&(e=CAAT.currentDirector.getImage(e)),this.parentOffsetX=0,this.parentOffsetY=0,this.rows=t,this.columns=n;if(e instanceof CAAT.Foundation.SpriteImage||e instanceof CAAT.SpriteImage){this.image=e.image;var r=e.mapInfo[0];this.width=r.width,this.height=r.height,this.parentOffsetX=r.x,this.parentOffsetY=r.y,this.width=e.mapInfo[0].width,this.height=e.mapInfo[0].height}else this.image=e,this.width=e.width,this.height=e.height,this.mapInfo={};this.singleWidth=Math.floor(this.width/n),this.singleHeight=Math.floor(this.height/t);var i,s,o,u;if(e.__texturePage){e.__du=this.singleWidth/e.__texturePage.width,e.__dv=this.singleHeight/e.__texturePage.height;var a=this.singleWidth,f=this.singleHeight,l=this.columns;if(e.inverted){var c=a;a=f,f=c,l=this.rows}var h=this.image.__tx,p=this.image.__ty,d=this.image.__texturePage;for(i=0;i<t*n;i++){var v=i%l>>0,m=i/l>>0,g=h+v*a,y=p+m*f,b=g+a,w=y+f;u=(new CAAT.Foundation.SpriteImageHelper(g,y,b-g,w-y,d.width,d.height)).setGL(g/d.width,y/d.height,b/d.width,w/d.height),this.mapInfo[i]=u}}else for(i=0;i<t*n;i++)s=(i%this.columns|0)*this.singleWidth+this.parentOffsetX,o=(i/this.columns|0)*this.singleHeight+this.parentOffsetY,u=new CAAT.Foundation.SpriteImageHelper(s,o,this.singleWidth,this.singleHeight,e.width,e.height),this.mapInfo[i]=u;return this},copy:function(e){return this.initialize(e,1,1),this.mapInfo=e.mapInfo,this},paintTiled:function(e,t,n,r){var i=this.mapInfo[this.spriteIndex],s=new CAAT.Math.Rectangle;this.ownerActor.AABB.intersect(e.AABB,s);var o=this.getWidth(),u=this.getHeight(),a=(this.offsetX-this.ownerActor.x)%o;a>0&&(a-=o);var f=(this.offsetY-this.ownerActor.y)%u;f>0&&(f-=u);var l=((s.width-a)/o>>0)+1,c=((s.height-f)/u>>0)+1,h,p,d=e.ctx;for(h=0;h<c;h++)for(p=0;p<l;p++)d.drawImage(this.image,i.x,i.y,i.width,i.height,s.x-this.ownerActor.x+a+p*i.width>>0,s.y-this.ownerActor.y+f+h*i.height>>0,i.width,i.height)},paintInvertedH:function(e,t,n,r){var i=this.mapInfo[this.spriteIndex],s=e.ctx;return s.save(),s.translate((n|0)+i.width,r|0),s.scale(-1,1),s.drawImage(this.image,i.x,i.y,i.width,i.height,this.offsetX>>0,this.offsetY>>0,i.width,i.height),s.restore(),this},paintInvertedV:function(e,t,n,r){var i=this.mapInfo[this.spriteIndex],s=e.ctx;return s.save(),s.translate(n|0,r+i.height|0),s.scale(1,-1),s.drawImage(this.image,i.x,i.y,i.width,i.height,this.offsetX>>0,this.offsetY>>0,i.width,i.height),s.restore(),this},paintInvertedHV:function(e,t,n,r){var i=this.mapInfo[this.spriteIndex],s=e.ctx;return s.save(),s.translate(n|0,r+i.height|0),s.scale(1,-1),s.translate(i.width,0),s.scale(-1,1),s.drawImage(this.image,i.x,i.y,i.width,i.height,this.offsetX>>0,this.offsetY>>0,i.width,i.height),s.restore(),this},paintN:function(e,t,n,r){var i=this.mapInfo[this.spriteIndex];return e.ctx.drawImage(this.image,i.x,i.y,i.width,i.height,this.offsetX+n>>0,this.offsetY+r>>0,i.width,i.height),this},paintAtRect:function(e,t,n,r,i,s){var o=this.mapInfo[this.spriteIndex];return e.ctx.drawImage(this.image,o.x,o.y,o.width,o.height,this.offsetX+n>>0,this.offsetY+r>>0,i,s),this},paintScaledWidth:function(e,t,n,r){var i=this.mapInfo[this.spriteIndex];return e.ctx.drawImage(this.image,i.x,i.y,i.width,i.height,this.offsetX+n>>0,this.offsetY+r>>0,this.ownerActor.width,i.height),this},paintChunk:function(e,t,n,r,i,s,o){e.drawImage(this.image,r,i,s,o,t,n,s,o)},paintTile:function(e,t,n,r){var i=this.mapInfo[t];return e.drawImage(this.image,i.x,i.y,i.width,i.height,this.offsetX+n>>0,this.offsetY+r>>0,i.width,i.height),this},paintScaled:function(e,t,n,r){var i=this.mapInfo[this.spriteIndex];return e.ctx.drawImage(this.image,i.x,i.y,i.width,i.height,this.offsetX+n>>0,this.offsetY+r>>0,this.ownerActor.width,this.ownerActor.height),this},getCurrentSpriteImageCSSPosition:function(){var e=this.mapInfo[this.spriteIndex],t=-(e.x+this.parentOffsetX-this.offsetX),n=-(e.y+this.parentOffsetY-this.offsetY);return""+t+"px "+n+"px "+(this.ownerActor.transformation===CAAT.Foundation.SpriteImage.TR_TILE?"repeat":"no-repeat")},getNumImages:function(){return this.rows*this.columns},setUV:function(e,t){var n=this.image;if(!n.__texturePage)return;var r=t,i=this.spriteIndex,s=this.mapInfo[this.spriteIndex],o=s.u,u=s.v,a=s.u1,f=s.v1;if(this.offsetX||this.offsetY){var l=this.ownerActor.width,c=this.ownerActor.height,h=n.__texturePage,p=-this.offsetX/h.width,d=-this.offsetY/h.height,v=(l-this.offsetX)/h.width,m=(c-this.offsetY)/h.height;o=p+n.__u,u=d+n.__v,a=v+n.__u,f=m+n.__v}n.inverted?(e[r++]=a,e[r++]=u,e[r++]=a,e[r++]=f,e[r++]=o,e[r++]=f,e[r++]=o,e[r++]=u):(e[r++]=o,e[r++]=u,e[r++]=a,e[r++]=u,e[r++]=a,e[r++]=f,e[r++]=o,e[r++]=f)},setChangeFPS:function(e){return this.changeFPS=e,this},setSpriteTransformation:function(e){this.transformation=e;var t=CAAT.Foundation.SpriteImage;switch(e){case t.TR_FLIP_HORIZONTAL:this.paint=this.paintInvertedH;break;case t.TR_FLIP_VERTICAL:this.paint=this.paintInvertedV;break;case t.TR_FLIP_ALL:this.paint=this.paintInvertedHV;break;case t.TR_FIXED_TO_SIZE:this.paint=this.paintScaled;break;case t.TR_FIXED_WIDTH_TO_SIZE:this.paint=this.paintScaledWidth;break;case t.TR_TILE:this.paint=this.paintTiled;break;default:this.paint=this.paintN}return this.ownerActor.invalidate(),this},resetAnimationTime:function(){return this.prevAnimationTime=-1,this},setAnimationImageIndex:function(e){return this.animationImageIndex=e,this.spriteIndex=e[0],this.prevAnimationTime=-1,this},setSpriteIndex:function(e){return this.spriteIndex=e,this},setSpriteIndexAtTime:function(e){if(this.animationImageIndex.length>1)if(this.prevAnimationTime===-1)this.prevAnimationTime=e,this.spriteIndex=this.animationImageIndex[0],this.prevIndex=0,this.ownerActor.invalidate();else{var t=e;t-=this.prevAnimationTime,t/=this.changeFPS,t%=this.animationImageIndex.length;var n=Math.floor(t);n<this.prevIndex&&this.callback&&this.callback(this,e),this.prevIndex=n,this.spriteIndex=this.animationImageIndex[n],this.ownerActor.invalidate()}},getMapInfo:function(e){return this.mapInfo[e]},initializeFromMap:function(e,t){this.initialize(e,1,1);var n,r,i=0;for(n in t){var s=t[n];r=new CAAT.Foundation.SpriteImageHelper(parseFloat(s.x)+this.parentOffsetX,parseFloat(s.y)+this.parentOffsetY,parseFloat(s.width),parseFloat(s.height),e.width,e.height),this.mapInfo[n]=r,i||this.setAnimationImageIndex([n]),i++}return this},addElement:function(e,t){var n=new CAAT.Foundation.SpriteImageHelper(parseFloat(t.x)+this.parentOffsetX,parseFloat(t.y)+this.parentOffsetY,parseFloat(t.width),parseFloat(t.height),this.image.width,this.image.height);return n.xoffset=typeof t.xoffset=="undefined"?0:parseFloat(t.xoffset),n.yoffset=typeof t.yoffset=="undefined"?0:parseFloat(t.yoffset),n.xadvance=typeof t.xadvance=="undefined"?t.width:parseFloat(t.xadvance),this.mapInfo[e]=n,this},initializeAsGlyphDesigner:function(e,t){this.initialize(e,1,1);var n,r,i=0;for(n in t){var s=t[n];r=new CAAT.Foundation.SpriteImageHelper(parseFloat(s.x)+this.parentOffsetX,parseFloat(s.y)+this.parentOffsetX,parseFloat(s.width),parseFloat(s.height),e.width,e.height),r.xoffset=typeof s.xoffset=="undefined"?0:s.xoffset,r.yoffset=typeof s.yoffset=="undefined"?0:s.yoffset,r.xadvance=typeof s.xadvance=="undefined"?s.width:s.xadvance,this.mapInfo[n]=r,i||this.setAnimationImageIndex([n]),i++}return this},initializeAsFontMap:function(e,t){this.initialize(e,1,1);var n,r=0;for(var i=0;i<t.length;i++){var s=t[i];n=new CAAT.Foundation.SpriteImageHelper(parseFloat(r)+this.parentOffsetX,0+this.parentOffsetY,parseFloat(s.width),e.height,e.width,e.height),n.xoffset=0,n.yoffset=0,n.xadvance=s.width,r+=s.width,this.mapInfo[t[i].c]=n,i||this.setAnimationImageIndex([t[i].c])}return this},initializeAsMonoTypeFontMap:function(e,t){var n=[],r=t.split(""),i=e.width/r.length>>0;for(var s=0;s<r.length;s++)n.push({c:r[s],width:i});return this.initializeAsFontMap(e,n)},stringWidth:function(e){var t,n,r=0,i;for(t=0,n=e.length;t<n;t++)i=this.mapInfo[e.charAt(t)],i&&(r+=i.xadvance*this.fontScale);return r},stringHeight:function(){if(this.fontHeight)return this.fontHeight*this.fontScale;var e=0;for(var t in this.mapInfo){var n=this.mapInfo[t],r=n.height+n.yoffset;r>e&&(e=r)}return this.fontHeight=e,this.fontHeight*this.fontScale},drawText:function(e,t,n,r){var i,s,o,u;for(i=0;i<e.length;i++)o=this.mapInfo[e.charAt(i)],o&&(u=o.width,u>0&&o.height>0&&t.drawImage(this.image,o.x,o.y,u,o.height,n+o.xoffset*this.fontScale,r+o.yoffset*this.fontScale,u*this.fontScale,o.height*this.fontScale),n+=o.xadvance*this.fontScale)},getFontData:function(){var e=this.stringHeight()*.8>>0;return{height:this.stringHeight(),ascent:e,descent:this.stringHeight()-e}}}}}),CAAT.Module({defines:"CAAT.Foundation.Actor",aliases:["CAAT.Actor"],depends:["CAAT.Event.AnimationLoop","CAAT.Foundation.SpriteImage","CAAT.Core.Constants","CAAT.Behavior.PathBehavior","CAAT.Behavior.RotateBehavior","CAAT.Behavior.ScaleBehavior","CAAT.Behavior.Scale1Behavior","CAAT.PathUtil.LinearPath","CAAT.Event.AnimationLoop"],constants:{ANCHOR_CENTER:0,ANCHOR_TOP:1,ANCHOR_BOTTOM:2,ANCHOR_LEFT:3,ANCHOR_RIGHT:4,ANCHOR_TOP_LEFT:5,ANCHOR_TOP_RIGHT:6,ANCHOR_BOTTOM_LEFT:7,ANCHOR_BOTTOM_RIGHT:8,ANCHOR_CUSTOM:9,CACHE_NONE:0,CACHE_SIMPLE:1,CACHE_DEEP:2},extendsWith:function(){var e=0;return{__init:function(){return this.behaviorList=[],this.lifecycleListenerList=[],this.AABB=new CAAT.Math.Rectangle,this.viewVertices=[new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0)],this.scaleAnchor=CAAT.Foundation.Actor.ANCHOR_CENTER,this.modelViewMatrix=new CAAT.Math.Matrix,this.worldModelViewMatrix=new CAAT.Math.Matrix,this.resetTransform(),this.setScale(1,1),this.setRotation(0),this.id=e++,this},__super:null,lifecycleListenerList:null,behaviorList:null,parent:null,x:0,y:0,width:0,height:0,preferredSize:null,minimumSize:null,start_time:0,duration:Number.MAX_VALUE,clip:!1,clipPath:null,tAnchorX:0,tAnchorY:0,scaleX:1,scaleY:1,scaleTX:.5,scaleTY:.5,scaleAnchor:0,rotationAngle:0,rotationY:.5,rotationX:.5,alpha:1,isGlobalAlpha:!1,frameAlpha:1,expired:!1,discardable:!1,pointed:!1,mouseEnabled:!0,visible:!0,fillStyle:null,strokeStyle:null,time:0,AABB:null,viewVertices:null,inFrame:!1,dirty:!0,wdirty:!0,oldX:-1,oldY:-1,modelViewMatrix:null,worldModelViewMatrix:null,modelViewMatrixI:null,worldModelViewMatrixI:null,glEnabled:!1,backgroundImage:null,id:null,size_active:1,size_total:1,__d_ax:-1,__d_ay:-1,gestureEnabled:!1,invalid:!0,cached:0,preventLayout:!1,isAA:!0,setPreventLayout:function(e){return this.preventLayout=e,this},invalidateLayout:function(){return this.parent&&!this.parent.layoutInvalidated&&this.parent.invalidateLayout(),this},__validateLayout:function(){},setPreferredSize:function(e,t){return this.preferredSize||(this.preferredSize=new CAAT.Math.Dimension),this.preferredSize.width=e,this.preferredSize.height=t,this},getPreferredSize:function(){return this.preferredSize?this.preferredSize:this.getMinimumSize()},setMinimumSize:function(e,t){return this.minimumSize||(this.minimumSize=new CAAT.Math.Dimension),this.minimumSize.width=e,this.minimumSize.height=t,this},getMinimumSize:function(){return this.minimumSize?this.minimumSize:new CAAT.Math.Dimension(this.width,this.height)},create:function(){return this},moveTo:function(e,t,n,r,i,s){if(e===this.x&&t===this.y)return;var o="__moveTo",u=this.getBehavior(o);return u||(u=(new CAAT.Behavior.PathBehavior).setId(o).setValues(new CAAT.PathUtil.LinearPath),this.addBehavior(u)),u.path.setInitialPosition(this.x,this.y).setFinalPosition(e,t),u.setDelayTime(r?r:0,n),i&&u.setInterpolator(i),s&&(u.lifecycleListenerList=[],u.addListener({behaviorExpired:function(e,t,n){s(e,t,n)}})),this},rotateTo:function(e,t,n,r,i,s){if(e===this.rotationAngle)return;var o="__rotateTo",u=this.getBehavior(o);return u||(u=(new CAAT.Behavior.RotateBehavior).setId(o).setValues(0,0,.5,.5),this.addBehavior(u)),u.setValues(this.rotationAngle,e,r,i).setDelayTime(n?n:0,t),s&&u.setInterpolator(s),this},scaleTo:function(e,t,n,r,i,s,o){if(this.scaleX===e&&this.scaleY===t)return;var u="__scaleTo",a=this.getBehavior(u);return a||(a=(new CAAT.Behavior.ScaleBehavior).setId(u).setValues(1,1,1,1,.5,.5),this.addBehavior(a)),a.setValues(this.scaleX,e,this.scaleY,t,i,s).setDelayTime(r?r:0,n),o&&a.setInterpolator(o),this},scaleXTo:function(e,t,n,r,i,s){return this.__scale1To(CAAT.Behavior.Scale1Behavior.AXIS_X,e,t,n,r,i,s)},scaleYTo:function(e,t,n,r,i,s){return this.__scale1To(CAAT.Behavior.Scale1Behavior.AXIS_Y,e,t,n,r,i,s)},__scale1To:function(e,t,n,r,i,s,o){if(e===CAAT.Behavior.Scale1Behavior.AXIS_X&&t===this.scaleX||e===CAAT.Behavior.Scale1Behavior.AXIS_Y&&t===this.scaleY)return;var u="__scaleXTo",a=this.getBehavior(u);return a||(a=(new CAAT.Behavior.Scale1Behavior).setId(u).setValues(1,1,e===CAAT.Behavior.Scale1Behavior.AXIS_X,.5,.5),this.addBehavior(a)),a.setValues(e?this.scaleX:this.scaleY,t,i,s).setDelayTime(r?r:0,n),o&&a.setInterpolator(o),this},touchStart:function(e){},touchMove:function(e){},touchEnd:function(e){},gestureStart:function(e,t,n){},gestureChange:function(e,t,n){return this.gestureEnabled&&(this.setRotation(e),this.setScale(t,n)),this},gestureEnd:function(e,t,n){},isVisible:function(){return this.visible},invalidate:function(){return this.invalid=!0,this},setGestureEnabled:function(e){return this.gestureEnabled=!!e,this},isGestureEnabled:function(){return this.gestureEnabled},getId:function(){return this.id},setId:function(e){return this.id=e,this},setParent:function(e){return this.parent=e,this},setBackgroundImage:function(e,t){if(e){e instanceof CAAT.Foundation.SpriteImage?e=e.getRef():isString(e)?e=(new CAAT.Foundation.SpriteImage).initialize(CAAT.currentDirector.getImage(e),1,1):e=(new CAAT.Foundation.SpriteImage).initialize(e,1,1),e.setOwner(this),this.backgroundImage=e;if(typeof t=="undefined"||t)this.width=e.getWidth(),this.height=e.getHeight();this.glEnabled=!0,this.invalidate()}else this.backgroundImage=null;return this},setSpriteIndex:function(e){return this.backgroundImage&&(this.backgroundImage.setSpriteIndex(e),this.invalidate()),this},setBackgroundImageOffset:function(e,t){return this.backgroundImage&&this.backgroundImage.setOffset(e,t),this},setAnimationImageIndex:function(e){return this.backgroundImage&&(this.backgroundImage.resetAnimationTime(),this.backgroundImage.setAnimationImageIndex(e),this.invalidate()),this},addAnimation:function(e,t,n,r){return this.backgroundImage&&this.backgroundImage.addAnimation(e,t,n,r),this},playAnimation:function(e){return this.backgroundImage&&this.backgroundImage.playAnimation(e),this},setAnimationEndCallback:function(e){return this.backgroundImage&&this.backgroundImage.setAnimationEndCallback(e),this},resetAnimationTime:function(){return this.backgroundImage&&(this.backgroundImage.resetAnimationTime(),this.invalidate()),this},setChangeFPS:function(e){return this.backgroundImage&&this.backgroundImage.setChangeFPS(e),this},setImageTransformation:function(e){return this.backgroundImage&&this.backgroundImage.setSpriteTransformation(e),this},centerOn:function(e,t){return this.setPosition(e-this.width/2,t-this.height/2),this},centerAt:function(e,t){return this.setPosition(e-this.width*(.5-this.tAnchorX),t-this.height*(.5-this.tAnchorY)),this},getTextureGLPage:function(){return this.backgroundImage.image.__texturePage},setVisible:function(e){return this.invalidate(),CAAT.currentDirector&&CAAT.currentDirector.dirtyRectsEnabled&&!e&&this.visible&&CAAT.currentDirector.scheduleDirtyRect(this.AABB),e&&!this.visible&&(this.dirty=!0),this.visible=e,this},setOutOfFrameTime:function(){return this.setFrameTime(-1,0),this},addListener:function(e){return this.lifecycleListenerList.push(e),this},removeListener:function(e){var t=this.lifecycleListenerList.length;while(t--)if(this.lifecycleListenerList[t]===e){this.lifecycleListenerList.splice(t,1);return}},setGlobalAlpha:function(e){return this.isGlobalAlpha=e,this},fireEvent:function(e,t){for(var n=0;n<this.lifecycleListenerList.length;n++)this.lifecycleListenerList[n].actorLifeCycleEvent(this,e,t)},setExpired:function(e){return this.expired=!0,this.fireEvent("expired",e),this},enableEvents:function(e){return this.mouseEnabled=e,this},emptyBehaviorList:function(){return this.behaviorList=[],this},setFillStyle:function(e){return this.fillStyle=e,this.invalidate(),this},setStrokeStyle:function(e){return this.strokeStyle=e,this.invalidate(),this},setPaint:function(e){return this.setFillStyle(e)},setAlpha:function(e){return this.alpha=e,this.invalidate(),this},resetTransform:function(){return this.rotationAngle=0,this.rotationX=.5,this.rotationY=.5,this.scaleX=1,this.scaleY=1,this.scaleTX=.5,this.scaleTY=.5,this.scaleAnchor=0,this.oldX=-1,this.oldY=-1,this.dirty=!0,this},setFrameTime:function(e,t){return this.start_time=e,this.duration=t,this.expired=!1,this.dirty=!0,this},paint:function(e,t){if(this.backgroundImage)this.backgroundImage.paint(e,t,0,0);else if(this.fillStyle){var n=e.ctx;n.fillStyle=this.fillStyle,n.fillRect(0,0,this.width,this.height)}},setScale:function(e,t){return this.scaleX=e,this.scaleY=t,this.dirty=!0,this},getAnchorPercent:function(e){var t=[.5,.5,.5,0,.5,1,0,.5,1,.5,0,0,1,0,0,1,1,1];return{x:t[e*2],y:t[e*2+1]}},getAnchor:function(e){var t=0,n=0,r=CAAT.Foundation.Actor;switch(e){case r.ANCHOR_CENTER:t=.5,n=.5;break;case r.ANCHOR_TOP:t=.5,n=0;break;case r.ANCHOR_BOTTOM:t=.5,n=1;break;case r.ANCHOR_LEFT:t=0,n=.5;break;case r.ANCHOR_RIGHT:t=1,n=.5;break;case r.ANCHOR_TOP_RIGHT:t=1,n=0;break;case r.ANCHOR_BOTTOM_LEFT:t=0,n=1;break;case r.ANCHOR_BOTTOM_RIGHT:t=1,n=1;break;case r.ANCHOR_TOP_LEFT:t=0,n=0}return{x:t,y:n}},setGlobalAnchor:function(e,t){return this.tAnchorX=e,this.rotationX=e,this.scaleTX=e,this.tAnchorY=t,this.rotationY=t,this.scaleTY=t,this.dirty=!0,this},setScaleAnchor:function(e,t){return this.scaleTX=e,this.scaleTY=t,this.dirty=!0,this},setScaleAnchored:function(e,t,n,r){return this.scaleTX=n,this.scaleTY=r,this.scaleX=e,this.scaleY=t,this.dirty=!0,this},setRotationAnchor:function(e,t){return this.rotationX=t,this.rotationY=e,this.dirty=!0,this},setRotation:function(e){return this.rotationAngle=e,this.dirty=!0,this},setRotationAnchored:function(e,t,n){return this.rotationAngle=e,this.rotationX=t,this.rotationY=n,this.dirty=!0,this},setSize:function(e,t){return this.width=e,this.height=t,this.dirty=!0,this},setBounds:function(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this.dirty=!0,this},setLocation:function(e,t){return this.x=e,this.y=t,this.oldX=e,this.oldY=t,this.dirty=!0,this},setPosition:function(e,t){return this.setLocation(e,t)},setPositionAnchor:function(e,t){return this.tAnchorX=e,this.tAnchorY=t,this},setPositionAnchored:function(e,t,n,r){return this.setLocation(e,t),this.tAnchorX=n,this.tAnchorY=r,this},isInAnimationFrame:function(e){return this.expired?!1:this.duration===Number.MAX_VALUE?this.start_time<=e:e>=this.start_time+this.duration?(this.expired||this.setExpired(e),!1):this.start_time<=e&&e<this.start_time+this.duration},contains:function(e,t){return e>=0&&t>=0&&e<this.width&&t<this.height},addBehavior:function(e){return this.behaviorList.push(e),this},removeBehaviour:function(e){var t=this.behaviorList,n=t.length-1;while(n)if(t[n]===e)return t.splice(n,1),this;return this},removeBehaviorById:function(e){var t=this.behaviorList;for(var n=0;n<t.length;n++)t[n].id===e&&t.splice(n,1);return this},getBehavior:function(e){var t=this.behaviorList;for(var n=0;n<t.length;n++){var r=t[n];if(r.id===e)return r}return null},setDiscardable:function(e){return this.discardable=e,this},destroy:function(e){this.parent&&this.parent.removeChild(this),this.backgroundImage=null,this.emptyBehaviorList(),this.fireEvent("destroyed",e),this.lifecycleListenerList=[]},modelToView:function(e){var t,n,r,i;this.dirty&&this.setModelViewMatrix(),i=this.worldModelViewMatrix.matrix;if(e instanceof Array)for(var s=0;s<e.length;s++)r=e[s],t=r.x,n=r.y,r.x=t*i[0]+n*i[1]+i[2],r.y=t*i[3]+n*i[4]+i[5];else t=e.x,n=e.y,e.x=t*i[0]+n*i[1]+i[2],e.y=t*i[3]+n*i[4]+i[5];return e},modelToModel:function(e,t){return this.dirty&&this.setModelViewMatrix(),t.viewToModel(this.modelToView(e))},viewToModel:function(e){return this.dirty&&this.setModelViewMatrix(),this.worldModelViewMatrixI=this.worldModelViewMatrix.getInverse(),this.worldModelViewMatrixI.transformCoord(e),e},findActorAtPosition:function(e){return this.scaleX===0||this.scaleY===0?null:!this.visible||!this.mouseEnabled||!this.isInAnimationFrame(this.time)?null:(this.modelViewMatrixI=this.modelViewMatrix.getInverse(),this.modelViewMatrixI.transformCoord(e),this.contains(e.x,e.y)?this:null)},enableDrag:function(){return this.ax=0,this.ay=0,this.asx=1,this.asy=1,this.ara=0,this.screenx=0,this.screeny=0,this.mouseEnter=function(e){this.__d_ax=-1,this.__d_ay=-1,this.pointed=!0,CAAT.setCursor("move")},this.mouseExit=function(e){this.__d_ax=-1,this.__d_ay=-1,this.pointed=!1,CAAT.setCursor("default")},this.mouseMove=function(e){},this.mouseUp=function(e){this.__d_ax=-1,this.__d_ay=-1},this.mouseDrag=function(e){var t;t=this.modelToView(new CAAT.Math.Point(e.x,e.y)),this.parent.viewToModel(t);if(this.__d_ax===-1||this.__d_ay===-1)this.__d_ax=t.x,this.__d_ay=t.y,this.__d_asx=this.scaleX,this.__d_asy=this.scaleY,this.__d_ara=this.rotationAngle,this.__d_screenx=e.screenPoint.x,this.__d_screeny=e.screenPoint.y;if(e.isShiftDown()){var n=(e.screenPoint.x-this.__d_screenx)/100,r=(e.screenPoint.y-this.__d_screeny)/100;if(!e.isAltDown()){var i=Math.max(n,r);n=i,r=i}this.setScale(n+this.__d_asx,r+this.__d_asy)}else if(e.isControlDown()){var s=e.screenPoint.x-this.__d_screenx,o=e.screenPoint.y-this.__d_screeny;this.setRotation(-Math.atan2(s,o)+this.__d_ara)}else this.x+=t.x-this.__d_ax,this.y+=t.y-this.__d_ay;this.__d_ax=t.x,this.__d_ay=t.y},this},disableDrag:function(){return this.mouseEnter=function(e){},this.mouseExit=function(e){},this.mouseMove=function(e){},this.mouseUp=function(e){},this.mouseDrag=function(e){},this},mouseClick:function(e){},mouseDblClick:function(e){},mouseEnter:function(e){this.pointed=!0},mouseExit:function(e){this.pointed=!1},mouseMove:function(e){},mouseDown:function(e){},mouseUp:function(e){},mouseOut:function(e){},mouseOver:function(e){},mouseDrag:function(e){},drawScreenBoundingBox:function(e,t){if(null!==this.AABB&&this.inFrame){var n=this.AABB,r=e.ctx;r.strokeStyle=CAAT.DEBUGAABBCOLOR,r.strokeRect(.5+(n.x|0),.5+(n.y|0),n.width|0,n.height|0);if(CAAT.DEBUGBB){var i=this.viewVertices;r.beginPath(),r.lineTo(i[0].x,i[0].y),r.lineTo(i[1].x,i[1].y),r.lineTo(i[2].x,i[2].y),r.lineTo(i[3].x,i[3].y),r.closePath(),r.strokeStyle=CAAT.DEBUGBBCOLOR,r.stroke()}}},animate:function(e,t){if(!this.visible)return!1;var n;if(!this.isInAnimationFrame(t))return this.inFrame=!1,this.dirty=!0,!1;if(this.x!==this.oldX||this.y!==this.oldY)this.dirty=!0,this.oldX=this.x,this.oldY=this.y;for(n=0;n<this.behaviorList.length;n++)this.behaviorList[n].apply(t,this);this.clipPath&&this.clipPath.applyBehaviors(t),this.setModelViewMatrix();if(this.dirty||this.wdirty||this.invalid)e.dirtyRectsEnabled&&e.addDirtyRect(this.AABB),this.setScreenBounds(),e.dirtyRectsEnabled&&e.addDirtyRect(this.AABB);return this.dirty=!1,this.invalid=!1,this.inFrame=!0,this.backgroundImage&&this.backgroundImage.setSpriteIndexAtTime(t),this.AABB.intersects(e.AABB)},setModelViewMatrix:function(){var e,t,n,r,i,s,o,u,a,f,l,c,h;this.wdirty=!1,h=this.modelViewMatrix.matrix;if(this.dirty){o=1,u=0,f=0,l=1,a=this.x-this.tAnchorX*this.width,c=this.y-this.tAnchorY*this.height;if(this.rotationAngle){var p=this.rotationX*this.width,d=this.rotationY*this.height;a+=o*p+u*d,c+=f*p+l*d,e=Math.cos(this.rotationAngle),t=Math.sin(this.rotationAngle),n=o,r=u,i=f,s=l,o=n*e+r*t,u=-n*t+r*e,f=i*e+s*t,l=-i*t+s*e,a+=-o*p-u*d,c+=-f*p-l*d}if(this.scaleX!=1||this.scaleY!=1){var v=this.scaleTX*this.width,m=this.scaleTY*this.height;a+=o*v+u*m,c+=f*v+l*m,o*=this.scaleX,u*=this.scaleY,f*=this.scaleX,l*=this.scaleY,a+=-o*v-u*m,c+=-f*v-l*m}h[0]=o,h[1]=u,h[2]=a,h[3]=f,h[4]=l,h[5]=c}if(this.parent){this.isAA=this.rotationAngle===0&&this.scaleX===1&&this.scaleY===1&&this.parent.isAA;if(this.dirty||this.parent.wdirty){this.worldModelViewMatrix.copy(this.parent.worldModelViewMatrix);if(this.isAA){var g=this.worldModelViewMatrix.matrix;g[2]+=h[2],g[5]+=h[5]}else this.worldModelViewMatrix.multiply(this.modelViewMatrix);this.wdirty=!0}}else this.dirty&&(this.wdirty=!0),this.worldModelViewMatrix.identity(),this.isAA=this.rotationAngle===0&&this.scaleX===1&&this.scaleY===1},setScreenBounds:function(){var e=this.AABB,t=this.viewVertices,n,r,i,s,o,u;if(this.isAA)return r=this.worldModelViewMatrix.matrix,i=r[2],s=r[5],o=this.width,u=this.height,e.x=i,e.y=s,e.x1=i+o,e.y1=s+u,e.width=o,e.height=u,CAAT.GLRENDER&&(n=t[0],n.x=i,n.y=s,n=t[1],n.x=i+o,n.y=s,n=t[2],n.x=i+o,n.y=s+u,n=t[3],n.x=i,n.y=s+u),this;n=t[0],n.x=0,n.y=0,n=t[1],n.x=this.width,n.y=0,n=t[2],n.x=this.width,n.y=this.height,n=t[3],n.x=0,n.y=this.height,this.modelToView(this.viewVertices);var a=Number.MAX_VALUE,f=-Number.MAX_VALUE,l=Number.MAX_VALUE,c=-Number.MAX_VALUE;return n=t[0],n.x<a&&(a=n.x),n.x>f&&(f=n.x),n.y<l&&(l=n.y),n.y>c&&(c=n.y),n=t[1],n.x<a&&(a=n.x),n.x>f&&(f=n.x),n.y<l&&(l=n.y),n.y>c&&(c=n.y),n=t[2],n.x<a&&(a=n.x),n.x>f&&(f=n.x),n.y<l&&(l=n.y),n.y>c&&(c=n.y),n=t[3],n.x<a&&(a=n.x),n.x>f&&(f=n.x),n.y<l&&(l=n.y),n.y>c&&(c=n.y),e.x=a,e.y=l,e.x1=f,e.y1=c,e.width=f-a,e.height=c-l,this},paintActor:function(e,t){if(!this.visible||!e.inDirtyRect(this))return!0;var n=e.ctx;return this.frameAlpha=this.parent?this.parent.frameAlpha*this.alpha:1,n.globalAlpha=this.frameAlpha,e.modelViewMatrix.transformRenderingContextSet(n),this.worldModelViewMatrix.transformRenderingContext(n),this.clip&&(n.beginPath(),this.clipPath?this.clipPath.applyAsPath(e):n.rect(0,0,this.width,this.height),n.clip()),this.paint(e,t),!0},__paintActor:function(e,t){if(!this.visible)return!0;var n=e.ctx;this.frameAlpha=this.alpha;var r=this.worldModelViewMatrix.matrix;return n.setTransform(r[0],r[3],r[1],r[4],r[2],r[5],this.frameAlpha),this.paint(e,t),!0},paintActorGL:function(e,t){this.frameAlpha=this.parent.frameAlpha*this.alpha;if(!this.glEnabled||!this.visible)return;if(this.glNeedsFlush(e)){e.glFlush(),this.glSetShader(e),this.__uv||(this.__uv=new Float32Array(8)),this.__vv||(this.__vv=new Float32Array(12)),this.setGLCoords(this.__vv,0),this.setUV(this.__uv,0),e.glRender(this.__vv,12,this.__uv);return}var n=e.coords,r=e.coordsIndex;this.setGLCoords(n,r),e.coordsIndex=r+12,this.setUV(e.uv,e.uvIndex),e.uvIndex+=8},setGLCoords:function(e,t){var n=this.viewVertices;e[t++]=n[0].x,e[t++]=n[0].y,e[t++]=0,e[t++]=n[1].x,e[t++]=n[1].y,e[t++]=0,e[t++]=n[2].x,e[t++]=n[2].y,e[t++]=0,e[t++]=n[3].x,e[t++]=n[3].y,e[t]=0},setUV:function(e,t){this.backgroundImage.setUV(e,t)},glNeedsFlush:function(e){return this.getTextureGLPage()!==e.currentTexturePage?!0:this.frameAlpha!==e.currentOpacity?!0:!1},glSetShader:function(e){var t=this.getTextureGLPage();t!==e.currentTexturePage&&e.setGLTexturePage(t),this.frameAlpha!==e.currentOpacity&&e.setGLCurrentOpacity(this.frameAlpha)},endAnimate:function(e,t){return this},initialize:function(e){if(e)for(var t in e)this[t]=e[t];return this},setClip:function(e,t){return this.clip=e,this.clipPath=t,this},isCached:function(){return this.cached},stopCacheAsBitmap:function(){this.cached&&(this.backgroundImage=null,this.cached=CAAT.Foundation.Actor.CACHE_NONE)},cacheAsBitmap:function(e,t){if(this.width<=0||this.height<=0)return this;e=e||0;var n=document.createElement("canvas");n.width=this.width,n.height=this.height;var r=n.getContext("2d");CAAT.Foundation.Actor.prototype.animate.call(this,CAAT.currentDirector,e);var i={ctx:r,modelViewMatrix:new CAAT.Math.Matrix,worldModelViewMatrix:new CAAT.Math.Matrix,dirtyRectsEnabled:!1,inDirtyRect:function(){return!0},AABB:new CAAT.Math.Rectangle(0,0,this.width,this.height)},s=this.modelViewMatrix,o=this.worldModelViewMatrix;return this.modelViewMatrix=new CAAT.Math.Matrix,this.worldModelViewMatrix=new CAAT.Math.Matrix,this.cached=CAAT.Foundation.Actor.CACHE_NONE,typeof t=="undefined"&&(t=CAAT.Foundation.Actor.CACHE_SIMPLE),t===CAAT.Foundation.Actor.CACHE_DEEP?(this.animate(i,e),this.paintActor(i,e)):this instanceof CAAT.Foundation.ActorContainer||this instanceof CAAT.ActorContainer?CAAT.Foundation.ActorContainer.superclass.paintActor.call(this,i,e):(this.animate(i,e),this.paintActor(i,e)),this.setBackgroundImage(n),this.cached=t,this.modelViewMatrix=s,this.worldModelViewMatrix=o,this},resetAsButton:function(){return this.actionPerformed=null,this.mouseEnter=function(){},this.mouseExit=function(){},this.mouseDown=function(){},this.mouseUp=function(){},this.mouseClick=function(){},this.mouseDrag=function(){},this},setAsButton:function(e,t,n,r,i,s){var o=this;return this.setBackgroundImage(e,!0),this.iNormal=t||0,this.iOver=n||this.iNormal,this.iPress=r||this.iNormal,this.iDisabled=i||this.iNormal,this.fnOnClick=s,this.enabled=!0,this.setSpriteIndex(t),this.setEnabled=function(e){return this.enabled=e,this.setSpriteIndex(this.enabled?this.iNormal:this.iDisabled),this},this.actionPerformed=function(e){this.enabled&&this.fnOnClick&&this.fnOnClick(this)},this.mouseEnter=function(e){if(!this.enabled)return;this.dragging?this.setSpriteIndex(this.iPress):this.setSpriteIndex(this.iOver),CAAT.setCursor("pointer")},this.mouseExit=function(e){if(!this.enabled)return;this.setSpriteIndex(this.iNormal),CAAT.setCursor("default")},this.mouseDown=function(e){if(!this.enabled)return;this.setSpriteIndex(this.iPress)},this.mouseUp=function(e){if(!this.enabled)return;this.setSpriteIndex(this.iNormal),this.dragging=!1},this.mouseClick=function(e){},this.mouseDrag=function(e){if(!this.enabled)return;this.dragging=!0},this.setButtonImageIndex=function(e,t,n,r){return this.iNormal=e||0,this.iOver=t||this.iNormal,this.iPress=n||this.iNormal,this.iDisabled=r||this.iNormal,this.setSpriteIndex(this.iNormal),this},this},findActorById:function(e){return this.id===e?this:null}}}}),CAAT.Module({defines:"CAAT.Foundation.ActorContainer",aliases:["CAAT.ActorContainer"],depends:["CAAT.Foundation.Actor","CAAT.Math.Point","CAAT.Math.Rectangle"],constants:{ADDHINT:{CONFORM:1},AddHint:{CONFORM:1}},extendsClass:"CAAT.Foundation.Actor",extendsWith:function(){var e=CAAT.Foundation.Actor.CACHE_DEEP,t=CAAT.Foundation.ActorContainer.superclass,n=t.drawScreenBoundingBox,r=t.paintActor,i=t.paintActorGL,s=t.animate,o=t.findActorAtPosition,u=t.destroy;return{__init:function(e){return this.__super(),this.childrenList=[],this.activeChildren=[],this.pendingChildrenList=[],typeof e!="undefined"&&(this.addHint=e,this.boundingBox=new CAAT.Math.Rectangle),this},childrenList:null,activeChildren:null,pendingChildrenList:null,addHint:0,boundingBox:null,runion:new CAAT.Math.Rectangle,layoutManager:null,layoutInvalidated:!0,setLayout:function(e){return this.layoutManager=e,this},setBounds:function(e,t,n,r){return CAAT.Foundation.ActorContainer.superclass.setBounds.call(this,e,t,n,r),CAAT.currentDirector&&!CAAT.currentDirector.inValidation&&this.invalidateLayout(),this},__validateLayout:function(){this.__validateTree(),this.layoutInvalidated=!1},__validateTree:function(){if(this.layoutManager&&this.layoutManager.isInvalidated()){CAAT.currentDirector.inValidation=!0,this.layoutManager.doLayout(this);for(var e=0;e<this.getNumChildren();e+=1)this.getChildAt(e).__validateLayout()}},invalidateLayout:function(){this.layoutInvalidated=!0;if(this.layoutManager){this.layoutManager.invalidateLayout(this);for(var e=0;e<this.getNumChildren();e+=1)this.getChildAt(e).invalidateLayout()}},getLayout:function(){return this.layoutManager},drawScreenBoundingBox:function(e,t){if(!this.inFrame)return;var r=this.activeChildren;for(var i=0;i<r.length;i++)r[i].drawScreenBoundingBox(e,t);n.call(this,e,t)},emptyChildren:function(){return this.childrenList=[],this},paintActor:function(t,n){if(!this.visible)return!1;var i=t.ctx;i.save();if(!r.call(this,t,n))return!1;if(this.cached===e)return!1;this.isGlobalAlpha||(this.frameAlpha=this.parent?this.parent.frameAlpha:1);for(var s=0,o=this.activeChildren.length;s<o;++s){var u=this.activeChildren[s];u.visible&&(i.save(),u.paintActor(t,n),i.restore())}return this.postPaint&&this.postPaint(t,n),i.restore(),!0},__paintActor:function(e,t){if(!this.visible)return!0;var n=e.ctx;this.frameAlpha=this.parent?this.parent.frameAlpha*this.alpha:1;var r=this.worldModelViewMatrix.matrix;n.setTransform(r[0],r[3],r[1],r[4],r[2],r[5],this.frameAlpha),this.paint(e,t),this.isGlobalAlpha||(this.frameAlpha=this.parent?this.parent.frameAlpha:1);for(var i=0,s=this.activeChildren.length;i<s;++i){var o=this.activeChildren[i];o.paintActor(e,t)}return!0},paintActorGL:function(e,t){var n,r,s;if(!this.visible)return!0;i.call(this,e,t),this.isGlobalAlpha||(this.frameAlpha=this.parent.frameAlpha);for(n=0,r=this.activeChildren.length;n<r;++n)s=this.activeChildren[n],s.paintActorGL(e,t)},animate:function(t,n){if(!this.visible)return!1;this.activeChildren=[];var r=null;if(!1===s.call(this,t,n))return!1;if(this.cached===e)return!0;this.__validateLayout(),CAAT.currentDirector.inValidation=!1;var i,o,u=this.pendingChildrenList;for(i=0;i<u.length;i++){var a=u[i];this.addChildImmediately(a.child,a.constraint)}this.pendingChildrenList=[];var f=[],l=this.childrenList;this.size_active=1,this.size_total=1;for(i=0;i<l.length;i++){var c=l[i];c.time=n,this.size_total+=c.size_total,c.animate(t,n)?(this.activeChildren.push(c),this.size_active+=c.size_active):c.expired&&c.discardable&&f.push(c)}for(i=0,o=f.length;i<o;i++){var h=f[i];h.destroy(n),t.dirtyRectsEnabled&&t.addDirtyRect(h.AABB)}return!0},endAnimate:function(e,t){},addChildImmediately:function(e,t){return this.addChild(e,t)},addChild:function(e,t){if(e.parent!=null)throw"adding to a container an element with parent.";return e.parent=this,this.childrenList.push(e),e.dirty=!0,this.layoutManager?(this.layoutManager.addChild(e,t),this.invalidateLayout()):this.addHint===CAAT.Foundation.ActorContainer.AddHint.CONFORM&&this.recalcSize(),this},recalcSize:function(){var e=this.boundingBox;e.setEmpty();var t=this.childrenList,n;for(var r=0;r<t.length;r++)n=t[r],this.runion.setBounds(n.x<0?0:n.x,n.y<0?0:n.y,n.width,n.height),e.unionRectangle(this.runion);return this.setSize(e.x1,e.y1),this},addChildDelayed:function(e,t){return this.pendingChildrenList.push({child:e,constraint:t}),this},addChildAt:function(e,t){return t<=0?(e.parent=this,e.dirty=!0,this.childrenList.splice(0,0,e),this.invalidateLayout(),this):(t>=this.childrenList.length&&(t=this.childrenList.length),e.parent=this,e.dirty=!0,this.childrenList.splice(t,0,e),this.invalidateLayout(),this)},findActorById:function(e){if(CAAT.Foundation.ActorContainer.superclass.findActorById.call(this,e))return this;var t=this.childrenList;for(var n=0,r=t.length;n<r;n++){var i=t[n].findActorById(e);if(null!=i)return i}return null},findChild:function(e){var t=this.childrenList,n,r=t.length;for(n=0;n<r;n++)if(t[n]===e)return n;return-1},removeChildAt:function(e){var t=this.childrenList,n;return-1!==e&&e>=0&&e<this.childrenList.length?(t[e].setParent(null),n=t.splice(e,1),n[0].isVisible()&&CAAT.currentDirector.dirtyRectsEnabled&&CAAT.currentDirector.scheduleDirtyRect(n[0].AABB),this.invalidateLayout(),n[0]):null},removeChild:function(e){var t=this.findChild(e),n=this.removeChildAt(t);return n},removeFirstChild:function(){var e=this.childrenList.shift();return e.parent=null,e.isVisible()&&CAAT.currentDirector.dirtyRectsEnabled&&CAAT.currentDirector.scheduleDirtyRect(e.AABB),this.invalidateLayout(),e},removeLastChild:function(){if(this.childrenList.length){var e=this.childrenList.pop();return e.parent=null,e.isVisible()&&CAAT.currentDirector.dirtyRectsEnabled&&CAAT.currentDirector.scheduleDirtyRect(e.AABB),this.invalidateLayout(),e}return null},findActorAtPosition:function(e){if(null===o.call(this,e))return null;var t=this.childrenList;for(var n=t.length-1;n>=0;n--){var r=this.childrenList[n],i=new CAAT.Math.Point(e.x,e.y,0),s=r.findActorAtPosition(i);if(null!==s)return s}return this},destroy:function(){var e=this.childrenList;for(var t=e.length-1;t>=0;t--)e[t].destroy();return u.call(this),this},getNumChildren:function(){return this.childrenList.length},getNumActiveChildren:function(){return this.activeChildren.length},getChildAt:function(e){return this.childrenList[e]},setZOrder:function(e,t){var n=this.findChild(e);if(-1!==n){var r=this.childrenList;if(t===n)return;if(t>=r.length)r.splice(n,1),r.push(e);else{var i=r.splice(n,1);t<0?t=0:t>r.length&&(t=r.length),r.splice(t,0,i[0])}this.invalidateLayout()}}}}}),CAAT.Module({defines:"CAAT.Foundation.Scene",depends:["CAAT.Math.Point","CAAT.Math.Matrix","CAAT.PathUtil.Path","CAAT.Behavior.GenericBehavior","CAAT.Behavior.ContainerBehavior","CAAT.Behavior.ScaleBehavior","CAAT.Behavior.AlphaBehavior","CAAT.Behavior.RotateBehavior","CAAT.Behavior.PathBehavior","CAAT.Foundation.ActorContainer","CAAT.Foundation.Timer.TimerManager"],aliases:["CAAT.Scene"],extendsClass:"CAAT.Foundation.ActorContainer",constants:{EASE_ROTATION:1,EASE_SCALE:2,EASE_TRANSLATE:3},extendsWith:function(){return{__init:function(){return this.__super(),this.timerManager=new CAAT.TimerManager,this.fillStyle=null,this.isGlobalAlpha=!0,this},easeContainerBehaviour:null,easeContainerBehaviourListener:null,easeIn:!1,paused:!1,timerManager:null,isPaused:function(){return this.paused},setPaused:function(e){this.paused=e},createTimer:function(e,t,n,r,i){return this.timerManager.createTimer(e,t,n,r,i,this)},setTimeout:function(e,t,n,r){return this.timerManager.createTimer(this.time,e,t,n,r,this)},createAlphaBehaviour:function(e,t){var n=new CAAT.Behavior.AlphaBehavior;n.setFrameTime(0,e),n.startAlpha=t?0:1,n.endAlpha=t?1:0,this.easeContainerBehaviour.addBehavior(n)},easeTranslationIn:function(e,t,n,r){this.easeTranslation(e,t,n,!0,r)},easeTranslationOut:function(e,t,n,r){this.easeTranslation(e,t,n,!1,r)},easeTranslation:function(e,t,n,r,i){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior,this.easeIn=r;var s=new CAAT.Behavior.PathBehavior;i&&s.setInterpolator(i),s.setFrameTime(0,e),n<1?n=1:n>4&&(n=4);switch(n){case CAAT.Foundation.Actor.ANCHOR_TOP:r?(s.setPath((new CAAT.PathUtil.Path).setLinear(0,-this.height+1,0,0)),this.setPosition(0,-this.height+1)):(s.setPath((new CAAT.PathUtil.Path).setLinear(0,0,0,-this.height+1)),this.setPosition(0,0));break;case CAAT.Foundation.Actor.ANCHOR_BOTTOM:r?(s.setPath((new CAAT.PathUtil.Path).setLinear(0,this.height-1,0,0)),this.setPosition(0,this.height-1)):(s.setPath((new CAAT.PathUtil.Path).setLinear(0,0,0,this.height-1)),this.setPosition(0,0));break;case CAAT.Foundation.Actor.ANCHOR_LEFT:r?(s.setPath((new CAAT.PathUtil.Path).setLinear(-this.width+1,0,0,0)),this.setPosition(-this.width+1,0)):(s.setPath((new CAAT.PathUtil.Path).setLinear(0,0,-this.width+1,0)),this.setPosition(0,0));break;case CAAT.Foundation.Actor.ANCHOR_RIGHT:r?(s.setPath((new CAAT.PathUtil.Path).setLinear(this.width-1,0,0,0)),this.setPosition(this.width-1,0)):(s.setPath((new CAAT.PathUtil.Path).setLinear(0,0,this.width-1,0)),this.setPosition(0,0))}t&&this.createAlphaBehaviour(e,r),this.easeContainerBehaviour.addBehavior(s),this.easeContainerBehaviour.setFrameTime(this.time,e),this.easeContainerBehaviour.addListener(this),this.emptyBehaviorList(),CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},easeScaleIn:function(e,t,n,r,i){this.easeScale(e,t,n,r,!0,i),this.easeIn=!0},easeScaleOut:function(e,t,n,r,i){this.easeScale(e,t,n,r,!1,i),this.easeIn=!1},easeScale:function(e,t,n,r,i,s){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior;var o=0,u=0,a=0,f=0;switch(r){case CAAT.Foundation.Actor.ANCHOR_TOP_LEFT:case CAAT.Foundation.Actor.ANCHOR_TOP_RIGHT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_LEFT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_RIGHT:case CAAT.Foundation.Actor.ANCHOR_CENTER:a=1,f=1;break;case CAAT.Foundation.Actor.ANCHOR_TOP:case CAAT.Foundation.Actor.ANCHOR_BOTTOM:o=1,a=1,u=0,f=1;break;case CAAT.Foundation.Actor.ANCHOR_LEFT:case CAAT.Foundation.Actor.ANCHOR_RIGHT:u=1,f=1,o=0,a=1;break;default:alert("scale anchor ?? "+r)}if(!i){var l;l=o,o=a,a=l,l=u,u=f,f=l}n&&this.createAlphaBehaviour(t,i);var c=this.getAnchorPercent(r),h=(new CAAT.Behavior.ScaleBehavior).setFrameTime(e,t).setValues(o,a,u,f,c.x,c.y);s&&h.setInterpolator(s),this.easeContainerBehaviour.addBehavior(h),this.easeContainerBehaviour.setFrameTime(this.time,t),this.easeContainerBehaviour.addListener(this),this.emptyBehaviorList(),CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},addBehavior:function(e){return this},easeRotationIn:function(e,t,n,r){this.easeRotation(e,t,n,!0,r),this.easeIn=!0},easeRotationOut:function(e,t,n,r){this.easeRotation(e,t,n,!1,r),this.easeIn=!1},easeRotation:function(e,t,n,r,i){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior;var s=0,o=0;n==CAAT.Foundation.Actor.ANCHOR_CENTER&&(n=CAAT.Foundation.Actor.ANCHOR_TOP);switch(n){case CAAT.Foundation.Actor.ANCHOR_TOP:case CAAT.Foundation.Actor.ANCHOR_BOTTOM:case CAAT.Foundation.Actor.ANCHOR_LEFT:case CAAT.Foundation.Actor.ANCHOR_RIGHT:s=Math.PI*(Math.random()<.5?1:-1);break;case CAAT.Foundation.Actor.ANCHOR_TOP_LEFT:case CAAT.Foundation.Actor.ANCHOR_TOP_RIGHT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_LEFT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_RIGHT:s=Math.PI/2*(Math.random()<.5?1:-1);break;default:alert("rot anchor ?? "+n)}if(!1===r){var u=s;s=o,o=u}t&&this.createAlphaBehaviour(e,r);var a=this.getAnchorPercent(n),f=(new CAAT.Behavior.RotateBehavior).setFrameTime(0,e).setValues(s,o,a.x,a.y);i&&f.setInterpolator(i),this.easeContainerBehaviour.addBehavior(f),this.easeContainerBehaviour.setFrameTime(this.time,e),this.easeContainerBehaviour.addListener(this),this.emptyBehaviorList(),CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},setEaseListener:function(e){this.easeContainerBehaviourListener=e},behaviorExpired:function(e){this.easeContainerBehaviourListener.easeEnd(this,this.easeIn)},activated:function(){},setExpired:function(e){this.expired=e},paint:function(e,t){if(this.fillStyle){var n=e.ctx;n.fillStyle=this.fillStyle,n.fillRect(0,0,this.width,this.height)}},findActorAtPosition:function(e){var t,n,r=new CAAT.Math.Point;if(this.inputList){var i=this.inputList;for(t=0;t<i.length;t++){var s=i[t];for(n=0;n<s.length;n++)if(s[n].visible){r.set(e.x,e.y);var o=s[n].worldModelViewMatrix.getInverse();o.transformCoord(r);if(s[n].contains(r.x,r.y))return s[n]}}}return r.set(e.x,e.y),CAAT.Foundation.Scene.superclass.findActorAtPosition.call(this,r)},enableInputList:function(e){this.inputList=[];for(var t=0;t<e;t++)this.inputList.push([]);return this},addActorToInputList:function(e,t,n){t<0?t=0:t>=this.inputList.length&&(t=this.inputList.length-1);var r=this.inputList[t];return typeof n=="undefined"||n>=r.length?r.push(e):n<=0?r.unshift(e):r.splice(n,0,e),this},emptyInputList:function(e){return e<0?e=0:e>=this.inputList.length&&(e=this.inputList.length-1),this.inputList[e]=[],this},removeActorFromInputList:function(e,t){if(typeof t=="undefined"){var n,r;for(n=0;n<this.inputList.length;n++){var i=this.inputList[n];for(r=0;r<i.length;r++)i[r]==e&&i.splice(r,1)}return this}t<0?t=0:t>=this.inputList.length&&(t=this.inputList.length-1);var i=this.inputList[t];for(r=0;r<i.length;r++)i[r]==e&&i.splice(r,1);return this},getIn:function(e){},goOut:function(e){}}}}),CAAT.Module({defines:"CAAT.Foundation.Director",aliases:["CAAT.Director"],extendsClass:"CAAT.Foundation.ActorContainer",depends:["CAAT.Core.Class","CAAT.Core.Constants","CAAT.Foundation.ActorContainer","CAAT.Module.Audio.AudioManager","CAAT.Module.Runtime.BrowserInfo","CAAT.Module.Debug.Debug","CAAT.Math.Point","CAAT.Math.Rectangle","CAAT.Math.Matrix","CAAT.Foundation.Timer.TimerManager","CAAT.Foundation.Actor","CAAT.Foundation.Scene","CAAT.Event.AnimationLoop","CAAT.Event.Input","CAAT.Event.KeyEvent","CAAT.Event.MouseEvent","CAAT.Event.TouchEvent","CAAT.WebGL.Program","CAAT.WebGL.ColorProgram","CAAT.WebGL.TextureProgram","CAAT.WebGL.GLU","CAAT.Module.TexturePacker.TexturePageManager"],constants:{RENDER_MODE_CONTINUOUS:1,RENDER_MODE_DIRTY:2,CLEAR_DIRTY_RECTS:1,CLEAR_ALL:!0,CLEAR_NONE:!1,RESIZE_NONE:1,RESIZE_WIDTH:2,RESIZE_HEIGHT:4,RESIZE_BOTH:8,RESIZE_PROPORTIONAL:16},extendsWith:function(){return{__init:function(){this.__super(),this.browserInfo=CAAT.Module.Runtime.BrowserInfo,this.audioManager=(new CAAT.Module.Audio.AudioManager).initialize(8),this.scenes=[],this.imagesCache=[],this.mousePoint=new CAAT.Math.Point(0,0,0),this.prevMousePoint=new CAAT.Math.Point(0,0,0),this.screenMousePoint=new CAAT.Math.Point(0,0,0),this.isMouseDown=!1,this.lastSelectedActor=null,this.dragging=!1,this.cDirtyRects=[],this.sDirtyRects=[],this.dirtyRects=[];for(var e=0;e<64;e++)this.dirtyRects.push(new CAAT.Math.Rectangle);return this.dirtyRectsIndex=0,this.touches={},this.timerManager=new CAAT.Foundation.Timer.TimerManager,this.__map={},this},debug:!1,renderMode:CAAT.Foundation.Director.RENDER_MODE_CONTINUOUS,onRenderStart:null,onRenderEnd:null,mousePoint:null,prevMousePoint:null,screenMousePoint:null,isMouseDown:!1,lastSelectedActor:null,dragging:!1,scenes:null,currentScene:null,canvas:null,ctx:null,time:0,timeline:0,imagesCache:null,audioManager:null,clear:CAAT.Foundation.Director.CLEAR_ALL,transitionScene:null,browserInfo:null,gl:null,glEnabled:!1,glTextureManager:null,glTtextureProgram:null,glColorProgram:null,pMatrix:null,coords:null,coordsIndex:0,uv:null,uvIndex:0,front_to_back:!1,statistics:{size_total:0,size_active:0,size_dirtyRects:0,draws:0,size_discarded_by_dirty_rects:0},currentTexturePage:0,currentOpacity:1,intervalId:null,frameCounter:0,resize:1,onResizeCallback:null,__gestureScale:0,__gestureRotation:0,dirtyRects:null,cDirtyRects:null,sDirtyRects:null,dirtyRectsIndex:0,dirtyRectsEnabled:!1,nDirtyRects:0,drDiscarded:0,stopped:!1,needsRepaint:!1,touches:null,timerManager:null,SCREEN_RATIO:1,__map:null,clean:function(){return this.scenes=null,this.currentScene=null,this.imagesCache=null,this.audioManager=null,this.isMouseDown=!1,this.lastSelectedActor=null,this.dragging=!1,this.__gestureScale=0,this.__gestureRotation=0,this.dirty=!0,this.dirtyRects=null,this.cDirtyRects=null,this.dirtyRectsIndex=0,this.dirtyRectsEnabled=!1,this.nDirtyRects=0,this.onResizeCallback=null,this.__map={},this},cancelPlay:function(e){return this.audioManager.cancelPlay(e)},cancelPlayByChannel:function(e){return this.audioManager.cancelPlayByChannel(e)},setValueForKey:function(e,t){return this.__map[e]=t,this},getValueForKey:function(e){return this.__map[e]},createTimer:function(e,t,n,r,i){return this.timerManager.createTimer(e,t,n,r,i,this)},requestRepaint:function(){this.needsRepaint=!0},getCurrentScene:function(){return this.currentScene},checkDebug:function(){if(!navigator.isCocoonJS&&CAAT.DEBUG){var e=(new CAAT.Module.Debug.Debug).initialize(this.width,60);this.debugInfo=e.debugInfo.bind(e)}},getRenderType:function(){return this.glEnabled?"WEBGL":"CANVAS"},windowResized:function(e,t){var n=CAAT.Foundation.Director;switch(this.resize){case n.RESIZE_WIDTH:this.setBounds(0,0,e,this.height);break;case n.RESIZE_HEIGHT:this.setBounds(0,0,this.width,t);break;case n.RESIZE_BOTH:this.setBounds(0,0,e,t);break;case n.RESIZE_PROPORTIONAL:this.setScaleProportional(e,t)}this.glEnabled&&this.glReset(),this.onResizeCallback&&this.onResizeCallback(this,e,t)},setScaleProportional:function(e,t){var n=Math.min(e/this.referenceWidth,t/this.referenceHeight);this.canvas.width=this.referenceWidth*n,this.canvas.height=this.referenceHeight*n,this.ctx=this.canvas.getContext(this.glEnabled?"experimental-webgl":"2d"),this.__setupRetina(),this.setScaleAnchored(n*this.scaleX,n*this.scaleY,0,0),this.glEnabled&&this.glReset()},enableResizeEvents:function(e,t){var n=CAAT.Foundation.Director;return e===n.RESIZE_BOTH||e===n.RESIZE_WIDTH||e===n.RESIZE_HEIGHT||e===n.RESIZE_PROPORTIONAL?(this.referenceWidth=this.width,this.referenceHeight=this.height,this.resize=e,CAAT.registerResizeListener(this),this.onResizeCallback=t,this.windowResized(window.innerWidth,window.innerHeight)):(CAAT.unregisterResizeListener(this),this.onResizeCallback=null),this},__setupRetina:function(){if(CAAT.RETINA_DISPLAY_ENABLED){var e=CAAT.Module.Runtime.BrowserInfo.DevicePixelRatio,t=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,n=e/t;if(e!==t){var r=this.canvas.width,i=this.canvas.height;this.canvas.width=r*n,this.canvas.height=i*n,this.canvas.style.width=r+"px",this.canvas.style.height=i+"px",this.setScaleAnchored(n,n,0,0)}else this.setScaleAnchored(1,1,0,0);this.SCREEN_RATIO=n}else this.setScaleAnchored(1,1,0,0);for(var s=0;s<this.scenes.length;s++)this.scenes[s].setBounds(0,0,this.width,this.height)},setBounds:function(e,t,n,r){return CAAT.Foundation.Director.superclass.setBounds.call(this,e,t,n,r),this.canvas.width!==n&&(this.canvas.width=n),this.canvas.height!==r&&(this.canvas.height=r),this.ctx=this.canvas.getContext(this.glEnabled?"experimental-webgl":"2d"),this.__setupRetina(),this.glEnabled&&this.glReset(),this},initialize:function(e,t,n,r){typeof n!="undefined"&&(isString(n)?n=document.getElementById(n):n instanceof HTMLCanvasElement||console.log("Canvas is a: "+n+" ???")),n||(n=document.createElement("canvas"),document.body.appendChild(n)),this.canvas=n,typeof r=="undefined"&&(r=n),this.setBounds(0,0,e,t),this.enableEvents(r),this.timeline=(new Date).getTime();if(CAAT.CACHE_SCENE_ON_CHANGE){this.transitionScene=(new CAAT.Foundation.Scene).setBounds(0,0,e,t);var i=document.createElement("canvas");i.width=e,i.height=t;var s=(new CAAT.Foundation.Actor).setBackgroundImage(i);this.transitionScene.ctx=i.getContext("2d"),this.transitionScene.addChildImmediately(s),this.transitionScene.setEaseListener(this)}return this.checkDebug(),this},glReset:function(){this.pMatrix=CAAT.WebGL.GLU.makeOrtho(0,this.referenceWidth,this.referenceHeight,0,-1,1),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.glColorProgram.setMatrixUniform(this.pMatrix),this.glTextureProgram.setMatrixUniform(this.pMatrix),this.gl.viewportWidth=this.canvas.width,this.gl.viewportHeight=this.canvas.height},initializeGL:function(e,t,n,r){n||(n=document.createElement("canvas"),document.body.appendChild(n)),n.width=e,n.height=t,typeof r=="undefined"&&(r=n),this.referenceWidth=e,this.referenceHeight=t;var i;try{this.gl=n.getContext("experimental-webgl"),this.gl.viewportWidth=e,this.gl.viewportHeight=t,CAAT.GLRENDER=!0}catch(s){}if(!this.gl)return this.initialize(e,t,n);this.canvas=n,this.setBounds(0,0,e,t),this.enableEvents(n),this.timeline=(new Date).getTime(),this.glColorProgram=(new CAAT.WebGL.ColorProgram(this.gl)).create().initialize(),this.glTextureProgram=(new CAAT.WebGL.TextureProgram(this.gl)).create().initialize(),this.glTextureProgram.useProgram(),this.glReset();var o=512;return this.coords=new Float32Array(o*12),this.uv=new Float32Array(o*8),this.gl.clearColor(0,0,0,255),this.front_to_back?(this.gl.clearDepth(1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LESS)):this.gl.disable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.glEnabled=!0,this.checkDebug(),this},createScene:function(){var e=new CAAT.Scene;return this.addScene(e),e},setImagesCache:function(e,t,n){if(!e||!e.length)return this;var r;null!==this.glTextureManager&&(this.glTextureManager.deletePages(),this.glTextureManager=null);if(this.imagesCache){var i=[];for(r=0;r<this.imagesCache.length;r++)i.push(this.imagesCache[r].id);for(r=0;r<i.length;r++)delete this.imagesCache[i[r]]}this.imagesCache=e;if(e)for(r=0;r<e.length;r++)this.imagesCache[e[r].id]=e[r].image;return this.tpW=t||2048,this.tpH=n||2048,this.updateGLPages(),this},updateGLPages:function(){this.glEnabled&&(this.glTextureManager=new CAAT.Module.TexturePacker.TexturePageManager,this.glTextureManager.createPages(this.gl,this.tpW,this.tpH,this.imagesCache),this.currentTexturePage=this.glTextureManager.pages[0],this.glTextureProgram.setTexture(this.currentTexturePage.texture))},setGLTexturePage:function(e){return this.currentTexturePage=e,this.glTextureProgram.setTexture(e.texture),this},addImage:function(e,t,n){if(this.getImage(e)){for(var r in this.imagesCache)if(this.imagesCache[r].id===e){this.imagesCache[r].image=t;break}this.imagesCache[e]=t}else this.imagesCache.push({id:e,image:t}),this.imagesCache[e]=t;n||this.updateGLPages()},deleteImage:function(e,t){for(var n=0;n<this.imagesCache.length;n++)if(this.imagesCache[n].id===e){delete this.imagesCache[e],this.imagesCache.splice(n,1);break}t||this.updateGLPages()},setGLCurrentOpacity:function(e){this.currentOpacity=e,this.glTextureProgram.setAlpha(e)},glRender:function(e,t,n){e=e||this.coords,n=n||this.uv,t=t||this.coordsIndex;var r=this.gl,i=t/12*2,s=t/3;this.glTextureProgram.updateVertexBuffer(e),this.glTextureProgram.updateUVBuffer(n),r.drawElements(r.TRIANGLES,3*i,r.UNSIGNED_SHORT,0)},glFlush:function(){this.coordsIndex!==0&&this.glRender(this.coords,this.coordsIndex,this.uv),this.coordsIndex=0,this.uvIndex=0,this.statistics.draws++},findActorAtPosition:function(e){var t=this.childrenList;for(var n=t.length-1;n>=0;n--){var r=this.childrenList[n],i=new CAAT.Math.Point(e.x,e.y,0),s=r.findActorAtPosition(i);if(null!==s)return s}return this},resetStats:function(){this.statistics.size_total=0,this.statistics.size_active=0,this.statistics.draws=0,this.statistics.size_discarded_by_dirty_rects=0},render:function(e){if(this.currentScene&&this.currentScene.isPaused())return;this.time+=e;for(i=0,l=this.childrenList.length;i<l;i++){var t=this.childrenList[i];if(t.isInAnimationFrame(this.time)&&!t.isPaused()){var n=t.time-t.start_time;t.timerManager.checkTimers(n),t.timerManager.removeExpiredTimers()}}this.animate(this,this.time),!navigator.isCocoonJS&&CAAT.DEBUG&&this.resetStats();var r=this.childrenList.length,i,n,t,s=this.ctx;if(this.glEnabled){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.coordsIndex=0,this.uvIndex=0;for(i=0;i<r;i++)t=this.childrenList[i],t.isInAnimationFrame(this.time)&&(n=t.time-t.start_time,t.onRenderStart&&t.onRenderStart(n),t.paintActorGL(this,n),t.onRenderEnd&&t.onRenderEnd(n),t.isPaused()||(t.time+=e),!navigator.isCocoonJS&&CAAT.DEBUG&&(this.statistics.size_total+=t.size_total,this.statistics.size_active+=t.size_active));this.glFlush()}else{s.globalAlpha=1,s.globalCompositeOperation="source-over",s.save();if(this.dirtyRectsEnabled){this.modelViewMatrix.transformRenderingContext(s);if(!CAAT.DEBUG_DIRTYRECTS){s.beginPath(),this.nDirtyRects=0;var o=this.cDirtyRects;for(i=0;i<o.length;i++){var u=o[i];u.isEmpty()||(s.rect(u.x|0,u.y|0,1+(u.width|0),1+(u.height|0)),this.nDirtyRects++)}s.clip()}else s.clearRect(0,0,this.canvas.width,this.canvas.height)}else this.clear===CAAT.Foundation.Director.CLEAR_ALL&&s.clearRect(0,0,this.canvas.width,this.canvas.height);for(i=0;i<r;i++)t=this.childrenList[i],t.isInAnimationFrame(this.time)&&(n=t.time-t.start_time,s.save(),t.onRenderStart&&t.onRenderStart(n),!CAAT.DEBUG_DIRTYRECTS&&this.dirtyRectsEnabled?this.nDirtyRects&&t.paintActor(this,n):t.paintActor(this,n),t.onRenderEnd&&t.onRenderEnd(n),s.restore(),CAAT.DEBUGAABB&&(s.globalAlpha=1,s.globalCompositeOperation="source-over",this.modelViewMatrix.transformRenderingContextSet(s),t.drawScreenBoundingBox(this,n)),t.isPaused()||(t.time+=e),!navigator.isCocoonJS&&CAAT.DEBUG&&(this.statistics.size_total+=t.size_total,this.statistics.size_active+=t.size_active,this.statistics.size_dirtyRects=this.nDirtyRects));if(this.nDirtyRects>0&&!navigator.isCocoonJS&&CAAT.DEBUG&&CAAT.DEBUG_DIRTYRECTS){s.beginPath(),this.nDirtyRects=0;var o=this.cDirtyRects;for(i=0;i<o.length;i++){var u=o[i];u.isEmpty()||(s.rect(u.x|0,u.y|0,1+(u.width|0),1+(u.height|0)),this.nDirtyRects++)}s.clip(),s.fillStyle="rgba(160,255,150,.4)",s.fillRect(0,0,this.canvas.width,this.canvas.height)}s.restore()}this.frameCounter++},inDirtyRect:function(e){if(!this.dirtyRectsEnabled||CAAT.DEBUG_DIRTYRECTS)return!0;var t=this.cDirtyRects,n,r=e.AABB;for(n=0;n<t.length;n++)if(t[n].intersects(r))return!0;return this.statistics.size_discarded_by_dirty_rects+=e.size_total,!1},animate:function(e,t){this.timerManager.checkTimers(t),this.setModelViewMatrix(this),this.modelViewMatrixI=this.modelViewMatrix.getInverse(),this.setScreenBounds(),this.dirty=!1,this.invalid=!1,this.dirtyRectsIndex=-1,this.cDirtyRects=[];var n=this.childrenList,r,i,s;if(this.dirtyRectsEnabled){var o=this.sDirtyRects;if(o.length){for(i=0,s=o.length;i<s;i++)this.addDirtyRect(o[i]);this.sDirtyRects=[]}}for(i=0;i<n.length;i++){r=n[i];var u=r.time-r.start_time;r.animate(this,u)}return this.timerManager.removeExpiredTimers(),this},scheduleDirtyRect:function(e){this.sDirtyRects.push(e)},addDirtyRect:function(e){if(e.isEmpty())return;var t,n,r,i,s=this.cDirtyRects;for(t=0;t<s.length;t++){n=s[t];if(!n.isEmpty()&&n.intersects(e)){var o=!0;while(o){n.unionRectangle(e);for(r=0;r<s.length;r++)if(r!==t){i=s[r];if(!i.isEmpty()&&i.intersects(n)){n.unionRectangle(i),i.setEmpty();break}}r==s.length&&(o=!1)}for(r=0;r<s.length;r++)s[r].isEmpty()&&s.splice(r,1);return}}this.dirtyRectsIndex++;if(this.dirtyRectsIndex>=this.dirtyRects.length)for(t=0;t<32;t++)this.dirtyRects.push(new CAAT.Math.Rectangle);var u=this.dirtyRects[this.dirtyRectsIndex];u.x=e.x,u.y=e.y,u.x1=e.x1,u.y1=e.y1,u.width=e.width,u.height=e.height,this.cDirtyRects.push(u)},renderToContext:function(e,t){if(t.isInAnimationFrame(this.time)){e.setTransform(1,0,0,1,0,0),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.clearRect(0,0,this.width,this.height);var n=this.ctx;this.ctx=e,e.save();var r=this.modelViewMatrix,i=this.worldModelViewMatrix;this.worldModelViewMatrix=new CAAT.Math.Matrix,this.modelViewMatrix=this.worldModelViewMatrix,this.wdirty=!0,t.animate(this,t.time),t.onRenderStart&&t.onRenderStart(t.time),t.paintActor(this,t.time),t.onRenderEnd&&t.onRenderEnd(t.time),this.worldModelViewMatrix=i,this.modelViewMatrix=r,e.restore(),this.ctx=n}},addScene:function(e){e.setBounds(0,0,this.width,this.height),this.scenes.push(e),e.setEaseListener(this),null===this.currentScene&&this.setScene(0)},getNumScenes:function(){return this.scenes.length},easeInOut:function(e,t,n,r,i,s,o,u,a,f){if(e===this.getCurrentSceneIndex())return;var l=this.scenes[e],c=this.scenes[r];!CAAT.__CSS__&&CAAT.CACHE_SCENE_ON_CHANGE&&(this.renderToContext(this.transitionScene.ctx,c),c=this.transitionScene),l.setExpired(!1),c.setExpired(!1),l.mouseEnabled=!1,c.mouseEnabled=!1,l.resetTransform(),c.resetTransform(),l.setLocation(0,0),c.setLocation(0,0),l.alpha=1,c.alpha=1,t===CAAT.Foundation.Scene.EASE_ROTATION?l.easeRotationIn(o,u,n,a):t===CAAT.Foundation.Scene.EASE_SCALE?l.easeScaleIn(0,o,u,n,a):l.easeTranslationIn(o,u,n,a),i===CAAT.Foundation.Scene.EASE_ROTATION?c.easeRotationOut(o,u,s,f):i===CAAT.Foundation.Scene.EASE_SCALE?c.easeScaleOut(0,o,u,s,f):c.easeTranslationOut(o,u,s,f),this.childrenList=[],c.goOut(l),l.getIn(c),this.addChild(c),this.addChild(l)},easeInOutRandom:function(e,t,n,r){var i=Math.random(),s=Math.random(),o,u;i<.33?(o=CAAT.Foundation.Scene.EASE_ROTATION,u=(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4)):i<.66?(o=CAAT.Foundation.Scene.EASE_SCALE,u=(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,.4)):(o=CAAT.Foundation.Scene.EASE_TRANSLATE,u=(new CAAT.Behavior.Interpolator).createBounceOutInterpolator());var a,f;s<.33?(a=CAAT.Foundation.Scene.EASE_ROTATION,f=(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4)):s<.66?(a=CAAT.Foundation.Scene.EASE_SCALE,f=(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(4)):(a=CAAT.Foundation.Scene.EASE_TRANSLATE,f=(new CAAT.Behavior.Interpolator).createBounceOutInterpolator()),this.easeInOut(e,o,Math.random()*8.99>>0,t,a,Math.random()*8.99>>0,n,r,u,f)},easeIn:function(e,t,n,r,i,s){var o=this.scenes[e];t===CAAT.Foundation.Scene.EASE_ROTATION?o.easeRotationIn(n,r,i,s):t===CAAT.Foundation.Scene.EASE_SCALE?o.easeScaleIn(0,n,r,i,s):o.easeTranslationIn(n,r,i,s),this.childrenList=[],this.addChild(o),o.resetTransform(),o.setLocation(0,0),o.alpha=1,o.mouseEnabled=!1,o.setExpired(!1)},setScene:function(e){var t=this.scenes[e];this.childrenList=[],this.addChild(t),this.currentScene=t,t.setExpired(!1),t.mouseEnabled=!0,t.resetTransform(),t.setLocation(0,0),t.alpha=1,t.getIn(),t.activated()},switchToScene:function(e,t,n,r){var i=this.getSceneIndex(this.currentScene);r?this.easeInOutRandom(e,i,t,n):this.setScene(e)},switchToPrevScene:function(e,t,n){var r=this.getSceneIndex(this.currentScene);if(this.getNumScenes()<=1||r===0)return;n?this.easeInOutRandom(r-1,r,e,t):this.setScene(r-1)},switchToNextScene:function(e,t,n){var r=this.getSceneIndex(this.currentScene);if(this.getNumScenes()<=1||r===this.getNumScenes()-1)return;n?this.easeInOutRandom(r+1,r,e,t):this.setScene(r+1)},mouseEnter:function(e){},mouseExit:function(e){},mouseMove:function(e){},mouseDown:function(e){},mouseUp:function(e){},mouseDrag:function(e){},easeEnd:function(e,t){t?(this.currentScene=e,this.currentScene.activated()):e.setExpired(!0),e.mouseEnabled=!0,e.emptyBehaviorList()},getSceneIndex:function(e){for(var t=0;t<this.scenes.length;t++)if(this.scenes[t]===e)return t;return-1},getScene:function(e){return this.scenes[e]},getSceneById:function(e){for(var t=0;t<this.scenes.length;t++)if(this.scenes[t].id===e)return this.scenes[t];return null},getCurrentSceneIndex:function(){return this.getSceneIndex(this.currentScene)},getBrowserName:function(){return this.browserInfo.browser},getBrowserVersion:function(){return this.browserInfo.version},getOSName:function(){return this.browserInfo.OS},getImage:function(e){var t=this.imagesCache[e];if(t)return t;for(var n in this.imagesCache)if(this.imagesCache[n].id===e)return this.imagesCache[n].image;return null},musicPlay:function(e){return this.audioManager.playMusic(e)},musicStop:function(){this.audioManager.stopMusic()},addAudio:function(e,t){return this.audioManager.addAudio(e,t),this},audioPlay:function(e){return this.audioManager.play(e)},audioLoop:function(e){return this.audioManager.loop(e)},endSound:function(){return this.audioManager.endSound()},setSoundEffectsEnabled:function(e){return this.audioManager.setSoundEffectsEnabled(e)},setMusicEnabled:function(e){return this.audioManager.setMusicEnabled(e)},isMusicEnabled:function(){return this.audioManager.isMusicEnabled()},isSoundEffectsEnabled:function(){return this.audioManager.isSoundEffectsEnabled()},setVolume:function(e,t){return this.audioManager.setVolume(e,t)},emptyScenes:function(){this.scenes=[]},addChild:function(e){e.parent=this,this.childrenList.push(e)},loop:function(e,t,n){n?(this.onRenderStart=t,this.onRenderEnd=n):t&&(this.onRenderEnd=t),CAAT.loop()},renderFrame:function(){CAAT.currentDirector=this;if(this.stopped)return;var e=(new Date).getTime(),t=e-this.timeline;t>500&&(t=500),this.onRenderStart&&this.onRenderStart(t),this.render(t),this.debugInfo&&this.debugInfo(this.statistics),this.timeline=e,this.onRenderEnd&&this.onRenderEnd(t),this.needsRepaint=!1},resetTimeline:function(){this.timeline=(new Date).getTime()},endLoop:function(){},setClear:function(e){return this.clear=e,this.clear===CAAT.Foundation.Director.CLEAR_DIRTY_RECTS?this.dirtyRectsEnabled=!0:this.dirtyRectsEnabled=!1,this},getAudioManager:function(){return this.audioManager},cumulateOffset:function(e,t,n){var r=n+"Left",i=n+"Top",s=0,o=0,u;while(navigator.browser!=="iOS"&&e&&e.style){e.currentStyle?u=e.currentStyle.position:(u=(e.ownerDocument.defaultView||e.ownerDocument.parentWindow).getComputedStyle(e,null),u=u?u.getPropertyValue("position"):null);if(!!/^(fixed)$/.test(u))break;s+=e[r],o+=e[i],e=e[t]}return{x:s,y:o,style:u}},getOffset:function(e){var t=this.cumulateOffset(e,"offsetParent","offset");if(t.style==="fixed"){var n=this.cumulateOffset(e,e.parentNode?"parentNode":"parentElement","scroll");return{x:t.x+n.x,y:t.y+n.y}}return{x:t.x,y:t.y}},getCanvasCoord:function(e,t){var n=new CAAT.Math.Point,r=0,i=0;t||(t=window.event);if(t.pageX||t.pageY)r=t.pageX,i=t.pageY;else if(t.clientX||t.clientY)r=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=t.clientY+document.body.scrollTop+document.documentElement.scrollTop;var s=this.getOffset(this.canvas);r-=s.x,i-=s.y,r*=this.SCREEN_RATIO,i*=this.SCREEN_RATIO,n.x=r,n.y=i,this.modelViewMatrixI||(this.modelViewMatrixI=this.modelViewMatrix.getInverse()),this.modelViewMatrixI.transformCoord(n),r=n.x,i=n.y,e.set(r,i),this.screenMousePoint.set(r,i)},__mouseDownHandler:function(e){if(this.dragging&&this.lastSelectedActor){this.__mouseUpHandler(e);return}this.getCanvasCoord(this.mousePoint,e),this.isMouseDown=!0;var t=this.findActorAtPosition(this.mousePoint);if(null!==t){var n=t.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));t.mouseDown((new CAAT.Event.MouseEvent).init(n.x,n.y,e,t,new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y)))}this.lastSelectedActor=t},__mouseUpHandler:function(e){this.isMouseDown=!1,this.getCanvasCoord(this.mousePoint,e);var t=null,n=this.lastSelectedActor;null!==n&&(t=n.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),n.actionPerformed&&n.contains(t.x,t.y)&&n.actionPerformed(e),n.mouseUp((new CAAT.Event.MouseEvent).init(t.x,t.y,e,n,this.screenMousePoint,this.currentScene.time))),!this.dragging&&null!==n&&n.contains(t.x,t.y)&&n.mouseClick((new CAAT.Event.MouseEvent).init(t.x,t.y,e,n,this.screenMousePoint,this.currentScene.time)),this.dragging=!1,this.in_=!1},__mouseMoveHandler:function(e){var t,n,r=this.currentScene?this.currentScene.time:0;if(this.isMouseDown&&null!==this.lastSelectedActor){t=this.lastSelectedActor,n=t.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));if(!this.dragging&&Math.abs(this.prevMousePoint.x-n.x)<CAAT.DRAG_THRESHOLD_X&&Math.abs(this.prevMousePoint.y-n.y)<CAAT.DRAG_THRESHOLD_Y)return;this.dragging=!0;var i=t.x,s=t.y;t.mouseDrag((new CAAT.Event.MouseEvent).init(n.x,n.y,e,t,new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y),r)),this.prevMousePoint.x=n.x,this.prevMousePoint.y=n.y;if(i===t.x&&s===t.y){var o=t.contains(n.x,n.y);this.in_&&!o&&(t.mouseExit((new CAAT.Event.MouseEvent).init(n.x,n.y,e,t,this.screenMousePoint,r)),this.in_=!1),!this.in_&&o&&(t.mouseEnter((new CAAT.Event.MouseEvent).init(n.x,n.y,e,t,this.screenMousePoint,r)),this.in_=!0)}return}this.in_=!0,t=this.findActorAtPosition(this.mousePoint),t!==this.lastSelectedActor&&(null!==this.lastSelectedActor&&(n=this.lastSelectedActor.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),this.lastSelectedActor.mouseExit((new CAAT.Event.MouseEvent).init(n.x,n.y,e,this.lastSelectedActor,this.screenMousePoint,r))),null!==t&&(n=t.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),t.mouseEnter((new CAAT.Event.MouseEvent).init(n.x,n.y,e,t,this.screenMousePoint,r)))),n=t.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),null!==t&&t.mouseMove((new CAAT.Event.MouseEvent).init(n.x,n.y,e,t,this.screenMousePoint,r)),this.prevMousePoint.x=n.x,this.prevMousePoint.y=n.y,this.lastSelectedActor=t},__mouseOutHandler:function(e){if(this.dragging)return;if(null!==this.lastSelectedActor){this.getCanvasCoord(this.mousePoint,e);var t=new CAAT.Math.Point(this.mousePoint.x,this.mousePoint.y,0);this.lastSelectedActor.viewToModel(t);var n=(new CAAT.Event.MouseEvent).init(t.x,t.y,e,this.lastSelectedActor,this.screenMousePoint,this.currentScene.time);this.lastSelectedActor.mouseExit(n),this.lastSelectedActor.mouseOut(n),this.dragging||(this.lastSelectedActor=null)}else this.isMouseDown=!1,this.in_=!1},__mouseOverHandler:function(e){if(this.dragging)return;var t,n,r;null==this.lastSelectedActor?(t=this.findActorAtPosition(this.mousePoint),null!==t&&(n=t.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),r=(new CAAT.Event.MouseEvent).init(n.x,n.y,e,t,this.screenMousePoint,this.currentScene?this.currentScene.time:0),t.mouseOver(r),t.mouseEnter(r)),this.lastSelectedActor=t):(t=this.lastSelectedActor,n=t.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),r=(new CAAT.Event.MouseEvent).init(n.x,n.y,e,t,this.screenMousePoint,this.currentScene.time),t.mouseOver(r),t.mouseEnter(r))},__mouseDBLClickHandler:function(e){this.getCanvasCoord(this.mousePoint,e),null!==this.lastSelectedActor&&this.lastSelectedActor.mouseDblClick((new CAAT.Event.MouseEvent).init(this.mousePoint.x,this.mousePoint.y,e,this.lastSelectedActor,this.screenMousePoint,this.currentScene.time))},__touchStartHandler:function(e){if(e.target===this.canvas){e.preventDefault(),e.returnValue=!1,e=e.targetTouches[0];var t=this.mousePoint;this.getCanvasCoord(t,e);if(t.x<0||t.y<0||t.x>=this.width||t.y>=this.height)return;this.touching=!0,this.__mouseDownHandler(e)}},__touchEndHandler:function(e){if(this.touching){e.preventDefault(),e.returnValue=!1,e=e.changedTouches[0];var t=this.mousePoint;this.getCanvasCoord(t,e),this.touching=!1,this.__mouseUpHandler(e)}},__touchMoveHandler:function(e){if(this.touching){e.preventDefault(),e.returnValue=!1;if(this.gesturing)return;for(var t=0;t<e.targetTouches.length;t++){var n=e.targetTouches[t],r=this.mousePoint;this.getCanvasCoord(r,n),this.__mouseMoveHandler(n)}}},__gestureStart:function(e,t){this.gesturing=!0,this.__gestureRotation=this.lastSelectedActor.rotationAngle,this.__gestureSX=this.lastSelectedActor.scaleX-1,this.__gestureSY=this.lastSelectedActor.scaleY-1},__gestureChange:function(e,t){if(typeof e=="undefined"||typeof t=="undefined")return;this.lastSelectedActor!==null&&this.lastSelectedActor.isGestureEnabled()&&(this.lastSelectedActor.setRotation(t*Math.PI/180+this.__gestureRotation),this.lastSelectedActor.setScale(this.__gestureSX+e,this.__gestureSY+e))},__gestureEnd:function(e,t){this.gesturing=!1,this.__gestureRotation=0,this.__gestureScale=0},__touchEndHandlerMT:function(e){e.preventDefault(),e.returnValue=!1;var t,n,r=[];for(t=0;t<e.changedTouches.length;t++){var i=e.changedTouches[t],s=i.identifier;r.push(s)}var o={};for(t=0;t<r.length;t++){var u=r[t];if(this.touches[u]){var a=this.touches[u].actor;o[a.id]||(o[a.id]={actor:a,touch:(new CAAT.Event.TouchEvent).init(e,a,this.currentScene.time)});var f=o[a.id].touch;f.addChangedTouch(this.touches[u].touch)}}for(t=0;t<e.changedTouches.length;t++){var l=e.changedTouches[t],s=l.identifier;delete this.touches[s]}for(var c in o){var h=o[c],a=h.actor,l=h.touch;for(var p in this.touches){var d=this.touches[p];d.actor.id===a.id&&l.addTouch(d.touch)}a.touchEnd(l)}},__touchMoveHandlerMT:function(e){e.preventDefault(),e.returnValue=!1;var t,n=[];for(t=0;t<e.changedTouches.length;t++){var r=e.changedTouches[t],i=r.identifier;if(this.touches[i]){var s=this.mousePoint;this.getCanvasCoord(s,r);var o=this.touches[i].actor;s=o.viewToModel(s),this.touches[i]={actor:o,touch:new CAAT.Event.TouchInfo(i,s.x,s.y,o)},n.push(i)}}var u={};for(t=0;t<n.length;t++){var a=n[t],o=this.touches[a].actor;u[o.id]||(u[o.id]={actor:o,touch:(new CAAT.Event.TouchEvent).init(e,o,this.currentScene.time)});var f=u[o.id].touch;f.addTouch(this.touches[a].touch),f.addChangedTouch(this.touches[a].touch)}for(var l in u){var c=u[l],o=c.actor,r=c.touch;for(var h in this.touches){var p=this.touches[h];p.actor.id===o.id&&r.addTouch(p.touch)}o.touchMove(r)}},__touchCancelHandleMT:function(e){this.__touchEndHandlerMT(e)},__touchStartHandlerMT:function(e){e.preventDefault(),e.returnValue=!1;var t,n=[],r=!0;for(t=0;t<e.changedTouches.length;t++){var i=e.changedTouches[t],s=i.identifier,o=this.mousePoint;this.getCanvasCoord(o,i);if(o.x<0||o.y<0||o.x>=this.width||o.y>=this.height){r=!1;continue}var u=this.findActorAtPosition(o);u!==null&&(o=u.viewToModel(o),this.touches[s]||(this.touches[s]={actor:u,touch:new CAAT.Event.TouchInfo(s,o.x,o.y,u)},n.push(s)))}var a={};for(t=0;t<n.length;t++){var f=n[t],u=this.touches[f].actor;a[u.id]||(a[u.id]={actor:u,touch:(new CAAT.Event.TouchEvent).init(e,u,this.currentScene.time)});var l=a[u.id].touch;l.addTouch(this.touches[f].touch),l.addChangedTouch(this.touches[f].touch)}for(var c in a){var h=a[c],u=h.actor,i=h.touch;for(var p in this.touches){var d=this.touches[p];d.actor.id===u.id&&i.addTouch(d.touch)}u.touchStart(i)}},__findTouchFirstActor:function(){var e=Number.MAX_VALUE,t=null;for(var n in this.touches){var r=this.touches[n];r.touch.time&&r.touch.time<e&&r.actor.isGestureEnabled()&&(t=r.actor,e=r.touch.time)}return t},__gesturedActor:null,__touchGestureStartHandleMT:function(e){var t=this.__findTouchFirstActor();t!==null&&t.isGestureEnabled()&&(this.__gesturedActor=t,this.__gestureRotation=t.rotationAngle,this.__gestureSX=t.scaleX-1,this.__gestureSY=t.scaleY-1,t.gestureStart(e.rotation*Math.PI/180,e.scale+this.__gestureSX,e.scale+this.__gestureSY))},__touchGestureEndHandleMT:function(e){null!==this.__gesturedActor&&this.__gesturedActor.isGestureEnabled()&&this.__gesturedActor.gestureEnd(e.rotation*Math.PI/180,e.scale+this.__gestureSX,e.scale+this.__gestureSY),this.__gestureRotation=0,this.__gestureScale=0},__touchGestureChangeHandleMT:function(e){this.__gesturedActor!==null&&this.__gesturedActor.isGestureEnabled()&&this.__gesturedActor.gestureChange(e.rotation*Math.PI/180,this.__gestureSX+e.scale,this.__gestureSY+e.scale)},addHandlers:function(e){var t=this;window.addEventListener("mouseup",function(e){if(t.touching){e.preventDefault(),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation();var n=t.mousePoint;t.getCanvasCoord(n,e),t.__mouseUpHandler(e),t.touching=!1}},!1),window.addEventListener("mousedown",function(n){if(n.target===e){n.preventDefault(),n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation();var r=t.mousePoint;t.getCanvasCoord(r,n);if(r.x<0||r.y<0||r.x>=t.width||r.y>=t.height)return;t.touching=!0,t.__mouseDownHandler(n)}},!1),window.addEventListener("mouseover",function(n){if(n.target===e&&!t.dragging){n.preventDefault(),n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation();var r=t.mousePoint;t.getCanvasCoord(r,n);if(r.x<0||r.y<0||r.x>=t.width||r.y>=t.height)return;t.__mouseOverHandler(n)}},!1),window.addEventListener("mouseout",function(n){if(n.target===e&&!t.dragging){n.preventDefault(),n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation();var r=t.mousePoint;t.getCanvasCoord(r,n),t.__mouseOutHandler(n)}},!1),window.addEventListener("mousemove",function(e){e.preventDefault(),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation();var n=t.mousePoint;t.getCanvasCoord(n,e);if(!t.dragging&&(n.x<0||n.y<0||n.x>=t.width||n.y>=t.height))return;t.__mouseMoveHandler(e)},!1),window.addEventListener("dblclick",function(n){if(n.target===e){n.preventDefault(),n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation();var r=t.mousePoint;t.getCanvasCoord(r,n);if(r.x<0||r.y<0||r.x>=t.width||r.y>=t.height)return;t.__mouseDBLClickHandler(n)}},!1),CAAT.TOUCH_BEHAVIOR===CAAT.TOUCH_AS_MOUSE?(e.addEventListener("touchstart",this.__touchStartHandler.bind(this),!1),e.addEventListener("touchmove",this.__touchMoveHandler.bind(this),!1),e.addEventListener("touchend",this.__touchEndHandler.bind(this),!1),e.addEventListener("gesturestart",function(n){n.target===e&&(n.preventDefault(),n.returnValue=!1,t.__gestureStart(n.scale,n.rotation))},!1),e.addEventListener("gestureend",function(n){n.target===e&&(n.preventDefault(),n.returnValue=!1,t.__gestureEnd(n.scale,n.rotation))},!1),e.addEventListener("gesturechange",function(n){n.target===e&&(n.preventDefault(),n.returnValue=!1,t.__gestureChange(n.scale,n.rotation))},!1)):CAAT.TOUCH_BEHAVIOR===CAAT.TOUCH_AS_MULTITOUCH&&(e.addEventListener("touchstart",this.__touchStartHandlerMT.bind(this),!1),e.addEventListener("touchmove",this.__touchMoveHandlerMT.bind(this),!1),e.addEventListener("touchend",this.__touchEndHandlerMT.bind(this),!1),e.addEventListener("touchcancel",this.__touchCancelHandleMT.bind(this),!1),e.addEventListener("gesturestart",this.__touchGestureStartHandleMT.bind(this),!1),e.addEventListener("gestureend",this.__touchGestureEndHandleMT.bind(this),!1),e.addEventListener("gesturechange",this.__touchGestureChangeHandleMT.bind(this),!1))},enableEvents:function(e){CAAT.RegisterDirector(this),this.in_=!1,this.createEventHandler(e)},createEventHandler:function(e){this.in_=!1,this.addHandlers(e)}}},onCreate:function(){typeof CAAT.__CSS__!="undefined"&&(CAAT.Foundation.Director.prototype.clip=!0,CAAT.Foundation.Director.prototype.glEnabled=!1,CAAT.Foundation.Director.prototype.getRenderType=function(){return"CSS"},CAAT.Foundation.Director.prototype.setScaleProportional=function(e,t){var n=Math.min(e/this.referenceWidth,t/this.referenceHeight);this.setScaleAnchored(n,n,0,0),this.eventHandler.style.width=""+this.referenceWidth+"px",this.eventHandler.style.height=""+this.referenceHeight+"px"},CAAT.Foundation.Director.prototype.setBounds=function(e,t,n,r){CAAT.Foundation.Director.superclass.setBounds.call(this,e,t,n,r);for(var i=0;i<this.scenes.length;i++)this.scenes[i].setBounds(0,0,n,r);return this.eventHandler.style.width=n+"px",this.eventHandler.style.height=r+"px",this},CAAT.Foundation.Director.prototype.initialize=function(e,t,n,r){return this.timeline=(new Date).getTime(),this.domElement=n,this.style("position","absolute"),this.style("width",""+e+"px"),this.style("height",""+t+"px"),this.style("overflow","hidden"),this.enableEvents(n),this.setBounds(0,0,e,t),this.checkDebug(),this},CAAT.Foundation.Director.prototype.render=function(e){this.time+=e,this.animate(this,e);var t,n,r;!navigator.isCocoonJS&&CAAT.DEBUG&&this.resetStats();for(t=0,n=this.childrenList.length;t<n;t++){var i=this.childrenList[t];i.isInAnimationFrame(this.time)&&!i.isPaused()&&(r=i.time-i.start_time,i.timerManager.checkTimers(r),i.timerManager.removeExpiredTimers())}for(t=0,n=this.childrenList.length;t<n;t++){var i=this.childrenList[t];i.isInAnimationFrame(this.time)&&(r=i.time-i.start_time,i.onRenderStart&&i.onRenderStart(r),i.paintActor(this,r),i.onRenderEnd&&i.onRenderEnd(r),i.isPaused()||(i.time+=e),!navigator.isCocoonJS&&CAAT.DEBUG&&(this.statistics.size_discarded_by_dirtyRects+=this.drDiscarded,this.statistics.size_total+=i.size_total,this.statistics.size_active+=i.size_active,this.statistics.size_dirtyRects=this.nDirtyRects))}this.frameCounter++},CAAT.Foundation.Director.prototype.addScene=function(e){e.setVisible(!0),e.setBounds(0,0,this.width,this.height),this.scenes.push(e),e.setEaseListener(this),null===this.currentScene&&this.setScene(0),this.domElement.appendChild(e.domElement)},CAAT.Foundation.Director.prototype.emptyScenes=function(){this.scenes=[],this.domElement.innerHTML="",this.createEventHandler()},CAAT.Foundation.Director.prototype.setClear=function(e){return this},CAAT.Foundation.Director.prototype.createEventHandler=function(){this.eventHandler=document.createElement("div"),this.domElement.appendChild(this.eventHandler),this.eventHandler.style.position="absolute",this.eventHandler.style.left="0",this.eventHandler.style.top="0",this.eventHandler.style.zIndex=999999,this.eventHandler.style.width=""+this.width+"px",this.eventHandler.style.height=""+this.height+"px",this.canvas=this.eventHandler,this.in_=!1,this.addHandlers(this.canvas)},CAAT.Foundation.Director.prototype.inDirtyRect=function(){return!0})}}),CAAT.Module({defines:"CAAT.Foundation.UI.Dock",aliases:["CAAT.Dock"],extendsClass:"CAAT.Foundation.ActorContainer",depends:["CAAT.Foundation.ActorContainer","CAAT.Behavior.GenericBehavior"],constants:{OP_LAYOUT_BOTTOM:0,OP_LAYOUT_TOP:1,OP_LAYOUT_LEFT:2,OP_LAYOUT_RIGHT:3},extendsWith:{scene:null,ttask:null,minSize:0,maxSize:0,range:2,layoutOp:0,initialize:function(e){return this.scene=e,this},setApplicationRange:function(e){return this.range=e,this},setLayoutOp:function(e){return this.layoutOp=e,this},setSizes:function(e,t){this.minSize=e,this.maxSize=t;for(var n=0;n<this.childrenList.length;n++)this.childrenList[n].width=e,this.childrenList[n].height=e;return this},layout:function(){var e,t,n=CAAT.Foundation.UI.Dock;if(this.layoutOp===n.OP_LAYOUT_BOTTOM||this.layoutOp===n.OP_LAYOUT_TOP){var r=0,i=0;for(e=0;e<this.getNumChildren();e++)r+=this.getChildAt(e).width;i=(this.width-r)/2;for(e=0;e<this.getNumChildren();e++)t=this.getChildAt(e),t.x=i,i+=t.width,this.layoutOp===n.OP_LAYOUT_BOTTOM?t.y=this.maxSize-t.height:t.y=0}else{var s=0,o=0;for(e=0;e<this.getNumChildren();e++)s+=this.getChildAt(e).height;o=(this.height-s)/2;for(e=0;e<this.getNumChildren();e++)t=this.getChildAt(e),t.y=o,o+=t.height,this.layoutOp===n.OP_LAYOUT_LEFT?t.x=0:t.x=this.width-t.width}},mouseMove:function(e){this.actorNotPointed()},mouseExit:function(e){this.actorNotPointed()},actorNotPointed:function(){var e,t=this;for(e=0;e<this.getNumChildren();e++){var n=this.getChildAt(e);n.emptyBehaviorList(),n.addBehavior((new CAAT.Behavior.GenericBehavior).setValues(n.width,this.minSize,n,"width").setFrameTime(this.scene.time,250)).addBehavior((new CAAT.Behavior.GenericBehavior).setValues(n.height,this.minSize,n,"height").setFrameTime(this.scene.time,250)),e===this.getNumChildren()-1&&n.behaviorList[0].addListener({behaviorApplied:function(e,t,n,r,i){r.parent.layout()},behaviorExpired:function(r,s,o){for(e=0;e<t.getNumChildren();e++)n=t.getChildAt(e),n.width=t.minSize,n.height=t.minSize;o.parent.layout()}})}},actorPointed:function(e,t,n){var r=this.findChild(n),i=CAAT.Foundation.UI.Dock,s=0;this.layoutOp===i.OP_LAYOUT_BOTTOM||this.layoutOp===i.OP_LAYOUT_TOP?s=e/n.width:s=t/n.height;var o;for(o=0;o<this.childrenList.length;o++){var u=this.childrenList[o];u.emptyBehaviorList();var a=0;o<r-this.range||o>r+this.range?a=this.minSize:o===r?a=this.maxSize:o<r?a=this.minSize+(this.maxSize-this.minSize)*(Math.cos((o-r-s+1)/this.range*Math.PI)+1)/2:a=this.minSize+(this.maxSize-this.minSize)*(Math.cos((o-r-s)/this.range*Math.PI)+1)/2,u.height=a,u.width=a}this.layout()},actorMouseExit:function(e){null!==this.ttask&&this.ttask.cancel();var t=this;this.ttask=this.scene.createTimer(this.scene.time,100,function(n,r,i){t.actorNotPointed()},null,null)},actorMouseEnter:function(e){null!==this.ttask&&(this.ttask.cancel(),this.ttask=null)},addChild:function(e){var t=this;return e.__Dock_mouseEnter=e.mouseEnter,e.__Dock_mouseExit=e.mouseExit,e.__Dock_mouseMove=e.mouseMove,e.mouseEnter=function(e){t.actorMouseEnter(e),this.__Dock_mouseEnter(e)},e.mouseExit=function(e){t.actorMouseExit(e),this.__Dock_mouseExit(e)},e.mouseMove=function(e){t.actorPointed(e.point.x,e.point.y,e.source),this.__Dock_mouseMove(e)},e.width=this.minSize,e.height=this.minSize,CAAT.Foundation.UI.Dock.superclass.addChild.call(this,e)}}}),CAAT.Module({defines:"CAAT.Foundation.UI.InterpolatorActor",aliases:["CAAT.InterpolatorActor"],depends:["CAAT.Foundation.Actor"],extendsClass:"CAAT.Foundation.Actor",extendsWith:{interpolator:null,contour:null,S:50,gap:5,setGap:function(e){return this.gap=e,this},setInterpolator:function(e,t){return this.interpolator=e,this.contour=e.getContour(t||this.S),this},paint:function(e,t){CAAT.InterpolatorActor.superclass.paint.call(this,e,t);if(this.backgroundImage)return this;if(this.interpolator){var n=e.ctx,r=this.width-2*this.gap,i=this.height-2*this.gap;n.beginPath(),n.moveTo(this.gap+r*this.contour[0].x,-this.gap+this.height-i*this.contour[0].y);for(var s=1;s<this.contour.length;s++)n.lineTo(this.gap+r*this.contour[s].x,-this.gap+this.height-i*this.contour[s].y);n.strokeStyle=this.strokeStyle,n.stroke()}},getInterpolator:function(){return this.interpolator}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Label",depends:["CAAT.Foundation.Actor","CAAT.Foundation.SpriteImage","CAAT.Module.Font.Font"],aliases:["CAAT.UI.Label"],extendsClass:"CAAT.Foundation.Actor",extendsWith:function(){var e=0,t=.6,n=function(e){return this.ctx=e,this};n.prototype={ctx:null,defaultFS:null,font:null,fontSize:null,fill:null,stroke:null,filled:null,stroked:null,strokeSize:null,italic:null,bold:null,alignment:null,tabSize:null,shadow:null,shadowBlur:null,shadowColor:null,sfont:null,chain:null,setDefault:function(e){this.defaultFS=24,this.font="Arial",this.fontSize=this.defaultFS,this.fill="#000",this.stroke="#f00",this.filled=!0,this.stroked=!1,this.strokeSize=1,this.italic=!1,this.bold=!1,this.alignment="left",this.tabSize=75,this.shadow=!1,this.shadowBlur=0,this.shadowColor="#000";for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);return this.__setFont(),this},setStyle:function(e){if(typeof e!="undefined")for(var t in e)this[t]=e[t];return this},applyStyle:function(){return this.__setFont(),this},clone:function(){var e=new n(this.ctx),t;for(t in this)this.hasOwnProperty(t)&&(e[t]=this[t]);var r=this;while(r.chain){r=r.chain;for(t in r)e[t]===null&&r.hasOwnProperty(t)&&(e[t]=r[t])}return e.__setFont(),e},__getProperty:function(e){var t=this,n;do{n=t[e];if(n!==null)return n;t=t.chain}while(t);return null},image:function(e){this.__setShadow(e)},text:function(e,t,n,r){this.__setShadow(e),e.font=this.__getProperty("sfont"),this.filled&&this.__fillText(e,t,n,r),this.stroked&&this.__strokeText(e,t,n,r)},__setShadow:function(e){this.__getProperty("shadow")&&(e.shadowBlur=this.__getProperty("shadowBlur"),e.shadowColor=this.__getProperty("shadowColor"))},__fillText:function(e,t,n,r){e.fillStyle=this.__getProperty("fill"),e.fillText(t,n,r)},__strokeText:function(e,t,n,r){e.strokeStyle=this.__getProperty("stroke"),e.lineWidth=this.__getProperty("strokeSize"),e.beginPath(),e.strokeText(t,n,r)},__setFont:function(){var e=this.__getProperty("italic"),t=this.__getProperty("bold"),n=this.__getProperty("fontSize"),r=this.__getProperty("font");this.sfont=(e?"italic ":"")+(t?"bold ":"")+n+"px "+r,this.ctx.font=this.__getProperty("sfont")},setBold:function(e){e!=this.bold&&(this.bold=e,this.__setFont())},setItalic:function(e){e!=this.italic&&(this.italic=e,this.__setFont())},setStroked:function(e){this.stroked=e},setFilled:function(e){this.filled=e},getTabPos:function(e){var t=this.__getProperty("tabSize");return((e/t>>0)+1)*t},setFillStyle:function(e){this.fill=e},setStrokeStyle:function(e){this.stroke=e},setStrokeSize:function(e){this.strokeSize=e},setAlignment:function(e){this.alignment=e},setFontSize:function(e){e!==this.fontSize&&(this.fontSize=e,this.__setFont())}};var r=function(){return this.text="",this};r.prototype={x:0,y:0,width:0,text:null,crcs:null,rcs:null,styles:null,images:null,lines:null,documentHeight:0,anchorStack:null,__nextLine:function(){this.x=0,this.currentLine=new u(CAAT.Module.Font.Font.getFontMetrics(this.crcs.sfont)),this.lines.push(this.currentLine)},__image:function(e,t,n){var r;t&&n?r=e.getWidth():r=e.getWrappedImageWidth(),this.width&&r+this.x>this.width&&this.x>0&&this.__nextLine(),this.currentLine.addElementImage(new s(this.x,e,t,n,this.crcs.clone(),this.__getCurrentAnchor())),this.x+=r},__text:function(){if(this.text.length===0)return;var e=this.ctx.measureText(this.text).width;this.width&&e+this.x>this.width&&this.x>0&&this.__nextLine(),this.currentLine.addElement(new o(this.text,this.x,e,0,this.crcs.clone(),this.__getCurrentAnchor())),this.x+=e,this.text=""},fchar:function(e){e===" "?(this.__text(),this.x+=this.ctx.measureText(e).width,this.width&&this.x>this.width&&this.__nextLine()):this.text+=e},end:function(){this.text.length>0&&this.__text();var e=0,t=0;for(var n=0;n<this.lines.length;n++){var r=this.lines[n].getHeight();r===0&&(r=this.styles["default"].fontSize),e+=r,n===this.lines.length-1&&(t=r*.25>>0),this.lines[n].setY(e)}this.documentHeight=e+t},getDocumentHeight:function(){return this.documentHeight},__getCurrentAnchor:function(){return this.anchorStack.length?this.anchorStack[this.anchorStack.length-1]:null},__resetAppliedStyles:function(){this.rcs=[],this.__pushDefaultStyles()},__pushDefaultStyles:function(){this.crcs=(new n(this.ctx)).setDefault(this.styles["default"]),this.rcs.push(this.crcs)},__pushStyle:function(e){var t=this.crcs;this.crcs=new n(this.ctx),this.crcs.chain=t,this.crcs.setStyle(e),this.crcs.applyStyle(),this.rcs.push(this.crcs)},__popStyle:function(){this.rcs.length>1&&(this.rcs.pop(),this.crcs=this.rcs[this.rcs.length-1],this.crcs.applyStyle())},__popAnchor:function(){this.anchorStack.length>0&&this.anchorStack.pop()},__pushAnchor:function(e){this.anchorStack.push(e)},start:function(e,t,n,r){this.x=0,this.y=0,this.width=typeof r!="undefined"?r:0,this.ctx=e,this.lines=[],this.styles=t,this.images=n,this.anchorStack=[],this.__resetAppliedStyles(),this.__nextLine()},setTag:function(e){var t,n;this.__text(),e=e.toLowerCase();if(e==="b")this.crcs.setBold(!0);else if(e==="/b")this.crcs.setBold(!1);else if(e==="i")this.crcs.setItalic(!0);else if(e==="/i")this.crcs.setItalic(!1);else if(e==="stroked")this.crcs.setStroked(!0);else if(e==="/stroked")this.crcs.setStroked(!1);else if(e==="filled")this.crcs.setFilled(!0);else if(e==="/filled")this.crcs.setFilled(!1);else if(e==="tab")this.x=this.crcs.getTabPos(this.x);else if(e==="br")this.__nextLine();else if(e==="/a")this.__popAnchor();else if(e==="/style")this.rcs.length>1&&this.__popStyle();else if(e.indexOf("fillcolor")===0)t=e.split("="),this.crcs.setFillStyle(t[1]);else if(e.indexOf("strokecolor")===0)t=e.split("="),this.crcs.setStrokeStyle(t[1]);else if(e.indexOf("strokesize")===0)t=e.split("="),this.crcs.setStrokeSize(t[1]|0);else if(e.indexOf("fontsize")===0)t=e.split("="),this.crcs.setFontSize(t[1]|0);else if(e.indexOf("style")===0)t=e.split("="),n=this.styles[t[1]],n&&this.__pushStyle(n);else if(e.indexOf("image")===0){t=e.split("=")[1].split(",");var r=t[0];if(this.images[r]){var i=0,s=0;t.length>=3&&(i=t[1]|0,s=t[2]|0),this.__image(this.images[r],i,s)}}else e.indexOf("a=")===0&&(t=e.split("="),this.__pushAnchor(t[1]))}};var i=function(e,t){return this.link=e,this.style=t,this};i.prototype={x:null,y:null,width:null,height:null,style:null,link:null,isLink:function(){return this.link},setLink:function(e){return this.link=e,this},getLink:function(){return this.link},contains:function(e,t){return!1}};var s=function(e,t,n,r,i,o){s.superclass.constructor.call(this,o,i),this.x=e,this.image=t,this.row=n,this.column=r,this.width=t.getWidth(),this.height=t.getHeight();if(this.image instanceof CAAT.SpriteImage||this.image instanceof CAAT.Foundation.SpriteImage)this.spriteIndex=n*t.columns+r,this.paint=this.paintSI;return this};s.prototype={image:null,row:null,column:null,spriteIndex:null,paint:function(t){this.style.image(t),t.drawImage(this.image,this.x,-this.height+1),e&&t.strokeRect(this.x,-this.height+1,this.width,this.height)},paintSI:function(t){this.style.image(t),this.image.setSpriteIndex(this.spriteIndex),this.image.paint({ctx:t},0,this.x,-this.height+1),e&&t.strokeRect(this.x,-this.height+1,this.width,this.height)},getHeight:function(){return this.image instanceof CAAT.Foundation.SpriteImage?this.image.singleHeight:this.image.height},getFontMetrics:function(){return null},contains:function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<this.y+this.height},setYPosition:function(e){this.y=e-this.height+1}};var o=function(e,t,n,r,i,s){return o.superclass.constructor.call(this,s,i),this.x=t,this.y=0,this.width=n,this.text=e,this.style=i,this.fm=CAAT.Module.Font.Font.getFontMetrics(i.sfont),this.height=this.fm.height,this};o.prototype={text:null,style:null,fm:null,bl:null,paint:function(t){this.style.text(t,this.text,this.x,0),e&&t.strokeRect(this.x,-this.fm.ascent,this.width,this.height)},getHeight:function(){return this.fm.height},getFontMetrics:function(){return this.fm},contains:function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height},setYPosition:function(e){this.bl=e,this.y=e-this.fm.ascent}},extend(s,i),extend(o,i);var u=function(e){return this.elements=[],this.defaultFontMetrics=e,this};return u.prototype={elements:null,width:0,height:0,defaultHeight:0,y:0,x:0,alignment:null,baselinePos:0,addElement:function(e){this.width=Math.max(this.width,e.x+e.width),this.height=Math.max(this.height,e.height),this.elements.push(e),this.alignment=e.style.__getProperty("alignment")},addElementImage:function(e){this.width=Math.max(this.width,e.x+e.width),this.height=Math.max(this.height,e.height),this.elements.push(e)},getHeight:function(){return this.height},setY:function(e){this.y=e},getY:function(){return this.y},paint:function(e){e.save(),e.translate(this.x,this.y+this.baselinePos);for(var t=0;t<this.elements.length;t++)this.elements[t].paint(e);e.restore()},setAlignment:function(e){var n;if(this.alignment==="center")this.x=(e-this.width)/2;else if(this.alignment==="right")this.x=e-this.width;else if(this.alignment==="justify"&&this.width/e>=t&&this.elements.length>1){var r=e-this.width,i=r/(this.elements.length-1)|0;for(n=1;n<this.elements.length;n++)this.elements[n].x+=n*i;r=e-this.width-i*(this.elements.length-1);for(n=0;n<r;n++)this.elements[this.elements.length-1-n].x+=r-n}},adjustHeight:function(){var e=null,t=null,n;for(n=0;n<this.elements.length;n+=1){var r=this.elements[n],i=r.getFontMetrics();null!=i?e?i.ascent>e.ascent&&(e=i):e=i:t?r.getHeight()>r.getHeight()&&(t=r):t=r}this.baselinePos=Math.max(e?e.ascent:this.defaultFontMetrics.ascent,t?t.getHeight():this.defaultFontMetrics.ascent),this.height=this.baselinePos+(e!=null?e.descent:this.defaultFontMetrics.descent);for(n=0;n<this.elements.length;n++)this.elements[n].setYPosition(this.baselinePos);return this.height},__getElementAt:function(e,t){for(var n=0;n<this.elements.length;n++){var r=this.elements[n];if(r.contains(e,t))return r}return null}},{__init:function(){return this.__super(),this.rc=new r,this.lines=[],this.styles={},this.images={},this},halignment:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT,valignment:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP,text:null,rc:null,styles:null,documentWidth:0,documentHeight:0,documentX:0,documentY:0,reflow:!0,lines:null,images:null,clickCallback:null,setStyle:function(e,t){return this.styles[e]=t,this},addImage:function(e,t){return this.images[e]=t,this},setSize:function(e,t){return CAAT.Foundation.UI.Label.superclass.setSize.call(this,e,t),this.setText(this.text,this.width),this},setBounds:function(e,t,n,r){return CAAT.Foundation.UI.Label.superclass.setBounds.call(this,e,t,n,r),this.setText(this.text,this.width),this},setText:function(e,t){if(null===e)return;var n=this.cached;n&&this.stopCacheAsBitmap(),this.documentWidth=0,this.documentHeight=0,this.text=e;var r,i,s,o,u,a,f=CAAT.currentDirector.ctx;f.save(),s=this.text,r=0,i=s.length,this.rc.start(f,this.styles,this.images,t);while(r<i)a=s.charAt(r),a==="\\"?(r+=1,this.rc.fchar(s.charAt(r)),r+=1):a==="<"?(o=s.indexOf(">",r+1),-1!==o&&(u=s.substr(r+1,o-r-1),u.indexOf("<")!==-1?(this.rc.fchar(a),r+=1):(this.rc.setTag(u),r=o+1))):(this.rc.fchar(a),r+=1);return this.rc.end(),this.lines=this.rc.lines,this.__calculateDocumentDimension(typeof t=="undefined"?0:t),this.setLinesAlignment(),f.restore(),this.setPreferredSize(this.documentWidth,this.documentHeight),this.invalidateLayout(),this.setDocumentPosition(),n&&this.cacheAsBitmap(0,n),this},setVerticalAlignment:function(e){return this.valignment=e,this.setDocumentPosition(),this},setHorizontalAlignment:function(e){return this.halignment=e,this.setDocumentPosition(),this},setDocumentPosition:function(){var e=0,t=0;this.valignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER?t=(this.height-this.documentHeight)/2:this.valignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM&&(t=this.height-this.documentHeight),this.halignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER?e=(this.width-this.documentWidth)/2:this.halignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT&&(e=this.width-this.documentWidth),this.documentX=e,this.documentY=t},__calculateDocumentDimension:function(e){var t,n=0;this.documentWidth=0,this.documentHeight=0;for(t=0;t<this.lines.length;t++)this.lines[t].y=n,this.documentWidth=Math.max(this.documentWidth,this.lines[t].width),this.documentHeight+=this.lines[t].adjustHeight(),n+=this.lines[t].getHeight();return this.documentWidth=Math.max(this.documentWidth,e),this},setLinesAlignment:function(){for(var e=0;e<this.lines.length;e++)this.lines[e].setAlignment(this.documentWidth)},paint:function(t,n){if(this.cached===CAAT.Foundation.Actor.CACHE_NONE){var r=t.ctx;r.save(),r.textBaseline="alphabetic",r.translate(this.documentX,this.documentY);for(var i=0;i<this.lines.length;i++){var s=this.lines[i];s.paint(t.ctx),e&&r.strokeRect(s.x,s.y,s.width,s.height)}r.restore()}else this.backgroundImage&&this.backgroundImage.paint(t,n,0,0)},__getDocumentElementAt:function(e,t){e-=this.documentX,t-=this.documentY;for(var n=0;n<this.lines.length;n++){var r=this.lines[n];if(r.x<=e&&r.y<=t&&r.x+r.width>=e&&r.y+r.height>=t)return r.__getElementAt(e-r.x,t-r.y)}return null},mouseExit:function(e){CAAT.setCursor("default")},mouseMove:function(e){var t=this.__getDocumentElementAt(e.x,e.y);t&&t.getLink()?CAAT.setCursor("pointer"):CAAT.setCursor("default")},mouseClick:function(e){if(this.clickCallback){var t=this.__getDocumentElementAt(e.x,e.y);t.getLink()&&this.clickCallback(t.getLink())}},setClickCallback:function(e){return this.clickCallback=e,this}}}}),CAAT.Module({defines:"CAAT.Foundation.UI.PathActor",aliases:["CAAT.PathActor"],depends:["CAAT.Foundation.Actor"],extendsClass:"CAAT.Foundation.Actor",extendsWith:{path:null,pathBoundingRectangle:null,bOutline:!1,outlineColor:"black",onUpdateCallback:null,interactive:!1,getPath:function(){return this.path},setPath:function(e){return this.path=e,e!=null&&(this.pathBoundingRectangle=e.getBoundingBox(),this.setInteractive(this.interactive)),this},paint:function(e,t){CAAT.Foundation.UI.PathActor.superclass.paint.call(this,e,t);if(!this.path)return;var n=e.ctx;n.strokeStyle="#000",this.path.paint(e,this.interactive),this.bOutline&&(n.strokeStyle=this.outlineColor,n.strokeRect(this.pathBoundingRectangle.x,this.pathBoundingRectangle.y,this.pathBoundingRectangle.width,this.pathBoundingRectangle.height))},showBoundingBox:function(e,t){return this.bOutline=e,e&&t&&(this.outlineColor=t),this},setInteractive:function(e){return this.interactive=e,this.path&&this.path.setInteractive(e),this},setOnUpdateCallback:function(e){return this.onUpdateCallback=e,this},mouseDrag:function(e){this.path.drag(e.point.x,e.point.y,this.onUpdateCallback)},mouseDown:function(e){this.path.press(e.point.x,e.point.y)},mouseUp:function(e){this.path.release()}}}),CAAT.Module({defines:"CAAT.Foundation.UI.ShapeActor",aliases:["CAAT.ShapeActor"],extendsClass:"CAAT.Foundation.ActorContainer",depends:["CAAT.Foundation.ActorContainer"],constants:{SHAPE_CIRCLE:0,SHAPE_RECTANGLE:1},extendsWith:{__init:function(){return this.__super(),this.compositeOp="source-over",this.setShape(CAAT.Foundation.UI.ShapeActor.SHAPE_CIRCLE),this},shape:0,compositeOp:null,lineWidth:1,lineCap:null,lineJoin:null,miterLimit:null,setLineWidth:function(e){return this.lineWidth=e,this},setLineCap:function(e){return this.lineCap=e,this},setLineJoin:function(e){return this.lineJoin=e,this},setMiterLimit:function(e){return this.miterLimit=e,this},getLineCap:function(){return this.lineCap},getLineJoin:function(){return this.lineJoin},getMiterLimit:function(){return this.miterLimit},getLineWidth:function(){return this.lineWidth},setShape:function(e){return this.shape=e,this.paint=this.shape===CAAT.Foundation.UI.ShapeActor.SHAPE_CIRCLE?this.paintCircle:this.paintRectangle,this},setCompositeOp:function(e){return this.compositeOp=e,this},paint:function(e,t){},paintCircle:function(e,t){if(this.cached){CAAT.Foundation.ActorContainer.prototype.paint.call(this,e,t);return}var n=e.ctx;n.lineWidth=this.lineWidth,n.globalCompositeOperation=this.compositeOp,null!==this.fillStyle&&(n.fillStyle=this.fillStyle,n.beginPath(),n.arc(this.width/2,this.height/2,Math.min(this.width,this.height)/2-this.lineWidth/2,0,2*Math.PI,!1),n.fill()),null!==this.strokeStyle&&(n.strokeStyle=this.strokeStyle,n.beginPath(),n.arc(this.width/2,this.height/2,Math.min(this.width,this.height)/2-this.lineWidth/2,0,2*Math.PI,!1),n.stroke())},paintRectangle:function(e,t){if(this.cached){CAAT.Foundation.ActorContainer.prototype.paint.call(this,e,t);return}var n=e.ctx;n.lineWidth=this.lineWidth,this.lineCap&&(n.lineCap=this.lineCap),this.lineJoin&&(n.lineJoin=this.lineJoin),this.miterLimit&&(n.miterLimit=this.miterLimit),n.globalCompositeOperation=this.compositeOp,null!==this.fillStyle&&(n.fillStyle=this.fillStyle,n.beginPath(),n.fillRect(0,0,this.width,this.height),n.fill()),null!==this.strokeStyle&&(n.strokeStyle=this.strokeStyle,n.beginPath(),n.strokeRect(0,0,this.width,this.height),n.stroke())}}}),CAAT.Module({defines:"CAAT.Foundation.UI.StarActor",aliases:["CAAT.StarActor"],depends:["CAAT.Foundation.ActorContainer"],extendsClass:"CAAT.Foundation.ActorContainer",extendsWith:{__init:function(){return this.__super(),this.compositeOp="source-over",this},nPeaks:0,maxRadius:0,minRadius:0,initialAngle:0,compositeOp:null,lineWidth:1,lineCap:null,lineJoin:null,miterLimit:null,setLineWidth:function(e){return this.lineWidth=e,this},setLineCap:function(e){return this.lineCap=e,this},setLineJoin:function(e){return this.lineJoin=e,this},setMiterLimit:function(e){return this.miterLimit=e,this},getLineCap:function(){return this.lineCap},getLineJoin:function(){return this.lineJoin},getMiterLimit:function(){return this.miterLimit},getLineWidth:function(){return this.lineWidth},setFilled:function(e){return this},setOutlined:function(e){return this},setCompositeOp:function(e){return this.compositeOp=e,this},setInitialAngle:function(e){return this.initialAngle=e,this},initialize:function(e,t,n){return this.setSize(2*t,2*t),this.nPeaks=e,this.maxRadius=t,this.minRadius=n,this},paint:function(e,t){var n=e.ctx,r=this.width/2,i=this.height/2,s=this.maxRadius,o=this.minRadius,u=r+s*Math.cos(this.initialAngle),a=i+s*Math.sin(this.initialAngle);n.lineWidth=this.lineWidth,this.lineCap&&(n.lineCap=this.lineCap),this.lineJoin&&(n.lineJoin=this.lineJoin),this.miterLimit&&(n.miterLimit=this.miterLimit),n.globalCompositeOperation=this.compositeOp,n.beginPath(),n.moveTo(u,a);for(var f=1;f<this.nPeaks*2;f++){var l=Math.PI/this.nPeaks*f+this.initialAngle,c=f%2===0?s:o,h=r+c*Math.cos(l),p=i+c*Math.sin(l);n.lineTo(h,p)}n.lineTo(r+s*Math.cos(this.initialAngle),i+s*Math.sin(this.initialAngle)),n.closePath(),this.fillStyle&&(n.fillStyle=this.fillStyle,n.fill()),this.strokeStyle&&(n.strokeStyle=this.strokeStyle,n.stroke())}}}),CAAT.Module({defines:"CAAT.Foundation.UI.TextActor",aliases:["CAAT.TextActor"],extendsClass:"CAAT.Foundation.Actor",constants:{TRAVERSE_PATH_FORWARD:1,TRAVERSE_PATH_BACKWARD:-1},depends:["CAAT.Foundation.Actor","CAAT.Foundation.SpriteImage","CAAT.Module.Font.Font","CAAT.Math.Point","CAAT.Behavior.Interpolator"],extendsWith:{__init:function(){return this.__super(),this.font="10px sans-serif",this.textAlign="left",this.outlineColor="black",this.clip=!1,this.__calcFontData(),this},font:null,fontData:null,textAlign:null,textBaseline:"top",fill:!0,textFillStyle:"#eee",text:null,textWidth:0,textHeight:0,outline:!1,outlineColor:null,lineWidth:1,path:null,pathInterpolator:null,pathDuration:1e4,sign:1,lx:0,ly:0,setFill:function(e){return this.stopCacheAsBitmap(),this.fill=e,this},setLineWidth:function(e){return this.stopCacheAsBitmap(),this.lineWidth=e,this},setTextFillStyle:function(e){return this.stopCacheAsBitmap(),this.textFillStyle=e,this},setOutline:function(e){return this.stopCacheAsBitmap(),this.outline=e,this},setPathTraverseDirection:function(e){return this.sign=e,this},setOutlineColor:function(e){return this.stopCacheAsBitmap(),this.outlineColor=e,this},setText:function(e){this.stopCacheAsBitmap(),this.text=e;if(null===this.text||this.text==="")this.width=this.height=0;return this.calcTextSize(CAAT.currentDirector),this.invalidate(),this},setTextAlign:function(e){return this.textAlign=e,this.__setLocation(),this},setAlign:function(e){return this.setTextAlign(e)},setTextBaseline:function(e){return this.stopCacheAsBitmap(),this.textBaseline=e,this},setBaseline:function(e){return this.stopCacheAsBitmap(),this.setTextBaseline(e)},setFont:function(e){return this.stopCacheAsBitmap(),e||(e="10px sans-serif"),e instanceof CAAT.Module.Font.Font?e.setAsSpriteImage():e instanceof CAAT.Foundation.SpriteImage,this.font=e,this.__calcFontData(),this.calcTextSize(CAAT.director[0]),this},setLocation:function(e,t){return this.lx=e,this.ly=t,this.__setLocation(),this},setPosition:function(e,t){return this.lx=e,this.ly=t,this.__setLocation(),this},setBounds:function(e,t,n,r){return this.lx=e,this.ly=t,this.setSize(n,r),this.__setLocation(),this},setSize:function(e,t){return CAAT.Foundation.UI.TextActor.superclass.setSize.call(this,e,t),this.__setLocation(),this},__setLocation:function(){var e,t;this.textAlign==="center"?e=this.lx-this.width/2:this.textAlign==="right"||this.textAlign==="end"?e=this.lx-this.width:e=this.lx,this.textBaseline==="bottom"?t=this.ly-this.height:this.textBaseline==="middle"?t=this.ly-this.height/2:this.textBaseline==="alphabetic"?t=this.ly-this.fontData.ascent:t=this.ly,CAAT.Foundation.UI.TextActor.superclass.setLocation.call(this,e,t)},centerAt:function(e,t){return this.textAlign="left",this.textBaseline="top",CAAT.Foundation.UI.TextActor.superclass.centerAt.call(this,e,t)},calcTextSize:function(e){if(typeof this.text=="undefined"||null===this.text||""===this.text)return this.textWidth=0,this.textHeight=0,this;if(e.glEnabled)return this;if(this.font instanceof CAAT.Foundation.SpriteImage)return this.textWidth=this.font.stringWidth(this.text),this.textHeight=this.font.stringHeight(),this.width=this.textWidth,this.height=this.textHeight,this.fontData=this.font.getFontData(),this;if(this.font instanceof CAAT.Module.Font.Font)return this.textWidth=this.font.stringWidth(this.text),this.textHeight=this.font.stringHeight(),this.width=this.textWidth,this.height=this.textHeight,this.fontData=this.font.getFontData(),this;var t=e.ctx;return t.save(),t.font=this.font,this.textWidth=t.measureText(this.text).width,this.width===0&&(this.width=this.textWidth),this.textHeight=this.fontData.height,this.setSize(this.textWidth,this.textHeight),t.restore(),this},__calcFontData:function(){this.fontData=CAAT.Module.Font.Font.getFontMetrics(this.font)},paint:function(e,t){if(!this.text)return;CAAT.Foundation.UI.TextActor.superclass.paint.call(this,e,t);if(this.cached)return;if(null===this.text)return;(this.textWidth===0||this.textHeight===0)&&this.calcTextSize(e);var n=e.ctx;if(this.font instanceof CAAT.Module.Font.Font||this.font instanceof CAAT.Foundation.SpriteImage){this.drawSpriteText(e,t);return}null!==this.font&&(n.font=this.font),n.textBaseline="alphabetic";if(null===this.path){null!==this.textAlign&&(n.textAlign=this.textAlign);var r=0;this.textAlign==="center"?r=this.width/2|0:this.textAlign==="right"&&(r=this.width),this.fill&&(null!==this.textFillStyle&&(n.fillStyle=this.textFillStyle),n.fillText(this.text,r,this.fontData.ascent)),this.outline&&(null!==this.outlineColor&&(n.strokeStyle=this.outlineColor),n.lineWidth=this.lineWidth,n.beginPath(),n.strokeText(this.text,r,this.fontData.ascent))}else this.drawOnPath(e,t)},drawOnPath:function(e,t){var n=e.ctx;this.fill&&null!==this.textFillStyle&&(n.fillStyle=this.textFillStyle),this.outline&&null!==this.outlineColor&&(n.strokeStyle=this.outlineColor);var r=this.sign*this.pathInterpolator.getPosition(t%this.pathDuration/this.pathDuration).y*this.path.getLength(),i=new CAAT.Math.Point(0,0,0),s=new CAAT.Math.Point(0,0,0);for(var o=0;o<this.text.length;o++){var u=this.text[o].toString(),a=n.measureText(u).width,f=r;i=this.path.getPositionFromLength(f).clone(),s=this.path.getPositionFromLength(f-.1).clone();var l=Math.atan2(i.y-s.y,i.x-s.x);n.save(),CAAT.CLAMP?n.translate(i.x>>0,i.y>>0):n.translate(i.x,i.y),n.rotate(l),this.fill&&n.fillText(u,0,0),this.outline&&(n.beginPath(),n.lineWidth=this.lineWidth,n.strokeText(u,0,0)),n.restore(),r+=a}},drawSpriteText:function(e,t){null===this.path?this.font.drawText(this.text,e.ctx,0,0):this.drawSpriteTextOnPath(e,t)},drawSpriteTextOnPath:function(e,t){var n=e.ctx,r=this.sign*this.pathInterpolator.getPosition(t%this.pathDuration/this.pathDuration).y*this.path.getLength(),i=new CAAT.Math.Point(0,0,0),s=new CAAT.Math.Point(0,0,0);for(var o=0;o<this.text.length;o++){var u=this.text[o].toString(),a=this.font.stringWidth(u),f=a/2+r;i=this.path.getPositionFromLength(f).clone(),s=this.path.getPositionFromLength(f-.1).clone();var l=Math.atan2(i.y-s.y,i.x-s.x);n.save(),CAAT.CLAMP?n.translate(i.x|0,i.y|0):n.translate(i.x,i.y),n.rotate(l);var c=this.textBaseline==="bottom"?0-this.font.getHeight():0;this.font.drawText(u,n,0,c),n.restore(),r+=a}},setPath:function(e,t,n){return this.path=e,this.pathInterpolator=t||(new CAAT.Behavior.Interpolator).createLinearInterpolator(),this.pathDuration=n||1e4,this.mouseEnabled=!1,this}}}),CAAT.ModuleManager.solveAll(),define("sge/vendor/caat",function(e){return function(){var t,n;return t||e.CAAT}}(this)),define("sge/lib/class",[],function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;return this.Class=function(){},Class.extend=function(n){function o(){!e&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;e=!0;var i=new this;e=!1;for(var s in n)i[s]=typeof n[s]=="function"&&typeof r[s]=="function"&&t.test(n[s])?function(e,t){return function(){var n=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=n,i}}(s,n[s]):n[s];return o.prototype=i,o.prototype.constructor=o,o.extend=arguments.callee,o},Class}),define("sge/renderer",["jquery","sge/vendor/caat","sge/lib/class"],function(e,t,n){var r={SPRITESHEETS:{}};return r}),define("sge/engine",["sge/lib/class"],function(e){var t=e.extend({init:function(){this.interval=null,this.entities={},this._ids=[],this._lastTick=0,this._debug=0,this._debugTick=!1},run:function(e){e==undefined&&(e=30),this._lastTick=Date.now(),this.interval=setInterval(this.tickCallback.bind(this),1e3/e)},stop:function(){clearInterval(this.interval),this.interval=null},tickCallback:function(){var e=Date.now(),t=e-this._lastTick;this._lastTick=e,this.tick(t/1e3)}});return t}),define("sge/observable",["sge/lib/class"],function(e){var t=e.extend({init:function(){this._listeners={}},addListener:function(e,t){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)},fireEvent:function(){args=Array.prototype.slice.call(arguments),event=args.shift(),typeof event=="string"&&(event={type:event}),event.target||(event.target=this);if(!event.type)throw new Error("Event object missing 'type' property.");if(this._listeners[event.type]){var e=this._listeners[event.type].slice(0);for(var t=0,n=e.length;t<n;t++)try{e[t].apply(this,args)}catch(r){console.log("SandboxObservableError: "+r),console.log(r.stack),console.trace()}}},removeListener:function(e,t){if(this._listeners[e]instanceof Array){var n=this._listeners[e];for(var r=0,i=n.length;r<i;r++)if(n[r]===t){var s=n.splice(r,1);break}}}});return t}),define("sge/component",["sge/lib/class"],function(e){var t={},n=e.extend({init:function(e,t){this.entity=e,this.data={},this._listeners={}},get:function(e){var t=null;return this["_get_"+e]!==undefined?t=this["_get_"+e]():t=this.data[e],t},set:function(e,t,n){var r=null;return this["_set_"+e]!==undefined?r=this["_set_"+e](t,n):r=this.__set_value(e,t,n),r},__set_value:function(e,t,n){switch(n){case"add":var r=this.get(e);newValue=this.data[e]=r+t;break;case"subtract":var r=this.get(e);newValue=this.data[e]=r-t;break;case"set":default:newValue=this.data[e]=t}return newValue},render:function(){},tick:function(){},register:function(e){this.state=e},deregister:function(e){this.state=null},createInputListener:function(e,t){this._listeners[t]=t.bind(this)}});return n.register=function(e,n){t[e]=n},n.Factory=function(e,n,r){return new t[e](n,r)},n}),define("sge/spritesheet",[],function(){var e=function(t,n,r){r===undefined&&(r=n),this.ready=!1,this.spriteWidth=n,this.spriteHeight=r,this.offsetX=this.spriteWidth/-2,this.offsetY=this.spriteHeight/-2,e.SpriteSheetImages[t]===undefined?(this.image=new Image,this.buffer=this.image,this.image.onload=this.onLoadImage.bind(this),this.image.src=t,e.SpriteSheetImages[t]=this.image):(this.image=e.SpriteSheetImages[t],this.buffer=this.image,this.onLoadImage())};return e.SpriteSheetImages={},e.prototype.onLoadImage=function(){this.imageWidth=this.image.width,this.imageHeight=this.image.height,this.horzSprites=this.imageWidth/this.spriteWidth,this.vertSprites=this.imageHeight/this.spriteHeight,this._image_tint=document.createElement("canvas"),this._image_tint.width=this.image.width,this._image_tint.height=this.image.height,this._image_buffer=document.createElement("canvas"),this._image_buffer.width=this.image.width,this._image_buffer.height=this.image.height,this.buffer=this.image,this.ready=!0},e.prototype.getSrcRect=function(e){var t=null,n=null;e[0]!=undefined?(t=e[0],n=e[1]):(t=e%this.horzSprites,n=Math.floor(e/this.horzSprites));var r=t*this.spriteWidth,i=n*this.spriteHeight;return[r,i,this.spriteWidth,this.spriteHeight]},e.prototype.tint=function(e){e===undefined?this.buffer=this.image:(ctx=this._image_tint.getContext("2d"),ctx.fillStyle=e,ctx.fillRect(0,0,this._image_tint.width,this._image_tint.height),ctx.globalCompositeOperation="destination-atop",ctx.drawImage(this.image,0,0),ctx=this._image_buffer.getContext("2d"),ctx.drawImage(this.image,0,0),this.tint_alpha>0&&(ctx.globalAlpha=this.tint_alpha,ctx.drawImage(this._image_tint,0,0),ctx.globalAlpha=1),this.buffer=this._image_tint)},e}),define("sge/components/sprite",["sge/component","sge/spritesheet","sge/config","sge/renderer"],function(e,t,n,r){var i=e.extend({init:function(e,t){this._super(e,t),this.data.frame=t.frame||0,this.data.scale=t.scale||1,this.data.mirror=!0,this.data.offsetX=t.offsetX||0,this.data.offsetY=t.offsetY||0;var n=t.src.split("/"),i=n[n.length-1].split(".")[0];this.spriteSheet=r.SPRITESHEETS[i],this.tintCallback=function(e,t){this.setBackground(i+"_tint_red");var n=this.entity.state.createTimeout(t,function(){this.setBackground(i)}.bind(this))}.bind(this),this.entity.addListener("tint",this.tintCallback)},setBackground:function(e){var t=r.SPRITESHEETS[e];this.actor.setBackgroundImage(t)},register:function(e){this._super(e),this.actor=(new CAAT.Actor).setLocation(this.get("offsetX"),this.get("offsetY")).setBackgroundImage(this.spriteSheet).setSpriteIndex(0),this.entity.get("xform.container").addChild(this.actor)},deregister:function(e){this.entity.get("xform.container").removeChild(this.actor),this._super(e)},render:function(e,t){this.actor.setSpriteIndex(this.get("frame"))}});return e.register("sprite",i),i}),define("sge/components/anim",["sge/component"],function(e){var t=e.extend({init:function(e,t){this._super(e,t),this.data.play=!1,this.frame=0;var n=Object.keys(t.frames);this.animData={};for(var r=n.length-1;r>=0;r--){var i=n[r],s=t.frames[i];s.frames===undefined&&(s={frames:s}),this.animData[i]=s}this.current=null,this.currentAnim=null,this.frameLength=null,this.setAnim("walk_right")},tick:function(){this.data.play&&(this.frame++,this.frame>=this.frameLength&&(this.frame=0),this.entity.set("sprite.frame",this.currentAnim[this.frame]))},_set_anim:function(e){e!=this.current&&this.setAnim(e)},setAnim:function(e){this.current=e;var t=this.animData[e].mirror===!0;this.entity.set("sprite.mirror",t),this.currentAnim=this.animData[e].frames,this.frameLength=this.currentAnim.length,this.data.anim=e}});return e.register("anim",t),t}),define("sge/components/xform",["sge/component"],function(e){var t=e.extend({init:function(e,t){this._super(e,t),this.data.tx=t.tx||0,this.data.ty=t.ty||0,this.data.vx=t.vx||0,this.data.vy=t.vy||0,this.data.container=t.container||"scene",this.data.dir=t.dir||"down",this.container=new CAAT.ActorContainer},_get_container:function(){return this.container},_set_tx:function(e,t){return this.data.tx=this.__set_value("tx",e,t),this.entity.fireEvent("xform.move"),this.data.tx},_set_ty:function(e,t){return this.data.ty=this.__set_value("ty",e,t),this.entity.fireEvent("xform.move"),this.data.ty},register:function(e){this._super(e);var t=this.data.container;this.scene=this.state[t],this.scene.addChild(this.container)},deregister:function(e){this.scene.removeChild(this.container),this._super(e)},render:function(e,t){var n=this.entity.get("xform.tx"),r=this.entity.get("xform.ty");this.container.setLocation(n,r)}});return e.register("xform",t),t}),define("sge/components/movement",["sge/component"],function(e){var t=e.extend({init:function(e,t){this._super(e,t),this.data.speed=8,this.data.width=t.width||640,this.data.height=t.height||480,this.data.map=t.map||null,this._isKeyDown={}},tick:function(e){var t=this.entity.get("xform.vx")*e,n=this.entity.get("xform.vy")*e;Math.abs(t)>0||Math.abs(n)>0?(this.entity.set("anim.play",!0),Math.abs(t)>Math.abs(n)?t>0?(this.entity.set("anim.anim","walk_right"),this.entity.set("xform.dir","right")):(this.entity.set("anim.anim","walk_left"),this.entity.set("xform.dir","left")):n<0?(this.entity.set("anim.anim","walk_up"),this.entity.set("xform.dir","up")):(this.entity.set("anim.anim","walk_down"),this.entity.set("xform.dir","down"))):this.entity.set("anim.play",!1)}});return e.register("movement",t),t}),define("sge/components/controls",["sge/component"],function(e){var t=e.extend({init:function(e,t){this._super(e,t),this.data.speed=128},register:function(e){this.input=e.input},deregister:function(e){this.input=undefined},tick:function(){if(this.input===undefined)return;var e=0,t=0;(this.input.isPressed("down")||this.input.isPressed("S")||this.input.joystick.down())&&t++,(this.input.isPressed("up")||this.input.isPressed("W")||this.input.joystick.up())&&t--,(this.input.isPressed("right")||this.input.isPressed("D")||this.input.joystick.right())&&e++,(this.input.isPressed("left")||this.input.isPressed("A")||this.input.joystick.left())&&e--,this.entity.set("xform.vx",e*this.data.speed),this.entity.set("xform.vy",t*this.data.speed)}});return e.register("controls",t),t}),define("sge/components/debug",["sge/component"],function(e){var t=e.extend({init:function(e,t){this._super(e,t),this.data.fillStyle="yellow",this.data.strokeStyle="black",this.entity.addListener("contact.start",function(){this.data.fillStyle="red"}.bind(this)),this.entity.addListener("contact.end",function(){this.data.fillStyle="yellow"}.bind(this))},render:function(e,t){var n=this.entity.get("xform.tx"),r=this.entity.get("xform.ty"),i=this.entity.get("physics.width"),s=this.entity.get("physics.height")}});return e.register("debug",t),t}),define("sge/components/eventmgr",["sge/component"],function(e){var t=e.extend({init:function(e,t){this._super(e,t);var n=Object.keys(t.callbacks);for(var r=n.length-1;r>=0;r--){var i=n[r];this.entity.addListener(i,t.callbacks[i])}}});return e.register("eventmgr",t),t}),define("sge/entity",["sge/lib/class","sge/observable","sge/component","sge/components/sprite","sge/components/anim","sge/components/xform","sge/components/movement","sge/components/controls","sge/components/debug","sge/components/eventmgr"],function(e,t,n){var r=t.extend({init:function(e){this._super(),this.id=null,this.components={},this.tags=[];var t=Object.keys(e);t.reverse();for(var r=t.length-1;r>=0;r--){var i=t[r],s=n.Factory(i,this,e[i]);this.components[i]=s}},componentCall:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),n=Object.keys(this.components);for(var r=n.length-1;r>=0;r--){var i=this.components[n[r]];i[t].apply(i,e)}},get:function(e){var t=e.split("."),n=t.shift(),r=this.components[n];return t.length?r.get(t.join(".")):r},set:function(e,t,n){var r=e.split("."),i=r.shift(),s=this.components[i];return s.set(r.join("."),t,n)},hasTag:function(e){return this.tags.indexOf(e)>=0},register:function(e){this.componentCall("register",e)},deregister:function(e){this.componentCall("deregister",e)}});return r}),function(e){var t={VERSION:"2.2.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(e,n){var r=typeof e.initial=="string"?{state:e.initial}:e.initial,i=e.terminal||e["final"],s=n||e.target||{},o=e.events||[],u=e.callbacks||{},a={},f=function(e){var n=e.from instanceof Array?e.from:e.from?[e.from]:[t.WILDCARD];a[e.name]=a[e.name]||{};for(var r=0;r<n.length;r++)a[e.name][n[r]]=e.to||n[r]};r&&(r.event=r.event||"startup",f({name:r.event,from:"none",to:r.state}));for(var l=0;l<o.length;l++)f(o[l]);for(var c in a)a.hasOwnProperty(c)&&(s[c]=t.buildEvent(c,a[c]));for(var c in u)u.hasOwnProperty(c)&&(s[c]=u[c]);return s.current="none",s.is=function(e){return e instanceof Array?e.indexOf(this.current)>=0:this.current===e},s.can=function(e){return!this.transition&&(a[e].hasOwnProperty(this.current)||a[e].hasOwnProperty(t.WILDCARD))},s.cannot=function(e){return!this.can(e)},s.error=e.error||function(e,t,n,r,i,s,o){throw o||s},s.isFinished=function(){return this.is(i)},r&&!r.defer&&s[r.event](),s},doCallback:function(e,n,r,i,s,o){if(n)try{return n.apply(e,[r,i,s].concat(o))}catch(u){return e.error(r,i,s,o,t.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",u)}},beforeAnyEvent:function(e,n,r,i,s){return t.doCallback(e,e.onbeforeevent,n,r,i,s)},afterAnyEvent:function(e,n,r,i,s){return t.doCallback(e,e.onafterevent||e.onevent,n,r,i,s)},leaveAnyState:function(e,n,r,i,s){return t.doCallback(e,e.onleavestate,n,r,i,s)},enterAnyState:function(e,n,r,i,s){return t.doCallback(e,e.onenterstate||e.onstate,n,r,i,s)},changeState:function(e,n,r,i,s){return t.doCallback(e,e.onchangestate,n,r,i,s)},beforeThisEvent:function(e,n,r,i,s){return t.doCallback(e,e["onbefore"+n],n,r,i,s)},afterThisEvent:function(e,n,r,i,s){return t.doCallback(e,e["onafter"+n]||e["on"+n],n,r,i,s)},leaveThisState:function(e,n,r,i,s){return t.doCallback(e,e["onleave"+r],n,r,i,s)},enterThisState:function(e,n,r,i,s){return t.doCallback(e,e["onenter"+i]||e["on"+i],n,r,i,s)},beforeEvent:function(e,n,r,i,s){if(!1===t.beforeThisEvent(e,n,r,i,s)||!1===t.beforeAnyEvent(e,n,r,i,s))return!1},afterEvent:function(e,n,r,i,s){t.afterThisEvent(e,n,r,i,s),t.afterAnyEvent(e,n,r,i,s)},leaveState:function(e,n,r,i,s){var o=t.leaveThisState(e,n,r,i,s),u=t.leaveAnyState(e,n,r,i,s);if(!1===o||!1===u)return!1;if(t.ASYNC===o||t.ASYNC===u)return t.ASYNC},enterState:function(e,n,r,i,s){t.enterThisState(e,n,r,i,s),t.enterAnyState(e,n,r,i,s)},buildEvent:function(e,n){return function(){var r=this.current,i=n[r]||n[t.WILDCARD]||r,s=Array.prototype.slice.call(arguments);if(this.transition)return this.error(e,r,i,s,t.Error.PENDING_TRANSITION,"event "+e+" inappropriate because previous transition did not complete");if(this.cannot(e))return this.error(e,r,i,s,t.Error.INVALID_TRANSITION,"event "+e+" inappropriate in current state "+this.current);if(!1===t.beforeEvent(this,e,r,i,s))return t.Result.CANCELLED;if(r===i)return t.afterEvent(this,e,r,i,s),t.Result.NOTRANSITION;var o=this;this.transition=function(){return o.transition=null,o.current=i,t.enterState(o,e,r,i,s),t.changeState(o,e,r,i,s),t.afterEvent(o,e,r,i,s),t.Result.SUCCEEDED},this.transition.cancel=function(){o.transition=null,t.afterEvent(o,e,r,i,s)};var u=t.leaveState(this,e,r,i,s);if(!1===u)return this.transition=null,t.Result.CANCELLED;if(t.ASYNC===u)return t.Result.PENDING;if(this.transition)return this.transition()}}};"function"==typeof define?define("sge/vendor/state-machine",["require"],function(e){return t}):e.StateMachine=t}(this),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?void 0:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t==null?x.identity:t);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);if(t.length===0)throw new Error("bindAll must be passed function names");return T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,f<=0?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]===void 0&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=M(e[o],t[o],n,r)))break}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)){o++;if(!(u=x.has(t,c)&&M(e[c],t[c],n,r)))break}if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(e);for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=x.invert(_.escape);var D={escape:new RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(e==null)return void 0;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=++P+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(j,function(e){return"\\"+B[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("sge/vendor/underscore",function(e){return function(){var t,n;return t||e._}}(this)),define("sge/gamestate",["sge/lib/class","sge/vendor/underscore"],function(e,t,n){var r=e.extend({init:function(e,t){this._length=e,this.callback=t},tick:function(e){return this._length=this._length-e,this._length<=0?(this.callback(),!1):!0}}),i=e.extend({init:function(e,t,n){this.game=e,this._keepScene=!1,this._sceneIndex=e.renderer.scenes.length;var r=e.renderer.createScene();this.scene=new CAAT.ActorContainer,r.addChild(this.scene),this.scene.setBounds(0,0,e.renderer.width,e.renderer.height),this.input=e.input.createProxy(),this.entities={},this._name=t,this._entity_ids=[],this.initState(n),this._timeouts=[]},createTimeout:function(e,t){var n=new r(e,t);this._timeouts.push(n)},tickTimeouts:function(e){this._timeouts=t.filter(this._timeouts,function(t){return t.tick(e)})},initState:function(){},startState:function(){this.input.enable=!0,this._keepScene||this.game.renderer.setScene(this._sceneIndex)},endState:function(){this.input.enable=!1},destroyState:function(){},tick:function(){t.each(this._entity_ids,function(e){var t=this.entities[e];t.componentCall("tick")}.bind(this)),t.each(this._entity_ids,function(e){var t=this.entities[e];t.componentCall("render",this.game.renderer,"main")}.bind(this))},getNextId:function(){var e=0;while(this._entity_ids.indexOf(e)>-1)e++;return e},addEntity:function(e){var t=this.getNextId();return e.id=t,this._entity_ids.push(t),this.entities[t]=e,e.state=this,e.register(this),e},getEntity:function(e){return this.entities[e]},getEntities:function(){var e=[];return t.each(this._entity_ids,function(t){e.push(this.entities[t])}.bind(this)),e},getEntitiesWithTag:function(e){return t.filter(this.getEntities(),function(n){return t.include(n.tags,e)})},getEntityWithTag:function(e){return t.filter(this.getEntities(),function(n){return t.include(n.tags,e)})[0]},getEntitiesWithComponent:function(e){return t.filter(this.getEntities(),function(t){return t.components[e]!==undefined})},removeEntity:function(e){var n=e.id;return this._entity_ids=t.without(this._entity_ids,n),this.entities[n]=undefined,e.deregister(),e.id=null,e.state=null,e}});return i}),function(e,t){function r(){if(n.READY)return;n.event.determineEventTypes();for(var e in n.gestures)n.gestures.hasOwnProperty(e)&&n.detection.register(n.gestures[e]);n.event.onTouch(n.DOCUMENT,n.EVENT_MOVE,n.detection.detect),n.event.onTouch(n.DOCUMENT,n.EVENT_END,n.detection.detect),n.READY=!0}var n=function(e,t){return new n.Instance(e,t||{})};n.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},n.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,n.HAS_TOUCHEVENTS="ontouchstart"in e,n.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i,n.NO_MOUSEEVENTS=n.HAS_TOUCHEVENTS&&navigator.userAgent.match(n.MOBILE_REGEX),n.EVENT_TYPES={},n.DIRECTION_DOWN="down",n.DIRECTION_LEFT="left",n.DIRECTION_UP="up",n.DIRECTION_RIGHT="right",n.POINTER_MOUSE="mouse",n.POINTER_TOUCH="touch",n.POINTER_PEN="pen",n.EVENT_START="start",n.EVENT_MOVE="move",n.EVENT_END="end",n.DOCUMENT=document,n.plugins={},n.READY=!1,n.Instance=function(e,t){var i=this;return r(),this.element=e,this.enabled=!0,this.options=n.utils.extend(n.utils.extend({},n.defaults),t||{}),this.options.stop_browser_behavior&&n.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),n.event.onTouch(e,n.EVENT_START,function(e){i.enabled&&n.detection.startDetect(i,e)}),this},n.Instance.prototype={on:function(t,n){var r=t.split(" ");for(var i=0;i<r.length;i++)this.element.addEventListener(r[i],n,!1);return this},off:function(t,n){var r=t.split(" ");for(var i=0;i<r.length;i++)this.element.removeEventListener(r[i],n,!1);return this},trigger:function(t,r){var i=n.DOCUMENT.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=r;var s=this.element;return n.utils.hasParent(r.target,s)&&(s=r.target),s.dispatchEvent(i),this},enable:function(t){return this.enabled=t,this}};var i=null,s=!1,o=!1;n.event={bindDom:function(e,t,n){var r=t.split(" ");for(var i=0;i<r.length;i++)e.addEventListener(r[i],n,!1)},onTouch:function(t,r,u){var a=this;this.bindDom(t,n.EVENT_TYPES[r],function(f){var l=f.type.toLowerCase();if(l.match(/mouse/)&&o)return;l.match(/touch/)||l.match(/pointerdown/)||l.match(/mouse/)&&f.which===1?s=!0:l.match(/mouse/)&&f.which!==1&&(s=!1),l.match(/touch|pointer/)&&(o=!0);var c=0;s&&(n.HAS_POINTEREVENTS&&r!=n.EVENT_END?c=n.PointerEvent.updatePointer(r,f):l.match(/touch/)?c=f.touches.length:o||(c=l.match(/up/)?0:1),c>0&&r==n.EVENT_END?r=n.EVENT_MOVE:c||(r=n.EVENT_END),!c&&i!==null?f=i:i=f,u.call(n.detection,a.collectEventData(t,r,f)),n.HAS_POINTEREVENTS&&r==n.EVENT_END&&(c=n.PointerEvent.updatePointer(r,f))),c||(i=null,s=!1,o=!1,n.PointerEvent.reset())})},determineEventTypes:function(){var t;n.HAS_POINTEREVENTS?t=n.PointerEvent.getEvents():n.NO_MOUSEEVENTS?t=["touchstart","touchmove","touchend touchcancel"]:t=["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],n.EVENT_TYPES[n.EVENT_START]=t[0],n.EVENT_TYPES[n.EVENT_MOVE]=t[1],n.EVENT_TYPES[n.EVENT_END]=t[2]},getTouchList:function(t){return n.HAS_POINTEREVENTS?n.PointerEvent.getTouchList():t.touches?t.touches:[{identifier:1,pageX:t.pageX,pageY:t.pageY,target:t.target}]},collectEventData:function(t,r,i){var s=this.getTouchList(i,r),o=n.POINTER_TOUCH;if(i.type.match(/mouse/)||n.PointerEvent.matchType(n.POINTER_MOUSE,i))o=n.POINTER_MOUSE;return{center:n.utils.getCenter(s),timeStamp:(new Date).getTime(),target:i.target,touches:s,eventType:r,pointerType:o,srcEvent:i,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return n.detection.stopDetect()}}}},n.PointerEvent={pointers:{},getTouchList:function(){var e=this,t=[];return Object.keys(e.pointers).sort().forEach(function(n){t.push(e.pointers[n])}),t},updatePointer:function(e,t){return e==n.EVENT_END?this.pointers={}:(t.identifier=t.pointerId,this.pointers[t.pointerId]=t),Object.keys(this.pointers).length},matchType:function(e,t){if(!t.pointerType)return!1;var r={};return r[n.POINTER_MOUSE]=t.pointerType==t.MSPOINTER_TYPE_MOUSE||t.pointerType==n.POINTER_MOUSE,r[n.POINTER_TOUCH]=t.pointerType==t.MSPOINTER_TYPE_TOUCH||t.pointerType==n.POINTER_TOUCH,r[n.POINTER_PEN]=t.pointerType==t.MSPOINTER_TYPE_PEN||t.pointerType==n.POINTER_PEN,r[e]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},n.utils={extend:function(n,r,i){for(var s in r){if(n[s]!==t&&i)continue;n[s]=r[s]}return n},hasParent:function(e,t){while(e){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(t){var n=[],r=[];for(var i=0,s=t.length;i<s;i++)n.push(t[i].pageX),r.push(t[i].pageY);return{pageX:(Math.min.apply(Math,n)+Math.max.apply(Math,n))/2,pageY:(Math.min.apply(Math,r)+Math.max.apply(Math,r))/2}},getVelocity:function(t,n,r){return{x:Math.abs(n/t)||0,y:Math.abs(r/t)||0}},getAngle:function(t,n){var r=n.pageY-t.pageY,i=n.pageX-t.pageX;return Math.atan2(r,i)*180/Math.PI},getDirection:function(t,r){var i=Math.abs(t.pageX-r.pageX),s=Math.abs(t.pageY-r.pageY);return i>=s?t.pageX-r.pageX>0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT:t.pageY-r.pageY>0?n.DIRECTION_UP:n.DIRECTION_DOWN},getDistance:function(t,n){var r=n.pageX-t.pageX,i=n.pageY-t.pageY;return Math.sqrt(r*r+i*i)},getScale:function(t,n){return t.length>=2&&n.length>=2?this.getDistance(n[0],n[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,n){return t.length>=2&&n.length>=2?this.getAngle(n[1],n[0])-this.getAngle(t[1],t[0]):0},isVertical:function(t){return t==n.DIRECTION_UP||t==n.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(t,n){var r,i=["webkit","khtml","moz","ms","o",""];if(!n||!t.style)return;for(var s=0;s<i.length;s++)for(var o in n)n.hasOwnProperty(o)&&(r=o,i[s]&&(r=i[s]+r.substring(0,1).toUpperCase()+r.substring(1)),t.style[r]=n[o]);n.userSelect=="none"&&(t.onselectstart=function(){return!1})}},n.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,r){if(this.current)return;this.stopped=!1,this.current={inst:t,startEvent:n.utils.extend({},r),lastEvent:!1,name:""},this.detect(r)},detect:function(t){if(!this.current||this.stopped)return;t=this.extendEventData(t);var r=this.current.inst.options;for(var i=0,s=this.gestures.length;i<s;i++){var o=this.gestures[i];if(!this.stopped&&r[o.name]!==!1&&o.handler.call(o,t,this.current.inst)===!1){this.stopDetect();break}}return this.current&&(this.current.lastEvent=t),t.eventType==n.EVENT_END&&!t.touches.length-1&&this.stopDetect(),t},stopDetect:function(){this.previous=n.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(t){var r=this.current.startEvent;if(r&&(t.touches.length!=r.touches.length||t.touches===r.touches)){r.touches=[];for(var i=0,s=t.touches.length;i<s;i++)r.touches.push(n.utils.extend({},t.touches[i]))}var o=t.timeStamp-r.timeStamp,u=t.center.pageX-r.center.pageX,a=t.center.pageY-r.center.pageY,f=n.utils.getVelocity(o,u,a);return n.utils.extend(t,{deltaTime:o,deltaX:u,deltaY:a,velocityX:f.x,velocityY:f.y,distance:n.utils.getDistance(r.center,t.center),angle:n.utils.getAngle(r.center,t.center),direction:n.utils.getDirection(r.center,t.center),scale:n.utils.getScale(r.touches,t.touches),rotation:n.utils.getRotation(r.touches,t.touches),startEvent:r}),t},register:function(r){var i=r.defaults||{};return i[r.name]===t&&(i[r.name]=!0),n.utils.extend(n.defaults,i,!0),r.index=r.index||1e3,this.gestures.push(r),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}},n.gestures=n.gestures||{},n.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(t,r){switch(t.eventType){case n.EVENT_START:clearTimeout(this.timer),n.detection.current.name=this.name,this.timer=setTimeout(function(){n.detection.current.name=="hold"&&r.trigger("hold",t)},r.options.hold_timeout);break;case n.EVENT_MOVE:t.distance>r.options.hold_threshold&&clearTimeout(this.timer);break;case n.EVENT_END:clearTimeout(this.timer)}}},n.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(t,r){if(t.eventType==n.EVENT_END){var i=n.detection.previous,s=!1;if(t.deltaTime>r.options.tap_max_touchtime||t.distance>r.options.tap_max_distance)return;i&&i.name=="tap"&&t.timeStamp-i.lastEvent.timeStamp<r.options.doubletap_interval&&t.distance<r.options.doubletap_distance&&(r.trigger("doubletap",t),s=!0);if(!s||r.options.tap_always)n.detection.current.name="tap",r.trigger(n.detection.current.name,t)}}},n.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.7},handler:function(t,r){if(t.eventType==n.EVENT_END){if(r.options.swipe_max_touches>0&&t.touches.length>r.options.swipe_max_touches)return;if(t.velocityX>r.options.swipe_velocity||t.velocityY>r.options.swipe_velocity)r.trigger(this.name,t),r.trigger(this.name+t.direction,t)}}},n.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(t,r){if(n.detection.current.name!=this.name&&this.triggered){r.trigger(this.name+"end",t),this.triggered=!1;return}if(r.options.drag_max_touches>0&&t.touches.length>r.options.drag_max_touches)return;switch(t.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:if(t.distance<r.options.drag_min_distance&&n.detection.current.name!=this.name)return;n.detection.current.name=this.name;if(n.detection.current.lastEvent.drag_locked_to_axis||r.options.drag_lock_to_axis&&r.options.drag_lock_min_distance<=t.distance)t.drag_locked_to_axis=!0;var i=n.detection.current.lastEvent.direction;t.drag_locked_to_axis&&i!==t.direction&&(n.utils.isVertical(i)?t.direction=t.deltaY<0?n.DIRECTION_UP:n.DIRECTION_DOWN:t.direction=t.deltaX<0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT),this.triggered||(r.trigger(this.name+"start",t),this.triggered=!0),r.trigger(this.name,t),r.trigger(this.name+t.direction,t),(r.options.drag_block_vertical&&n.utils.isVertical(t.direction)||r.options.drag_block_horizontal&&!n.utils.isVertical(t.direction))&&t.preventDefault();break;case n.EVENT_END:this.triggered&&r.trigger(this.name+"end",t),this.triggered=!1}}},n.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(t,r){if(n.detection.current.name!=this.name&&this.triggered){r.trigger(this.name+"end",t),this.triggered=!1;return}if(t.touches.length<2)return;r.options.transform_always_block&&t.preventDefault();switch(t.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:var i=Math.abs(1-t.scale),s=Math.abs(t.rotation);if(i<r.options.transform_min_scale&&s<r.options.transform_min_rotation)return;n.detection.current.name=this.name,this.triggered||(r.trigger(this.name+"start",t),this.triggered=!0),r.trigger(this.name,t),s>r.options.transform_min_rotation&&r.trigger("rotate",t),i>r.options.transform_min_scale&&(r.trigger("pinch",t),r.trigger("pinch"+(t.scale<1?"in":"out"),t));break;case n.EVENT_END:this.triggered&&r.trigger(this.name+"end",t),this.triggered=!1}}},n.gestures.Touch={name:"touch",index:-Infinity,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(t,r){if(r.options.prevent_mouseevents&&t.pointerType==n.POINTER_MOUSE){t.stopDetect();return}r.options.prevent_default&&t.preventDefault(),t.eventType==n.EVENT_START&&r.trigger(this.name,t)}},n.gestures.Release={name:"release",index:Infinity,handler:function(t,r){t.eventType==n.EVENT_END&&r.trigger(this.name,t)}},typeof module=="object"&&typeof module.exports=="object"?module.exports=n:(e.Hammer=n,typeof e.define=="function"&&e.define.amd&&e.define("hammer",[],function(){return n}))}(this),define("sge/vendor/hammer",function(e){return function(){var t,n;return t||e.Hammer}}(this)),define("sge/input",["sge/lib/class","sge/observable","sge/vendor/hammer"],function(e,t,n){var r={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"left-window-key":91,"right-window-key":92,select:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,"decimal-point":110,divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,numlock:144,scrolllock:145,"semi-colon":186,equals:187,comma:188,dash:189,period:190,slash:191,accent:192,lbracket:219,backslash:220,rbraket:221,singlequote:222},i={},s=Object.keys(r);for(var o=0;o<s.length;o++){var u=s[o],a=r[u];i[a]=u}var f=t.extend({init:function(e){this._super(),this._input=e,this.enable=!1,this.joystick=e.joystick},fireEvent:function(){var e=Array.prototype.slice.call(arguments);this.enable&&this._super.apply(this,e)},isPressed:function(e){return this._input.isPressed(e)}}),l=t.extend({init:function(){this._super(),this._isNewKeyDown={},this._isKeyDown={},this._proxies=[],this._events=[],this.joystick=new VirtualJoystick({container:document.getElementById("game")}),document.onkeydown=this.keyDownCallback.bind(this),document.onkeyup=this.keyUpCallback.bind(this),n(document).on("tap",this.tapCallback.bind(this))},tapCallback:function(e){console.log("tap"),this._events.push("tap")},keyDownCallback:function(e){this._isKeyDown[e.keyCode]||(this._isNewKeyDown[e.keyCode]=!0)},keyUpCallback:function(e){delete this._isNewKeyDown[e.keyCode],this._isKeyDown[e.keyCode]=undefined},isPressed:function(e){return this._isKeyDown[r[e]]===!0},tick:function(){var e=Object.keys(this._isNewKeyDown);for(var t=e.length-1;t>=0;t--){var n=e[t];this._isKeyDown[n]=!0,delete this._isNewKeyDown[n],this.fireEvent("keydown:"+i[n])}for(var r=this._events.length-1;r>=0;r--)this.fireEvent(this._events[r]);this._events=[]},createProxy:function(){var e=new f(this);return this._proxies.push(e),e},fireEvent:function(){var e=Array.prototype.slice.call(arguments);this._super.apply(this,e);var t=_.filter(this._proxies,function(e){return e.enable});for(var n=t.length-1;n>=0;n--)t[n].fireEvent.apply(t[n],e)}});return l});var VirtualJoystick=function(e){e=e||{},this._container=e.container||document.body,this._strokeStyle=e.strokeStyle||"cyan",this._stickEl=e.stickElement||this._buildJoystickStick(),this._baseEl=e.baseElement||this._buildJoystickBase(),this._mouseSupport=e.mouseSupport!==undefined?e.mouseSupport:!1,this._container.style.position="relative",this._container.appendChild(this._baseEl),this._baseEl.style.position="absolute",this._baseEl.style.display="none",this._container.appendChild(this._stickEl),this._stickEl.style.position="absolute",this._stickEl.style.display="none",this._pressed=!1,this._touchIdx=null,this._baseX=0,this._baseY=0,this._stickX=0,this._stickY=0;var t=function(e,t){return function(){return e.apply(t,arguments)}};this._$onTouchStart=t(this._onTouchStart,this),this._$onTouchEnd=t(this._onTouchEnd,this),this._$onTouchMove=t(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=t(this._onMouseDown,this),this._$onMouseUp=t(this._onMouseUp,this),this._$onMouseMove=t(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))};VirtualJoystick.prototype.destroy=function(){this._container.removeChild(this._baseEl),this._container.removeChild(this._stickEl),this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))},VirtualJoystick.touchScreenAvailable=function(){return"createTouch"in document?!0:!1},function(e){e.addEventListener=function(e,t){return this._events===undefined&&(this._events={}),this._events[e]=this._events[e]||[],this._events[e].push(t),t},e.removeEventListener=function(e,t){this._events===undefined&&(this._events={});if(e in this._events==0)return;this._events[e].splice(this._events[e].indexOf(t),1)},e.dispatchEvent=function(e){this._events===undefined&&(this._events={});if(this._events[e]===undefined)return;var t=this._events[e].slice();for(var n=0;n<t.length;n++){var r=t[n].apply(this,Array.prototype.slice.call(arguments,1));if(r!==undefined)return r}return undefined}}(VirtualJoystick.prototype),VirtualJoystick.prototype.deltaX=function(){return this._stickX-this._baseX},VirtualJoystick.prototype.deltaY=function(){return this._stickY-this._baseY},VirtualJoystick.prototype.up=function(){if(this._pressed===!1)return!1;var e=this.deltaX(),t=this.deltaY();return t>=0?!1:Math.abs(e)>2*Math.abs(t)?!1:!0},VirtualJoystick.prototype.down=function(){if(this._pressed===!1)return!1;var e=this.deltaX(),t=this.deltaY();return t<=0?!1:Math.abs(e)>2*Math.abs(t)?!1:!0},VirtualJoystick.prototype.right=function(){if(this._pressed===!1)return!1;var e=this.deltaX(),t=this.deltaY();return e<=0?!1:Math.abs(t)>2*Math.abs(e)?!1:!0},VirtualJoystick.prototype.left=function(){if(this._pressed===!1)return!1;var e=this.deltaX(),t=this.deltaY();return e>=0?!1:Math.abs(t)>2*Math.abs(e)?!1:!0},VirtualJoystick.prototype._onUp=function(){this._pressed=!1,this._stickEl.style.display="none",this._baseEl.style.display="none",this._baseX=this._baseY=0,this._stickX=this._stickY=0},VirtualJoystick.prototype._onDown=function(e,t){this._pressed=!0,this._baseX=e,this._baseY=t,this._stickX=e,this._stickY=t,this._stickEl.style.display="",this._stickEl.style.left=e-this._stickEl.width/2+"px",this._stickEl.style.top=t-this._stickEl.height/2+"px",this._baseEl.style.display="",this._baseEl.style.left=e-this._baseEl.width/2+"px",this._baseEl.style.top=t-this._baseEl.height/2+"px"},VirtualJoystick.prototype._onMove=function(e,t){this._pressed===!0&&(this._stickX=e,this._stickY=t,this._stickEl.style.left=e-this._stickEl.width/2+"px",this._stickEl.style.top=t-this._stickEl.height/2+"px")},VirtualJoystick.prototype._onMouseUp=function(e){return this._onUp()},VirtualJoystick.prototype._onMouseDown=function(e){var t=e.clientX,n=e.clientY;return this._onDown(t,n)},VirtualJoystick.prototype._onMouseMove=function(e){var t=e.clientX,n=e.clientY;return this._onMove(t,n)},VirtualJoystick.prototype._onTouchStart=function(e){if(this._touchIdx!==null)return;var t=this.dispatchEvent("touchStartValidation",e);if(t===!1)return;e.preventDefault();var n=e.changedTouches[0];this._touchIdx=n.identifier;var r=n.pageX,i=n.pageY;return this._onDown(r,i)},VirtualJoystick.prototype._onTouchEnd=function(e){if(this._touchIdx===null)return;var t=e.changedTouches;for(var n=0;n<t.length&&t[n].identifier!==this._touchIdx;n++);if(n===t.length)return;return this._touchIdx=null,e.preventDefault(),this._onUp()},VirtualJoystick.prototype._onTouchMove=function(e){if(this._touchIdx===null)return;var t=e.changedTouches;for(var n=0;n<t.length&&t[n].identifier!==this._touchIdx;n++);if(n===t.length)return;var r=t[n];e.preventDefault();var i=r.pageX,s=r.pageY;return this._onMove(i,s)},VirtualJoystick.prototype._buildJoystickBase=function(){var e=document.createElement("canvas");e.width=126,e.height=126;var t=e.getContext("2d");return t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=6,t.arc(e.width/2,e.width/2,40,0,Math.PI*2,!0),t.stroke(),t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=2,t.arc(e.width/2,e.width/2,60,0,Math.PI*2,!0),t.stroke(),e},VirtualJoystick.prototype._buildJoystickStick=function(){var e=document.createElement("canvas");e.width=86,e.height=86;var t=e.getContext("2d");return t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=6,t.arc(e.width/2,e.width/2,40,0,Math.PI*2,!0),t.stroke(),e},define("sge/vendor/virtualjoystick",function(e){return function(){var t,n;return t||e.VirtualJoystick}}(this)),define("sge/vendor/pxloader",[],function(){function e(e){e=e||{},this.settings=e,e.statusInterval==null&&(e.statusInterval=5e3),e.loggingDelay==null&&(e.loggingDelay=2e4),e.noProgressTimeout==null&&(e.noProgressTimeout=Infinity);var n=[],r=[],i,s=Date.now(),o={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},u=function(e){return e==null?[]:Array.isArray(e)?e:[e]};this.add=function(e){e.tags=new t(e.tags),e.priority==null&&(e.priority=Infinity),n.push({resource:e,status:o.QUEUED})},this.addProgressListener=function(e,n){r.push({callback:e,tags:new t(n)})},this.addCompletionListener=function(e,n){r.push({tags:new t(n),callback:function(t){t.completedCount===t.totalCount&&e(t)}})};var a=function(e){e=u(e);var t=function(t){var n=t.resource,r=Infinity;for(var i=0;i<n.tags.length;i++)for(var s=0;s<Math.min(e.length,r);s++){if(n.tags[i]===e[s]&&s<r){r=s;if(r===0)break}if(r===0)break}return r};return function(e,n){var r=t(e),i=t(n);return r<i?-1:r>i?1:e.priority<n.priority?-1:e.priority>n.priority?1:0}};this.start=function(e){i=Date.now();var t=a(e);n.sort(t);for(var r=0,s=n.length;r<s;r++){var u=n[r];u.status=o.WAITING,u.resource.start(this)}setTimeout(f,100)};var f=function(){var t=!1,r=Date.now()-s,i=r>=e.noProgressTimeout,u=r>=e.loggingDelay;for(var a=0,l=n.length;a<l;a++){var c=n[a];if(c.status!==o.WAITING)continue;c.resource.checkStatus&&c.resource.checkStatus(),c.status===o.WAITING&&(i?c.resource.onTimeout():t=!0)}u&&t&&h(),t&&setTimeout(f,e.statusInterval)};this.isBusy=function(){for(var e=0,t=n.length;e<t;e++)if(n[e].status===o.QUEUED||n[e].status===o.WAITING)return!0;return!1};var l=function(e,t){var i=null,u,a,f,l,h;for(u=0,a=n.length;u<a;u++)if(n[u].resource===e){i=n[u];break}if(i==null||i.status!==o.WAITING)return;i.status=t,s=Date.now(),f=e.tags.length;for(u=0,a=r.length;u<a;u++)l=r[u],l.tags.length===0?h=!0:h=e.tags.contains(l.tags),h&&c(i,l)};this.onLoad=function(e){l(e,o.LOADED)},this.onError=function(e){l(e,o.ERROR)},this.onTimeout=function(e){l(e,o.TIMEOUT)};var c=function(e,t){var r=0,i=0,s,u,a,f;for(s=0,u=n.length;s<u;s++)a=n[s],f=!1,t.tags.length===0?f=!0:f=a.resource.tags.contains(t.tags),f&&(i++,(a.status===o.LOADED||a.status===o.ERROR||a.status===o.TIMEOUT)&&r++);t.callback({resource:e.resource,loaded:e.status===o.LOADED,error:e.status===o.ERROR,timeout:e.status===o.TIMEOUT,completedCount:r,totalCount:i})},h=this.log=function(e){if(!window.console)return;var t=Math.round((Date.now()-i)/1e3);window.console.log("PxLoader elapsed: "+t+" sec");for(var r=0,s=n.length;r<s;r++){var u=n[r];if(!e&&u.status!==o.WAITING)continue;var a="PxLoader: #"+r+" "+u.resource.getName();switch(u.status){case o.QUEUED:a+=" (Not Started)";break;case o.WAITING:a+=" (Waiting)";break;case o.LOADED:a+=" (Loaded)";break;case o.ERROR:a+=" (Error)";break;case o.TIMEOUT:a+=" (Timeout)"}u.resource.tags.length>0&&(a+=" Tags: ["+u.resource.tags.array.join(",")+"]"),window.console.log(a)}}}function t(e){this.array=[],this.object={},this.value=null,this.length=0;if(e!==null&&e!==undefined){if(Array.isArray(e))this.array=e;else if(typeof e=="object")for(var t in e)this.array.push(t);else this.array.push(e),this.value=e;this.length=this.array.length;for(var n=0;n<this.length;n++)this.object[this.array[n]]=!0}}function n(e,t,n){var r=this,i=null;this.img=new Image,this.tags=t,this.priority=n;var s=function(){r.img.readyState==="complete"&&(a(),i.onLoad(r))},o=function(){a(),i.onLoad(r)},u=function(){a(),i.onError(r)},a=function(){r.unbind("load",o),r.unbind("readystatechange",s),r.unbind("error",u)};this.start=function(t){i=t,r.bind("load",o),r.bind("readystatechange",s),r.bind("error",u),r.img.src=e},this.checkStatus=function(){r.img.complete&&(a(),i.onLoad(r))},this.onTimeout=function(){a(),r.img.complete?i.onLoad(r):i.onTimeout(r)},this.getName=function(){return e},this.bind=function(e,t){r.img.addEventListener?r.img.addEventListener(e,t,!1):r.img.attachEvent&&r.img.attachEvent("on"+e,t)},this.unbind=function(e,t){r.img.removeEventListener?r.img.removeEventListener(e,t,!1):r.img.detachEvent&&r.img.detachEvent("on"+e,t)}}return t.prototype.contains=function(e){if(this.length===0||e.length===0)return!1;if(this.length===1&&this.value!==null)return e.length===1?this.value===e.value:e.object.hasOwnProperty(this.value);if(e.length<this.length)return e.contains(this);for(var t in this.object)if(e.object[t])return!0;return!1},e.prototype.addImage=function(e,t,r){var i=new n(e,t,r);return this.add(i),i.img},e}),Date.now||(Date.now=function(){return(new Date).getTime()}),Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"}),define("sge/game",["jquery","sge/lib/class","sge/vendor/caat","sge/vendor/state-machine","sge/engine","sge/gamestate","sge/input","sge/renderer","sge/vendor/virtualjoystick","sge/vendor/pxloader"],function(e,t,n,r,i,s,o,u,a,f,l){var c=s.extend({initState:function(){var e=this.game.renderer.width,t=this.game.renderer.height,r=(new n.TextActor).setText("Loading").setLocation(e/2,t/2);this.scene.addChild(r)},startState:function(){this._super(),this.game._states.game.loader&&this.game._states.game.loader.start(),this.elem&&this.elem.fadeIn()},endState:function(){this._super(),this.elem&&this.elem.fadeOut()}}),h=s.extend({initState:function(){var e=this.game.renderer.width,t=this.game.renderer.height,r=(new n.TextActor).setText("DreddRL").setLocation(e/2,t/2),i=(new n.TextActor).setText("Press Enter to Start");this.scene.addChild(r),this.scene.addChild(i),this.startGame=function(){this.game._states.game=new this.game._gameState(this.game,"Game"),this.game.fsm.startGame()}.bind(this),this.startState(),this.input.addListener("keydown:enter",this.startGame),this.input.addListener("tap",this.startGame)},startState:function(){this._super(),this.elem&&this.elem.fadeIn()},endState:function(){this._super(),this.elem&&this.elem.fadeOut()},tick:function(e){}}),p=s.extend({initState:function(){var e=this.game.renderer.width,t=this.game.renderer.height,r=(new n.TextActor).setText("Game Over").setLocation(e/2,t/2);this.scene.addChild(r),this.startGame=function(){this.game._states.game=new this.game._gameState(this.game),this.game.fsm.loadMainMenu()}.bind(this),this.input.addListener("keydown:enter",this.startGame),this.input.addListener("tap",this.startGame)},startState:function(){this._super(),this.elem&&this.elem.fadeIn()},endState:function(){this._super(),this.elem&&this.elem.fadeOut()},tick:function(e){}}),d=s.extend({initState:function(){var e=this.game.renderer.width,t=this.game.renderer.height,r=(new n.TextActor).setText("Win").setLocation(e/2,t/2);this.scene.addChild(r),this.startGame=function(){this.game._states.game=new this.game._gameState(this.game),this.game.fsm.loadMainMenu()}.bind(this),this.input.addListener("keydown:enter",this.startGame),this.input.addListener("tap",this.startGame)},startState:function(){this._super(),this.elem&&this.elem.fadeIn()},endState:function(){this._super(),this.elem&&this.elem.fadeOut()},tick:function(e){}}),v=s.extend({initState:function(){var e=this.game.renderer.width,t=this.game.renderer.height,r=(new n.TextActor).setText("Paused").setLocation(e/2,t/2),i=(new n.TextActor).setText("Press Enter to Start").setLocation(e/2,t/2)+32;this.scene.addChild(r),this.unpause=function(){this.game.fsm.unpause()}.bind(this),this.input.addListener("keydown:space",this.unpause),this.input.addListener("tap",this.unpause)},startState:function(){this._super(),this.elem&&this.elem.fadeIn()},endState:function(){this._super(),this.elem&&this.elem.fadeOut()},tick:function(e){func=this.game._states.game._paused_tick,func&&func.call(this.game._states.game,e)}}),m=s.extend({initState:function(){setTimeout(function(){this.game.fsm.finishLoad(),setTimeout(function(){this.game.fsm.gameWin()}.bind(this),5e3)}.bind(this),1e3)}}),g=t.extend({init:function(t){this.options=e.extend({elem:null,pauseState:v,width:720,height:540},t||{}),this.engine=new i,this.loader=new f,this.input=new o,this._tick=0,this._last=0,this._lastRender=0,this._gameState=m,this._debugElem=e(".fps"),this.options.elem!==null?this.elem=e(this.options.elem):(console.log("[SGE ERROR] Need an element to render in. Use elem option to constructor."),this.elem=null),this.renderer=(new n.Director).initialize(this.options.width,this.options.height,e("#game")[0]),this.engine.tick=function(e){this.tick(e)}.bind(this),this.fsm=r.create({initial:"mainmenu",events:[{name:"startLoad",from:["game","menu","mainmenu"],to:"loading"},{name:"finishLoad",from:"loading",to:"game"},{name:"pause",from:"game",to:"paused"},{name:"unpause",from:["paused","menu"],to:"game"},{name:"startGame",from:"mainmenu",to:"loading"},{name:"loadMainMenu",from:["game","gameover","gamewin","menu","pause"],to:"mainmenu"},{name:"gameOver",from:"game",to:"gameover"},{name:"gameWin",from:"game",to:"gamewin"},{name:"startDialog",from:"game",to:"dialog"},{name:"endDialog",from:"dialog",to:"game"}],callbacks:{onleavestate:function(e,t,n){if(t=="none")return;this._states[t].endState(e,t,n)}.bind(this),onenterstate:function(e,t,n){if(t=="none")return;this._states[n].startState(e,t,n),this.state=this._states[n]}.bind(this)}}),this._states={game:null,mainmenu:new h(this,"Main Menu"),loading:new c(this,"Loading"),paused:new this.options.pauseState(this,"Paused"),gameover:new p(this,"Game Over"),gamewin:new d(this,"Game Win")},this.state=this._states.loading,this.initGame(t)},setGameState:function(e){this._gameState=e},addState:function(e,t){return this._states[e]=t,t},initGame:function(){},preRender:function(){},postRender:function(){},tick:function(e){this.input.tick(),this.state!=null&&this.state.tick(e)},start:function(){window.onblur=function(){this.fsm.pause()}.bind(this),this.engine.run(15),n.loop(30)}});return g}),define("sge/lib/random",[],function(){var e=function(){return Math.random()},t=function(e,t){var n=t-e;return Math.random()*n+e},n=function(e,n){return Math.round(t(e,n))},r=function(e){var t=e.length-1;return e[Math.round(Math.random()*t)]};return{unit:e,range:t,rangeInt:n,item:r}}),define("sge/lib/collision",[],function(){var e=function(e,t,n,r,i,s,o,u){var a=((e*r-t*n)*(i-o)-(e-n)*(i*u-s*o))/((e-n)*(s-u)-(t-r)*(i-o)),f=((e*r-t*n)*(s-u)-(t-r)*(i*u-s*o))/((e-n)*(s-u)-(t-r)*(i-o));if(isNaN(a)||isNaN(f))return!1;if(e>=n){if(!(n<=a&&a<=e))return!1}else if(!(e<=a&&a<=n))return!1;if(t>=r){if(!(r<=f&&f<=t))return!1}else if(!(t<=f&&f<=r))return!1;if(i>=o){if(!(o<=a&&a<=i))return!1}else if(!(i<=a&&a<=o))return!1;if(s>=u){if(!(u<=f&&f<=s))return!1}else if(!(s<=f&&f<=u))return!1;return[a,f]},t=function(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)},n=function(t,n,r,i,s){coords=[[s.left,s.top,s.right,s.top],[s.left,s.bottom,s.right,s.bottom],[s.left,s.top,s.left,s.bottom],[s.right,s.top,s.right,s.bottom]];var o=!1;for(var u=coords.length-1;u>=0;u--){var a=coords[u];o=e(t,n,r,i,a[0],a[1],a[2],a[3]);if(o)break}return o};return pointRectIntersect=function(e,t,n){return n.left<e&&n.right>e&&n.top<t&&n.bottom>t},{lineIntersect:e,rectIntersect:t,lineRectIntersect:n,pointRectIntersect:pointRectIntersect}}),define("sge/lib/util",[],function(){var e=function(t,n){for(var r in n)t[r]&&typeof t[r]=="object"&&t[r].toString()=="[object Object]"&&n[r]?e(t[r],n[r]):t[r]=n[r];return t};return{extend:e}}),define("sge/main",["sge/config","sge/renderer","sge/engine","sge/entity","sge/component","sge/game","sge/gamestate","sge/vendor/pxloader","sge/vendor/virtualjoystick","sge/vendor/hammer","sge/lib/class","sge/lib/random","sge/lib/collision","sge/lib/util","sge/spritesheet"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){return{config:e,Renderer:t,Engine:n,Entity:r,Component:i,Game:s,GameState:o,vendor:{PxLoader:u,VirtualJoystick:a,Hammer:f},Class:l,random:c,util:p,collision:h,SpriteSheet:d}}),define("sge",["sge/main"],function(e){return e}),define("dreddrl/config",[],function(){return{fireButton:"space",pauseButton:"escape",unpauseButton:"space",dialogButton:"space"}}),define("dreddrl/components/bullet",["sge"],function(e){var t=e.Component.extend({init:function(e,t){this._super(e,t),this.kill=this.kill.bind(this),this.hit=this.hit.bind(this)},hit:function(){console.log("Hit")},kill:function(){this.entity.fireEvent("kill")},register:function(e){this._super(e),this.entity.addListener("contact.tile",this.kill),this.scene=this.state.scene,this.container=(new CAAT.ActorContainer).setLocation(12,12);var t=6,n=32;Math.abs(this.entity.get("xform.vx"))>Math.abs(this.entity.get("xform.vy"))&&(t=32,n=6),this.actor=(new CAAT.Actor).setSize(t,n).setFillStyle("blue").setLocation(0,0),this.container.addChild(this.actor),this.entity.get("xform.container").addChild(this.container)},deregister:function(e){this.entity.removeListener("contact.tile",this.kill),this.entity.get("xform.container").removeChild(this.container),this._super(e)},tick:function(e){this.entity.set("physics.width",Math.max(Math.abs(this.entity.get("xform.vx"))*e,2)*2),this.entity.set("physics.height",Math.max(Math.abs(this.entity.get("xform.vy"))*e,2)*2)}});return e.Component.register("bullet",t),t}),define("dreddrl/components/weapons",["sge","../config","./bullet"],function(e,t){var n=e.Component.extend({init:function(e,t){this._super(e,t),this.fire=this.fire.bind(this)},fire:function(){var t=this.entity.get("inventory.ammo");if(t<=0)return;this.entity.set("inventory.ammo",t-1);var n=1024,r=0,i=0;switch(this.entity.get("xform.dir")){case"up":i=-1;break;case"down":i=1;break;case"left":r=-1;break;case"right":r=1}var s=new e.Entity({xform:{tx:this.entity.get("xform.tx")+r*24*1,ty:this.entity.get("xform.ty")+i*24*1,vx:r*n,vy:i*n,container:"_entityContainer"},physics:{width:4+Math.abs(r*20),height:4+Math.abs(i*20),type:2},bullet:{},debug:{},health:{life:1,alignment:this.entity.get("health.alignment"),visible:!1}});this.state.addEntity(s)},register:function(e){this.state=e,this.entity.state.input.addListener("keydown:"+t.fireButton,this.fire)},unregister:function(){this.entity.state.input.removeListener("keydown:"+t.fireButton,this.fire),this.state=null}});return e.Component.register("weapons",n),n}),define("dreddrl/components/physics",["sge"],function(e){var t=e.Component.extend({init:function(e,t){this._super(e,t),this.data.width=t.width||16,this.data.height=t.height||16,this.data.type=t.type||0,this._wait=!0}});return e.Component.register("physics",t),t}),define("dreddrl/components/judgemovement",["sge/component"],function(e){var t=e.extend({init:function(e,t){this._super(e,t),this.data.speed=8,this.data.width=t.width||640,this.data.height=t.height||480,this.data.map=t.map||null,this._isKeyDown={}},register:function(e){this.input=e.input},deregister:function(e){this.input=undefined},tick:function(e){var t=this.entity.get("xform.vx")*e,n=this.entity.get("xform.vy")*e;Math.abs(t)>0||Math.abs(n)>0?(this.entity.set("anim.play",!0),this.input.isPressed("Z")||(Math.abs(t)>Math.abs(n)?t>0?(this.entity.set("anim.anim","walk_right"),this.entity.set("xform.dir","right")):(this.entity.set("anim.anim","walk_left"),this.entity.set("xform.dir","left")):n<0?(this.entity.set("anim.anim","walk_up"),this.entity.set("xform.dir","up")):(this.entity.set("anim.anim","walk_down"),this.entity.set("xform.dir","down")))):this.entity.set("anim.play",!1)}});return e.register("judge.movement",t),t}),define("dreddrl/components/deaddrop",["sge"],function(e){var t=e.Component.extend({init:function(e,t){this._super(e,t),this.drop=this.drop.bind(this),this.entity.addListener("kill",this.drop)},drop:function(){var e=null,t=Math.floor(this.entity.get("xform.tx")/32),n=Math.floor(this.entity.get("xform.ty")/32),r=[[1,0],[-1,0],[0,1],[0,-1]];while(r.length){var i=r.shift(),s=this.state.map.getTile(t+i[0],n+i[1]);if(s.passable){e=[32*(t+i[0]+.5),32*(n+i[1]+.5)];break}}if(e===null)return;var o=this.state.factory(Math.random()>.5?"rammen":"gun",{xform:{tx:e[0],ty:e[1]}});this.state.addEntity(o)}});return e.Component.register("deaddrop",t),t}),define("dreddrl/components/freeitem",["sge"],function(e){var t=e.Component.extend({init:function(e,t){this._super(e,t),this.data.name=t.name||"Item";var n=Object.keys(t);for(var r=n.length-1;r>=0;r--)this.data[n[r]]=t[n[r]];this.pickup=this.pickup.bind(this),this.entity.addListener("contact.start",this.pickup)},pickup:function(e){e.hasTag("pc")&&(e.fireEvent("pickup",this.entity),this.entity.fireEvent("kill"))},register:function(e){this.state=e},unregister:function(){this.state=null}});return e.Component.register("freeitem",t),t}),define("dreddrl/components/inventory",["sge","jquery"],function(e,t){var n=e.Component.extend({init:function(e,n){this._super(e,n),this.data.ammo=n.ammo||100,this.data.items=[],this.data.objects={},this._elem_ammo=t("span.ammo"),this.entity.addListener("pickup",this.pickup.bind(this))},pickup:function(e){var t=e.get("freeitem"),n=t.get("inventory.ammo"),r=Object.keys(t.data);this.entity.fireEvent("log","Picked up "+t.get("name")),r=_.without(r,"name");for(var i=r.length-1;i>=0;i--){var s=r[i];s=="inventory.add"?this.data.items.push(t.data[s]):this.entity.set(s,t.data[s],"add")}},subtractProperty:function(e,t){t=t||1,t=this.get(e)-t,this.set(e,t)}});return e.Component.register("inventory",n),n}),define("dreddrl/components/interaction",["sge"],function(e){var t=e.Component.extend({init:function(e,t){this._super(e,t),this.data.fillStyle="green",this.data.strokeStyle="black",this.data.targets=t.targets||null,this.data.width=t.width||32,this.data.height=t.height||32,this.data.dist=t.dist||96,this.data.priority=t.priority||!1,this.active=!1,this.interact=this.interact.bind(this),this.entity.addListener("focus.gain",this.activate.bind(this)),this.entity.addListener("focus.lose",this.deactivate.bind(this))},activate:function(e){this.activeCoord=e,this.active=!0,this.state.input.addListener("keydown:enter",this.interact)},deactivate:function(){this.active=!1,this.state.input.removeListener("keydown:enter",this.interact)},interact:function(){this.entity.fireEvent("interact")},register:function(t){this._super(t),this.get("priority")&&(this.signalActor=(new CAAT.Actor).setLocation(4,-36).setBackgroundImage(e.Renderer.SPRITESHEETS.exclimation_icons).setSpriteIndex(0),this.entity.get("xform").container.addChild(this.signalActor))},deregister:function(e){this.get("priority")&&this.entity.get("xform").container.removeChild(this.signalActor),this._super(e),this.state.input.removeListener("keydown:enter",this.interact)}});return e.Component.register("interact",t),t});var DOOROPENTILE1={srcX:2,srcY:36},DOOROPENTILE2={srcX:2,srcY:37},DOORCLOSEDTILE1={srcX:1,srcY:36},DOORCLOSEDTILE2={srcX:1,srcY:37};define("dreddrl/components/door",["sge"],function(e){var t=e.Component.extend({init:function(e,t){this._super(e,t),this.room=t.room,this.data.locked=t.locked||!1,this.data.open=t.open===undefined?!0:t.open,this.interact=this.interact.bind(this),this.entity.addListener("interact",this.interact)},interact:function(){this.get("locked")?this.entity.fireEvent("log","Door is locked"):(this.set("open",!this.get("open")),this.room.update(),this.updateTiles())},createTiles:function(){var t=Math.floor(this.entity.get("xform.tx")/32),n=Math.floor(this.entity.get("xform.ty")/32);this.tileA=(new CAAT.Actor).setLocation(t*32+16,n*32+16).setFillStyle("#FF0000").setSize(30,30),this.tileB=(new CAAT.Actor).setLocation(t*32+16,(n-1)*32+16).setFillStyle("#FF0000").setSize(30,30);var r=DOORCLOSEDTILE1.srcY*8+DOORCLOSEDTILE1.srcX;this.tileB.setBackgroundImage(e.Renderer.SPRITESHEETS.future2).setSpriteIndex(r);var r=DOORCLOSEDTILE2.srcY*8+DOORCLOSEDTILE2.srcX;this.tileA.setBackgroundImage(e.Renderer.SPRITESHEETS.future2).setSpriteIndex(r),this.map.dynamicContainer.addChild(this.tileA),this.map.dynamicContainer.addChild(this.tileB)},updateMapTiles:function(){var e=Math.floor(this.entity.get("xform.tx")/32),t=Math.floor(this.entity.get("xform.ty")/32);tile=this.map.getTile(e,t-2),tile=this.map.getTile(e,t-1),tile.layers.layer1=DOOROPENTILE1,tile=this.map.getTile(e,t),tile.layers.layer1=DOOROPENTILE2},updateTiles:function(){var e=this.get("open"),t=Math.floor(this.entity.get("xform.tx")/32),n=Math.floor(this.entity.get("xform.ty")/32);tile=this.map.getTile(t,n-2),tile.passable=e,tile=this.map.getTile(t,n-1),tile.passable=e,tile=this.map.getTile(t,n),tile.passable=e,e?(this.tileA.setVisible(!1),this.tileB.setVisible(!1)):(this.tileA.setVisible(!0),this.tileB.setVisible(!0))},register:function(e){this.state=e,this.map=e.map,this.updateMapTiles(),this.createTiles(),this.updateTiles()},unregister:function(){this.state=null,this.map=null}});return e.Component.register("door",t),t}),define("dreddrl/action",["sge"],function(sge){var Action=sge.Class.extend({init:function(e,t){this.entity=e,this.children=[],this.label=null,t.type===undefined&&(t.type="action"),t.label===undefined&&(t.label=t.type),t.children===undefined&&(t.children=[]),t.args===undefined&&(t.args=[]),this.type=t.type,this.args=t.args,this.label=t.label,this.leaf=!0,this.loadChildren(t)},add:function(e){this.children.push(e)},remove:function(e){this.children.remove(e)},uiInterface:function(){return null},loadChildren:function(e){for(var t=0;t<e.children.length;t++){var n=e.children[t],r=rpg.Action.Load(n);this.add(r)}},run:function(e){this.state=e,this.start.apply(this,this.args)},start:function(){},end:function(){var e=this.getEngine().getPlugin("event");e.actions=e.actions.without(this),this.getEvent().run()},evalExpr:function(expr,ctx){var expr_=this.parseExpr(expr,ctx),evaled=eval(expr_);return evaled},parseExpr:function(e,t){var n=e,r=(e+"").match(/\$\{(@?[\w()"'\.]+)\}/g);return r&&_.each(r,function(e){var r=e.match(/\$\{(@?[\w()\.]+)\}/)[1],i=this.evalValue(r,t);n=n.replace(e,i)}.bind(this)),n},evalValue:function(e,t){var n=t;if(e.match(/^@/)){var r=e.split(".")[0];r=r.replace("@(","").replace(")",""),r=="state"?n=this.state:n=this.state.getEntitiesWithTag(r)[0],e=e.replace("@("+r+").","")}return n.get(e)},setAttr:function(e,t,n){var r=this.entity;if(e.match(/^@/)){var i=e.split(".")[0];i=i.replace("@(","").replace(")",""),i=="state"?r=this.state:r=this.state.getEntitiesWithTag(i)[0],e=e.replace("@("+i+").","")}return r.set(e,t,n)}});return Action._classHash={},Action.Load=function(e,t){var n=t.type,r=Action._classHash[n];if(r===undefined)return null;var i=new r(e,t);return i.type=n,i},Action.register=function(e,t){Action._classHash[e]=t},Action.Exists=function(e){return Action._classHash.keys().include(e)},Action.List=function(e){return rpg.Action._classHash.keys()},Action}),define("dreddrl/components/actions",["sge","../action"],function(e,t){var n=e.Component.extend({init:function(e,n){this._super(e,n);var r=Object.keys(n);for(var i=r.length-1;i>=0;i--){var s=n[r[i]].slice(0),o=function(){var e=s.slice(0),n=e.shift(),r=t.Load(this.entity,{type:n,args:e});r.run(this.state)}.bind(this);this.data[r[i]]=o,this.entity.addListener(r[i],o)}},interact:function(){var e=this.get("dialog");if(typeof e=="string")this.state.startDialog(this.get("dialog"));else{console.log(e),dialogData=e.slice(0);var n=dialogData.shift(),r=t.Load(this.entity,{type:n,args:dialogData});r.run(this.state)}},register:function(e){this.state=e,this.map=e.map},unregister:function(){this.state=null,this.map=null}});return e.Component.register("actions",n),n}),define("dreddrl/components/elevator",["sge"],function(e){var t=e.Component.extend({init:function(e,t){this._super(e,t),this.data.open=t.open||!0,this.interact=this.interact.bind(this),this.entity.addListener("interact",this.interact)},interact:function(){},updateTiles:function(){var e=Math.floor(this.entity.get("xform.tx")/32)-1,t=Math.floor(this.entity.get("xform.ty")/32)-2;for(var n=0;n<3;n++)for(var r=0;r<3;r++)tile=this.map.getTile(e+r,t+n),tile.layers.layer1={srcX:r,srcY:32+n,spriteSheet:"future1"}},register:function(e){this._super(e),this.map=e.map,this.updateTiles()}});return e.Component.register("elevator",t),t}),define("dreddrl/components/quest",["sge"],function(e){var t=e.Component.extend({init:function(e,t){this._super(e,t),this.data.status=0,this.data.total=3},tick:function(e){this.get("status")>=this.get("total")&&this.state.game.fsm.gameWin()}});return e.Component.register("quest",t),t}),define("dreddrl/components/encounter",["sge"],function(e){var t=e.Component.extend({init:function(e,t){this._super(e,t),this.encounter=t.encounter.add(this),this.data.status=t.status||0},_get_status:function(){return this.encounter.status},_set_status:function(e){return this.encounter.status=e,this.encounter.update(e),this.encounter.status}});return e.Component.register("encounter",t),t}),define("dreddrl/components/stats",["sge"],function(e){var t=e.Component.extend({init:function(e,t){this._super(e,t),this.data.xp=t.xp==undefined?0:t.xp,this.data.alignment=t.alignment||"evil"},addStat:function(e,t){t=t||1,this.set(e,this.get(e)+t)},subtractStat:function(e,t){t=t||1,this.set(e,this.get(e)-t)}});return e.Component.register("stats",t),t}),define("dreddrl/components/health",["sge/component"],function(e){var t=e.extend({init:function(e,t){this._super(e,t),this.data.visible=t.visible===undefined?!0:t.visible,this.data.life=t.life||100,this.data.maxLife=t.maxLife||t.life||100,this.data.alignment=t.alignment||0,this.entity.addListener("contact.start",function(e){if(!e.get("health"))return;var t=this.get("alignment"),n=e.get("health.alignment");if(t==0||n==0)return;if(t<0&&n<0)return;if(t>0&&n>0)return;this.set("life",-1,"add"),this.data.life<=0?(this.data.life=0,this.entity.fireEvent("kill","Ran out of health.")):this.entity.fireEvent("tint","red",.25)}.bind(this))},register:function(e){this._super(e),this.scene=this.state.scene,this.container=(new CAAT.ActorContainer).setLocation(0,-24),bg=(new CAAT.Actor).setSize(32,6).setFillStyle("black"),this.container.addChild(bg),this.lifebar=(new CAAT.Actor).setSize(30,4).setFillStyle("green").setLocation(1,1),this.container.addChild(this.lifebar),this.container.setVisible(this.get("alignment")!=0&&this.get("visible")!=0),this.entity.get("xform.container").addChild(this.container)},deregister:function(e){this.entity.get("xform.container").removeChild(this.container),this._super(e)},_set_life:function(e,t){var n=this.__set_value("life",e,t);this.data.life=Math.min(n,this.get("maxLife"));var r=this.data.life/this.get("maxLife");return this.set("pct",r),fillColor="green",r<=.75?fillColor="yellow":r<=.5?fillColor="orange":r<=.25&&(fillColor="red"),this.lifebar.setFillStyle(fillColor),this.lifebar.setSize(30*r,4),this.data.life}});return e.register("health",t),t}),define("dreddrl/components/simpleai",["sge/component","sge/vendor/state-machine"],function(e,t){var n=e.extend({init:function(e,n){this._super(e,n),this.data.tracking=n.tracking||null,this.data.territory=n.territory,this.fsm=t.create({initial:"idle",events:[{name:"seePlayer",from:"idle",to:"tracking"},{name:"losePlayer",from:"tracking",to:"idle"}]}),this.data.radius=96,this._idleCounter=0},register:function(e){this._super(e),this.map=this.state.map},getPC:function(){return this.entity.state.getEntitiesWithTag(this.get("tracking"))[0]||null},getPCPosition:function(){var e=this.getPC(),t=this.entity.get("xform.tx")-e.get("xform.tx"),n=this.entity.get("xform.ty")-e.get("xform.ty"),r=Math.sqrt(t*t+n*n);return[e,t,n,r]},tick:function(e){this.wander()},tick_tracking:function(e){var t=this.getPCPosition(),n=t[1],r=t[2],i=t[3];if(i>=this.data.radius)this.fsm.losePlayer();else{var s=0,o=0;s=-64*(t[1]/i),o=-64*(r/i),this.entity.set("xform.vx",s),this.entity.set("xform.vy",o)}},tick_idle:function(e){if(this.get("tracking")!==null){var t=this.getPCPosition(),n=t[1],r=t[2],i=t[3];t[3]<=this.data.radius?this.fsm.seePlayer():this.wander()}else this.wander()},wander:function(){if(this._idleCounter<0){this._idleCounter=30+Math.random()*30;var e=!1,t=this.entity.get("xform.tx"),n=this.entity.get("xform.ty"),r=0,i=0;for(var s=0;s<5;s++){if(Math.random()>.5)var r=64*(Math.random()*2-1),i=64*(Math.random()*2-1);if(this.data.territory===undefined)break;var o=this.map.getTile(Math.floor((t+r)/32),Math.floor((n+i)/32));if(o&&o.data.territory==this.data.territory)break;r=0,i=0}this.entity.set("xform.vx",r),this.entity.set("xform.vy",i)}else this._idleCounter--}});return e.register("simpleai",n),n}),define("dreddrl/components/emote",["sge"],function(e){var t=e.Component.extend({init:function(e,t){this._super(e,t),this._visible=!1,this.fontSize=16,this.data.text=t.text||"",this.entity.addListener("emote.msg",function(e){this.container.setVisible(!0),this.set("text",e),this.entity.state.createTimeout(1,function(){this.container.setVisible(!1)}.bind(this))}.bind(this))},register:function(e){this._super(e),this.scene=this.state.scene,this.container=(new CAAT.ActorContainer).setLocation(32,-24),this.bg=(new CAAT.Actor).setSize(32,16).setFillStyle("black"),this.container.addChild(this.bg),this.text=(new CAAT.TextActor).setLocation(2,2).setFont(this.fontSize+"px sans-serif"),this.container.addChild(this.text),this.container.setVisible(!1),this.entity.get("xform").container.addChild(this.container)},deregister:function(e){this.entity.get("xform").container.removeChild(this.container),this._super(e)},_set_text:function(e){return this.text.setText(e),this.text.calcTextSize(this.state.game.renderer),this.bg.setSize(this.text.textWidth+4,this.fontSize+8),e}});return e.Component.register("emote",t),t}),define("dreddrl/actions/dialog",["sge","../action"],function(e,t){var n=t.extend({init:function(e,t){this._super(e,t),this.async=!0},start:function(e){this.state.startDialog(e)}});return t.register("dialog",n),n}),define("dreddrl/actions/if",["sge","../action"],function(e,t){var n=t.extend({init:function(e,t){this._super(e,t),this.async=!0},start:function(e,n,r){var i=this.parseExpr(e,this.entity),s=Boolean(this.evalExpr(i,this.entity)),o=[];s?o=n.slice(0):o=r.slice(0),_.each(o,function(e){e=e.slice(0);var n=e.shift(),r=t.Load(this.entity,{type:n,args:e});r.run(this.state)}.bind(this))}});return t.register("if",n),n}),define("dreddrl/actions/set",["sge","../action"],function(e,t){var n=t.extend({init:function(e,t){this._super(e,t),this.async=!0},start:function(e,t,n){var r=this.evalExpr(t);this.setAttr(e,t,n)}});return t.register("set",n),n}),define("dreddrl/actions/switch",["sge","../action"],function(e,t){var n=t.extend({init:function(e,t){this._super(e,t),this.async=!0},start:function(){var e=Array.prototype.slice.call(arguments),n=e.shift(),r=this.parseExpr(n,this.entity),i=parseInt(this.evalExpr(r,this.entity)),s=e[i];_.each(s,function(e){e=e.slice(0);var n=e.shift(),r=t.Load(this.entity,{type:n,args:e});r.run(this.state)}.bind(this))}});return t.register("switch",n),n}),define("dreddrl/actions/event",["sge","../action"],function(e,t){var n=t.extend({init:function(e,t){this._super(e,t),this.async=!0},start:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();if(t=="this")var n=this.entity;else var n=this.state.getEntityWithTag(t);n.fireEvent.apply(n,e)}});return t.register("event",n),n}),define("dreddrl/factory",["sge","./components/weapons","./components/physics","./components/judgemovement","./components/deaddrop","./components/freeitem","./components/inventory","./components/interaction","./components/door","./components/actions","./components/elevator","./components/quest","./components/encounter","./components/stats","./components/health","./components/simpleai","./components/emote","./actions/dialog","./actions/if","./actions/set","./actions/switch","./actions/event"],function(e){var t=["gang_1","gang_2","gang_6","women_1","women_2","women_3","women_4","women_5","women_6","women_7","women_8"],n={chara:function(){return{xform:{container:"_entityContainer"},sprite:{width:32,offsetY:-8,scale:2},anim:{frames:{walk_down:[0,1,2],walk_up:[9,10,11],walk_right:[6,7,8],walk_left:[3,4,5]}},physics:{},inventory:{}}},pc:function(){return r(n.chara(),{controls:{},sprite:{src:"assets/sprites/judge.png"},"judge.movement":{map:this.map,speed:64},health:{alignment:5,life:10},weapons:{},stats:{},emote:{}})},npc:function(){return r(n.chara(),{movement:{map:this.map,speed:16},simpleai:{territory:"neutral"},health:{alignment:0,life:1},sprite:{src:"assets/sprites/"+e.random.item(t)+".png"}})},enemy:function(){var t=["I am the law.","Objection noted.","Sentence. Execution!","You've been found guilt."];return r(n.npc(),{sprite:{src:"assets/sprites/albert.png"},health:{alignment:-10,life:3},simpleai:{tracking:"pc",territory:"albert"},deaddrop:{},actions:{kill:["switch",0,[["set","@(pc).stats.xp",5,"add"],["event","pc","emote.msg",e.random.item(t)]]]}})},gangboss:function(){return r(n.enemy(),{sprite:{src:"assets/sprites/albertbrownhair.png"},health:{alignment:-10,life:6},deaddrop:{}})},freeitem:function(){return{xform:{container:"_entityContainer"},physics:{},sprite:{src:"assets/sprites/scifi_icons_1.png",width:24,offsetY:0,scale:2,frame:1}}},gun:function(){return r(n.freeitem(),{freeitem:{"inventory.ammo":10,name:"Gun"}})},rammen:function(){return r(n.freeitem(),{sprite:{frame:123},freeitem:{"health.life":5,name:"Ramen"}})},keycard:function(){return r(n.freeitem(),{sprite:{frame:56},freeitem:{"inventory.add":"keycard.blue"}})},door:function(){return{xform:{container:"_entityContainer"},interact:{},door:{}}},elevator:function(){return{xform:{container:"_entityContainer"},interact:{},elevator:{}}},man:function(){return r(n.npc(),{sprite:{src:"assets/sprites/gang_"+e.random.item([1,2,6])+".png"}})},"woman.old":function(){return r(n.npc(),{sprite:{src:"assets/sprites/women_"+e.random.item([4,8])+".png"}})},woman:function(){return r(n.npc(),{sprite:{src:"assets/sprites/women_"+e.random.item([2,3,6,7])+".png"}})},"woman.young":function(){return r(n.npc(),{sprite:{src:"assets/sprites/women_"+e.random.item([1,5])+".png"}})}},r=function(e,t){for(var n in t)t[n]&&t[n].constructor&&t[n].constructor===Object?(e[n]=e[n]||{},arguments.callee(e[n],t[n])):e[n]=t[n];return e},i=function(t,i){i=i||{};var s=r(n[t](),i);return new e.Entity(s)};return i}),define("dreddrl/map",["sge/lib/class","sge/vendor/caat","sge/renderer","sge/config"],function(e,t,n,r){var i=e.extend({init:function(e,t){this.x=e,this.y=t,this.passable=!0,this.hidden=!1,this.layers={layer0:{srcX:14,srcY:8}},this.actors={},this.data={territory:"neutral"}},hide:function(){this.fade!=1&&(this.fadeDelta=.1,this.animate=!0)},show:function(){this.fade!=0&&(this.fadeDelta=-0.1,this.animate=!0)},anim:function(){this.animate&&(this.fade=Math.round(100*Math.max(Math.min(this.fade+this.fadeDelta,1),0))/100,this.fade<=0?(this.x==1&&this.y==1&&console.log("visible",this.fade),this.animate=!1,this.fade=0):this.fade>=1&&(this.animate=!1,this.fade=1))}}),s=e.extend({init:function(e,n,r){r===undefined&&(r={src:"assets/quest/img/2/tilesheet.png"}),this.options=r,this.width=e,this.height=n,this.tileSize=32,this.container=new t.ActorContainer,this.container.setBounds(0,0,e*32,n*32),this.dynamicContainer=new t.ActorContainer,this.dynamicContainer.setBounds(0,0,e*32,n*32),this._tiles=[],this.layers=["layer0","layer1"],this.layerContainers={},_.each(this.layers,function(r){this.layerContainers[r]=(new t.ActorContainer).setBounds(0,0,e*32,n*32),this.container.addChild(this.layerContainers[r])}.bind(this)),this.tileset=new Image,this.tileSheet=null,this.defaultSheet="default"},setup:function(e){var r=this.width*this.height,s=0,o=0;for(var u=0;u<r;u++){var a=new i(s,o);_.each(this.layers,function(e){a.actors[e]=(new t.Actor).setLocation(s*32+16,o*32+16).setFillStyle("#FF0000").setSize(30,30),a.actors[e].setBackgroundImage(n.SPRITESHEETS.future2).setSpriteIndex(15),this.layerContainers[e].addChild(a.actors[e])}.bind(this)),this._tiles.push(a),s++,s>=this.width&&(s=0,o++)}e.addChild(this.container),e.addChild(this.dynamicContainer),this.scene=e},getIndex:function(e,t){var n=t*this.width+e;return e>this.width-1||e<0?null:t>this.height-1||t<0?null:n},getTile:function(e,t){return this._tiles[this.getIndex(e,t)]||null},getTiles:function(e){return tiles=_.map(e,function(e){return this.getTile(e[0],e[1])}.bind(this)),tiles},renderTile:function(e){_.each(this.layers,function(t){if(e.layers[t]){var r=e.layers[t].srcY*8+e.layers[t].srcX,i=e.layers[t].spriteSheet||this.defaultSheet;e.actors[t].setBackgroundImage(n.SPRITESHEETS[i]).setSpriteIndex(r)}else e.actors[t].setVisible(!1)}.bind(this))},renderTiles:function(e){_.each(e,function(e){e.layers===undefined&&(e=this.getTile(e[0],e[1])),this.renderTile(e)}.bind(this))},render:function(e){_.each(this._tiles,function(e){this.renderTile(e)}.bind(this)),this.container.cacheAsBitmap(0,t.Foundation.Actor.CACHE_DEEP)},refreshCache:function(){this.container.stopCacheAsBitmap();var e=this.scene.x,n=this.scene.y;this.scene.setLocation(0,0),this.container.cacheAsBitmap(0,t.Foundation.Actor.CACHE_DEEP),this.scene.setLocation(e,n)},loadCallback:function(){this.onready&&this.onready()}});return s}),define("dreddrl/blocklevelgenerator",["sge","jquery","./factory","./map"],function(e,t,n,r,i){var s={srcX:0,srcY:0,spriteSheet:"future2"},o={srcX:0,srcY:36,layer:"canopy",spriteSheet:"future2"},u={srcX:1,srcY:36,spriteSheet:"future2"},a={srcX:1,srcY:37,spriteSheet:"future2"},f={srcX:2,srcY:36,spriteSheet:"future2"},l={srcX:2,srcY:37,spriteSheet:"future2"},c=function(e,t,n,r){var i=[];for(var s=0;s<=r;s++)for(var o=0;o<=n;o++)i.push([e+o,t+s]);return i},h=e.Class.extend({init:function(e,n,r,i,s,o){this.level=e,this.options=t.extend({doors:"bottom",open:!0},o||{}),this.cx=n,this.cy=r,this.width=i,this.height=s,this.spawned=[],this.data={},this.doors=[]},isLocked:function(){var e=!1;return _.each(this.doors,function(t){e=t.get("door.locked")}),e},plot:function(){var e=Math.floor((this.width-1)/2),t=Math.floor((this.height-1)/2),n=null;for(var r=this.cy-t;r<=this.cy+t;r++)for(var i=this.cx-e;i<=this.cx+e;i++)n=this.level.map.getTile(i,this.cy+t+1),n.layers.layer0=s,n.passable=!0;this.level.buildWall(this.cx-e,this.cy-t-2,this.width),this.level.buildWall(this.cx-e-1,this.cy+t+2,this.width+2);for(i=this.cx-e-1;i<=this.cx+e+1;i++)n=this.level.map.getTile(i,this.cy+t+1),n.layers.layer0=o,n.passable=!1,n=this.level.map.getTile(i,this.cy-t-3),n.layers.layer0=o,n.passable=!1;for(r=this.cy-t-2;r<=this.cy+t+1;r++)n=this.level.map.getTile(this.cx+e+1,r),n.layers.layer0=o,n.passable=!1,n=this.level.map.getTile(this.cx-e-1,r),n.layers.layer0=o,n.passable=!1;(this.options.doors=="bottom"||this.options.doors=="both")&&this.createDoor(this.cx,this.cy+t+3,this.options.open),(this.options.doors=="top"||this.options.doors=="both")&&this.createDoor(this.cx,this.cy-t-1,this.options.open),this.update()},createDoor:function(e,t,n){var r=null,i=this.level.state.factory("door",{xform:{tx:(e+.5)*32,ty:(t+.5)*32},door:{open:n,room:this},interact:{targets:[[(e+.5)*32,(t+.5)*32],[(e+.5)*32,(t-1.5)*32]]}});this.doors.push(i),i.tags.push("door"),this.level.state.addEntity(i)},getTiles:function(){return this.level.map.getTiles(c(this.cx-(this.width-1)/2,this.cy-(this.height-1)/2,this.width-1,this.height-1))},spawn:function(t,r){r=r||{};var i=e.random.item(this.getTiles());if(i){while(i.data.spawn!==undefined)i=e.random.item(this.getTiles());r.xform={tx:i.x*32+16,ty:i.y*32+16},i.spawn=!0;var s=n(t,r);return s}},update:function(){this.doors.length?this.doors[0].get("door.open")?_.each(this.getTiles(),function(e){e.fade=0}):_.each(this.getTiles(),function(e){e.fade=1}):_.each(this.getTiles(),function(e){e.fade=1})}}),p=e.Class.extend({init:function(e,t){this.state=e,this.map=e.map,_.each(this.map._tiles,function(e){e.fade=0,e.layers={layer0:s}}),this.rooms=[],this.buildLayout(),this.buildWall(0,1,this.map.width,!0);for(var n=0;n<this.map.height;n++){var r=this.map.getTile(0,n);r.layers={layer0:o},r.passable=!1,r=this.map.getTile(this.map.width-1,n),r.layers={layer0:o},r.passable=!1}this.buildWall(0,this.map.height-2,this.map.width,!0)},buildSmallRoomHall:function(e,t,n,r){var i=length%4,s=e;while(s<n-10){var o=1;this.createRoom(s+2,t+5,3,5,r),s+=o*2+2}this.buildWall(s,9,n-s-1,!0)},buildMediumRoomHall:function(e,t,n,r){var i=length%4,s=e;while(s<n-6){var o=2;this.createRoom(s+3,t+5,5,5,r),s+=o*2+2}this.buildWall(s,9,n-s-1,!0)},buildLargeRoomHall:function(e,t,n,r){var i=length%4,s=e;while(s<n-6){var o=3;this.createRoom(s+4,t+5,7,5,r),s+=o*2+2}this.buildWall(s,9,n-s-1,!0)},buildLayout:function(){this.createRoom(4,5,7,5,{doors:null}),this.createRoom(60,5,7,5,{doors:null});var t=this.map.getTiles(c(32,0,32,32));_.each(t,function(e){e.data.territory="albert"});var r=e.random.item(["slum","middle","upper"]);switch(r){case"upper":this.buildLargeRoomHall(8,0,60),this.buildLargeRoomHall(8,13,60,{doors:"top"}),this.buildLargeRoomHall(8,21,60),this.buildLargeRoomHall(8,34,60,{doors:"top"}),this.buildLargeRoomHall(8,42,60),this.buildLargeRoomHall(8,55,60,{doors:"top"});break;case"middle":this.buildMediumRoomHall(8,0,60),this.buildMediumRoomHall(8,13,60,{doors:"top"}),this.buildMediumRoomHall(8,21,60),this.buildMediumRoomHall(8,34,60,{doors:"top"}),this.buildMediumRoomHall(8,42,60),this.buildMediumRoomHall(8,55,60,{doors:"top"});break;case"slum":default:this.buildSmallRoomHall(8,0,65),this.buildSmallRoomHall(8,13,65,{doors:"top"}),this.buildSmallRoomHall(8,21,65),this.buildSmallRoomHall(8,34,65,{doors:"top"}),this.buildSmallRoomHall(8,42,65),this.buildSmallRoomHall(8,55,65,{doors:"top"})}var i=n("elevator",{xform:{tx:80,ty:368}});this.state.addEntity(i);var i=n("elevator",{xform:{tx:208,ty:368}});this.state.addEntity(i);var i=n("elevator",{xform:{tx:1872,ty:368}});this.state.addEntity(i);var i=n("elevator",{xform:{tx:2e3,ty:368}});this.state.addEntity(i),_.each(this.rooms,function(t){if(t.options.doors==null)return;_.each(t.doors,function(t){t.get("door.open")||e.random.unit()>.5&&t.set("door.locked",!0)});var n=this.map.getTile(t.cx,t.cy);if(n.data.territory=="albert"){var r=e.random.rangeInt(0,3);t.data.gang=n.data.territory;for(var i=0;i<r;i++){var s=t.spawn("enemy");s&&this.state.addEntity(s)}}else{var r=e.random.rangeInt(0,3);t.data.territory=n.data.territory;for(var i=0;i<r;i++){if(Math.random()>.5)var o="man";else var o=e.random.item(["woman","woman.young","woman.old"]);var u={actions:{interact:["event","this","emote.msg","Hi, I'm an npc."]},interact:{dist:48},emote:{}},s=t.spawn(o,u);s&&this.state.addEntity(s),_.each(t.doors,function(e){e.set("door.locked",!1)})}}}.bind(this))},getRandomEncounterRoom:function(t){t=t||{};var n=t.exclude||[],r=0;s=null;for(var r=0;r<this.rooms.length;r++){var i=e.random.item(this.rooms);if(_.include(n,i))continue;if(i.options.doors==null)continue;if(i.isLocked())continue;if(t.territory!==undefined&&i.data.territory!=t.territory)continue;var s=i;break}return s},buildWall:function(e,t,n,r){for(var i=0;i<n;i++){var s=this.map.getTile(i+e,t);s.layers={layer0:{srcX:6,srcY:1,spritesheet:"future2"}},s.passable=!1,s=this.map.getTile(i+e,t+1),s.layers={layer0:{srcX:6,srcY:2,spritesheet:"future2"}},s.passable=!1,r&&(s=this.map.getTile(i+e,t-1),s.layers.layer0=o,s.passable=!1)}},createPC:function(){var e=this.getRandomEncounterRoom();_.each(e.doors,function(e){e.set("door.open",!0),e.get("door").updateTiles()}),e.update();var t=null;return this.state.options.persist&&this.state.options.persist.pc!==undefined&&(t=this.state.options.persist.pc,t.set("xform.tx",(this.generator.rooms[0].cx+.5)*this.map.tileSize),t.set("xform.ty",(this.generator.rooms[0].cy+.5)*this.map.tileSize)),t==null&&(t=n("pc",{xform:{tx:(e.cx+.5)*this.map.tileSize,ty:(e.cy+.5)*this.map.tileSize,vx:Math.random()*10-5,vy:Math.random()*10-5}}),t.tags.push("pc"),t.addListener("kill",function(){this.state._killList.push(t)}.bind(t))),this.state.addEntity(t),t},createEnemy:function(e,t){var r=null,i=!1;return r=n("enemy",{xform:{tx:(e+.5)*this.map.tileSize,ty:(t+.5)*this.map.tileSize,vx:Math.random()*10-5,vy:Math.random()*10-5}}),r.tags.push("enemy"),this.state.addEntity(r),r},createRoom:function(e,n,r,i,s){s=t.extend({doors:"bottom",open:Math.random()>.5},s||{});var o=new h(this,e,n,r,i,s),u=this.map.getTile(e,n);o.data.territory=u.data.territory,o.plot(),this.rooms.push(o)}});return p}),define("dreddrl/physics",["sge"],function(e){TYPES={KINETIC:0,STATIC:1,PASS:2};var t=e.Class.extend({init:function(e){this.state=e,this.map=e.map,this._contactList=[],this._newContactList=[]},intersectRect:function(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)},moveGameObject:function(e,t,n){var r=e.get("xform.tx"),i=e.get("xform.ty"),s=r+t,o=i+n;if(this.map){var u=Math.floor(s/32),a=Math.floor(o/32),f=this.map.getTile(u,a);if(f==null)s=r,o=i,e.fireEvent("contact.tile");else if(f.passable!=1){var l=r+t,c=i+n,h=Math.floor(l/32),p=Math.floor(c/32),d=this.map.getTile(h,p);if(d.passable==0){var v=[l,i],m=[r,c],g=this.map.getTile(Math.floor(l/32),Math.floor(i/32)),y=this.map.getTile(Math.floor(r/32),Math.floor(c/32));g.passable?c=i:y.passable?l=r:(l=r,c=i),e.fireEvent("contact.tile")}t=l-r,n=c-i,s=l,o=c}}return s!=r&&e.set("xform.tx",s),o!=i&&e.set("xform.ty",o),[u,a]},resolveCollisions:function(e){var t=[],n=[];_.each(this.state.getEntitiesWithComponent("physics"),function(n){t.push(n);if(n.get("physics.type")&TYPES.STATIC)return;if(n.get("physics")._wait){n.get("physics")._wait=!1;return}var r=n.get("xform.vx")*e,i=n.get("xform.vy")*e;this.moveGameObject(n,r,i)}.bind(this));var r=0;while(t.length>1){var i=t.shift(),s=Boolean(i.get("physics.type")&TYPES.STATIC),o=i.get("xform.tx"),u=i.get("xform.ty"),a=i.get("physics.width"),f=i.get("physics.height"),l={top:u-f/2,bottom:u+f/2,left:o-a/2,right:o+a/2};for(var c=t.length-1;c>=0;c--){r++;var h=t[c],p=Boolean(h.get("physics.type")&TYPES.STATIC);if(s&p)continue;var d=h.get("xform.tx"),v=h.get("xform.ty"),m=h.get("physics.width"),g=h.get("physics.height"),y={top:v-g/2,bottom:v+g/2,left:d-m/2,right:d+m/2};if(this.intersectRect(l,y)){var b=i.id+"."+h.id;i.id>h.id&&(b=h.id+"."+i.id),n.push(b);if(!_.contains(this._contactList,b)){var w=b.split("."),i=this.state.getEntity(w[0]),h=this.state.getEntity(w[1]);i.fireEvent("contact.start",h),h.fireEvent("contact.start",i)}if(i.get("physics.type")==TYPES.PASS||h.get("physics.type")==TYPES.PASS)continue;var E=y.right-l.left,S=y.left-l.right,x=y.top-l.bottom,T=y.bottom-l.top,N=0,C=0;Math.abs(E)>Math.abs(S)?N=S:N=E,Math.abs(x)>Math.abs(T)?C=T:C=x,Math.abs(N)>Math.abs(C)?N=0:C=0;var k=0,L=0,A=0,O=0;i.get("physics.type")&TYPES.STATIC?(A=-N,O=-C):h.get("physics.type")&TYPES.STATIC?(k=N,L=C):(k=N/2,L=C/2,A=N/-2,O=C/-2),this.moveGameObject(i,k,L),this.moveGameObject(h,A,O)}}}for(var c=this._contactList.length-1;c>=0;c--)if(!_.contains(n,this._contactList[c])){var w=this._contactList[c].split("."),i=this.state.getEntity(w[0]),h=this.state.getEntity(w[1]);i&&i.fireEvent("contact.end",h),h&&h.fireEvent("contact.end",i)}this._contactList=n}});return t}),define("dreddrl/encounters",["sge"],function(e){var t=e.Class.extend({init:function(e,t){this.system=e,this.block=e.state.level,this.state=e.state,this.factory=this.state.factory,this.status=0,this.total=1,this.targetEntity=null,this.start(t)},isFinished:function(){return this.status>=this.total},start:function(){},finish:function(){this.system.complete(this)},tick:function(){},getPC:function(){return this.state.getEntityWithTag("pc")},update:function(e){this.isFinished()&&this.finish()},add:function(e){var t=e.entity;return t.addListener("target.set",function(){this.targetEntity=t}.bind(this)),t.addListener("target.remove",function(){this.targetEntity=null}.bind(this)),this}}),n=t.extend({start:function(e){var t=_.keys(e.entities||{}),n=null,r=_.map(t,function(t){var n=e.entities[t];n.meta=n.meta||{};var r=n.meta.inherit||"npc",i=this.block.getRandomEncounterRoom({territory:"neutral"});n.xform=n.xform||{},n.xform.tx=i.cx*32,n.xform.ty=i.cy*32,n.encounter={encounter:this},delete n.meta;var s=this.factory(r,n);return s.tags.push(t),this.state.addEntity(s),s}.bind(this));n==null&&(n=r[0]),this.targetEntity=n}}),r=e.Class.extend({init:function(e){this.state=e,this.encounters=[],this.active=null,this._index=0,this.compassActor=(new CAAT.ShapeActor).setShape(CAAT.ShapeActor.SHAPE_CIRCLE).setFillStyle("blue").setSize(32,32),this.state._entityContainer.addChild(this.compassActor)},create:function(e,t){var n=new e(this,t);return this.encounters.push(n),this.active||(this.active=n),n},getTargetEntity:function(){var e=null;return this.active&&(e=this.active.targetEntity),e},_compass_tick:function(t){var n=this.getTargetEntity();if(n){var r=this.state.getEntityWithTag("pc");y=[n.get("xform.tx"),n.get("xform.ty")];var i=y[0]-r.get("xform.tx"),s=y[1]-r.get("xform.ty"),o=Math.sqrt(i*i+s*s),u=640,a=Math.round(r.get("xform.tx")),f=Math.round(r.get("xform.ty")),l=Math.round(n.get("xform.tx")),c=Math.round(n.get("xform.ty")),h=Math.round(64-this.state._entityContainer.y),p=Math.round(this.state.game.renderer.height-64-this.state._entityContainer.y),d=Math.round(64-this.state._entityContainer.x),v=Math.round(this.state.game.renderer.width-64-this.state._entityContainer.x);coords=[[d,h,v,h],[d,p,v,p],[d,h,d,p],[v,h,v,p]];var m=!1;for(var g=coords.length-1;g>=0;g--){var y=coords[g];if(this._debug_tick){var b=y[0],w=y[1],E=y[2],S=y[3],x=((a*c-f*l)*(b-E)-(a-l)*(b*S-w*E))/((a-l)*(w-S)-(f-c)*(b-E)),T=((a*c-f*l)*(w-S)-(f-c)*(b*S-w*E))/((a-l)*(w-S)-(f-c)*(b-E));console.log(x,T),console.log(a,f,l,c,y[0],y[1],y[2],y[3])}m=e.collision.lineIntersect(a,f,l,c,y[0],y[1],y[2],y[3]);if(m)break}m?(tx=m[0],ty=m[1]):(tx=n.get("xform.tx"),ty=n.get("xform.ty"));var N={top:h,bottom:p,left:d,right:v};this.compassActor.setLocation(tx,ty)}},tick:function(){this.state.getEntitiesWithTag("pc").length<=0&&this.state.game.fsm.gameOver(),_.every(this.encounters,function(e){return e.isFinished()})&&this.state.game.fsm.gameWin(),this._compass_tick()},complete:function(e){this._next=-1,this.switch()},next:function(){var e=_.filter(this.encounters,function(e){return!e.isFinished()});return this._index++,this._index>=e.length&&(this._index=0),e[this._index]},"switch":function(){this.active=this.next()}}),i=t.extend({start:function(){this.total=3;var e=this.block.getRandomEncounterRoom({territory:"neutral"}),t=this.state.factory("woman",{xform:{tx:e.cx*32,ty:e.cy*32},interact:{priority:!0},encounter:{encounter:this},actions:{interact:["switch","${encounter.status}",[["dialog","Please help me! I haven't seen my daughter all day. Can you find her and make sure she is ok. Thanks."],["set","encounter.status",1],["event","daughter","target.set"]],[["dialog","Have you found my daughter yet?! I'm worried!"]],[["dialog","Thank you for finding my daughter. Here take this for your trouble."],["set","@(pc).stats.xp",50,"add"],["set","encounter.status",3]],[["dialog","Welcome to Peach Trees. "]]]}});t.tags.push("mother"),this.block.state.addEntity(t),this.targetEntity=t;var n=this.block.getRandomEncounterRoom({exclude:[e],territory:"neutral"}),r=this.state.factory("woman.young",{xform:{tx:n.cx*32,ty:n.cy*32},interact:{priority:!0},encounter:{encounter:this},actions:{interact:["if","${encounter.status}==1",[["dialog","Yes, I'm doing fine. Tell my mom I'm fine."],["set","encounter.status",2],["event","mother","target.set"]],[["dialog","Hey there. Haven't seen you around the block before."]]]}});r.tags.push("daughter"),this.block.state.addEntity(r)},finish:function(){this._super();var e=this.getPC();e.set("stats.xp",50,"add"),this.state.log("Completed Checkup Encounter")}}),s=t.extend({start:function(){var e=this.block.getRandomEncounterRoom({territory:"albert"}),t=this.state.factory("gangboss",{xform:{tx:e.cx*32,ty:e.cy*32},encounter:{encounter:this},actions:{kill:["if",!0,[["set","@(pc).stats.xp",5,"add"],["set","encounter.status",1]]]}});t.tags.push("gangboss"),this.block.state.addEntity(t),this.targetEntity=t},finish:function(){this._super();var e=this.getPC();e.set("stats.xp",50,"add"),this.state.log("Completed Execute Gang Boss")}}),o={entities:{client:{meta:{inherit:"man",spawn:"room.random"},interact:{priority:!0},actions:{interact:["switch","${encounter.status}",[["dialog","Help me, the Spacers have kidnapped my daughter. Can you get her back for me?"],["set","encounter.status",1]],[["dialog","Please find my daughter"]]]}}}};return{Encounter:t,EncounterSystem:r,ExecuteEncounter:s,CheckupEncounter:i,rescueEncounterTemplate:o,SerialEncounter:n}}),define("dreddrl/dreddrlstate",["sge","./config","./blocklevelgenerator","./physics","./factory","./map","./encounters"],function(e,t,n,r,i,s,o){INTRO="In Mega City One the men and women of the Hall of Justice are the only thing that stand between order and chaos. Jury, judge and executioner these soliders of justice are the physical embodiment of the the law. As a member of this elite group it is your responsiblity to bring justice to Mega City One.",INTRO2="Rookie you have been assigned to dispense the law in this Mega Block.";var u=e.GameState.extend({initState:function(n){this.scene.setBounds(0,0,2048,2048),this.options=n||{},this._contactList=[],this._intro=!1,this._killList=[],this._logMsg=[],this._logQueue=[],this._logTimer=-1,this._track_x=null,this._track_y=null,this._debug_count=0,this._debugTick=!1,this._uiContainer=(new CAAT.ActorContainer).setBounds(0,0,2048,2048),this._entityContainer=(new CAAT.ActorContainer).setBounds(0,0,2048,2048),this.scene.addChild(this._entityContainer),this.scene.addChild(this._uiContainer),this.factory=i,this.map=new s(65,66,{src:["assets/tiles/future1.png","assets/tiles/future2.png","assets/tiles/future3.png","assets/tiles/future4.png"]}),this.map.defaultSheet="future2",this._spatialHash={},this._spatialHashReverse={},this._spatialHashWidth=this.map.width*32/4,this._spatialHashHeight=this.map.height*32/4,this.loader=new e.vendor.PxLoader,this.loader.addProgressListener(this.progressListener.bind(this)),this.loader.addImage(e.config.baseUrl+"assets/tiles/future1.png"),this.loader.addImage(e.config.baseUrl+"assets/tiles/future2.png"),this.loader.addImage(e.config.baseUrl+"assets/tiles/future3.png"),this.loader.addImage(e.config.baseUrl+"assets/tiles/future4.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/judge.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/albert.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/albertbrownhair.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/judge_tint_red.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/albert_tint_red.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/albertbrownhair_tint_red.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/gang_1.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/gang_2.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/gang_6.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/women_1.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/women_2.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/women_3.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/women_4.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/women_5.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/women_6.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/women_7.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/women_8.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/scifi_icons_1.png"),this.loader.addImage(e.config.baseUrl+"assets/sprites/exclimation_icons.png"),this.pause=function(){this.game.fsm.pause()}.bind(this),this.input.addListener("keydown:"+t.pauseButton,this.pause),this.toggleShadows=function(){this.shadows.toggle()}.bind(this),this.loader.start()},evalValue:function(e,t){var n=t;if(e.match(/^@/)){var r=e.split(".")[0];r=r.replace("@(","").replace(")",""),r=="state"?n=this:n=this.getEntitiesWithTag(r)[0],e=e.replace("@("+r+").","")}return n.get(e)},_updateUI:function(){_.map(this._uiFunctions,function(e){e()}),this._updateLog()},_createUIItem:function(t,n,r){r=e.util.extend({tx:16,ty:16},r||{});var i=(new CAAT.ActorContainer).setLocation(r.tx,r.ty),s="24px sans-serif",t=(new CAAT.TextActor).setFont(s).setText(t),o=(new CAAT.TextActor).setFont(s).setText("null");t.calcTextSize(this.game.renderer),o.setLocation(t.textWidth+4,0),i.addChild(t),i.addChild(o);var u=function(){var e=this.evalValue(n);o.setText(e)};this._uiFunctions.push(u.bind(this)),this._uiContainer.addChild(i)},initGame:function(){this.physics=new r(this),this.map.setup(this._entityContainer),this._interaction_actor=(new CAAT.Actor).setFillStyle("green").setStrokeStyle("black").setSize(32,32).setVisible(!1),this._entityContainer.addChild(this._interaction_actor),this.level=new n(this,this.options);var e=i("pc",{xform:{tx:96,ty:384}});e.tags.push("pc"),e.addListener("kill",function(){this.state._killList.push(e)}.bind(e)),this.addEntity(e),this.pc=e,this.encounterSystem=new o.EncounterSystem(this),this.encounterSystem.create(o.CheckupEncounter),this.encounterSystem.create(o.ExecuteEncounter),this.encounterSystem.create(o.SerialEncounter,o.rescueEncounterTemplate),this.map.render(),this.input.addListener("keydown:Q",function(){this.encounterSystem.switch()}.bind(this)),setTimeout(function(){this.game.fsm.finishLoad()}.bind(this),1e3),this.map.render(this.game.renderer),this._uiFunctions=[],this._createUIItem("XP:","@(pc).stats.xp"),this._createUIItem("AMMO:","@(pc).inventory.ammo",{ty:40}),this._createUIItem("HEALTH:","@(pc).health.life",{ty:64}),this._logs=[],this._cachedLogLength=this._logs.length,this._logContainer=new CAAT.ActorContainer,this._logContainer.setLocation(16,this.game.renderer.height-80),this.logActors=[];var t=16;this.logActors[0]=(new CAAT.TextActor).setFont(t+"px sans-serif").setLocation(0,0),this._logContainer.addChild(this.logActors[0]),this.logActors[1]=(new CAAT.TextActor).setFont(t+"px sans-serif").setLocation(0,16).setAlpha(.75),this._logContainer.addChild(this.logActors[1]),this.logActors[2]=(new CAAT.TextActor).setFont(t+"px sans-serif").setLocation(0,32).setAlpha(.5),this._logContainer.addChild(this.logActors[2]),this.logActors[3]=(new CAAT.TextActor).setFont(t+"px sans-serif").setLocation(0,48).setAlpha(.25),this._logContainer.addChild(this.logActors[3]),this._uiContainer.addChild(this._logContainer),this._dialogContainer=(new CAAT.ActorContainer).setLocation(16,16).setVisible(!1),this._dialogActor=(new CAAT.TextActor).setFont(t+"px sans-serif").setText("TEST!"),this._dialogContainer.addChild(this._dialogActor),this._uiContainer.addChild(this._dialogContainer),this.log("You are the Law.")},progressListener:function(t){var n=t.resource.getName().split("/"),r=n[n.length-1].split(".")[0],i=32;r.match(/icons/)&&(i=24),e.Renderer.SPRITESHEETS[r]=(new CAAT.SpriteImage).initialize(t.resource.img,t.resource.img.height/i,t.resource.img.width/i),t.completedCount==t.totalCount&&this.initGame()},addEntity:function(e){this._super(e),e.addListener("kill",function(){this._killList.push(e)}.bind(this)),e.addListener("log",function(e){this.logCallback(e)}.bind(this)),e.addListener("xform.move",function(){this._updateHash(e)}.bind(this)),this._updateHash(e)},logCallback:function(e){this.log(e)},log:function(e){this._logs.push(e)},_updateLog:function(){this._cachedLogLength!=this._logs.length&&(this._logContainer.stopCacheAsBitmap(),this._cachedLogLength=this._logs.length,msgs=this._logs.slice(-4),msgs.reverse(),_.each(msgs,function(e,t){this.logActors[t].setText(e)}.bind(this)),this._logContainer.cacheAsBitmap())},_removeFromHash:function(e){var t=this._spatialHashReverse[e.id];this._spatialHashReverse[e.id]=undefined,this._spatialHash[t]=_.without(this._spatialHash[t],e.id)},_updateHash:function(e){var t=Math.floor(e.get("xform.tx")/this._spatialHashWidth),n=Math.floor(e.get("xform.ty")/this._spatialHashHeight);this._spatialHashReverse[e.id]!==undefined&&this._removeFromHash(e);var r=t+"."+n;this._spatialHash[r]==undefined&&(this._spatialHash[r]=[]),this._spatialHash[r].push(e.id),this._spatialHashReverse[e.id]=r},_interaction_tick:function(e){var t=null,n=64,r=null,i=this._spatialHashReverse[this.pc.id],s=_.map(this._spatialHash[i],function(e){return this.getEntity(e)}.bind(this));this._debugTick&&console.log("Interact",s);for(var o=s.length-1;o>=0;o--){entity=s[o];if(entity.get("interact")==undefined)continue;if(entity==this.pc)continue;entity.get("interact.targets")!==null?coords=entity.get("interact.targets"):coords=[[entity.get("xform.tx"),entity.get("xform.ty")]];for(var u=coords.length-1;u>=0;u--){var a=coords[u][0]-this.pc.get("xform.tx"),f=coords[u][1]-this.pc.get("xform.ty"),l=Math.sqrt(a*a+f*f);l<=entity.get("interact.dist")&&l<n&&(t=entity,n=l,r=coords[u])}}t!=this._closest&&(this._closest&&(this._closest.fireEvent("focus.lose"),this._interaction_actor.setVisible(!1)),t&&(t.fireEvent("focus.gain",r),this._interaction_actor.setLocation(r[0],r[1]),this._interaction_actor.setVisible(!0)),this._closest=t),t!=null&&this._interaction_actor.setLocation(r[0],r[1])},startDialog:function(e){this.game._states.dialog.setDialog(e),this.game.fsm.startDialog()},tick:function(e){this._debugTick=this.game.engine._debugTick;var t=Date.now();this.tickTimeouts(e);if(this._debugTick){var n=Date.now();console.log("Timeout Time:",n-t),t=n}this.physics.resolveCollisions(e);if(this._debugTick){var n=Date.now();console.log("Physics Time:",n-t),t=n}this._intro==0&&(this._intro=!0,this.startDialog(INTRO)),this._interaction_tick(e);if(this._debugTick){var n=Date.now();console.log("Interaction Time:",n-t),t=n}for(var r=this._entity_ids.length-1;r>=0;r--)this.entities[this._entity_ids[r]].componentCall("tick",e);if(this._debugTick){var n=Date.now();console.log("Component Time:",n-t,this._entity_ids.length),t=n}_.each(this._killList,function(e){this._removeFromHash(e),this.removeEntity(e)}.bind(this));if(this._debugTick){var n=Date.now();console.log("Kill Time:",n-t),t=n}this.encounterSystem.tick(e);var i=this.pc.get("xform.tx"),s=this.pc.get("xform.ty");this._entityContainer.setLocation(-i+this.game.renderer.width/2,-s+this.game.renderer.height/2),this._updateUI();if(this._debugTick){var n=Date.now();console.log("Scene Time:",n-t),t=n}_.each(this._entity_ids,function(e){var t=this.entities[e],n=t.get("xform.tx"),r=t.get("xform.ty"),i=this.map.getTile(Math.floor(n/32),Math.floor(r/32));(i.fade<1||!0)&&t.componentCall("render",this.game.renderer,"main")}.bind(this));if(this._debugTick){var n=Date.now();console.log("Render Time:",n-t),t=n}},_paused_tick:function(e){_.each(this._entity_ids,function(e){var t=this.entities[e];t.componentCall("render",this.game.renderer,"main")}.bind(this))}});return u}),define("dreddrl/dialogstate",["sge","./config"],function(e,t){var n=e.GameState.extend({initState:function(){this._keepScene=!0;var e=this.game.renderer.width,n=this.game.renderer.height;this.container=(new CAAT.ActorContainer).setBounds(0,0,e,n),this.dialogContainer=(new CAAT.ActorContainer).setLocation(16,n/2-32),this.container.addChild((new CAAT.Actor).setSize(e,n).setFillStyle("black").setAlpha(.5)),this.container.addChild(this.dialogContainer),this.interact=this.interact.bind(this),this.input.addListener("keydown:"+t.dialogButton,this.interact)},startState:function(){var e=this.game._states.game;e._uiContainer.setVisible(!1),this.scene=e.scene,this.scene.addChild(this.container),this._super()},endState:function(){var e=this.game._states.game;e._uiContainer.setVisible(!0),this.scene.removeChild(this.container),this.scene=null,this._super()},interact:function(){this.game.fsm.endDialog()},tick:function(){this.game._states.game._paused_tick()},setDialog:function(e){this.dialog=e,this.dialogContainer.stopCacheAsBitmap(),this.dialogContainer.emptyChildren();var t=e.split(" "),n=t.length,r=0,i=0,s=(new CAAT.TextActor).setFont("24px sans-serif"),o=0,u=this.game.renderer.width-64;while(i<=n){var a=t.slice(r,i).join(" ");s.setText(a),s.calcTextSize(this.game.renderer),s.textWidth>u?(i--,s.setLocation(16,o).setText(t.slice(r,i).join(" ")),this.dialogContainer.addChild(s),o+=24,r=i,i=r+1,s=(new CAAT.TextActor).setFont("24px sans-serif")):i++}s.setLocation(16,o),this.dialogContainer.addChild(s),this.dialogContainer.setLocation(16,this.game.renderer.height-(o+96)),this.dialogContainer.cacheAsBitmap()}});return n}),define("dreddrl/pausestate",["sge","./config"],function(e,t){var n=e.GameState.extend({initState:function(){this._keepScene=!0;var e=this.game.renderer.width,n=this.game.renderer.height;this.container=(new CAAT.ActorContainer).setBounds(0,0,e,n);var r=(new CAAT.TextActor).setText("Paused").setFont("64px sans-serif").setTextAlign("center").setLocation(e/2,n/2-32);this.container.addChild((new CAAT.Actor).setSize(e,n).setFillStyle("black").setAlpha(.5)),this.container.addChild(r),this.unpause=function(){this.game.fsm.unpause()}.bind(this),this.input.addListener("keydown:"+t.unpauseButton,this.unpause),this.input.addListener("tap",this.unpause)},startState:function(){var e=this.game._states.game;this.scene=e.scene,this.scene.addChild(this.container),this._super()},endState:function(){this.scene.removeChild(this.container),this.scene=null,this._super()},tick:function(e){func=this.game._states.game._paused_tick,func&&func.call(this.game._states.game,e)}});return n}),define("dreddrl/main",["./dreddrlstate","./dialogstate","./pausestate"],function(e,t,n){return{DreddRLState:e,DialogState:t,PauseState:n}}),define("dreddrl",["dreddrl/main"],function(e){return e});