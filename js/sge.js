//     Underscore.js 1.4.4
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore may be freely distributed under the MIT license.

/*
The MIT License

Copyright (c) 2010-2011-2012 Ibon Tolosana [@hyperandroid]

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

Version: 0.6 build: 49

Created on:
DATE: 2013-04-03
TIME: 21:50:58
*/

/*

  Javascript State Machine Library - https://github.com/jakesgordon/javascript-state-machine

  Copyright (c) 2012, 2013 Jake Gordon and contributors
  Released under the MIT license - https://github.com/jakesgordon/javascript-state-machine/blob/master/LICENSE

*/

/*! Hammer.JS - v1.0.6dev - 2013-04-10
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2013 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */

function proxyFunction(e,t,n,r,i){return function(){var s=Array.prototype.slice.call(arguments);n&&n({object:e,method:t,arguments:s});var o=null;try{o=e[t].apply(e,s);if(r){var u=r({object:e,method:t,arguments:s});u&&(o=u)}}catch(a){if(!i)throw a;o=i({object:e,method:t,arguments:s,exception:a})}return o}}function proxyAttribute(e,t,n,r,i){e.__defineGetter__(n,function(){return r&&r(t,n),t[n]}),e.__defineSetter__(n,function(e){t[n]=e,i&&i(t,n,e)})}function proxyObject(e,t,n,r,i,s){if(typeof e!="object"||isArray(e)||isString(e)||e.$proxy)return e;var o={};o.$proxy=!0,o.$proxy_delegate=e;for(var u in e){if(u==="constructor")continue;typeof e[u]=="function"?o[u]=proxyFunction(e,u,t,n,r):proxyAttribute(o,e,u,i,s)}return o}define("sge/config",[],function(){return{baseUrl:""}}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?void 0:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t==null?x.identity:t);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);if(t.length===0)throw new Error("bindAll must be passed function names");return T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,f<=0?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]===void 0&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=M(e[o],t[o],n,r)))break}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)){o++;if(!(u=x.has(t,c)&&M(e[c],t[c],n,r)))break}if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(e);for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=x.invert(_.escape);var D={escape:new RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(e==null)return void 0;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=++P+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(j,function(e){return"\\"+B[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("sge/vendor/underscore",function(e){return function(){var t,n;return t||e._}}(this)),function(e){function o(t){var n=t.split("."),r=e;for(var i=0;i<n.length-1;i++)r[n[i]]||(r[n[i]]={}),r=r[n[i]]}function u(t,n){var r=t.split("."),i=e;for(var s=0;s<r.length-1;s++){if(!i[r[s]])return console.log("    Error assigning value to namespace :"+t+". '"+r[s]+"' does not exist."),null;i=i[r[s]]}return i[r[r.length-1]]=n,i[r[r.length-1]]}function a(t){var n=t.split("."),r=e;for(var i=0;i<n.length;i++){if(!r[n[i]])return null;r=r[n[i]]}return r}String.prototype.endsWith=function(e){return this.indexOf(e,this.length-e.length)!==-1},Function.prototype.bind=Function.prototype.bind||function(){var e=this,t=Array.prototype.slice.call(arguments),n=t.shift();return function(){return e.apply(n,t.concat(Array.prototype.slice.call(arguments)))}},e.isArray=function(e){return typeof e=="object"&&e instanceof Array},e.isString=function(e){return typeof e=="string"},e.isFunction=function(e){return typeof e=="function"};var t=!1,n=function(){};n.extend=function(e,r,i,s,a){function c(){!t&&this.__init&&this.__init.apply(this,arguments)}var f=this.prototype;t=!0;var l=new this;t=!1,c.prototype=l,c.prototype.constructor=c,c.superclass=f,c.extend=n.extend,u(i,c);if(r){r=isFunction(r)?r():r;for(var h in r)r.hasOwnProperty(h)&&(c[h]=r[h])}c.__CLASS=i;if(s){isArray(s)||(s=[s]);for(var p=0;p<s.length;p++){o(s[p]);var d=u(s[p],c);if(r)for(var h in r)r.hasOwnProperty(h)&&(d[h]=r[h])}}e=isFunction(e)?e():e;for(var v in e)l[v]=(v==="__init"||a&&a.decorated)&&isFunction(e[v])&&isFunction(f[v])?function(e,t){return function(){var n=this.__super;this.__super=f[e];var r=t.apply(this,arguments);return this.__super=n,r}}(v,e[v]):e[v];return c};var r=function(e){return this.name=e.defines,this.extendWith=e.extendsWith,this.callback=e.onCreate,this.callbackPreCreation=e.onPreCreate,this.dependencies=e.depends,this.baseClass=e.extendsClass,this.aliases=e.aliases,this.constants=e.constants,this.decorated=e.decorated,this.children=[],this};r.prototype={children:null,name:null,extendWith:null,callback:null,dependencies:null,baseClass:null,aliases:null,constants:null,decorated:!1,solved:!1,visited:!1,status:function(){console.log("  Module: "+this.name+(this.dependencies.length?" unsolved_deps:["+this.dependencies+"]":" no dependencies.")+(this.solved?" solved":" ------> NOT solved."))},removeDependency:function(e){for(var t=0;t<this.dependencies.length;t++)if(this.dependencies[t]===e){this.dependencies.splice(t,1);break}},assignDependency:function(e){var t;for(t=0;t<this.dependencies.length;t++)if(this.dependencies[t]===e.name){this.children.push(e),this.dependencies.splice(t,1);break}},isSolved:function(){return this.solved},solveDeep:function(){if(this.visited)return!0;this.visited=!0;if(this.solved)return!0;if(this.dependencies.length!==0)return!1;var e=!0;for(var t=0;t<this.children.length;t++)if(!this.children[t].solveDeep())return!1;return this.__initModule(),this.solved=!0,f.solved(this),!0},__initModule:function(){var e=null;if(this.baseClass){e=a(this.baseClass);if(!e){console.log("  "+this.name+" -> Can't extend non-existant class: "+this.baseClass);return}}else e=n;e=e.extend(this.extendWith,this.constants,this.name,this.aliases,{decorated:this.decorated}),console.log("Created module: "+this.name),this.callback&&this.callback()}};var i=function(e,t){return this.path=e,this.module=t,this};i.prototype={path:null,processed:!1,module:null,setProcessed:function(){this.processed=!0},isProcessed:function(){return this.processed}};var s=function(){return this.nodes=[],this.loadedFiles=[],this.path={},this.solveListener=[],this.orderedSolvedModules=[],this.readyListener=[],this};s.baseURL="",s.modulePath={},s.sortedModulePath=[],s.symbol={},s.prototype={nodes:null,loadedFiles:null,solveListener:null,readyListener:null,orderedSolvedModules:null,addSolvedListener:function(e,t){this.solveListener.push({name:e,callback:t})},solved:function(e){var t;for(t=0;t<this.solveListener.length;t++)this.solveListener[t].name===e.name&&this.solveListener[t].callback();this.orderedSolvedModules.push(e),this.notifyReady()},notifyReady:function(){var e;for(e=0;e<this.nodes.length;e++)if(!this.nodes[e].isSolved())return;for(e=0;e<this.loadedFiles.length;e++)if(!this.loadedFiles[e].isProcessed())return;var t=this,n=Array.prototype.slice.call(this.readyListener);setTimeout(function(){for(var e=0;e<n.length;e++)n[e]()},0),this.readyListener=[]},status:function(){for(var e=0;e<this.nodes.length;e++)this.nodes[e].status()},module:function(e){var t,n,i;if(this.isModuleScheduledToSolve(e.defines))return this;if(e.onPreCreate)try{e.onPreCreate()}catch(s){console.log("  -> catched "+s+" on module "+e.defines+" preCreation.")}e.depends||(e.depends=[]);var o=e.depends;o&&(isArray(o)||(o=[o],e.depends=o)),i=0;while(i<o.length)this.alreadySolved(o[i])?o.splice(i,1):i++;n=new r(e);for(var i=0;i<this.nodes.length;i++)this.nodes[i].assignDependency(n);this.nodes.push(n);for(i=0;i<e.depends.length;)if(this.isModuleScheduledToSolve(e.depends[i])){var u=this.findNode(e.depends[i]);null!==u?n.assignDependency(u):(alert("Module loaded and does not exist in loaded modules nodes. "+e.depends[i]),i++)}else i+=1;return function(e,t){setTimeout(function(){for(i=0;i<t.depends.length;i++)e.loadFile(t.depends[i])},0)}(this,e),this},findNode:function(e){for(var t=0;t<this.nodes.length;t++)if(this.nodes[t].name===e)return this.nodes[t];return null},alreadySolved:function(e){for(var t=0;t<this.nodes.length;t++)if(this.nodes[t].name===e&&this.nodes[t].isSolved())return!0;return!1},exists:function(t){var t=t.split("."),n=e;for(var r=0;r<t.length;r++){if(!n[t[r]])return!1;n=n[t[r]]}return!0},loadFile:function(e){if(this.exists(e))return;var t=this.getPath(e);for(var n=0;n<this.loadedFiles.length;n++)if(this.loadedFiles[n].path===t)return;var r=new i(t,e);this.loadedFiles.push(r);var s=document.createElement("script");s.type="text/javascript",s.charset="utf-8",s.async=!0,s.addEventListener("load",this.moduleLoaded.bind(this),!1),s.addEventListener("error",this.moduleErrored.bind(this),!1),s.setAttribute("module-name",e),s.src=t+(l?"":"?"+(new Date).getTime()),document.getElementsByTagName("head")[0].appendChild(s)},getPath:function(e){if(e.endsWith(".js"))return e.charAt(0)!=="/"?e=s.baseURL+e:e=e.substring(1),e;var t,n;for(n in s.symbol)if(e===n)return s.baseURL+s.symbol[n];for(t=0;t<s.sortedModulePath.length;t++){var r=s.sortedModulePath[t];if(s.modulePath.hasOwnProperty(r)){var i=s.modulePath[r];if(e.indexOf(r)===0){var o=e.substring(r.length+1);return o=o.replace(/\./g,"/"),o=i+o+".js",s.baseURL+o}}}return s.baseURL+e.replace(/\./g,"/")+".js"},isModuleScheduledToSolve:function(e){for(var t=0;t<this.nodes.length;t++)if(this.nodes[t].name===e)return!0;return!1},moduleLoaded:function(e){if(e.type==="load"){var t=e.currentTarget||e.srcElement||e.target,n=t.getAttribute("module-name");for(var r=0;r<this.loadedFiles.length;r++)if(this.loadedFiles[r].module===n){this.loadedFiles[r].setProcessed();break}for(var r=0;r<this.nodes.length;r++)this.nodes[r].removeDependency(n);for(var r=0;r<this.nodes.length;r++){for(var i=0;i<this.nodes.length;i++)this.nodes[i].visited=!1;this.nodes[r].solveDeep()}var s=this;setTimeout(function(){s.notifyReady()},0)}},moduleErrored:function(e){var t=e.currentTarget||e.srcElement;console.log("Error loading module: "+t.getAttribute("module-name"))},solvedInOrder:function(){for(var e=0;e<this.orderedSolvedModules.length;e++)console.log(this.orderedSolvedModules[e].name)},solveAll:function(){for(var e=0;e<this.nodes.length;e++)this.nodes[e].solveDeep()},onReady:function(e){this.readyListener.push(e)}};var f=new s,l=!1;e.CAAT=e.CAAT||{},CAAT.Module=function(t){if(!t.defines){console.error("Bad module definition: "+t);return}o(t.defines),f.module(t)},CAAT.ModuleManager={},CAAT.ModuleManager.baseURL=function(e){return e?(e.endsWith("/")||(e+="/"),s.baseURL=e,CAAT.ModuleManager):CAAT.Module},CAAT.ModuleManager.setModulePath=function(e,t){return t.endsWith("/")||(t+="/"),s.modulePath[e]||(s.modulePath[e]=t,s.sortedModulePath.push(e),s.sortedModulePath.sort(function(e,t){return e==t?0:e<t?1:-1})),CAAT.ModuleManager},CAAT.ModuleManager.symbol=function(e,t){return s.symbol[e]||(s.symbol[e]=t),CAAT.ModuleManager},CAAT.ModuleManager.bring=function(e){isArray(e)||(e=[e]);for(var t=0;t<e.length;t++)f.loadFile(e[t]);return CAAT.ModuleManager},CAAT.ModuleManager.status=function(){f.status()},CAAT.ModuleManager.addModuleSolvedListener=function(e,t){return f.addSolveListener(e,t),CAAT.ModuleManager},CAAT.ModuleManager.load=function(e,t,n){var r=document.createElement("script");r.type="text/javascript",r.charset="utf-8",r.async=!0,t&&r.addEventListener("load",t,!1),n&&r.addEventListener("error",n,!1),r.addEventListener("load",function(){f.solveAll()},!1),r.src=e+(l?"":"?"+(new Date).getTime()),document.getElementsByTagName("head")[0].appendChild(r)},CAAT.ModuleManager.solvedInOrder=function(){f.solvedInOrder()},CAAT.ModuleManager.onReady=function(e){return f.onReady(e),CAAT.ModuleManager},CAAT.ModuleManager.solveAll=function(){f.solveAll()},CAAT.ModuleManager.debug=function(e){return l=e,CAAT.ModuleManager},CAAT.Class=n}(this),CAAT.Module({defines:"CAAT.Core.Constants",depends:["CAAT.Math.Matrix"],extendsWith:function(){return CAAT.CLAMP=!1,CAAT.setCoordinateClamping=function(e){CAAT.CLAMP=e,CAAT.Math.Matrix.setCoordinateClamping(e)},CAAT.log=function(){window.console&&window.console.log(Array.prototype.slice.call(arguments))},CAAT.CSS_TEXT_METRICS=0,CAAT.GLRENDER=!1,CAAT.DEBUG=!1,CAAT.DEBUGBB=!1,CAAT.DEBUGBBBCOLOR="#00f",CAAT.DEBUGAABB=!1,CAAT.DEBUGAABBCOLOR="#f00",CAAT.DEBUG_DIRTYRECTS=!1,CAAT.DRAG_THRESHOLD_X=5,CAAT.DRAG_THRESHOLD_Y=5,CAAT.CACHE_SCENE_ON_CHANGE=!0,{}}}),extend=function(e,t){var n=e.prototype,r=function(){};r.prototype=t.prototype,e.prototype=new r,e.superclass=t.prototype,e.prototype.constructor=e,t.prototype.constructor===Object.prototype.constructor&&(t.prototype.constructor=t);for(var i in n)n.hasOwnProperty(i)&&(e.prototype[i]=n[i])},extendWith=function(e,t,n){var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.superclass=e.prototype,t.prototype.constructor=t,e.prototype.constructor===Object.prototype.constructor&&(e.prototype.constructor=e);if(n)for(var i in n)n.hasOwnProperty(i)&&(t.prototype[i]=n[i])},CAAT.Module({defines:"CAAT.Core.Class",extendsWith:function(){return{}}}),CAAT.Module({defines:"CAAT.Math.Bezier",depends:["CAAT.Math.Curve"],extendsClass:"CAAT.Math.Curve",aliases:["CAAT.Bezier"],extendsWith:function(){return{cubic:!1,applyAsPath:function(e){var t=this.coordlist;return this.cubic?e.ctx.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y):e.ctx.quadraticCurveTo(t[1].x,t[1].y,t[2].x,t[2].y),this},isQuadric:function(){return!this.cubic},isCubic:function(){return this.cubic},setCubic:function(e,t,n,r,i,s,o,u){return this.coordlist=[],this.coordlist.push((new CAAT.Math.Point).set(e,t)),this.coordlist.push((new CAAT.Math.Point).set(n,r)),this.coordlist.push((new CAAT.Math.Point).set(i,s)),this.coordlist.push((new CAAT.Math.Point).set(o,u)),this.cubic=!0,this.update(),this},setQuadric:function(e,t,n,r,i,s){return this.coordlist=[],this.coordlist.push((new CAAT.Math.Point).set(e,t)),this.coordlist.push((new CAAT.Math.Point).set(n,r)),this.coordlist.push((new CAAT.Math.Point).set(i,s)),this.cubic=!1,this.update(),this},setPoints:function(e){if(e.length===3)this.coordlist=e,this.cubic=!1,this.update();else{if(e.length!==4)throw"points must be an array of 3 or 4 CAAT.Point instances.";this.coordlist=e,this.cubic=!0,this.update()}return this},paint:function(e){this.cubic?this.paintCubic(e):this.paintCuadric(e),CAAT.Math.Bezier.superclass.paint.call(this,e)},paintCuadric:function(e){var t,n;t=this.coordlist[0].x,n=this.coordlist[0].y;var r=e.ctx;r.save(),r.beginPath(),r.moveTo(t,n);var i=new CAAT.Math.Point;for(var s=this.k;s<=1+this.k;s+=this.k)this.solve(i,s),r.lineTo(i.x,i.y);r.stroke(),r.restore()},paintCubic:function(e){var t,n;t=this.coordlist[0].x,n=this.coordlist[0].y;var r=e.ctx;r.save(),r.beginPath(),r.moveTo(t,n);var i=new CAAT.Math.Point;for(var s=this.k;s<=1+this.k;s+=this.k)this.solve(i,s),r.lineTo(i.x,i.y);r.stroke(),r.restore()},solve:function(e,t){return this.cubic?this.solveCubic(e,t):this.solveQuadric(e,t)},solveCubic:function(e,t){var n=t*t,r=t*n,i=this.coordlist,s=i[0],o=i[1],u=i[2],a=i[3];return e.x=s.x+t*(-s.x*3+t*(3*s.x-s.x*t))+t*(3*o.x+t*(-6*o.x+o.x*3*t))+n*(u.x*3-u.x*3*t)+a.x*r,e.y=s.y+t*(-s.y*3+t*(3*s.y-s.y*t))+t*(3*o.y+t*(-6*o.y+o.y*3*t))+n*(u.y*3-u.y*3*t)+a.y*r,e},solveQuadric:function(e,t){var n=this.coordlist,r=n[0],i=n[1],s=n[2],o=1-t;return e.x=o*o*r.x+2*o*t*i.x+t*t*s.x,e.y=o*o*r.y+2*o*t*i.y+t*t*s.y,e}}}}),CAAT.Module({defines:"CAAT.Math.CatmullRom",depends:["CAAT.Math.Curve"],extendsClass:"CAAT.Math.Curve",aliases:["CAAT.CatmullRom"],extendsWith:function(){return{setCurve:function(e,t,n,r){return this.coordlist=[],this.coordlist.push(e),this.coordlist.push(t),this.coordlist.push(n),this.coordlist.push(r),this.update(),this},paint:function(e){var t,n;t=this.coordlist[1].x,n=this.coordlist[1].y;var r=e.ctx;r.save(),r.beginPath(),r.moveTo(t,n);var i=new CAAT.Point;for(var s=this.k;s<=1+this.k;s+=this.k)this.solve(i,s),r.lineTo(i.x,i.y);r.stroke(),r.restore(),CAAT.Math.CatmullRom.superclass.paint.call(this,e)},solve:function(e,t){var n=this.coordlist,r=((-t+2)*t-1)*t*.5,i=((3*t-5)*t*t+2)*.5,s=((-3*t+4)*t+1)*t*.5,o=(t-1)*t*t*.5;return e.x=n[0].x*r+n[1].x*i+n[2].x*s+n[3].x*o,e.y=n[0].y*r+n[1].y*i+n[2].y*s+n[3].y*o,e},applyAsPath:function(e){var t=e.ctx,n=new CAAT.Math.Point;for(var r=this.k;r<=1+this.k;r+=this.k)this.solve(n,r),t.lineTo(n.x,n.y);return this},endCurvePosition:function(){return this.coordlist[this.coordlist.length-2]},startCurvePosition:function(){return this.coordlist[1]}}}}),CAAT.Module({defines:"CAAT.Math.Curve",depends:["CAAT.Math.Point"],extendsWith:function(){return{coordlist:null,k:.05,length:-1,HANDLE_SIZE:20,drawHandles:!0,paint:function(e){if(!1===this.drawHandles)return;var t=this.coordlist,n=e.ctx;n.save(),n.beginPath(),n.strokeStyle="#a0a0a0",n.moveTo(t[0].x,t[0].y),n.lineTo(t[1].x,t[1].y),n.stroke(),this.cubic&&(n.moveTo(t[2].x,t[2].y),n.lineTo(t[3].x,t[3].y),n.stroke()),n.globalAlpha=.5;for(var r=0;r<this.coordlist.length;r++){n.fillStyle="#7f7f00";var i=this.HANDLE_SIZE/2;n.beginPath(),n.arc(t[r].x,t[r].y,i,0,2*Math.PI,!1),n.fill()}n.restore()},update:function(){this.calcLength()},solve:function(e,t){},getContour:function(e){var t=[],n;for(n=0;n<=e;n++){var r=new CAAT.Math.Point;this.solve(r,n/e),t.push(r)}return t},getBoundingBox:function(e){e||(e=new CAAT.Math.Rectangle),e.setEmpty(),e.union(this.coordlist[0].x,this.coordlist[0].y);var t=new CAAT.Math.Point;for(var n=this.k;n<=1+this.k;n+=this.k)this.solve(t,n),e.union(t.x,t.y);return e},calcLength:function(){var e,t;e=this.coordlist[0].x,t=this.coordlist[0].y;var n=0,r=new CAAT.Math.Point;for(var i=this.k;i<=1+this.k;i+=this.k)this.solve(r,i),n+=Math.sqrt((r.x-e)*(r.x-e)+(r.y-t)*(r.y-t)),e=r.x,t=r.y;return this.length=n,n},getLength:function(){return this.length},endCurvePosition:function(){return this.coordlist[this.coordlist.length-1]},startCurvePosition:function(){return this.coordlist[0]},setPoints:function(e){},setPoint:function(e,t){t>=0&&t<this.coordlist.length&&(this.coordlist[t]=e)},applyAsPath:function(e){}}}}),CAAT.Module({defines:"CAAT.Math.Dimension",aliases:["CAAT.Dimension"],extendsWith:function(){return{width:0,height:0,__init:function(e,t){return this.width=e,this.height=t,this}}}}),CAAT.Module({defines:"CAAT.Math.Matrix",depends:["CAAT.Math.Point"],aliases:["CAAT.Matrix"],onCreate:function(){CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Math.Matrix.prototype.transformRenderingContext_NoClamp,CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Math.Matrix.prototype.transformRenderingContextSet_NoClamp},constants:{setCoordinateClamping:function(e){e?(CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_Clamp,CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_Clamp,CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_Clamp,CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_Clamp):(CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_NoClamp,CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_NoClamp,CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_NoClamp,CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_NoClamp)}},extendsWith:function(){return{matrix:null,__init:function(){return this.matrix=[1,0,0,0,1,0,0,0,1],typeof Float32Array!="undefined"&&(this.matrix=new Float32Array(this.matrix)),this},transformCoord:function(e){var t=e.x,n=e.y,r=this.matrix;return e.x=t*r[0]+n*r[1]+r[2],e.y=t*r[3]+n*r[4]+r[5],e},rotate:function(e){var t=new CAAT.Math.Matrix;return t.setRotation(e),t},setRotation:function(e){this.identity();var t=this.matrix,n=Math.cos(e),r=Math.sin(e);return t[0]=n,t[1]=-r,t[3]=r,t[4]=n,this},scale:function(e,t){var n=new CAAT.Math.Matrix;return n.matrix[0]=e,n.matrix[4]=t,n},setScale:function(e,t){return this.identity(),this.matrix[0]=e,this.matrix[4]=t,this},translate:function(e,t){var n=new CAAT.Math.Matrix;return n.matrix[2]=e,n.matrix[5]=t,n},setTranslate:function(e,t){return this.identity(),this.matrix[2]=e,this.matrix[5]=t,this},copy:function(e){e=e.matrix;var t=this.matrix;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this},identity:function(){var e=this.matrix;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,this},multiply:function(e){var t=this.matrix,n=e.matrix,r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8];return t[0]=r*h+i*v+s*y,t[1]=r*p+i*m+s*b,t[2]=r*d+i*g+s*w,t[3]=o*h+u*v+a*y,t[4]=o*p+u*m+a*b,t[5]=o*d+u*g+a*w,t[6]=f*h+l*v+c*y,t[7]=f*p+l*m+c*b,t[8]=f*d+l*g+c*w,this},premultiply:function(e){var t=e.matrix[0]*this.matrix[0]+e.matrix[1]*this.matrix[3]+e.matrix[2]*this.matrix[6],n=e.matrix[0]*this.matrix[1]+e.matrix[1]*this.matrix[4]+e.matrix[2]*this.matrix[7],r=e.matrix[0]*this.matrix[2]+e.matrix[1]*this.matrix[5]+e.matrix[2]*this.matrix[8],i=e.matrix[3]*this.matrix[0]+e.matrix[4]*this.matrix[3]+e.matrix[5]*this.matrix[6],s=e.matrix[3]*this.matrix[1]+e.matrix[4]*this.matrix[4]+e.matrix[5]*this.matrix[7],o=e.matrix[3]*this.matrix[2]+e.matrix[4]*this.matrix[5]+e.matrix[5]*this.matrix[8],u=e.matrix[6]*this.matrix[0]+e.matrix[7]*this.matrix[3]+e.matrix[8]*this.matrix[6],a=e.matrix[6]*this.matrix[1]+e.matrix[7]*this.matrix[4]+e.matrix[8]*this.matrix[7],f=e.matrix[6]*this.matrix[2]+e.matrix[7]*this.matrix[5]+e.matrix[8]*this.matrix[8];return this.matrix[0]=t,this.matrix[1]=n,this.matrix[2]=r,this.matrix[3]=i,this.matrix[4]=s,this.matrix[5]=o,this.matrix[6]=u,this.matrix[7]=a,this.matrix[8]=f,this},getInverse:function(){var e=this.matrix,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=new CAAT.Math.Matrix,c=t*(s*f-a*o)-i*(n*f-a*r)+u*(n*o-s*r);if(c===0)return null;var h=l.matrix;return h[0]=s*f-o*a,h[1]=r*a-n*f,h[2]=n*o-r*s,h[3]=o*u-i*f,h[4]=t*f-r*u,h[5]=r*i-t*o,h[6]=i*a-s*u,h[7]=n*u-t*a,h[8]=t*s-n*i,l.multiplyScalar(1/c),l},multiplyScalar:function(e){var t;for(t=0;t<9;t++)this.matrix[t]*=e;return this},transformRenderingContextSet_NoClamp:function(e){var t=this.matrix;return e.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),this},transformRenderingContext_NoClamp:function(e){var t=this.matrix;return e.transform(t[0],t[3],t[1],t[4],t[2],t[5]),this},transformRenderingContextSet_Clamp:function(e){var t=this.matrix;return e.setTransform(t[0],t[3],t[1],t[4],t[2]>>0,t[5]>>0),this},transformRenderingContext_Clamp:function(e){var t=this.matrix;return e.transform(t[0],t[3],t[1],t[4],t[2]>>0,t[5]>>0),this},setModelViewMatrix:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g;g=this.matrix,c=1,h=0,d=0,v=1,p=e,m=t,s=Math.cos(i),o=Math.sin(i),u=c,a=h,f=d,l=v,c=u*s+a*o,h=-u*o+a*s,d=f*s+l*o,v=-f*o+l*s,c*=this.scaleX,h*=this.scaleY,d*=this.scaleX,v*=this.scaleY,g[0]=c,g[1]=h,g[2]=p,g[3]=d,g[4]=v,g[5]=m}}}}),CAAT.Module({defines:"CAAT.Math.Matrix3",aliases:["CAAT.Matrix3"],extendsWith:function(){return{matrix:null,fmatrix:null,__init:function(){return this.matrix=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.fmatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this},transformCoord:function(e){var t=e.x,n=e.y,r=e.z;return e.x=t*this.matrix[0][0]+n*this.matrix[0][1]+r*this.matrix[0][2]+this.matrix[0][3],e.y=t*this.matrix[1][0]+n*this.matrix[1][1]+r*this.matrix[1][2]+this.matrix[1][3],e.z=t*this.matrix[2][0]+n*this.matrix[2][1]+r*this.matrix[2][2]+this.matrix[2][3],e},initialize:function(e,t,n,r,i,s,o,u,a){return this.identity(),this.matrix[0][0]=e,this.matrix[0][1]=t,this.matrix[0][2]=n,this.matrix[1][0]=r,this.matrix[1][1]=i,this.matrix[1][2]=s,this.matrix[2][0]=o,this.matrix[2][1]=u,this.matrix[2][2]=a,this},initWithMatrix:function(e){return this.matrix=e,this},flatten:function(){var e=this.fmatrix,t=this.matrix;return e[0]=t[0][0],e[1]=t[1][0],e[2]=t[2][0],e[3]=t[3][0],e[4]=t[0][1],e[5]=t[1][1],e[6]=t[2][1],e[7]=t[2][1],e[8]=t[0][2],e[9]=t[1][2],e[10]=t[2][2],e[11]=t[3][2],e[12]=t[0][3],e[13]=t[1][3],e[14]=t[2][3],e[15]=t[3][3],this.fmatrix},identity:function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++)this.matrix[e][t]=e===t?1:0;return this},getMatrix:function(){return this.matrix},rotateXY:function(e){return this.rotate(e,0,0)},rotateXZ:function(e){return this.rotate(0,e,0)},rotateYZ:function(e){return this.rotate(0,0,e)},setRotate:function(e,t,n){var r=this.rotate(e,t,n);return this.copy(r),this},rotate:function(e,t,n){var r=new CAAT.Math.Matrix3,i,s,o;return e!==0&&(o=new CAAT.Math.Math.Matrix3,i=Math.sin(e),s=Math.cos(e),o.matrix[1][1]=s,o.matrix[1][2]=-i,o.matrix[2][1]=i,o.matrix[2][2]=s,r.multiply(o)),t!==0&&(o=new CAAT.Math.Matrix3,i=Math.sin(t),s=Math.cos(t),o.matrix[0][0]=s,o.matrix[0][2]=-i,o.matrix[2][0]=i,o.matrix[2][2]=s,r.multiply(o)),n!==0&&(o=new CAAT.Math.Matrix3,i=Math.sin(n),s=Math.cos(n),o.matrix[0][0]=s,o.matrix[0][1]=-i,o.matrix[1][0]=i,o.matrix[1][1]=s,r.multiply(o)),r},getClone:function(){var e=new CAAT.Math.Matrix3;return e.copy(this),e},multiply:function(e){var t=this.getClone(),n=t.matrix,r=n[0][0],i=n[0][1],s=n[0][2],o=n[0][3],u=n[1][0],a=n[1][1],f=n[1][2],l=n[1][3],c=n[2][0],h=n[2][1],p=n[2][2],d=n[2][3],v=n[3][0],m=n[3][1],g=n[3][2],y=n[3][3],b=e.matrix,w=b[0][0],E=b[0][1],S=b[0][2],x=b[0][3],T=b[1][0],N=b[1][1],C=b[1][2],k=b[1][3],L=b[2][0],A=b[2][1],O=b[2][2],M=b[2][3],_=b[3][0],D=b[3][1],P=b[3][2],H=b[3][3];return this.matrix[0][0]=r*w+i*T+s*L+o*_,this.matrix[0][1]=r*E+i*N+s*A+o*D,this.matrix[0][2]=r*S+i*C+s*O+o*P,this.matrix[0][3]=r*x+i*k+s*M+o*H,this.matrix[1][0]=u*w+a*T+f*L+l*_,this.matrix[1][1]=u*E+a*N+f*A+l*D,this.matrix[1][2]=u*S+a*C+f*O+l*P,this.matrix[1][3]=u*x+a*k+f*M+l*H,this.matrix[2][0]=c*w+h*T+p*L+d*_,this.matrix[2][1]=c*E+h*N+p*A+d*D,this.matrix[2][2]=c*S+h*C+p*O+d*P,this.matrix[2][3]=c*x+h*k+p*M+d*H,this},premultiply:function(e){var t=this.getClone(),n=t.matrix,r=n[0][0],i=n[0][1],s=n[0][2],o=n[0][3],u=n[1][0],a=n[1][1],f=n[1][2],l=n[1][3],c=n[2][0],h=n[2][1],p=n[2][2],d=n[2][3],v=n[3][0],m=n[3][1],g=n[3][2],y=n[3][3],b=e.matrix,w=b[0][0],E=b[0][1],S=b[0][2],x=b[0][3],T=b[1][0],N=b[1][1],C=b[1][2],k=b[1][3],L=b[2][0],A=b[2][1],O=b[2][2],M=b[2][3],_=b[3][0],D=b[3][1],P=b[3][2],H=b[3][3];return this.matrix[0][0]=r*w+i*T+s*L,this.matrix[0][1]=r*E+i*N+s*A,this.matrix[0][2]=r*S+i*C+s*O,this.matrix[0][3]=r*x+i*k+s*M+o,this.matrix[1][0]=u*w+a*T+f*L,this.matrix[1][1]=u*E+a*N+f*A,this.matrix[1][2]=u*S+a*C+f*O,this.matrix[1][3]=u*x+a*k+f*M+l,this.matrix[2][0]=c*w+h*T+p*L,this.matrix[2][1]=c*E+h*N+p*A,this.matrix[2][2]=c*S+h*C+p*O,this.matrix[2][3]=c*x+h*k+p*M+d,this},setTranslate:function(e,t,n){return this.identity(),this.matrix[0][3]=e,this.matrix[1][3]=t,this.matrix[2][3]=n,this},translate:function(e,t,n){var r=new CAAT.Math.Matrix3;return r.setTranslate(e,t,n),r},setScale:function(e,t,n){return this.identity(),this.matrix[0][0]=e,this.matrix[1][1]=t,this.matrix[2][2]=n,this},scale:function(e,t,n){var r=new CAAT.Math.Matrix3;return r.setScale(e,t,n),r},rotateModelView:function(e,t,n){var r=Math.sin(e),i=Math.sin(t),s=Math.sin(n),o=Math.cos(e),u=Math.cos(t),a=Math.cos(n);return this.matrix[0][0]=u*o,this.matrix[0][1]=-u*r,this.matrix[0][2]=i,this.matrix[0][3]=0,this.matrix[1][0]=s*i*o+r*a,this.matrix[1][1]=a*o-s*i*r,this.matrix[1][2]=-s*u,this.matrix[1][3]=0,this.matrix[2][0]=s*r-a*i*o,this.matrix[2][1]=a*i*r+s*o,this.matrix[2][2]=a*u,this.matrix[2][3]=0,this.matrix[3][0]=0,this.matrix[3][1]=0,this.matrix[3][2]=0,this.matrix[3][3]=1,this},copy:function(e){for(var t=0;t<4;t++)for(var n=0;n<4;n++)this.matrix[t][n]=e.matrix[t][n];return this},calculateDeterminant:function(){var e=this.matrix,t=e[0][0],n=e[0][1],r=e[0][2],i=e[0][3],s=e[1][0],o=e[1][1],u=e[1][2],a=e[1][3],f=e[2][0],l=e[2][1],c=e[2][2],h=e[2][3],p=e[3][0],d=e[3][1],v=e[3][2],m=e[3][3];return i*o*c*p+n*a*c*p+i*u*f*d+r*a*f*d+r*s*h*d+t*u*h*d+i*s*l*v+t*a*l*v+r*o*f*m+n*u*f*m+n*s*c*m+t*o*c*m+i*u*l*p-r*a*l*p-r*o*h*p-n*u*h*p-i*s*c*d-t*a*c*d-i*o*f*v-n*a*f*v-n*s*h*v-t*o*h*v-r*s*l*m-t*u*l*m},getInverse:function(){var e=this.matrix,t=e[0][0],n=e[0][1],r=e[0][2],i=e[0][3],s=e[1][0],o=e[1][1],u=e[1][2],a=e[1][3],f=e[2][0],l=e[2][1],c=e[2][2],h=e[2][3],p=e[3][0],d=e[3][1],v=e[3][2],m=e[3][3],g=new CAAT.Math.Matrix3;return g.matrix[0][0]=u*h*d+a*l*v+o*c*m-a*c*d-o*h*v-u*l*m,g.matrix[0][1]=i*c*d+n*h*v+r*l*m-n*c*m-r*h*d-i*l*v,g.matrix[0][2]=r*a*d+n*u*m+i*o*v-n*a*v-r*o*m-i*u*d,g.matrix[0][3]=i*u*l+n*a*c+r*o*h-r*a*l-i*o*c-n*u*h,g.matrix[1][0]=a*c*p+s*h*v+u*f*m-u*h*p-a*f*v-s*c*m,g.matrix[1][1]=r*h*p+i*f*v+t*c*m-i*c*p-t*h*v-r*f*m,g.matrix[1][2]=i*u*p+t*a*v+r*s*m-r*a*p-i*s*v-t*u*m,g.matrix[1][3]=r*a*f+i*s*c+t*u*h-i*u*f-t*a*c-r*s*h,g.matrix[2][0]=o*h*p+a*f*d+s*l*m-a*l*p-s*h*d-o*f*m,g.matrix[2][1]=i*l*p+t*h*d+n*f*m-t*l*m-n*h*p-i*f*d,g.matrix[2][2]=r*a*p+i*s*d+t*o*m-i*o*p-t*a*d-n*s*m,g.matrix[2][3]=i*o*f+t*a*l+n*s*h-t*o*h-n*a*f-i*s*l,g.matrix[3][0]=u*l*p+s*c*d+o*f*v-o*c*p-u*f*d-s*l*v,g.matrix[3][1]=n*c*p+r*f*d+t*l*v-r*l*p-t*c*d-n*f*v,g.matrix[3][2]=r*o*p+t*u*d+n*s*v-t*o*v-n*u*p-r*s*d,g.matrix[3][3]=n*u*f+r*s*l+t*o*c-r*o*f-t*u*l-n*s*c,g.multiplyScalar(1/this.calculateDeterminant())},multiplyScalar:function(e){var t,n;for(t=0;t<4;t++)for(n=0;n<4;n++)this.matrix[t][n]*=e;return this}}}}),CAAT.Module({defines:"CAAT.Math.Point",aliases:["CAAT.Point"],extendsWith:function(){return{x:0,y:0,z:0,__init:function(e,t,n){return this.x=e,this.y=t,this.z=n||0,this},set:function(e,t,n){return this.x=e,this.y=t,this.z=n||0,this},clone:function(){var e=new CAAT.Math.Point(this.x,this.y,this.z);return e},translate:function(e,t,n){return this.x+=e,this.y+=t,this.z+=n,this},translatePoint:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},subtract:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},multiply:function(e){return this.x*=e,this.y*=e,this.z*=e,this},rotate:function(e){var t=this.x,n=this.y;return this.x=t*Math.cos(e)-Math.sin(e)*n,this.y=t*Math.sin(e)+Math.cos(e)*n,this.z=0,this},setAngle:function(e){var t=this.getLength();return this.x=Math.cos(e)*t,this.y=Math.sin(e)*t,this.z=0,this},setLength:function(e){var t=this.getLength();return t?this.multiply(e/t):this.x=this.y=this.z=e,this},normalize:function(){var e=this.getLength();return this.x/=e,this.y/=e,this.z/=e,this},getAngle:function(){return Math.atan2(this.y,this.x)},limit:function(e){var t=this.getLengthSquared();if(t+.01>e*e){var n=Math.sqrt(t);this.x=this.x/n*e,this.y=this.y/n*e,this.z=this.z/n*e}return this},getLength:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return e<.005&&e>-0.005?1e-6:e},getLengthSquared:function(){var e=this.x*this.x+this.y*this.y+this.z*this.z;return e<.005&&e>-0.005?0:e},getDistance:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return Math.sqrt(t*t+n*n+r*r)},getDistanceSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},toString:function(){return"(CAAT.Math.Point) x:"+String(Math.round(Math.floor(this.x*10))/10)+" y:"+String(Math.round(Math.floor(this.y*10))/10)+" z:"+String(Math.round(Math.floor(this.z*10))/10)}}}}),CAAT.Module({defines:"CAAT.Math.Rectangle",aliases:["CAAT.Rectangle"],extendsWith:function(){return{__init:function(e,t,n,r){this.setLocation(e,t),this.setDimension(n,r)},x:0,y:0,x1:0,y1:0,width:-1,height:-1,setEmpty:function(){return this.width=-1,this.height=-1,this.x=0,this.y=0,this.x1=0,this.y1=0,this},setLocation:function(e,t){return this.x=e,this.y=t,this.x1=this.x+this.width,this.y1=this.y+this.height,this},setDimension:function(e,t){return this.width=e,this.height=t,this.x1=this.x+this.width,this.y1=this.y+this.height,this},setBounds:function(e,t,n,r){return this.setLocation(e,t),this.setDimension(n,r),this},contains:function(e,t){return e>=this.x&&e<this.x1&&t>=this.y&&t<this.y1},isEmpty:function(){return this.width===-1&&this.height===-1},union:function(e,t){if(this.isEmpty()){this.x=e,this.x1=e,this.y=t,this.y1=t,this.width=0,this.height=0;return}this.x1=this.x+this.width,this.y1=this.y+this.height,t<this.y&&(this.y=t),e<this.x&&(this.x=e),t>this.y1&&(this.y1=t),e>this.x1&&(this.x1=e),this.width=this.x1-this.x,this.height=this.y1-this.y},unionRectangle:function(e){return this.union(e.x,e.y),this.union(e.x1,e.y),this.union(e.x,e.y1),this.union(e.x1,e.y1),this},intersects:function(e){return e.isEmpty()||this.isEmpty()?!1:e.x1<=this.x?!1:e.x>=this.x1?!1:e.y1<=this.y?!1:e.y<this.y1},intersectsRect:function(e,t,n,r){if(-1===n||-1===r)return!1;var i=e+n-1,s=t+r-1;return i<this.x?!1:e>this.x1?!1:s<this.y?!1:t<=this.y1},intersect:function(e,t){return typeof t=="undefined"&&(t=new CAAT.Math.Rectangle),t.x=Math.max(this.x,e.x),t.y=Math.max(this.y,e.y),t.x1=Math.min(this.x1,e.x1),t.y1=Math.min(this.y1,e.y1),t.width=t.x1-t.x,t.height=t.y1-t.y,t}}}}),CAAT.Module({defines:"CAAT.Behavior.Interpolator",depends:["CAAT.Math.Point"],aliases:["CAAT.Interpolator"],constants:{enumerateInterpolators:function(){return[(new CAAT.Behavior.Interpolator).createLinearInterpolator(!1,!1),"Linear pingpong=false, inverse=false",(new CAAT.Behavior.Interpolator).createLinearInterpolator(!0,!1),"Linear pingpong=true, inverse=false",(new CAAT.Behavior.Interpolator).createBackOutInterpolator(!1),"BackOut pingpong=true, inverse=false",(new CAAT.Behavior.Interpolator).createBackOutInterpolator(!0),"BackOut pingpong=true, inverse=true",(new CAAT.Behavior.Interpolator).createLinearInterpolator(!1,!0),"Linear pingpong=false, inverse=true",(new CAAT.Behavior.Interpolator).createLinearInterpolator(!0,!0),"Linear pingpong=true, inverse=true",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(2,!1),"ExponentialIn pingpong=false, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(2,!1),"ExponentialOut pingpong=false, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(2,!1),"ExponentialInOut pingpong=false, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(2,!0),"ExponentialIn pingpong=true, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(2,!0),"ExponentialOut pingpong=true, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(2,!0),"ExponentialInOut pingpong=true, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(4,!1),"ExponentialIn pingpong=false, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(4,!1),"ExponentialOut pingpong=false, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4,!1),"ExponentialInOut pingpong=false, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(4,!0),"ExponentialIn pingpong=true, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(4,!0),"ExponentialOut pingpong=true, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4,!0),"ExponentialInOut pingpong=true, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(6,!1),"ExponentialIn pingpong=false, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(6,!1),"ExponentialOut pingpong=false, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(6,!1),"ExponentialInOut pingpong=false, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(6,!0),"ExponentialIn pingpong=true, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(6,!0),"ExponentialOut pingpong=true, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(6,!0),"ExponentialInOut pingpong=true, exponent=6",(new CAAT.Behavior.Interpolator).createBounceInInterpolator(!1),"BounceIn pingpong=false",(new CAAT.Behavior.Interpolator).createBounceOutInterpolator(!1),"BounceOut pingpong=false",(new CAAT.Behavior.Interpolator).createBounceInOutInterpolator(!1),"BounceInOut pingpong=false",(new CAAT.Behavior.Interpolator).createBounceInInterpolator(!0),"BounceIn pingpong=true",(new CAAT.Behavior.Interpolator).createBounceOutInterpolator(!0),"BounceOut pingpong=true",(new CAAT.Behavior.Interpolator).createBounceInOutInterpolator(!0),"BounceInOut pingpong=true",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1.1,.4,!1),"ElasticIn pingpong=false, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,.4,!1),"ElasticOut pingpong=false, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1.1,.4,!1),"ElasticInOut pingpong=false, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1.1,.4,!0),"ElasticIn pingpong=true, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,.4,!0),"ElasticOut pingpong=true, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1.1,.4,!0),"ElasticInOut pingpong=true, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1,.2,!1),"ElasticIn pingpong=false, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1,.2,!1),"ElasticOut pingpong=false, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1,.2,!1),"ElasticInOut pingpong=false, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1,.2,!0),"ElasticIn pingpong=true, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1,.2,!0),"ElasticOut pingpong=true, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1,.2,!0),"ElasticInOut pingpong=true, amp=1.0, d=.2"]},parse:function(e){var t="create"+e.type+"Interpolator",n=new CAAT.Behavior.Interpolator;try{n[t].apply(n,e.params||[])}catch(r){n.createLinearInterpolator(!1,!1)}return n}},extendsWith:function(){return{interpolated:null,paintScale:90,__init:function(){return this.interpolated=new CAAT.Math.Point(0,0,0),this},createLinearInterpolator:function(e,t){return this.getPosition=function(r){var i=r;return e&&(r<.5?r*=2:r=1-(r-.5)*2),t!==null&&t&&(r=1-r),this.interpolated.set(i,r)},this},createBackOutInterpolator:function(e){return this.getPosition=function(n){var r=n;e&&(n<.5?n*=2:n=1-(n-.5)*2),n-=1;var i=1.70158;return this.interpolated.set(r,n*n*((i+1)*n+i)+1)},this},createExponentialInInterpolator:function(e,t){return this.getPosition=function(r){var i=r;return t&&(r<.5?r*=2:r=1-(r-.5)*2),this.interpolated.set(i,Math.pow(r,e))},this},createExponentialOutInterpolator:function(e,t){return this.getPosition=function(r){var i=r;return t&&(r<.5?r*=2:r=1-(r-.5)*2),this.interpolated.set(i,1-Math.pow(1-r,e))},this},createExponentialInOutInterpolator:function(e,t){return this.getPosition=function(r){var i=r;return t&&(r<.5?r*=2:r=1-(r-.5)*2),r*2<1?this.interpolated.set(i,Math.pow(r*2,e)/2):this.interpolated.set(i,1-Math.abs(Math.pow(r*2-2,e))/2)},this},createQuadricBezierInterpolator:function(e,t,n,r){return this.getPosition=function(s){var o=s;return r&&(s<.5?s*=2:s=1-(s-.5)*2),s=(1-s)*(1-s)*e.y+2*(1-s)*s*t.y+s*s*n.y,this.interpolated.set(o,s)},this},createCubicBezierInterpolator:function(e,t,n,r,i){return this.getPosition=function(o){var u=o;i&&(o<.5?o*=2:o=1-(o-.5)*2);var a=o*o,f=o*a;return o=e.y+o*(-e.y*3+o*(3*e.y-e.y*o))+o*(3*t.y+o*(-6*t.y+t.y*3*o))+a*(n.y*3-n.y*3*o)+r.y*f,this.interpolated.set(u,o)},this},createElasticOutInterpolator:function(e,t,n){return this.getPosition=function(i){n&&(i<.5?i*=2:i=1-(i-.5)*2);if(i===0)return{x:0,y:0};if(i===1)return{x:1,y:1};var s=t/(2*Math.PI)*Math.asin(1/e);return this.interpolated.set(i,e*Math.pow(2,-10*i)*Math.sin((i-s)*2*Math.PI/t)+1)},this},createElasticInInterpolator:function(e,t,n){return this.getPosition=function(i){n&&(i<.5?i*=2:i=1-(i-.5)*2);if(i===0)return{x:0,y:0};if(i===1)return{x:1,y:1};var s=t/(2*Math.PI)*Math.asin(1/e);return this.interpolated.set(i,-(e*Math.pow(2,10*(i-=1))*Math.sin((i-s)*2*Math.PI/t)))},this},createElasticInOutInterpolator:function(e,t,n){return this.getPosition=function(i){n&&(i<.5?i*=2:i=1-(i-.5)*2);var s=t/(2*Math.PI)*Math.asin(1/e);return i*=2,i<=1?this.interpolated.set(i,-0.5*e*Math.pow(2,10*(i-=1))*Math.sin((i-s)*2*Math.PI/t)):this.interpolated.set(i,1+.5*e*Math.pow(2,-10*(i-=1))*Math.sin((i-s)*2*Math.PI/t))},this},bounce:function(e){return(e/=1)<1/2.75?{x:e,y:7.5625*e*e}:e<2/2.75?{x:e,y:7.5625*(e-=1.5/2.75)*e+.75}:e<2.5/2.75?{x:e,y:7.5625*(e-=2.25/2.75)*e+.9375}:{x:e,y:7.5625*(e-=2.625/2.75)*e+.984375}},createBounceOutInterpolator:function(e){return this.getPosition=function(n){return e&&(n<.5?n*=2:n=1-(n-.5)*2),this.bounce(n)},this},createBounceInInterpolator:function(e){return this.getPosition=function(n){e&&(n<.5?n*=2:n=1-(n-.5)*2);var r=this.bounce(1-n);return r.y=1-r.y,r},this},createBounceInOutInterpolator:function(e){return this.getPosition=function(n){e&&(n<.5?n*=2:n=1-(n-.5)*2);var r;return n<.5?(r=this.bounce(1-n*2),r.y=(1-r.y)*.5,r):(r=this.bounce(n*2-1,e),r.y=r.y*.5+.5,r)},this},paint:function(e){e.save(),e.beginPath(),e.moveTo(0,this.getPosition(0).y*this.paintScale);for(var t=0;t<=this.paintScale;t++)e.lineTo(t,this.getPosition(t/this.paintScale).y*this.paintScale);e.strokeStyle="black",e.stroke(),e.restore()},getContour:function(e){var t=[];for(var n=0;n<=e;n++)t.push({x:n/e,y:this.getPosition(n/e).y});return t}}}}),CAAT.Module({defines:"CAAT.Behavior.BaseBehavior",constants:{Status:{NOT_STARTED:0,STARTED:1,EXPIRED:2},parse:function(e){function t(e){var t=e.split("."),n=window;for(var r=0;r<t.length;r++){if(!n[t[r]])return null;n=n[t[r]]}return n}try{var n=e.type.toLowerCase();n="CAAT.Behavior."+n.substr(0,1).toUpperCase()+n.substr(1)+"Behavior";var r=new t(n),i=new r;return i.parse(e),i}catch(s){console.log("Error parsing behavior: "+s)}return null}},depends:["CAAT.Behavior.Interpolator"],extendsWith:function(){var e=(new CAAT.Behavior.Interpolator).createLinearInterpolator(!1),t=(new CAAT.Behavior.Interpolator).createLinearInterpolator(!0);return{__init:function(){return this.lifecycleListenerList=[],this.setDefaultInterpolator(),this},lifecycleListenerList:null,behaviorStartTime:-1,behaviorDuration:-1,cycleBehavior:!1,status:CAAT.Behavior.BaseBehavior.Status.NOT_STARTED,interpolator:null,actor:null,id:0,timeOffset:0,doValueApplication:!0,solved:!0,discardable:!1,isRelative:!1,setRelative:function(e){return this.isRelative=e,this},setRelativeValues:function(){return this.isRelative=!0,this},parse:function(e){e.pingpong&&this.setPingPong(),e.cycle&&this.setCycle(!0);var t=e.delay||0,n=e.duration||1e3;this.setDelayTime(t,n),e.interpolator&&this.setInterpolator(CAAT.Behavior.Interpolator.parse(e.interpolator))},setValueApplication:function(e){return this.doValueApplication=e,this},setTimeOffset:function(e){return this.timeOffset=e,this},setStatus:function(e){return this.status=e,this},setId:function(e){return this.id=e,this},setDefaultInterpolator:function(){return this.interpolator=e,this},setPingPong:function(){return this.interpolator=t,this},setFrameTime:function(e,t){return this.behaviorStartTime=e,this.behaviorDuration=t,this.status=CAAT.Behavior.BaseBehavior.Status.NOT_STARTED,this},setDelayTime:function(e,t){return this.behaviorStartTime=e,this.behaviorDuration=t,this.status=CAAT.Behavior.BaseBehavior.Status.NOT_STARTED,this.solved=!1,this.expired=!1,this},setOutOfFrameTime:function(){return this.status=CAAT.Behavior.BaseBehavior.Status.EXPIRED,this.behaviorStartTime=Number.MAX_VALUE,this.behaviorDuration=0,this},setInterpolator:function(e){return this.interpolator=e,this},apply:function(e,t){this.solved||(this.behaviorStartTime+=e,this.solved=!0),e+=this.timeOffset*this.behaviorDuration;var n=e;this.isBehaviorInTime(e,t)&&(e=this.normalizeTime(e),this.fireBehaviorAppliedEvent(t,n,e,this.setForTime(e,t)))},setCycle:function(e){return this.cycleBehavior=e,this},addListener:function(e){return this.lifecycleListenerList.push(e),this},emptyListenerList:function(){return this.lifecycleListenerList=[],this},getStartTime:function(){return this.behaviorStartTime},getDuration:function(){return this.behaviorDuration},isBehaviorInTime:function(e,t){var n=CAAT.Behavior.BaseBehavior.Status;return this.status===n.EXPIRED||this.behaviorStartTime<0?!1:(this.cycleBehavior&&e>=this.behaviorStartTime&&(e=(e-this.behaviorStartTime)%this.behaviorDuration+this.behaviorStartTime),e>this.behaviorStartTime+this.behaviorDuration?(this.status!==n.EXPIRED&&this.setExpired(t,e),!1):(this.status===n.NOT_STARTED&&(this.status=n.STARTED,this.fireBehaviorStartedEvent(t,e)),this.behaviorStartTime<=e))},fireBehaviorStartedEvent:function(e,t){for(var n=0,r=this.lifecycleListenerList.length;n<r;n++){var i=this.lifecycleListenerList[n];i.behaviorStarted&&i.behaviorStarted(this,t,e)}},fireBehaviorExpiredEvent:function(e,t){for(var n=0,r=this.lifecycleListenerList.length;n<r;n++){var i=this.lifecycleListenerList[n];i.behaviorExpired&&i.behaviorExpired(this,t,e)}},fireBehaviorAppliedEvent:function(e,t,n,r){for(var i=0,s=this.lifecycleListenerList.length;i<s;i++){var o=this.lifecycleListenerList[i];o.behaviorApplied&&o.behaviorApplied(this,t,n,e,r)}},normalizeTime:function(e){return e-=this.behaviorStartTime,this.cycleBehavior&&(e%=this.behaviorDuration),this.interpolator.getPosition(e/this.behaviorDuration).y},setExpired:function(e,t){this.status=CAAT.Behavior.BaseBehavior.Status.EXPIRED,this.setForTime(this.interpolator.getPosition(1).y,e),this.fireBehaviorExpiredEvent(e,t),this.discardable&&this.actor.removeBehavior(this)},setForTime:function(e,t){},initialize:function(e){if(e)for(var t in e)this[t]=e[t];return this},getPropertyName:function(){return""},calculateKeyFrameData:function(e){},getKeyFrameDataValues:function(e){},calculateKeyFramesData:function(e,t,n){}}}}),CAAT.Module({defines:"CAAT.Behavior.AlphaBehavior",aliases:["CAAT.AlphaBehavior"],depends:["CAAT.Behavior.BaseBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{startAlpha:0,endAlpha:0,parse:function(e){CAAT.Behavior.AlphaBehavior.superclass.parse.call(this,e),this.startAlpha=e.start||0,this.endAlpha=e.end||0},getPropertyName:function(){return"opacity"},setForTime:function(e,t){CAAT.Behavior.AlphaBehavior.superclass.setForTime.call(this,e,t);var n=this.startAlpha+e*(this.endAlpha-this.startAlpha);return this.doValueApplication&&t.setAlpha(n),n},setValues:function(e,t){return this.startAlpha=e,this.endAlpha=t,this},calculateKeyFrameData:function(e){return e=this.interpolator.getPosition(e).y,this.startAlpha+e*(this.endAlpha-this.startAlpha)},getKeyFrameDataValues:function(e){return e=this.interpolator.getPosition(e).y,{alpha:this.startAlpha+e*(this.endAlpha-this.startAlpha)}},calculateKeyFramesData:function(e,t,n){typeof n=="undefined"&&(n=100),n>>=0;var r,i,s="@-"+e+"-keyframes "+t+" {";for(r=0;r<=n;r++)i=""+r/n*100+"%"+"{"+"opacity: "+this.calculateKeyFrameData(r/n)+"}",s+=i;return s+="}",s}}}}),CAAT.Module({defines:"CAAT.Behavior.ContainerBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Behavior.GenericBehavior"],aliases:["CAAT.ContainerBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{parse:function(e){if(e.behaviors&&e.behaviors.length)for(var t=0;t<e.behaviors.length;t+=1)this.addBehavior(CAAT.Behavior.BaseBehavior.parse(e.behaviors[t]));CAAT.Behavior.ContainerBehavior.superclass.parse.call(this,e)},behaviors:null,conforming:!1,__init:function(e){return this.__super(),this.behaviors=[],e&&(this.conforming=!0),this},conformToDuration:function(e){this.duration=e;var t=e/this.duration,n;for(var r=0;r<this.behaviors.length;r++)n=this.behaviors[r],n.setFrameTime(n.getStartTime()*t,n.getDuration()*t);return this},getBehaviorById:function(e){for(var t=0;t<this.behaviors.length;t++)if(this.behaviors[t].id===e)return this.behaviors[t];return null},addBehavior:function(e){this.behaviors.push(e),e.addListener(this);if(this.conforming){var t=e.behaviorDuration+e.behaviorStartTime;this.behaviorDuration<t&&(this.behaviorDuration=t,this.behaviorStartTime=0)}return this},apply:function(e,t){this.solved||(this.behaviorStartTime+=e,this.solved=!0),e+=this.timeOffset*this.behaviorDuration;if(this.isBehaviorInTime(e,t)){e-=this.behaviorStartTime,this.cycleBehavior&&(e%=this.behaviorDuration);var n=this.behaviors;for(var r=0;r<n.length;r++)n[r].apply(e,t)}},behaviorExpired:function(e,t,n){this.cycleBehavior&&e.setStatus(CAAT.Behavior.BaseBehavior.Status.STARTED)},behaviorApplied:function(e,t,n,r,i){this.fireBehaviorAppliedEvent(r,t,n,i)},setForTime:function(e,t){var n=null,r=this.behaviors;for(var i=0;i<r.length;i++)n=r[i].setForTime(e,t);return n},setExpired:function(e,t){var n=this.behaviors;for(var r=0;r<n.length;r++){var i=n[r];i.status!==CAAT.Behavior.BaseBehavior.Status.EXPIRED&&i.setExpired(e,t-this.behaviorStartTime)}return CAAT.Behavior.ContainerBehavior.superclass.setExpired.call(this,e,t),this},setFrameTime:function(e,t){CAAT.Behavior.ContainerBehavior.superclass.setFrameTime.call(this,e,t);var n=this.behaviors;for(var r=0;r<n.length;r++)n[r].setStatus(CAAT.Behavior.BaseBehavior.Status.NOT_STARTED);return this},setDelayTime:function(e,t){CAAT.Behavior.ContainerBehavior.superclass.setDelayTime.call(this,e,t);var n=this.behaviors;for(var r=0;r<n.length;r++)n[r].setStatus(CAAT.Behavior.BaseBehavior.Status.NOT_STARTED);return this},getKeyFrameDataValues:function(e){var t,n,r,i={angle:0,scaleX:1,scaleY:1,x:0,y:0};for(t=0;t<this.behaviors.length;t++){n=this.behaviors[t];if(n.status!==CAAT.Behavior.BaseBehavior.Status.EXPIRED&&!(n instanceof CAAT.Behavior.GenericBehavior)){r=e*this.behaviorDuration;if(n.behaviorStartTime<=r&&n.behaviorStartTime+n.behaviorDuration>=r){r=(r-n.behaviorStartTime)/n.behaviorDuration;var s=n.getKeyFrameDataValues(r);for(var o in s)i[o]=s[o]}}}return i},calculateKeyFrameData:function(e,t){function c(e){i[e]?f+=i[e]:prevValues&&(l=prevValues[e],l&&(f+=l,i[e]=l))}var n,r,i={},s,o,u,a;for(n=0;n<this.behaviors.length;n++)r=this.behaviors[n],r.status!==CAAT.Behavior.BaseBehavior.Status.EXPIRED&&!(r instanceof CAAT.Behavior.GenericBehavior)&&(s=e*this.behaviorDuration,r.behaviorStartTime<=s&&r.behaviorStartTime+r.behaviorDuration>=s&&(s=(s-r.behaviorStartTime)/r.behaviorDuration,o=r.calculateKeyFrameData(s),u=r.getPropertyName(t),typeof i[u]=="undefined"&&(i[u]=""),i[u]+=o+" "));var f="",l;c("translate"),c("rotate"),c("scale");var h="";return f&&(h="-"+t+"-transform: "+f+";"),f="",c("opacity"),f&&(h+=" opacity: "+f+";"),h+=" -webkit-transform-origin: 0% 0%",{rules:h,ret:i}},calculateKeyFramesData:function(e,t,n,r,i){function s(t,n){for(var s in n)t[s]||(t[s]=n[s]);var o="-"+e+"-transform:";if(t.x||t.y){var u=t.x||0,a=t.y||0;o+="translate("+u+"px,"+a+"px)"}t.angle&&(o+=" rotate("+t.angle+"rad)");if(t.scaleX!==1||t.scaleY!==1)o+=" scale("+t.scaleX+","+t.scaleY+")";o+=";",t.alpha&&(o+=" opacity: "+t.alpha+";");if(r!==.5||i!==.5)o+=" -"+e+"-transform-origin:"+r*100+"% "+i*100+"%;";return o}if(this.duration===Number.MAX_VALUE)return"";typeof r=="undefined"&&(r=.5),typeof i=="undefined"&&(i=.5),typeof n=="undefined"&&(n=100);var o,u="@-"+e+"-keyframes "+t+" {",a,f={};for(o=0;o<=n;o++){a=this.interpolator.getPosition(o/n).y;var l=this.getKeyFrameDataValues(a);u+=""+o/n*100+"%"+"{"+s(l,f)+"}\n",f=l}return u+="}\n",u}}}}),CAAT.Module({defines:"CAAT.Behavior.GenericBehavior",depends:["CAAT.Behavior.BaseBehavior"],aliases:["CAAT.GenericBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{start:0,end:0,target:null,property:null,callback:null,setForTime:function(e,t){var n=this.start+e*(this.end-this.start);this.callback&&this.callback(n,this.target,t),this.property&&(this.target[this.property]=n)},setValues:function(e,t,n,r,i){return this.start=e,this.end=t,this.target=n,this.property=r,this.callback=i,this}}}}),CAAT.Module({defines:"CAAT.Behavior.PathBehavior",aliases:["CAAT.PathBehavior"],depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.SpriteImage"],constants:{AUTOROTATE:{LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1,FREE:2},autorotate:{LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1,FREE:2}},extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{parse:function(e){CAAT.Behavior.PathBehavior.superclass.parse.call(this,e);if(e.SVG){var t=new CAAT.PathUtil.SVGPath,n=t.parsePath(e.SVG);this.setValues(n)}e.autoRotate&&(this.autoRotate=e.autoRotate)},path:null,autoRotate:!1,prevX:-1,prevY:-1,autoRotateOp:CAAT.Behavior.PathBehavior.autorotate.FREE,isOpenContour:!1,relativeX:0,relativeY:0,setOpenContour:function(e){return this.isOpenContour=e,this},getPropertyName:function(){return"translate"},setRelativeValues:function(e,t){return this.relativeX=e,this.relativeY=t,this.isRelative=!0,this},setAutoRotate:function(e,t){return this.autoRotate=e,t!==undefined&&(this.autoRotateOp=t),this},setPath:function(e){return this.path=e,this},setValues:function(e){return this.setPath(e)},setTranslation:function(e,t){return this},calculateKeyFrameData:function(e){e=this.interpolator.getPosition(e).y;var t=this.path.getPosition(e);return"translateX("+t.x+"px) translateY("+t.y+"px)"},getKeyFrameDataValues:function(e){e=this.interpolator.getPosition(e).y;var t=this.path.getPosition(e),n={x:t.x,y:t.y};if(this.autoRotate){var r=e===0?t:this.path.getPosition(e-.001),i=t.x-r.x,s=t.y-r.y,o=Math.atan2(s,i);n.angle=o}return n},calculateKeyFramesData:function(e,t,n){typeof n=="undefined"&&(n=100),n>>=0;var r,i,s,o="@-"+e+"-keyframes "+t+" {";for(r=0;r<=n;r++)i=""+r/n*100+"%"+"{"+"-"+e+"-transform:"+this.calculateKeyFrameData(r/n)+"}",o+=i;return o+="}",o},setForTime:function(e,t){if(!this.path)return{x:t.x,y:t.y};var n=this.path.getPosition(e,this.isOpenContour,.001);this.isRelative&&(n.x+=this.relativeX,n.y+=this.relativeY);if(this.autoRotate){-1===this.prevX&&-1===this.prevY&&(this.prevX=n.x,this.prevY=n.y);var r=n.x-this.prevX,i=n.y-this.prevY;if(r===0&&i===0)return t.setLocation(n.x,n.y),{x:t.x,y:t.y};var s=Math.atan2(i,r),o=CAAT.Foundation.SpriteImage,u=CAAT.Behavior.PathBehavior.AUTOROTATE;this.autoRotateOp===u.LEFT_TO_RIGHT?this.prevX<=n.x?t.setImageTransformation(o.TR_NONE):(t.setImageTransformation(o.TR_FLIP_HORIZONTAL),s+=Math.PI):this.autoRotateOp===u.RIGHT_TO_LEFT&&(this.prevX<=n.x?t.setImageTransformation(o.TR_FLIP_HORIZONTAL):(t.setImageTransformation(o.TR_NONE),s-=Math.PI)),t.setRotation(s),this.prevX=n.x,this.prevY=n.y;var a=Math.sqrt(r*r+i*i);r/=a,i/=a}return this.doValueApplication?(t.setLocation(n.x,n.y),{x:t.x,y:t.y}):{x:n.x,y:n.y}},positionOnTime:function(e){return this.isBehaviorInTime(e,null)?(e=this.normalizeTime(e),this.path.getPosition(e)):{x:-1,y:-1}}}}}),CAAT.Module({defines:"CAAT.Behavior.RotateBehavior",extendsClass:"CAAT.Behavior.BaseBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],aliases:["CAAT.RotateBehavior"],extendsWith:function(){return{__init:function(){return this.__super(),this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER,this},parse:function(e){CAAT.Behavior.RotateBehavior.superclass.parse.call(this,e),this.startAngle=e.start||0,this.endAngle=e.end||0,this.anchorX=typeof e.anchorX!="undefined"?parseInt(e.anchorX):.5,this.anchorY=typeof e.anchorY!="undefined"?parseInt(e.anchorY):.5},startAngle:0,endAngle:0,anchorX:.5,anchorY:.5,rotationRelative:0,setRelativeValues:function(e){return this.rotationRelative=e,this.isRelative=!0,this},getPropertyName:function(){return"rotate"},setForTime:function(e,t){var n=this.startAngle+e*(this.endAngle-this.startAngle);return this.isRelative&&(n+=this.rotationRelative,n>=Math.PI&&(n-=2*Math.PI),n<-2*Math.PI&&(n+=2*Math.PI)),this.doValueApplication&&t.setRotationAnchored(n,this.anchorX,this.anchorY),n},setValues:function(e,t,n,r){return this.startAngle=e,this.endAngle=t,typeof n!="undefined"&&typeof r!="undefined"&&(this.anchorX=n,this.anchorY=r),this},setAngles:function(e,t){return this.setValues(e,t)},setAnchor:function(e,t,n){return this.anchorX=t/e.width,this.anchorY=n/e.height,this},calculateKeyFrameData:function(e){return e=this.interpolator.getPosition(e).y,"rotate("+(this.startAngle+e*(this.endAngle-this.startAngle))+"rad)"},getKeyFrameDataValues:function(e){return e=this.interpolator.getPosition(e).y,{angle:this.startAngle+e*(this.endAngle-this.startAngle)}},calculateKeyFramesData:function(e,t,n){typeof n=="undefined"&&(n=100),n>>=0;var r,i,s="@-"+e+"-keyframes "+t+" {";for(r=0;r<=n;r++)i=""+r/n*100+"%"+"{"+"-"+e+"-transform:"+this.calculateKeyFrameData(r/n)+"; -"+e+"-transform-origin:"+this.anchorX*100+"% "+this.anchorY*100+"% "+"}\n",s+=i;return s+="}\n",s}}}}),CAAT.Module({defines:"CAAT.Behavior.Scale1Behavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],aliases:["CAAT.Scale1Behavior"],constants:{AXIS:{X:0,Y:1},Axis:{X:0,Y:1}},extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{__init:function(){return this.__super(),this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER,this},startScale:1,endScale:1,anchorX:.5,anchorY:.5,applyOnX:!0,parse:function(e){CAAT.Behavior.Scale1Behavior.superclass.parse.call(this,e),this.startScale=e.start||0,this.endScale=e.end||0,this.anchorX=typeof e.anchorX!="undefined"?parseInt(e.anchorX):.5,this.anchorY=typeof e.anchorY!="undefined"?parseInt(e.anchorY):.5,this.applyOnX=e.axis?e.axis.toLowerCase()==="x":!0},applyOnAxis:function(e){e===CAAT.Behavior.Scale1Behavior.AXIS.X?this.applyOnX=!1:this.applyOnX=!0},getPropertyName:function(){return"scale"},setForTime:function(e,t){var n=this.startScale+e*(this.endScale-this.startScale);return 0===n&&(n=.01),this.doValueApplication&&(this.applyOnX?t.setScaleAnchored(n,t.scaleY,this.anchorX,this.anchorY):t.setScaleAnchored(t.scaleX,n,this.anchorX,this.anchorY)),n},setValues:function(e,t,n,r,i){return this.startScale=e,this.endScale=t,this.applyOnX=!!n,typeof r!="undefined"&&typeof i!="undefined"&&(this.anchorX=r,this.anchorY=i),this},setAnchor:function(e,t,n){return this.anchorX=t/e.width,this.anchorY=n/e.height,this},calculateKeyFrameData:function(e){var t;return e=this.interpolator.getPosition(e).y,t=this.startScale+e*(this.endScale-this.startScale),this.applyOnX?"scaleX("+t+")":"scaleY("+t+")"},getKeyFrameDataValues:function(e){e=this.interpolator.getPosition(e).y;var t={};return t[this.applyOnX?"scaleX":"scaleY"]=this.startScale+e*(this.endScale-this.startScale),t},calculateKeyFramesData:function(e,t,n){typeof n=="undefined"&&(n=100),n>>=0;var r,i,s="@-"+e+"-keyframes "+t+" {";for(r=0;r<=n;r++)i=""+r/n*100+"%"+"{"+"-"+e+"-transform:"+this.calculateKeyFrameData(r/n)+"; -"+e+"-transform-origin:"+this.anchorX*100+"% "+this.anchorY*100+"% "+"}\n",s+=i;return s+="}\n",s}}}}),CAAT.Module({defines:"CAAT.Behavior.ScaleBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],extendsClass:"CAAT.Behavior.BaseBehavior",aliases:["CAAT.ScaleBehavior"],extendsWith:function(){return{__init:function(){return this.__super(),this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER,this},startScaleX:1,endScaleX:1,startScaleY:1,endScaleY:1,anchorX:.5,anchorY:.5,parse:function(e){CAAT.Behavior.ScaleBehavior.superclass.parse.call(this,e),this.startScaleX=e.scaleX&&e.scaleX.start||0,this.endScaleX=e.scaleX&&e.scaleX.end||0,this.startScaleY=e.scaleY&&e.scaleY.start||0,this.endScaleY=e.scaleY&&e.scaleY.end||0,this.anchorX=typeof e.anchorX!="undefined"?parseInt(e.anchorX):.5,this.anchorY=typeof e.anchorY!="undefined"?parseInt(e.anchorY):.5},getPropertyName:function(){return"scale"},setForTime:function(e,t){var n=this.startScaleX+e*(this.endScaleX-this.startScaleX),r=this.startScaleY+e*(this.endScaleY-this.startScaleY);return 0===n&&(n=.01),0===r&&(r=.01),this.doValueApplication&&t.setScaleAnchored(n,r,this.anchorX,this.anchorY),{scaleX:n,scaleY:r}},setValues:function(e,t,n,r,i,s){return this.startScaleX=e,this.endScaleX=t,this.startScaleY=n,this.endScaleY=r,typeof i!="undefined"&&typeof s!="undefined"&&(this.anchorX=i,this.anchorY=s),this},setAnchor:function(e,t,n){return this.anchorX=t/e.width,this.anchorY=n/e.height,this},calculateKeyFrameData:function(e){var t,n;return e=this.interpolator.getPosition(e).y,t=this.startScaleX+e*(this.endScaleX-this.startScaleX),n=this.startScaleY+e*(this.endScaleY-this.startScaleY),"scale("+t+","+n+")"},getKeyFrameDataValues:function(e){return e=this.interpolator.getPosition(e).y,{scaleX:this.startScaleX+e*(this.endScaleX-this.startScaleX),scaleY:this.startScaleY+e*(this.endScaleY-this.startScaleY)}},calculateKeyFramesData:function(e,t,n){typeof n=="undefined"&&(n=100),n>>=0;var r,i,s="@-"+e+"-keyframes "+t+" {";for(r=0;r<=n;r++)i=""+r/n*100+"%"+"{"+"-"+e+"-transform:"+this.calculateKeyFrameData(r/n)+"; -"+e+"-transform-origin:"+this.anchorX*100+"% "+this.anchorY*100+"% "+"}\n",s+=i;return s+="}\n",s}}}}),CAAT.Module({defines:"CAAT.Module.Runtime.BrowserInfo",constants:function(){function e(e){for(var t=0;t<e.length;t++){var n=e[t].string,r=e[t].prop;this.versionSearchString=e[t].versionSearch||e[t].identity;if(n){if(n.indexOf(e[t].subString)!==-1)return e[t].identity}else if(r)return e[t].identity}}function t(e){var t=e.indexOf(this.versionSearchString);if(t===-1)return;return parseFloat(e.substring(t+this.versionSearchString.length+1))}var n=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Explorer",identity:"Explorer",versionSearch:"Explorer"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],r=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],i=e(n)||"An unknown browser",s=t(navigator.userAgent)||t(navigator.appVersion)||"an unknown version",o=e(r)||"an unknown OS",u=window.devicePixelRatio||1;return{browser:i,version:s,OS:o,DevicePixelRatio:u}}}),CAAT.Module({defines:"CAAT.Module.Audio.AudioManager",depends:["CAAT.Module.Runtime.BrowserInfo"],extendsWith:function(){return{__init:function(){return this.browserInfo=CAAT.Module.Runtime.BrowserInfo,this},musicChannel:null,browserInfo:null,musicEnabled:!0,fxEnabled:!0,audioCache:null,channels:null,workingChannels:null,loopingChannels:[],audioTypes:{mp3:"audio/mpeg;",ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',mp4:'audio/mp4; codecs="mp4a.40.2"'},initialize:function(e){this.audioCache=[],this.channels=[],this.workingChannels=[];for(var t=0;t<=e;t++){var n=document.createElement("audio");if(null!==n){n.finished=-1,this.channels.push(n);var r=this;n.addEventListener("ended",function(e){var t=e.target,n;for(n=0;n<r.workingChannels.length;n++)if(r.workingChannels[n]===t){r.workingChannels.splice(n,1);break}t.caat_callback&&t.caat_callback(t.caat_id),r.channels.push(t)},!1)}}return this.musicChannel=this.channels.pop(),this},addAudioFromURL:function(e,t,n){var r=null,i=document.createElement("audio");if(null!==i){if(!i.canPlayType)return!1;r=t.substr(t.lastIndexOf(".")+1);var s=i.canPlayType(this.audioTypes[r]);if(s!==""&&s!=="no")return i.src=t,i.preload="auto",i.load(),n&&(i.caat_callback=n,i.caat_id=e),this.audioCache.push({id:e,audio:i}),!0}return!1},addAudioFromDomNode:function(e,t,n){var r=t.src.substr(t.src.lastIndexOf(".")+1);return t.canPlayType(this.audioTypes[r])?(n&&(t.caat_callback=n,t.caat_id=e),this.audioCache.push({id:e,audio:t}),!0):!1},addAudioElement:function(e,t,n){if(typeof t=="string")return this.addAudioFromURL(e,t,n);try{if(t instanceof HTMLAudioElement)return this.addAudioFromDomNode(e,t,n)}catch(r){}return!1},addAudio:function(e,t,n){if(t instanceof Array){for(var r=0;r<t.length;r++)if(this.addAudioElement(e,t[r],n))break}else this.addAudioElement(e,t,n);return this},getAudio:function(e){for(var t=0;t<this.audioCache.length;t++)if(this.audioCache[t].id===e)return this.audioCache[t].audio;return null},stopMusic:function(){this.musicChannel.pause()},playMusic:function(e){if(!this.musicEnabled)return null;var t=this.getAudio(e);if(null!==t){var n=this.musicChannel;if(null!==n)return n.src=t.src,n.preload="auto",this.browserInfo.browser==="Firefox"?n.addEventListener("ended",function(e){var t=e.target;t.currentTime=0},!1):n.loop=!0,n.load(),n.play(),n}return null},setVolume:function(e,t){var n=this.getAudio(e);return null!=n&&(n.volume=t),this},play:function(e){if(!this.fxEnabled)return null;var t=this.getAudio(e);if(null!==t&&this.channels.length>0){var n=this.channels.shift();n.src=t.src,n.volume=t.volume,n.play(),this.workingChannels.push(n)}return t},cancelPlay:function(e){for(var t=0;this.workingChannels.length;t++){var n=this.workingChannels[t];n.caat_id===e&&(n.pause(),this.channels.push(n),this.workingChannels.splice(t,1))}return this},cancelPlayByChannel:function(e){for(var t=0;this.workingChannels.length;t++)if(this.workingChannels[t]===e)return this.channels.push(e),this.workingChannels.splice(t,1),this;return this},loop:function(e){if(!this.musicEnabled)return null;var t=this.getAudio(e);if(null!==t){var n=document.createElement("audio");if(null!==n)return n.src=t.src,n.preload="auto",this.browserInfo.browser==="Firefox"?n.addEventListener("ended",function(e){var t=e.target;t.currentTime=0},!1):n.loop=!0,n.load(),n.play(),this.loopingChannels.push(n),n}return null},endSound:function(){var e;for(e=0;e<this.workingChannels.length;e++)this.workingChannels[e].pause(),this.channels.push(this.workingChannels[e]);for(e=0;e<this.loopingChannels.length;e++)this.loopingChannels[e].pause();return this.workingChannels=[],this.loopingChannels=[],this.stopMusic(),this},setSoundEffectsEnabled:function(e){this.fxEnabled=e;for(var t=0;t<this.loopingChannels.length;t++)e?this.loopingChannels[t].play():this.loopingChannels[t].pause();return this},isSoundEffectsEnabled:function(){return this.fxEnabled},setMusicEnabled:function(e){return this.musicEnabled=e,this.stopMusic(),this},isMusicEnabled:function(){return this.musicEnabled}}}}),CAAT.Module({defines:"CAAT.Module.Storage.LocalStorage",constants:{save:function(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(n){}return this},load:function(e,t){try{var n=localStorage.getItem(e);return null===n?t:JSON.parse(n)}catch(r){return null}},remove:function(e){try{localStorage.removeItem(e)}catch(t){}return this}},extendsWith:{}}),CAAT.Module({defines:"CAAT.Module.ColorUtil.Color",depends:[],constants:{RampEnumeration:{RAMP_RGBA:0,RAMP_RGB:1,RAMP_CHANNEL_RGB:2,RAMP_CHANNEL_RGBA:3,RAMP_CHANNEL_RGB_ARRAY:4,RAMP_CHANNEL_RGBA_ARRAY:5},hsvToRgb:function(e,t,n){var r,i,s,o,u,a,f,l;e=Math.max(0,Math.min(360,e)),t=Math.max(0,Math.min(100,t)),n=Math.max(0,Math.min(100,n)),t/=100,n/=100;if(t===0)return r=i=s=n,[Math.round(r*255),Math.round(i*255),Math.round(s*255)];e/=60,o=Math.floor(e),u=e-o,a=n*(1-t),f=n*(1-t*u),l=n*(1-t*(1-u));switch(o){case 0:r=n,i=l,s=a;break;case 1:r=f,i=n,s=a;break;case 2:r=a,i=n,s=l;break;case 3:r=a,i=f,s=n;break;case 4:r=l,i=a,s=n;break;default:r=n,i=a,s=f}return new CAAT.Module.ColorUtil.Color(Math.round(r*255),Math.round(i*255),Math.round(s*255))},interpolate:function(e,t,n,r,i,s,o,u){var a,f,l;return u<=0?{r:e,g:t,b:n}:u>=o?{r:r,g:i,b:s}:(a=e+(r-e)/o*u>>0,f=t+(i-t)/o*u>>0,l=n+(s-n)/o*u>>0,a>255?a=255:a<0&&(a=0),f>255?f=255:f<0&&(f=0),l>255?l=255:l<0&&(l=0),{r:a,g:f,b:l})},makeRGBColorRamp:function(e,t,n){var r=[],i=e.length-1,s=t/i,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;for(o=0;o<i;o+=1){h=e[o],p=h>>24&255,d=(h&16711680)>>16,v=(h&65280)>>8,m=h&255,g=e[o+1],y=g>>24&255,b=(g&16711680)>>16,w=(g&65280)>>8,E=g&255,S=(y-p)/s,x=(b-d)/s,T=(w-v)/s,N=(E-m)/s;for(u=0;u<s;u+=1){a=p+S*u>>0,f=d+x*u>>0,l=v+T*u>>0,c=m+N*u>>0;var C=CAAT.Module.ColorUtil.Color.RampEnumeration;switch(n){case C.RAMP_RGBA:r.push("argb("+a+","+f+","+l+","+c+")");break;case C.RAMP_RGB:r.push("rgb("+f+","+l+","+c+")");break;case C.RAMP_CHANNEL_RGB:r.push(4278190080|f<<16|l<<8|c);break;case C.RAMP_CHANNEL_RGBA:r.push(a<<24|f<<16|l<<8|c);break;case C.RAMP_CHANNEL_RGBA_ARRAY:r.push([f,l,c,a]);break;case C.RAMP_CHANNEL_RGB_ARRAY:r.push([f,l,c])}}}return r},random:function(){var e="0123456789abcdef",t="#";for(var n=0;n<3;n++)t+=e[Math.random()*e.length>>0];return t}},extendsWith:{__init:function(e,t,n){return this.r=e||255,this.g=t||255,this.b=n||255,this},r:255,g:255,b:255,toHex:function(){return("000000"+((this.r<<16)+(this.g<<8)+this.b).toString(16)).slice(-6)}}}),CAAT.Module({defines:"CAAT.Module.Debug.Debug",depends:["CAAT.Event.AnimationLoop"],extendsWith:{width:0,height:0,canvas:null,ctx:null,statistics:null,framerate:null,textContainer:null,textFPS:null,textEntitiesTotal:null,textEntitiesActive:null,textDraws:null,textDrawTime:null,textRAFTime:null,textDirtyRects:null,textDiscardDR:null,frameTimeAcc:0,frameRAFAcc:0,canDebug:!1,SCALE:60,debugTpl:'    <style type="text/css">        #caat-debug {            z-index: 10000;            position:fixed;            bottom:0;            left:0;            width:100%;            background-color: rgba(0,0,0,0.8);        }        #caat-debug.caat_debug_max {            margin-bottom: 0px;        }        .caat_debug_bullet {            display:inline-block;            background-color:#f00;            width:8px;            height:8px;            border-radius: 4px;            margin-left:10px;            margin-right:2px;        }        .caat_debug_description {            font-size:11px;            font-family: helvetica, arial;            color: #aaa;            display: inline-block;        }        .caat_debug_value {            font-size:11px;            font-family: helvetica, arial;            color: #fff;            width:25px;            text-align: right;            display: inline-block;            margin-right: .3em;        }        .caat_debug_indicator {            float: right;        }        #debug_tabs {            border-top: 1px solid #888;            height:25px;        }        .tab_max_min {            font-family: helvetica, arial;            font-size: 12px;            font-weight: bold;            color: #888;            border-right: 1px solid #888;            float: left;            cursor: pointer;            padding-left: 5px;            padding-right: 5px;            padding-top: 5px;            height: 20px;        }        .debug_tabs_content_hidden {            display: none;            width: 100%;        }        .debug_tabs_content_visible {            display: block;            width: 100%;        }        .checkbox_enabled {            display:inline-block;            background-color:#eee;            border: 1px solid #eee;            width:6px;            height:8px;            margin-left:12px;            margin-right:2px;            cursor: pointer;        }        .checkbox_disabled {            display:inline-block;            width:6px;            height:8px;            background-color: #333;            border: 1px solid #eee;            margin-left:12px;            margin-right:2px;            cursor: pointer;        }        .checkbox_description {            font-size:11px;            font-family: helvetica, arial;            color: #fff;        }        .debug_tab {            font-family: helvetica, arial;            font-size: 12px;            color: #fff;            border-right: 1px solid #888;            float: left;            padding-left: 5px;            padding-right: 5px;            height: 20px;            padding-top: 5px;            cursor: default;        }        .debug_tab_selected {            background-color: #444;            cursor: default;        }        .debug_tab_not_selected {            background-color: #000;            cursor: pointer;        }    </style>    <div id="caat-debug">        <div id="debug_tabs">            <span class="tab_max_min" onCLick="javascript: var debug = document.getElementById(\'debug_tabs_content\');if (debug.className === \'debug_tabs_content_visible\') {debug.className = \'debug_tabs_content_hidden\'} else {debug.className = \'debug_tabs_content_visible\'}"> CAAT Debug panel </span>            <span id="caat-debug-tab0" class="debug_tab debug_tab_selected">Performance</span>            <span id="caat-debug-tab1" class="debug_tab debug_tab_not_selected">Controls</span>            <span class="caat_debug_indicator">                <span class="caat_debug_bullet" style="background-color:#0f0;"></span>                <span class="caat_debug_description">Draw Time: </span>                <span class="caat_debug_value" id="textDrawTime">5.46</span>                <span class="caat_debug_description">ms.</span>            </span>            <span class="caat_debug_indicator">                <span class="caat_debug_bullet" style="background-color:#f00;"></span>                <span class="caat_debug_description">FPS: </span>                <span class="caat_debug_value" id="textFPS">48</span>            </span>        </div>        <div id="debug_tabs_content" class="debug_tabs_content_hidden">            <div id="caat-debug-tab0-content">                <canvas id="caat-debug-canvas" height="60"></canvas>                <div>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0f0;"></span>                        <span class="caat_debug_description">RAF Time:</span>                        <span class="caat_debug_value" id="textRAFTime">20.76</span>                        <span class="caat_debug_description">ms.</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0ff;"></span>                        <span class="caat_debug_description">Entities Total: </span>                        <span class="caat_debug_value" id="textEntitiesTotal">41</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0ff;"></span>                        <span class="caat_debug_description">Entities Active: </span>                        <span class="caat_debug_value" id="textEntitiesActive">37</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">Draws: </span>                        <span class="caat_debug_value" id="textDraws">0</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">DirtyRects: </span>                        <span class="caat_debug_value" id="textDirtyRects">0</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">Discard DR: </span>                        <span class="caat_debug_value" id="textDiscardDR">0</span>                    </span>                </div>            </div>            <div id="caat-debug-tab1-content">                <div>                    <div>                        <span id="control-sound"></span>                        <span class="checkbox_description">Sound</span>                    </div>                    <div>                        <span id="control-music"></span>                        <span class="checkbox_description">Music</span>                    </div>                    <div>                        <span id="control-aabb"></span>                        <span class="checkbox_description">AA Bounding Boxes</span>                    </div>                    <div>                        <span id="control-bb"></span>                        <span class="checkbox_description">Bounding Boxes</span>                    </div>                    <div>                        <span id="control-dr"></span>                        <span class="checkbox_description">Dirty Rects</span>                    </div>                </div>            </div>        </div>    </div>',setScale:function(e){return this.scale=e,this},initialize:function(w,h){w=window.innerWidth,this.width=w,this.height=h,this.framerate={refreshInterval:CAAT.FPS_REFRESH||500,frames:0,timeLastRefresh:0,fps:0,prevFps:-1,fpsMin:1e3,fpsMax:0};var debugContainer=document.getElementById("caat-debug");if(!debugContainer){var wrap=document.createElement("div");wrap.innerHTML=this.debugTpl,document.body.appendChild(wrap),eval(' var __x= CAAT;        function initCheck( name, bool, callback ) {            var elem= document.getElementById(name);            if ( elem ) {                elem.className= (bool) ? "checkbox_enabled" : "checkbox_disabled";                if ( callback ) {                    elem.addEventListener( "click", (function(elem, callback) {                        return function(e) {                            elem.__value= !elem.__value;                            elem.className= (elem.__value) ? "checkbox_enabled" : "checkbox_disabled";                            callback(e,elem.__value);                        }                    })(elem, callback), false );                }                elem.__value= bool;            }        }        function setupTabs() {            var numTabs=0;            var elem;            var elemContent;            do {                elem= document.getElementById("caat-debug-tab"+numTabs);                if ( elem ) {                    elemContent= document.getElementById("caat-debug-tab"+numTabs+"-content");                    if ( elemContent ) {                        elemContent.style.display= numTabs===0 ? \'block\' : \'none\';                        elem.className= numTabs===0 ? "debug_tab debug_tab_selected" : "debug_tab debug_tab_not_selected";                        elem.addEventListener( "click", (function(tabIndex) {                            return function(e) {                                for( var i=0; i<numTabs; i++ ) {                                    var _elem= document.getElementById("caat-debug-tab"+i);                                    var _elemContent= document.getElementById("caat-debug-tab"+i+"-content");                                    _elemContent.style.display= i===tabIndex ? \'block\' : \'none\';                                    _elem.className= i===tabIndex ? "debug_tab debug_tab_selected" : "debug_tab debug_tab_not_selected";                                }                            }                        })(numTabs), false );                    }                    numTabs++;                }            } while( elem );        }        initCheck( "control-sound", __x.director[0].isSoundEffectsEnabled(), function(e, bool) {            __x.director[0].setSoundEffectsEnabled(bool);        } );        initCheck( "control-music", __x.director[0].isMusicEnabled(), function(e, bool) {            __x.director[0].setMusicEnabled(bool);        } );        initCheck( "control-aabb", CAAT.DEBUGBB, function(e,bool) {            CAAT.DEBUGAABB= bool;            __x.director[0].currentScene.dirty= true;        } );        initCheck( "control-bb", CAAT.DEBUGBB, function(e,bool) {            CAAT.DEBUGBB= bool;            if ( bool ) {                CAAT.DEBUGAABB= true;            }            __x.director[0].currentScene.dirty= true;        } );        initCheck( "control-dr", CAAT.DEBUG_DIRTYRECTS , function( e,bool ) {            CAAT.DEBUG_DIRTYRECTS= bool;        });        setupTabs();')}this.canvas=document.getElementById("caat-debug-canvas");if(null===this.canvas){this.canDebug=!1;return}return this.canvas.width=w,this.canvas.height=h,this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.width,this.height),this.textFPS=document.getElementById("textFPS"),this.textDrawTime=document.getElementById("textDrawTime"),this.textRAFTime=document.getElementById("textRAFTime"),this.textEntitiesTotal=document.getElementById("textEntitiesTotal"),this.textEntitiesActive=document.getElementById("textEntitiesActive"),this.textDraws=document.getElementById("textDraws"),this.textDirtyRects=document.getElementById("textDirtyRects"),this.textDiscardDR=document.getElementById("textDiscardDR"),this.canDebug=!0,this},debugInfo:function(e){this.statistics=e;var t=CAAT;this.frameTimeAcc+=t.FRAME_TIME,this.frameRAFAcc+=t.REQUEST_ANIMATION_FRAME_TIME,this.framerate.frames++;var n=(new Date).getTime();if(n>this.framerate.timeLastRefresh+this.framerate.refreshInterval){this.framerate.fps=this.framerate.frames*1e3/(n-this.framerate.timeLastRefresh)|0,this.framerate.fpsMin=this.framerate.frames>0?Math.min(this.framerate.fpsMin,this.framerate.fps):this.framerate.fpsMin,this.framerate.fpsMax=Math.max(this.framerate.fpsMax,this.framerate.fps),this.textFPS.innerHTML=this.framerate.fps;var r=(this.frameTimeAcc*100/this.framerate.frames|0)/100;this.frameTimeAcc=0,this.textDrawTime.innerHTML=r;var i=(this.frameRAFAcc*100/this.framerate.frames|0)/100;this.frameRAFAcc=0,this.textRAFTime.innerHTML=i,this.framerate.timeLastRefresh=n,this.framerate.frames=0,this.paint(i)}this.textEntitiesTotal.innerHTML=this.statistics.size_total,this.textEntitiesActive.innerHTML=this.statistics.size_active,this.textDirtyRects.innerHTML=this.statistics.size_dirtyRects,this.textDraws.innerHTML=this.statistics.draws,this.textDiscardDR.innerHTML=this.statistics.size_discarded_by_dirty_rects},paint:function(e){var t=this.ctx,n=0;t.drawImage(this.canvas,1,0,this.width-1,this.height,0,0,this.width-1,this.height),t.strokeStyle="black",t.beginPath(),t.moveTo(this.width-.5,0),t.lineTo(this.width-.5,this.height),t.stroke(),t.strokeStyle="#a22",t.beginPath(),n=this.height-(20/this.SCALE*this.height>>0)-.5,t.moveTo(.5,n),t.lineTo(this.width+.5,n),t.stroke(),t.strokeStyle="#aa2",t.beginPath(),n=this.height-(30/this.SCALE*this.height>>0)-.5,t.moveTo(.5,n),t.lineTo(this.width+.5,n),t.stroke();var r=Math.min(this.height-this.framerate.fps/this.SCALE*this.height,59);-1===this.framerate.prevFps&&(this.framerate.prevFps=r|0),t.strokeStyle="#0ff",t.beginPath(),t.moveTo(this.width,(r|0)-.5),t.lineTo(this.width,this.framerate.prevFps-.5),t.stroke(),this.framerate.prevFps=r;var i=(this.height-e/this.SCALE*this.height>>0)-.5;t.strokeStyle="#ff0",t.beginPath(),t.moveTo(this.width,i),t.lineTo(this.width,i),t.stroke()}}}),CAAT.Module({defines:"CAAT.Module.Font.Font",aliases:"CAAT.Font",depends:["CAAT.Foundation.SpriteImage"],constants:{getFontMetrics:function(e){var t;if(CAAT.CSS_TEXT_METRICS)try{return t=CAAT.Module.Font.Font.getFontMetricsCSS(e),t}catch(n){}return CAAT.Module.Font.Font.getFontMetricsNoCSS(e)},getFontMetricsNoCSS:function(e){var t=/(\d+)p[x|t]/i,n=t.exec(e),r;n?r=n[1]|0:r=32;var i=r-1,s=r+r*.2|0;return{height:s,ascent:i,descent:s-i}},getFontMetricsCSS:function(e){function t(e){var t,n,r,i,s,o,u,a,f,l,c=e&&e.ownerDocument;return n=c.documentElement,t=e.getBoundingClientRect(),r=document.body,i=c.nodeType===9?c.defaultView||c.parentWindow:!1,s=n.clientTop||r.clientTop||0,o=n.clientLeft||r.clientLeft||0,u=i.pageYOffset||n.scrollTop,a=i.pageXOffset||n.scrollLeft,f=t.top+u-s,l=t.left+a-o,{top:f,left:l}}try{var n=document.createElement("span");n.style.font=e,n.innerHTML="Hg";var r=document.createElement("div");r.style.display="inline-block",r.style.width="1px",r.style.heigh="0px";var i=document.createElement("div");i.appendChild(n),i.appendChild(r);var s=document.body;s.appendChild(i);try{var o={};return r.style.verticalAlign="baseline",o.ascent=t(r).top-t(n).top,r.style.verticalAlign="bottom",o.height=t(r).top-t(n).top,o.ascent=Math.ceil(o.ascent),o.height=Math.ceil(o.height),o.descent=o.height-o.ascent,o}finally{s.removeChild(i)}}catch(u){return null}}},extendsWith:function(){var e=10;return{fontSize:10,fontSizeUnit:"px",font:"Sans-Serif",fontStyle:"",fillStyle:"#fff",strokeStyle:null,strokeSize:1,padding:0,image:null,charMap:null,height:0,ascent:0,descent:0,setPadding:function(e){return this.padding=e,this},setFontStyle:function(e){return this.fontStyle=e,this},setStrokeSize:function(e){return this.strokeSize=e,this},setFontSize:function(e){return this.fontSize=e,this.fontSizeUnit="px",this},setFont:function(e){return this.font=e,this},setFillStyle:function(e){return this.fillStyle=e,this},setStrokeStyle:function(e){return this.strokeStyle=e,this},createDefault:function(e){var t="";for(var n=32;n<128;n++)t+=String.fromCharCode(n);return this.create(t,e)},create:function(e,t){t|=0,this.padding=t;var n=document.createElement("canvas"),r=n.getContext("2d");r.textBaseline="bottom",r.font=this.fontStyle+" "+this.fontSize+""+this.fontSizeUnit+" "+this.font;var i=0,s=[],o,u,a;for(o=0;o<e.length;o++){var f=Math.max(1,(r.measureText(e.charAt(o)).width>>0)+1)+2*t;s.push(f),i+=f}var l=CAAT.Font.getFontMetrics(r.font),c="alphabetic",h,p;p=l.height,this.ascent=l.ascent,this.descent=l.descent,this.height=l.height,h=l.ascent,n.width=i,n.height=p,r=n.getContext("2d"),r.textBaseline=c,r.font=this.fontStyle+" "+this.fontSize+""+this.fontSizeUnit+" "+this.font,r.fillStyle=this.fillStyle,r.strokeStyle=this.strokeStyle,this.charMap={},u=0;for(o=0;o<e.length;o++)a=e.charAt(o),r.fillText(a,u+t,h),this.strokeStyle&&(r.beginPath(),r.lineWidth=this.strokeSize,r.strokeText(a,u+t,h)),this.charMap[a]={x:u+t,width:s[o]-2*t},u+=s[o];return this.image=n,this},setAsSpriteImage:function(){var e=[],t=0;for(var n in this.charMap){var r=n,i=this.charMap[n];e[n]={id:t++,height:this.height,xoffset:0,letter:r,yoffset:0,width:i.width,xadvance:i.width,x:i.x,y:0}}return this.spriteImage=(new CAAT.Foundation.SpriteImage).initializeAsGlyphDesigner(this.image,e),this},getAscent:function(){return this.ascent},getDescent:function(){return this.descent},stringHeight:function(){return this.height},getFontData:function(){return{height:this.height,ascent:this.ascent,descent:this.descent}},stringWidth:function(t){var n,r,i=0,s;for(n=0,r=t.length;n<r;n++)s=this.charMap[t.charAt(n)],s?i+=s.width:i+=e;return i},drawText:function(t,n,r,i){var s,o,u,a,f=this.image.height;for(s=0,o=t.length;s<o;s++)u=this.charMap[t.charAt(s)],u?(a=u.width,a>0&&u.height>0&&n.drawImage(this.image,u.x,0,a,f,r,i,a,f),r+=a):(n.strokeStyle="#f00",n.strokeRect(r,i,e,f),r+=e)},save:function(){var e="image/png",t=this.image.toDataURL(e);document.location.href=t.replace(e,"image/octet-stream")},drawSpriteText:function(e,t){this.spriteImage.drawSpriteText(e,t)}}}}),CAAT.Module({defines:"CAAT.Module.CircleManager.PackedCircle",depends:["CAAT.Module.CircleManager.PackedCircle","CAAT.Math.Point"],constants:{BOUNDS_RULE_WRAP:1,BOUNDS_RULE_CONSTRAINT:2,BOUNDS_RULE_DESTROY:4,BOUNDS_RULE_IGNORE:8},extendsWith:{__init:function(){return this.boundsRule=CAAT.Module.CircleManager.PackedCircle.BOUNDS_RULE_IGNORE,this.position=new CAAT.Math.Point(0,0,0),this.offset=new CAAT.Math.Point(0,0,0),this.targetPosition=new CAAT.Math.Point(0,0,0),this},id:0,delegate:null,position:null,offset:null,targetPosition:null,targetChaseSpeed:.02,isFixed:!1,boundsRule:0,collisionMask:0,collisionGroup:0,containsPoint:function(e){var t=this.position.getDistanceSquared(e);return t<this.radiusSquared},getDistanceSquaredFromPosition:function(e){var t=this.position.getDistanceSquared(e);return t<this.radiusSquared},intersects:function(e){var t=this.position.getDistanceSquared(e.position);return t<this.radiusSquared||t<e.radiusSquared},setPosition:function(e){return this.position=e,this},setDelegate:function(e){return this.delegate=e,this},setOffset:function(e){return this.offset=e,this},setTargetPosition:function(e){return this.targetPosition=e,this},setTargetChaseSpeed:function(e){return this.targetChaseSpeed=e,this},setIsFixed:function(e){return this.isFixed=e,this},setCollisionMask:function(e){return this.collisionMask=e,this},setCollisionGroup:function(e){return this.collisionGroup=e,this},setRadius:function(e){return this.radius=e,this.radiusSquared=this.radius*this.radius,this},initialize:function(e){if(e)for(var t in e)this[t]=e[t];return this},dealloc:function(){this.position=null,this.offset=null,this.delegate=null,this.targetPosition=null}}}),CAAT.Module({defines:"CAAT.Module.CircleManager.PackedCircleManager",depends:["CAAT.Math.Point","CAAT.Math.Rectangle"],extendsWith:{__init:function(){this.bounds=new CAAT.Math.Rectangle},allCircles:[],numberOfCollisionPasses:1,numberOfTargetingPasses:0,bounds:null,addCircle:function(e){return e.id=this.allCircles.length,this.allCircles.push(e),this},removeCircle:function(e){var t=0,n=!1,r=this.allCircles.length;if(r===0)throw"Error: (PackedCircleManager) attempting to remove circle, and allCircles.length === 0!!";while(r--)if(this.allCircles[r]===e){n=!0,t=r;break}if(!n)throw"Could not locate circle in allCircles array!";return this.allCircles[t].dealloc(),this.allCircles[t]=null,this},forceCirclesToMatchDelegatePositions:function(){var e=this.allCircles.length;for(var t=0;t<e;t++){var n=this.allCircles[t];if(!n||!n.delegate)continue;n.position.set(n.delegate.x+n.offset.x,n.delegate.y+n.offset.y)}},pushAllCirclesTowardTarget:function(e){var t=new CAAT.Math.Point(0,0,0),n=this.allCircles,r=n.length;for(var i=0;i<this.numberOfTargetingPasses;i++)for(var s=0;s<r;s++){var o=n[s];if(o.isFixed)continue;t.x=o.position.x-(o.targetPosition.x+o.offset.x),t.y=o.position.y-(o.targetPosition.y+o.offset.y),t.multiply(o.targetChaseSpeed),o.position.x-=t.x,o.position.y-=t.y}},handleCollisions:function(){this.removeExpiredElements();var e=new CAAT.Math.Point(0,0,0),t=this.allCircles,n=t.length;for(var r=0;r<this.numberOfCollisionPasses;r++)for(var i=0;i<n;i++){var s=t[i];for(var o=i+1;o<n;o++){var u=t[o];if(!this.circlesCanCollide(s,u))continue;var a=u.position.x-s.position.x,f=u.position.y-s.position.y,l=(s.radius+u.radius)*1.08,c=s.position.getDistanceSquared(u.position);if(c<l*l-.02){e.x=a,e.y=f,e.normalize();var h=(l-Math.sqrt(c))*.5;e.multiply(h),u.isFixed||(s.isFixed&&e.multiply(2.2),u.position.translatePoint(e)),s.isFixed||(u.isFixed&&e.multiply(2.2),s.position.subtract(e))}}}},handleBoundaryForCircle:function(e,t){var n=e.position.x,r=e.position.y,i=e.radius,s=i*2,o=1,u=4,a=8,f=16,l=32;t=u|a,t&o&&n-s>this.bounds.right?e.position.x=this.bounds.left+i:t&o&&n+s<this.bounds.left&&(e.position.x=this.bounds.right-i),t&u&&r-s>this.bounds.bottom?e.position.y=this.bounds.top-i:t&u&&r+s<this.bounds.top&&(e.position.y=this.bounds.bottom+i),t&a&&n+i>=this.bounds.right?e.position.x=e.position.x=this.bounds.right-i:t&a&&n-i<this.bounds.left&&(e.position.x=this.bounds.left+i),t&f&&r+i>this.bounds.bottom?e.position.y=this.bounds.bottom-i:t&f&&r-i<this.bounds.top&&(e.position.y=this.bounds.top+i)},getCircleAt:function(e,t,n){var r=this.allCircles,i=r.length,s=new CAAT.Math.Point(e,t,0),o=null,u=Number.MAX_VALUE;for(var a=0;a<i;a++){var f=r[a];if(!f)continue;var l=f.position.getDistanceSquared(s);l<u&&l<f.radiusSquared+n&&(u=l,o=f)}return o},circlesCanCollide:function(e,t){return!e||!t||e===t?!1:!0},setBounds:function(e,t,n,r){this.bounds.x=e,this.bounds.y=t,this.bounds.width=n,this.bounds.height=r},setNumberOfCollisionPasses:function(e){return this.numberOfCollisionPasses=e,this},setNumberOfTargetingPasses:function(e){return this.numberOfTargetingPasses=e,this},sortOnDistanceToTarget:function(e,t){var n=e.getDistanceSquaredFromPosition(e.targetPosition),r=t.getDistanceSquaredFromPosition(e.targetPosition),i=0;return n>r?i=-1:n<r&&(i=1),i},removeExpiredElements:function(){for(var e=this.allCircles.length;e>=0;e--)this.allCircles[e]===null&&this.allCircles.splice(e,1)},initialize:function(e){if(e)for(var t in e)this[t]=e[t];return this}}}),CAAT.Module({defines:"CAAT.Module.Preloader.Preloader",extendsWith:function(){var e=function(e,t,n){var r=this;return this.id=e,this.path=t,this.image=new Image,this.loader=n,this.image.onload=this.onload.bind(this),this.image.onerror=this.onerror.bind(this),this};return e.prototype={id:null,path:null,image:null,loader:null,onload:function(e){this.loader.__onload(this),this.image.onload=null,this.image.onerror=null},onerror:function(e){this.loader.__onerror(this)},load:function(){this.image.src=this.path},clear:function(){this.loader=null}},{__init:function(){return this.elements=[],this.baseURL="",this},currentGroup:null,elements:null,imageCounter:0,cfinished:null,cloaded:null,cerrored:null,loadedCount:0,baseURL:null,addElement:function(t,n){return this.elements.push(new e(t,this.baseURL+n,this)),this},clear:function(){for(var e=0;e<this.elements.length;e++)this.elements[e].clear();this.elements=null},__onload:function(e){this.cloaded&&this.cloaded(e.id),this.loadedCount++,this.loadedCount===this.elements.length&&this.cfinished&&this.cfinished(this.elements)},__onerror:function(e){this.cerrored&&this.cerrored(e.id)},setBaseURL:function(e){return this.baseURL=e,this},load:function(e,t,n){this.cfinished=e,this.cloaded=t,this.cerroed=n;var r;for(r=0;r<this.elements.length;r++)this.elements[r].load();return this}}}}),CAAT.Module({defines:"CAAT.Module.Preloader.ImagePreloader",aliases:["CAAT.ImagePreloader"],extendsWith:{__init:function(){return this.images=[],this},images:null,notificationCallback:null,imageCounter:0,loadImages:function(e,t,n){e||t&&t(0,[]);var r=this,i;this.notificationCallback=t,this.images=[];for(i=0;i<e.length;i++)this.images.push({id:e[i].id,image:new Image});for(i=0;i<e.length;i++)this.images[i].image.onload=function(){r.imageCounter++,r.notificationCallback(r.imageCounter,r.images)},this.images[i].image.onerror=function(e){return function(t){n&&n(t,e)}}(i),this.images[i].image.src=e[i].url;e.length===0&&t(0,[])}}}),CAAT.Module({defines:"CAAT.Module.Image.ImageUtil",depends:["CAAT.Math.Matrix"],extendsWith:{},constants:{createAlphaSpriteSheet:function(e,t,n,r,i){if(e<t){var s=e;e=t,t=s}var o=document.createElement("canvas");o.width=r.width,o.height=r.height*n;var u=o.getContext("2d");u.fillStyle=i?i:"rgba(255,255,255,0)",u.fillRect(0,0,r.width,r.height*n);var a;for(a=0;a<n;a++)u.globalAlpha=1-(e-t)/n*(a+1),u.drawImage(r,0,a*r.height);return o},rotate:function(e,t){t=t||0;if(!t)return e;var n=document.createElement("canvas");n.width=e.height,n.height=e.width;var r=n.getContext("2d");r.globalAlpha=1,r.fillStyle="rgba(0,0,0,0)",r.clearRect(0,0,n.width,n.height);var i=new CAAT.Math.Matrix;return i.multiply((new CAAT.Math.Matrix).setTranslate(n.width/2,n.width/2)),i.multiply((new CAAT.Math.Matrix).setRotation(t*Math.PI/180)),i.multiply((new CAAT.Math.Matrix).setTranslate(-n.width/2,-n.width/2)),i.transformRenderingContext(r),r.drawImage(e,0,0),n},optimize:function(e,t,n){t>>=0;var r=!0,i=!0,s=!0,o=!0;typeof n!="undefined"&&(typeof n.top!="undefined"&&(r=n.top),typeof n.bottom!="undefined"&&(i=n.bottom),typeof n.left!="undefined"&&(s=n.left),typeof n.right!="undefined"&&(o=n.right));var u=document.createElement("canvas");u.width=e.width,u.height=e.height;var a=u.getContext("2d");a.fillStyle="rgba(0,0,0,0)",a.fillRect(0,0,e.width,e.height),a.drawImage(e,0,0);var f=a.getImageData(0,0,e.width,e.height),l=f.data,c,h,p=0,d=u.height-1,v=0,m=u.width-1,g=!1;if(r){for(c=0;c<u.height;c++){for(h=0;h<u.width;h++)if(l[c*u.width*4+3+h*4]>t){g=!0;break}if(g)break}p=c}if(i){g=!1;for(c=u.height-1;c>=p;c--){for(h=0;h<u.width;h++)if(l[c*u.width*4+3+h*4]>t){g=!0;break}if(g)break}d=c}if(s){g=!1;for(h=0;h<u.width;h++){for(c=p;c<=d;c++)if(l[c*u.width*4+3+h*4]>t){g=!0;break}if(g)break}v=h}if(o){g=!1;for(h=u.width-1;h>=v;h--){for(c=p;c<=d;c++)if(l[c*u.width*4+3+h*4]>t){g=!0;break}if(g)break}m=h}if(0===v&&0===p&&u.width-1===m&&u.height-1===d)return u;var y=m-v+1,b=d-p+1,w=a.getImageData(v,p,y,b);return u.width=y,u.height=b,a=u.getContext("2d"),a.putImageData(w,0,0),u},createThumb:function(e,t,n,r){t=t||24,n=n||24;var i=document.createElement("canvas");i.width=t,i.height=n;var s=i.getContext("2d");if(r){var o=Math.max(e.width,e.height),u=e.width/o*t,a=e.height/o*n;s.drawImage(e,(t-u)/2,(n-a)/2,u,a)}else s.drawImage(e,0,0,t,n);return i}}}),CAAT.Module({defines:"CAAT.Module.Collision.QuadTree",depends:["CAAT.Math.Rectangle"],extendsClass:"CAAT.Math.Rectangle",extendsWith:function(){var e=1,t=32;return{bgActors:null,quadData:null,create:function(n,r,i,s,o,u,a){typeof u=="undefined"&&(u=t),typeof a=="undefined"&&(a=e);var f=(n+i)/2,l=(r+s)/2;return this.x=n,this.y=r,this.x1=i,this.y1=s,this.width=i-n,this.height=s-r,this.bgActors=this.__getOverlappingActorList(o),this.bgActors.length<=a||this.width<=u?this:(this.quadData=new Array(4),this.quadData[0]=(new CAAT.Module.Collision.QuadTree).create(n,r,f,l,this.bgActors),this.quadData[1]=(new CAAT.Module.Collision.QuadTree).create(f,r,i,l,this.bgActors),this.quadData[2]=(new CAAT.Module.Collision.QuadTree).create(n,l,f,s,this.bgActors),this.quadData[3]=(new CAAT.Module.Collision.QuadTree).create(f,l,i,s,this.bgActors),this)},__getOverlappingActorList:function(e){var t=[];for(var n=0,r=e.length;n<r;n++){var i=e[n];this.intersects(i.AABB)&&t.push(i)}return t},getOverlappingActors:function(e){var t,n,r,i=[],s,o=this.bgActors,u;if(this.quadData){for(t=0;t<4;t++)if(this.quadData[t].intersects(e)){s=this.quadData[t].getOverlappingActors(e);for(n=0,r=s.length;n<r;n++)i.push(s[n])}}else for(t=0,r=o.length;t<r;t++)u=o[t],e.intersects(u.AABB)&&i.push(u);return i}}}}),CAAT.Module({defines:"CAAT.Module.Collision.SpatialHash",aliases:["CAAT.SpatialHash"],depends:["CAAT.Math.Rectangle"],extendsWith:{elements:null,width:null,height:null,rows:null,columns:null,xcache:null,ycache:null,xycache:null,rectangle:null,r0:null,r1:null,initialize:function(e,t,n,r){var i,s;this.elements=[];for(i=0;i<n*r;i++)this.elements.push([]);this.width=e,this.height=t,this.rows=n,this.columns=r,this.xcache=[];for(i=0;i<e;i++)this.xcache.push(i/(e/r)>>0);this.ycache=[];for(i=0;i<t;i++)this.ycache.push(i/(t/n)>>0);this.xycache=[];for(i=0;i<this.rows;i++){this.xycache.push([]);for(s=0;s<this.columns;s++)this.xycache[i].push(s+i*r)}return this.rectangle=(new CAAT.Math.Rectangle).setBounds(0,0,e,t),this.r0=new CAAT.Math.Rectangle,this.r1=new CAAT.Math.Rectangle,this},clearObject:function(){var e;for(e=0;e<this.rows*this.columns;e++)this.elements[e]=[];return this},addObject:function(e){var t=e.x|0,n=e.y|0,r=e.width|0,i=e.height|0,s=this.__getCells(t,n,r,i);for(var o=0;o<s.length;o++)this.elements[s[o]].push(e)},__getCells:function(e,t,n,r){var i=[],s;this.rectangle.contains(e,t)&&i.push(this.xycache[this.ycache[t]][this.xcache[e]]);if(this.rectangle.contains(e+n-1,t+r-1)){var o=this.xycache[this.ycache[t+r-1]][this.xcache[e+n-1]];if(o===i[0])return i;i.push(o)}if(this.rectangle.contains(e+n-1,t)){var o=this.xycache[this.ycache[t]][this.xcache[e+n-1]];if(o===i[0]||o===i[1])return i;i.push(o)}if(this.rectangle.contains(e+n-1,t+r-1)){var o=this.xycache[this.ycache[t+r-1]][this.xcache[e]];i.push(o)}return i},solveCollision:function(e){var t,n,r;for(t=0;t<this.elements.length;t++){var i=this.elements[t];i.length>1&&this._solveCollisionCell(i,e)}},_solveCollisionCell:function(e,t){var n,r;for(n=0;n<e.length;n++){var i=e[n];this.r0.setBounds(i.x,i.y,i.width,i.height);for(r=n+1;r<e.length;r++){var s=e[r];this.r0.intersects(this.r1.setBounds(s.x,s.y,s.width,s.height))&&t(i,s)}}},collide:function(e,t,n,r,i){e|=0,t|=0,n|=0,r|=0;var s=this.__getCells(e,t,n,r),o,u,a,f=this.elements;this.r0.setBounds(e,t,n,r);for(o=0;o<s.length;o++){var l=s[o],c=f[l];for(u=0,a=c.length;u<a;u++){var h=c[u];this.r1.setBounds(h.x,h.y,h.width,h.height);if(this.r0.intersects(this.r1)&&i(h))return}}}}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureElement",extendsWith:{inverted:!1,image:null,u:0,v:0,glTexture:null}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureScan",depends:["CAAT.Module.TexturePacker.TextureElement"],extendsWith:{__init:function(e){return this.freeChunks=[{position:0,size:e||1024}],this},freeChunks:null,findWhereFits:function(e){if(this.freeChunks.length===0)return[];var t=[],n;for(n=0;n<this.freeChunks.length;n++){var r=0;while(r+e<=this.freeChunks[n].size)t.push(r+this.freeChunks[n].position),r+=e}return t},fits:function(e,t){var n=0;for(n=0;n<this.freeChunks.length;n++){var r=this.freeChunks[n];if(r.position<=e&&e+t<=r.position+r.size)return!0}return!1},substract:function(e,t){var n=0;for(n=0;n<this.freeChunks.length;n++){var r=this.freeChunks[n];if(r.position<=e&&e+t<=r.position+r.size){var i=0,s=0,o=0,u=0;return i=r.position,s=e-r.position,o=e+t,u=r.position+r.size-o,this.freeChunks.splice(n,1),s>0&&this.freeChunks.splice(n++,0,{position:i,size:s}),u>0&&this.freeChunks.splice(n,0,{position:o,size:u}),!0}}return!1},log:function(e){if(0===this.freeChunks.length)CAAT.log("index "+e+" empty");else{var t="index "+e;for(var n=0;n<this.freeChunks.length;n++){var r=this.freeChunks[n];t+="["+r.position+","+r.size+"]"}CAAT.log(t)}}}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureScanMap",depends:["CAAT.Module.TexturePacker.TextureScan"],extendsWith:{__init:function(e,t){this.scanMapHeight=t,this.scanMapWidth=e,this.scanMap=[];for(var n=0;n<this.scanMapHeight;n++)this.scanMap.push(new CAAT.Module.TexturePacker.TextureScan(this.scanMapWidth));return this},scanMap:null,scanMapWidth:0,scanMapHeight:0,whereFitsChunk:function(e,t){if(e>this.width||t>this.height)return null;var n,r,i=0;while(i<=this.scanMapHeight-t){var s=null,o=!1;for(;i<=this.scanMapHeight-t;i++){s=this.scanMap[i].findWhereFits(e);if(null!==s&&s.length>0){o=!0;break}}if(!o)return null;var u=Number.MAX_VALUE;for(r=0;r<s.length;r++){var a=!0;for(n=i;n<i+t;n++)if(!this.scanMap[n].fits(s[r],e)){a=!1;break}if(a)return{x:s[r],y:i}}i++}return null},substract:function(e,t,n,r){for(var i=0;i<r;i++)this.scanMap[i+t].substract(e,n)||CAAT.log("Error: removing chunk ",n,r," at ",e,t)},log:function(){for(var e=0;e<this.scanMapHeight;e++)this.scanMap[e].log(e)}}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TexturePage",depends:["CAAT.Module.TexturePacker.TextureScanMap"],extendsWith:{__init:function(e,t){return this.width=e||1024,this.height=t||1024,this.images=[],this},width:1024,height:1024,gl:null,texture:null,allowImagesInvertion:!1,padding:4,scan:null,images:null,criteria:"area",initialize:function(e){this.gl=e,e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA);var t=new Uint8Array(this.width*this.height*4);for(var n=0;n<4*this.width*this.height;)t[n++]=0,t[n++]=0,t[n++]=0,t[n++]=0;e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,t),e.enable(e.BLEND);for(var r=0;r<this.images.length;r++){var i=this.images[r];i.inverted&&(i=CAAT.Module.Image.ImageUtil.rotate(i,-90)),e.texSubImage2D(e.TEXTURE_2D,0,this.images[r].__tx,this.images[r].__ty,e.RGBA,e.UNSIGNED_BYTE,i)}},create:function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n].image;r.__texturePage||t.push(r)}this.createFromImages(t)},clear:function(){this.createFromImages([])},update:function(e,t,n,r){this.allowImagesInvertion=e,this.padding=t,n<100&&(n=100),r<100&&(r=100),this.width=n,this.height=r,this.createFromImages(this.images)},createFromImages:function(e){var t;this.scan=new CAAT.Module.TexturePacker.TextureScanMap(this.width,this.height),this.images=[];if(this.allowImagesInvertion)for(t=0;t<e.length;t++)e[t].inverted=this.allowImagesInvertion&&e[t].height<e[t].width;var n=this;e.sort(function(e,t){var r=e.width*e.height,i=t.width*t.height;return n.criteria==="width"?e.width<t.width?1:e.width>t.width?-1:0:n.criteria==="height"?e.height<t.height?1:e.height>t.height?-1:0:r<i?1:r>i?-1:0});for(t=0;t<e.length;t++){var r=e[t];this.packImage(r)}},addImage:function(e,t,n){this.allowImagesInvertion=t,this.padding=n,this.images.push(e),this.createFromImages(Array.prototype.slice.call(this.images))},endCreation:function(){var e=this.gl;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)},deletePage:function(){for(var e=0;e<this.images.length;e++)delete this.images[e].__texturePage,delete this.images[e].__u,delete this.images[e].__v;this.gl.deleteTexture(this.texture)},toCanvas:function(e,t){e=e||document.createElement("canvas"),e.width=this.width,e.height=this.height;var n=e.getContext("2d");n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,this.width,this.height);for(var r=0;r<this.images.length;r++)n.drawImage(this.images[r].inverted?CAAT.Modules.Image.ImageUtil.rotate(this.images[r],90):this.images[r],this.images[r].__tx,this.images[r].__ty),t&&(n.strokeStyle="red",n.strokeRect(this.images[r].__tx,this.images[r].__ty,this.images[r].__w,this.images[r].__h));return t&&(n.strokeStyle="red",n.strokeRect(0,0,this.width,this.height)),e},packImage:function(e){var t,n;e.inverted?(t=e.height,n=e.width):(t=e.width,n=e.height);var r=t,i=n,s;r&&this.padding&&(s=this.padding,r+s<=this.width&&(r+=s)),i&&this.padding&&(s=this.padding,i+s<=this.height&&(i+=s));var o=this.scan.whereFitsChunk(r,i);null!==o?(this.images.push(e),e.__tx=o.x,e.__ty=o.y,e.__u=o.x/this.width,e.__v=o.y/this.height,e.__u1=(o.x+t)/this.width,e.__v1=(o.y+n)/this.height,e.__texturePage=this,e.__w=t,e.__h=n,this.scan.substract(o.x,o.y,r,i)):CAAT.log("Imagen ",e.src," de tamano ",e.width,e.height," no cabe.")},changeHeuristic:function(e){this.criteria=e}}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TexturePageManager",depends:["CAAT.Module.TexturePacker.TexturePage"],extendsWith:{__init:function(){return this.pages=[],this},pages:null,createPages:function(e,t,n,r){var i=!1;while(!i){var s=new CAAT.Module.TexturePacker.TexturePage(t,n);s.create(r),s.initialize(e),s.endCreation(),this.pages.push(s),i=!0;for(var o=0;o<r.length;o++)if(!r[o].image.__texturePage){r[o].image.width<=t&&r[o].image.height<=n&&(i=!1);break}}},deletePages:function(){for(var e=0;e<this.pages.length;e++)this.pages[e].deletePage();this.pages=null}}}),CAAT.Module({defines:"CAAT.Module.LayoutUtils.RowLayout",constants:{Row:function(e,t,n){var r=e.width,i=0,s=0,o=0,u=0,a=-Number.MAX_VALUE,f=Number.MAX_VALUE;for(o=t.length-1;o;o-=1)f<t[o].width&&(f=t[o].width),a<t[o].height&&(a=t[o].height);n.padding_left&&(i=n.padding_left,r-=i),n.padding_right&&(r-=n.padding_right);if(n.top){var l=parseInt(n.top,10);if(!isNaN(l))s=l;else switch(n.top){case"center":s=(e.height-a)/2;break;case"top":s=0;break;case"bottom":s=e.height-a;break;default:s=0}}var c=r/t.length;for(o=0,u=t.length;o<u;o++)t[o].setLocation(i+o*c+(c-t[o].width)/2,s)}}}),CAAT.Module({defines:"CAAT.Module.Initialization.Template",depends:["CAAT.Foundation.Director","CAAT.Module.Preloader.ImagePreloader"],constants:{init:function(e,t,n,r,i){var s=document.getElementById(n),o;if(CAAT.__CSS__)s&&0==s instanceof HTMLDivElement&&(s=null),s===null&&(s=document.createElement("div"),document.body.appendChild(s)),o=(new CAAT.Foundation.Director).initialize(e||800,t||600,s);else{if(s){if(s instanceof HTMLDivElement){var u=document.createElement("canvas");s.appendChild(u),s=u}else if(0==s instanceof HTMLCanvasElement){var u=document.createElement("canvas");document.body.appendChild(u),s=u}}else s=document.createElement("canvas"),document.body.appendChild(s);o=(new CAAT.Foundation.Director).initialize(e||800,t||600,s)}(new CAAT.Module.Preloader.ImagePreloader).loadImages(r,function(t,n){t===n.length&&(o.emptyScenes(),o.setImagesCache(n),i(o),o.easeIn(0,CAAT.Foundation.Scene.EASE_SCALE,2e3,!1,CAAT.Foundation.Actor.ANCHOR_CENTER,(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(2.5,.4)),CAAT.loop(60))})}}}),CAAT.Module({defines:"CAAT.Module.Initialization.TemplateWithSplash",depends:["CAAT.Foundation.Director","CAAT.Module.Preloader.ImagePreloader"],constants:{init:function(e,t,n,r,i,s,o,u){function a(e,t,n){var r=e.getImage("spinner"),i=e.getImage("splash"),s=e.createScene(),o=t,u=(new Date).getTime();return i&&s.addChild((new CAAT.Foundation.Actor).setBackgroundImage(i,!1).setBounds(0,0,e.width,e.height).setImageTransformation(CAAT.Foundation.SpriteImage.TR_FIXED_TO_SIZE)),r&&s.addChild((new CAAT.Foundation.Actor).setBackgroundImage(r).centerAt(s.width/2,s.height/2).addBehavior((new CAAT.Behavior.RotateBehavior).setValues(0,2*Math.PI).setFrameTime(0,1e3).setCycle(!0))),s.loadedImage=function(t,r){if(!r||t===r.length){var i=(new Date).getTime()-u;i<o?(i=Math.abs(o-i),i>o&&(i=o),setTimeout(function(){f(e,r,n)},i)):f(e,r,n)}},s}function f(e,t,n){e.emptyScenes(),e.setImagesCache(t),e.setClear(!0),n(e),e.setClear(CAAT.Foundation.Director.CLEAR_ALL),e.easeIn(0,CAAT.Foundation.Scene.EASE_SCALE,2e3,!1,CAAT.Foundation.Actor.ANCHOR_CENTER,(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(2.5,.4))}var l=document.getElementById(n),c;if(CAAT.__CSS__)l&&0==l instanceof HTMLDivElement&&(l=null),l===null&&(l=document.createElement("div"),document.body.appendChild(l)),c=(new CAAT.Foundation.Director).initialize(e||800,t||600,l);else{if(l){if(l instanceof HTMLDivElement){var h=document.createElement("canvas");l.appendChild(h),l=h}else if(0==l instanceof HTMLCanvasElement){var h=document.createElement("canvas");document.body.appendChild(h),l=h}}else l=document.createElement("canvas"),document.body.appendChild(l);c=(new CAAT.Foundation.Director).initialize(e||800,t||600,l)}var p=[];o&&p.push({id:"splash",url:o}),u&&p.push({id:"spinner",url:u}),c.setClear(CAAT.Foundation.Director.CLEAR_DIRTY_RECTS),(new CAAT.Module.Preloader.ImagePreloader).loadImages(p,function(t,n){if(t===n.length){c.setImagesCache(n);var o=a(c,r||5e3,s);CAAT.loop(60),i&&i.length>0?(new CAAT.Module.Preloader.ImagePreloader).loadImages(i,o.loadedImage):o.loadedImage(0,null)}})}}}),function(){CAAT.CSS={},CAAT.CSS.PREFIX=function(){var e="",t=["WebKit","Moz","O"],n="";for(var r=0;r<t.length;r++)if(window[t[r]+"CSSKeyframeRule"]){e=t[r].toLowerCase();break}return CAAT.CSS.PROP_ANIMATION="-"+e+"-animation",e}(),CAAT.CSS.applyKeyframe=function(e,t,n,r,i){e.style[CAAT.CSS.PROP_ANIMATION]=t+" "+n/1e3+"s "+r/1e3+"s linear both "+(i?"infinite":"")},CAAT.CSS.unregisterKeyframes=function(e){var t=CAAT.CSS.getCSSKeyframesIndex(e);null!==t&&document.styleSheets[t.sheetIndex].deleteRule(t.index)},CAAT.CSS.registerKeyframes=function(e){var t=e.name,n=e.behavior,r=e.size,i=e.overwrite;if(typeof t=="undefined"||typeof n=="undefined")throw"Keyframes must be defined by a name and a CAAT.Behavior instance.";typeof r=="undefined"&&(r=100),typeof i=="undefined"&&(i=!1);var s=CAAT.CSS.getCSSKeyframesIndex(t);if(null!==s&&!i)return;var o=n.calculateKeyFramesData(CAAT.CSS.PREFIX,t,r,e.anchorX,e.anchorY);if(document.styleSheets){if(!document.styleSheets.length){var u=document.createElement("style");u.type="text/css",document.getElementsByTagName("head")[0].appendChild(u)}null!==s&&document.styleSheets[s.sheetIndex].deleteRule(s.index);var a=s?s.sheetIndex:0;document.styleSheets[a].insertRule(o,0)}return o},CAAT.CSS.getCSSKeyframesIndex=function(e){var t=document.styleSheets;for(var n=t.length-1;n>=0;n--)try{var r=t[n],i=r.cssRules?r.cssRules:r.rules?r.rules:[];for(var s=i.length-1;s>=0;s--)if((i[s].type===window.CSSRule.WEBKIT_KEYFRAMES_RULE||i[s].type===window.CSSRule.MOZ_KEYFRAMES_RULE)&&i[s].name===e)return{sheetIndex:n,index:s}}catch(o){}return null},CAAT.CSS.getCSSKeyframes=function(e){var t=document.styleSheets;for(var n=t.length-1;n>=0;n--)try{var r=t[n],i=r.cssRules?r.cssRules:r.rules?r.rules:[];for(var s=i.length-1;s>=0;s--)if((i[s].type===window.CSSRule.WEBKIT_KEYFRAMES_RULE||i[s].type===window.CSSRule.MOZ_KEYFRAMES_RULE)&&i[s].name===e)return i[s]}catch(o){}return null}}(),CAAT.Module({defines:"CAAT.PathUtil.PathSegment",depends:["CAAT.Math.Rectangle","CAAT.Math.Point","CAAT.Math.Matrix","CAAT.Math.Curve"],extendsWith:function(){return{__init:function(){return this.bbox=new CAAT.Math.Rectangle,this},color:"#000",length:0,bbox:null,parent:null,setParent:function(e){return this.parent=e,this},setColor:function(e){return e&&(this.color=e),this},endCurvePosition:function(){},startCurvePosition:function(){},setPoints:function(e){},setPoint:function(e,t){},getPosition:function(e){},getLength:function(){return this.length},getBoundingBox:function(){return this.bbox},numControlPoints:function(){},getControlPoint:function(e){},endPath:function(){},getContour:function(e){},updatePath:function(e){},applyAsPath:function(e){},transform:function(e){},drawHandle:function(e,t,n){e.beginPath(),e.arc(t,n,CAAT.Math.Curve.prototype.HANDLE_SIZE/2,0,2*Math.PI,!1),e.fill()}}}}),CAAT.Module({defines:"CAAT.PathUtil.ArcPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Rectangle"],aliases:["CAAT.ArcPath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){return this.__super(),this.points=[],this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.newPosition=new CAAT.Math.Point,this},points:null,cw:!0,newPosition:null,radius:0,startAngle:0,angle:2*Math.PI,arcTo:!1,setRadius:function(e){return this.radius=e,this},isArcTo:function(){return this.arcTo},setArcTo:function(e){return this.arcTo=e,this},initialize:function(e,t,n,r){return this.setInitialPosition(e,t),this.setFinalPosition(e+n,t),this.angle=r||2*Math.PI,this},applyAsPath:function(e){var t=e.ctx;return this.arcTo?t.arcTo(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y,this.radius):t.arc(this.points[0].x,this.points[0].y,this.radius,this.startAngle,this.angle+this.startAngle,this.cw),this},setPoint:function(e,t){t>=0&&t<this.points.length&&(this.points[t]=e)},setPoints:function(e){return this.points=[],this.points[0]=e[0],this.points[1]=e[1],this.updatePath(),this},setClockWise:function(e){return this.cw=e!==undefined?e:!0,this},isClockWise:function(){return this.cw},setInitialPosition:function(e,t){for(var n=0,r=this.points.length;n<r;n++)this.points[0].x=e,this.points[0].y=t;return this},setFinalPosition:function(e,t){return this.points[1].x=e,this.points[1].y=t,this.updatePath(this.points[1]),this},endCurvePosition:function(){return this.points[0]},startCurvePosition:function(){return this.points[0]},getPosition:function(e){if(e>1||e<0)e%=1;e<0&&(e=1+e);if(-1===this.length)this.newPosition.set(this.points[0].x,this.points[0].y);else{var t=this.angle*e*(this.cw?1:-1)+this.startAngle;this.newPosition.set(this.points[0].x+this.radius*Math.cos(t),this.points[0].y+this.radius*Math.sin(t))}return this.newPosition},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[1].x},paint:function(e,t){var n=e.ctx;n.save(),n.strokeStyle=this.color,n.beginPath(),this.arcTo?n.arcTo(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y,this.radius):n.arc(this.points[0].x,this.points[0].y,this.radius,this.startAngle,this.startAngle+this.angle,this.cw),n.stroke();if(t){n.globalAlpha=.5,n.fillStyle="#7f7f00";for(var r=0;r<this.points.length;r++)this.drawHandle(n,this.points[r].x,this.points[r].y)}n.restore()},numControlPoints:function(){return this.points.length},getControlPoint:function(e){return this.points[e]},getContour:function(e){var t=[];for(var n=0;n<e;n++)t.push({x:this.points[0].x+this.radius*Math.cos(n*Math.PI/(e/2)),y:this.points[0].y+this.radius*Math.sin(n*Math.PI/(e/2))});return t},getPositionFromLength:function(e){var t=e/this.length*(this.cw?1:-1);return this.getPosition(t)},updatePath:function(e){return this.points[1]===e?(this.arcTo||(this.radius=Math.sqrt((this.points[0].x-this.points[1].x)*(this.points[0].x-this.points[1].x)+(this.points[0].y-this.points[1].y)*(this.points[0].y-this.points[1].y))),this.length=this.angle*this.radius,this.startAngle=Math.atan2(this.points[1].y-this.points[0].y,this.points[1].x-this.points[0].x)):this.points[0]===e&&this.points[1].set(this.points[0].x+this.radius*Math.cos(this.startAngle),this.points[0].y+this.radius*Math.sin(this.startAngle)),this.bbox.setEmpty(),this.bbox.x=this.points[0].x-this.radius,this.bbox.y=this.points[0].y-this.radius,this.bbox.x1=this.points[0].x+this.radius,this.bbox.y1=this.points[0].y+this.radius,this.bbox.width=2*this.radius,this.bbox.height=2*this.radius,this}}}}),CAAT.Module({defines:"CAAT.PathUtil.CurvePath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Bezier"],aliases:["CAAT.CurvePath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){return this.__super(),this.newPosition=new CAAT.Math.Point(0,0,0),this},curve:null,newPosition:null,applyAsPath:function(e){return this.curve.applyAsPath(e),this},setPoint:function(e,t){this.curve&&this.curve.setPoint(e,t)},setPoints:function(e){var t=new CAAT.Math.Bezier;return t.setPoints(e),this.curve=t,this},setQuadric:function(e,t,n,r,i,s){var o=new CAAT.Math.Bezier;return o.setQuadric(e,t,n,r,i,s),this.curve=o,this.updatePath(),this},setCubic:function(e,t,n,r,i,s,o,u){var a=new CAAT.Math.Bezier;return a.setCubic(e,t,n,r,i,s,o,u),this.curve=a,this.updatePath(),this},updatePath:function(e){return this.curve.update(),this.length=this.curve.getLength(),this.curve.getBoundingBox(this.bbox),this},getPosition:function(e){if(e>1||e<0)e%=1;return e<0&&(e=1+e),this.curve.solve(this.newPosition,e),this.newPosition},getPositionFromLength:function(e){return this.curve.solve(this.newPosition,e/this.length),this.newPosition},initialPositionX:function(){return this.curve.coordlist[0].x},finalPositionX:function(){return this.curve.coordlist[this.curve.coordlist.length-1].x},paint:function(e,t){this.curve.drawHandles=t,e.ctx.strokeStyle=this.color,this.curve.paint(e,t)},numControlPoints:function(){return this.curve.coordlist.length},getControlPoint:function(e){return this.curve.coordlist[e]},endCurvePosition:function(){return this.curve.endCurvePosition()},startCurvePosition:function(){return this.curve.startCurvePosition()},getContour:function(e){var t=[];for(var n=0;n<=e;n++)t.push({x:n/e,y:this.getPosition(n/e).y});return t}}}}),CAAT.Module({defines:"CAAT.PathUtil.LinearPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point"],aliases:["CAAT.LinearPath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){return this.__super(),this.points=[],this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.newPosition=new CAAT.Math.Point(0,0,0),this},points:null,newPosition:null,applyAsPath:function(e){e.ctx.lineTo(this.points[1].x,this.points[1].y)},setPoint:function(e,t){t===0?this.points[0]=e:t===1&&(this.points[1]=e)},updatePath:function(e){var t=this.points[1].x-this.points[0].x,n=this.points[1].y-this.points[0].y;return this.length=Math.sqrt(t*t+n*n),this.bbox.setEmpty(),this.bbox.union(this.points[0].x,this.points[0].y),this.bbox.union(this.points[1].x,this.points[1].y),this},setPoints:function(e){return this.points[0]=e[0],this.points[1]=e[1],this.updatePath(),this},setInitialPosition:function(e,t){return this.points[0].x=e,this.points[0].y=t,this.newPosition.set(e,t),this},setFinalPosition:function(e,t){return this.points[1].x=e,this.points[1].y=t,this},endCurvePosition:function(){return this.points[1]},startCurvePosition:function(){return this.points[0]},getPosition:function(e){if(e>1||e<0)e%=1;return e<0&&(e=1+e),this.newPosition.set(this.points[0].x+(this.points[1].x-this.points[0].x)*e,this.points[0].y+(this.points[1].y-this.points[0].y)*e),this.newPosition},getPositionFromLength:function(e){return this.getPosition(e/this.length)},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[1].x},paint:function(e,t){var n=e.ctx;n.save(),n.strokeStyle=this.color,n.beginPath(),n.moveTo(this.points[0].x,this.points[0].y),n.lineTo(this.points[1].x,this.points[1].y),n.stroke(),t&&(n.globalAlpha=.5,n.fillStyle="#7f7f00",n.beginPath(),this.drawHandle(n,this.points[0].x,this.points[0].y),this.drawHandle(n,this.points[1].x,this.points[1].y)),n.restore()},numControlPoints:function(){return 2},getControlPoint:function(e){if(0===e)return this.points[0];if(1===e)return this.points[1]},getContour:function(e){var t=[];return t.push(this.getPosition(0).clone()),t.push(this.getPosition(1).clone()),t}}}}),CAAT.Module({defines:"CAAT.PathUtil.RectPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Rectangle"],aliases:["CAAT.RectPath","CAAT.ShapePath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){return this.__super(),this.points=[],this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.newPosition=new CAAT.Math.Point,this},points:null,cw:!0,newPosition:null,applyAsPath:function(e){var t=e.ctx;return this.cw?(t.lineTo(this.points[0].x,this.points[0].y),t.lineTo(this.points[1].x,this.points[1].y),t.lineTo(this.points[2].x,this.points[2].y),t.lineTo(this.points[3].x,this.points[3].y),t.lineTo(this.points[4].x,this.points[4].y)):(t.lineTo(this.points[4].x,this.points[4].y),t.lineTo(this.points[3].x,this.points[3].y),t.lineTo(this.points[2].x,this.points[2].y),t.lineTo(this.points[1].x,this.points[1].y),t.lineTo(this.points[0].x,this.points[0].y)),this},setPoint:function(e,t){t>=0&&t<this.points.length&&(this.points[t]=e)},setPoints:function(e){return this.points=[],this.points.push(e[0]),this.points.push((new CAAT.Math.Point).set(e[1].x,e[0].y)),this.points.push(e[1]),this.points.push((new CAAT.Math.Point).set(e[0].x,e[1].y)),this.points.push(e[0].clone()),this.updatePath(),this},setClockWise:function(e){return this.cw=e!==undefined?e:!0,this},isClockWise:function(){return this.cw},setInitialPosition:function(e,t){for(var n=0,r=this.points.length;n<r;n++)this.points[n].x=e,this.points[n].y=t;return this},setFinalPosition:function(e,t){return this.points[2].x=e,this.points[2].y=t,this.points[1].x=e,this.points[1].y=this.points[0].y,this.points[3].x=this.points[0].x,this.points[3].y=t,this.points[4].x=this.points[0].x,this.points[4].y=this.points[0].y,this.updatePath(),this},endCurvePosition:function(){return this.points[4]},startCurvePosition:function(){return this.points[0]},getPosition:function(e){if(e>1||e<0)e%=1;e<0&&(e=1+e);if(-1===this.length)this.newPosition.set(0,0);else{var t=this.bbox.width/this.length,n=this.bbox.height/this.length,r=0,i,s,o=0;this.cw?(s=[0,1,2,3,4],i=[t,n,t,n]):(s=[4,3,2,1,0],i=[n,t,n,t]);while(o<i.length){if(!(r+i[o]<e))break;r+=i[o],o++}e-=r;var u=s[o],a=s[o+1];this.newPosition.set(this.points[u].x+(this.points[a].x-this.points[u].x)*e/i[o],this.points[u].y+(this.points[a].y-this.points[u].y)*e/i[o])}return this.newPosition},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[2].x},paint:function(e,t){var n=e.ctx;n.save(),n.strokeStyle=this.color,n.beginPath(),n.strokeRect(this.bbox.x,this.bbox.y,this.bbox.width,this.bbox.height);if(t){n.globalAlpha=.5,n.fillStyle="#7f7f00";for(var r=0;r<this.points.length;r++)this.drawHandle(n,this.points[r].x,this.points[r].y)}n.restore()},numControlPoints:function(){return this.points.length},getControlPoint:function(e){return this.points[e]},getContour:function(){var e=[];for(var t=0;t<this.points.length;t++)e.push(this.points[t]);return e},updatePath:function(e){e&&(e===this.points[0]?(this.points[1].y=e.y,this.points[3].x=e.x):e===this.points[1]?(this.points[0].y=e.y,this.points[2].x=e.x):e===this.points[2]?(this.points[3].y=e.y,this.points[1].x=e.x):e===this.points[3]&&(this.points[0].x=e.x,this.points[2].y=e.y),this.points[4].x=this.points[0].x,this.points[4].y=this.points[0].y),this.bbox.setEmpty();for(var t=0;t<4;t++)this.bbox.union(this.points[t].x,this.points[t].y);return this.length=2*this.bbox.width+2*this.bbox.height,this.points[0].x=this.bbox.x,this.points[0].y=this.bbox.y,this.points[1].x=this.bbox.x+this.bbox.width,this.points[1].y=this.bbox.y,this.points[2].x=this.bbox.x+this.bbox.width,this.points[2].y=this.bbox.y+this.bbox.height,this.points[3].x=this.bbox.x,this.points[3].y=this.bbox.y+this.bbox.height,this.points[4].x=this.bbox.x,this.points[4].y=this.bbox.y,this},getPositionFromLength:function(e){return this.getPosition(e/(this.bbox.width*2+this.bbox.height*2))}}}}),CAAT.Module({defines:"CAAT.PathUtil.Path",aliases:["CAAT.Path"],depends:["CAAT.PathUtil.PathSegment","CAAT.PathUtil.ArcPath","CAAT.PathUtil.CurvePath","CAAT.PathUtil.LinearPath","CAAT.PathUtil.RectPath","CAAT.Math.Bezier","CAAT.Math.CatmullRom","CAAT.Math.Point","CAAT.Math.Matrix"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:{__init:function(){return this.__super(),this.newPosition=new CAAT.Math.Point(0,0,0),this.pathSegments=[],this.behaviorList=[],this.matrix=new CAAT.Math.Matrix,this.tmpMatrix=new CAAT.Math.Matrix,this},pathSegments:null,pathSegmentDurationTime:null,pathSegmentStartTime:null,newPosition:null,pathLength:-1,beginPathX:-1,beginPathY:-1,trackPathX:-1,trackPathY:-1,ax:-1,ay:-1,point:[],interactive:!0,behaviorList:null,rb_angle:0,rb_rotateAnchorX:.5,rb_rotateAnchorY:.5,sb_scaleX:1,sb_scaleY:1,sb_scaleAnchorX:.5,sb_scaleAnchorY:.5,tAnchorX:0,tAnchorY:0,tb_x:0,tb_y:0,matrix:null,tmpMatrix:null,pathPoints:null,width:0,height:0,clipOffsetX:0,clipOffsetY:0,closed:!1,applyAsPath:function(e){var t=e.ctx;e.modelViewMatrix.transformRenderingContext(t),t.globalCompositeOperation="source-out",t.moveTo(this.getFirstPathSegment().startCurvePosition().x,this.getFirstPathSegment().startCurvePosition().y);for(var n=0;n<this.pathSegments.length;n++)this.pathSegments[n].applyAsPath(e);return t.globalCompositeOperation="source-over",this},setInteractive:function(e){return this.interactive=e,this},getFirstPathSegment:function(){return this.pathSegments.length?this.pathSegments[0]:null},getLastPathSegment:function(){return this.pathSegments.length?this.pathSegments[this.pathSegments.length-1]:null},endCurvePosition:function(){return this.pathSegments.length?this.pathSegments[this.pathSegments.length-1].endCurvePosition():(new CAAT.Math.Point).set(this.beginPathX,this.beginPathY)},startCurvePosition:function(){return this.pathSegments[0].startCurvePosition()},getCurrentPathSegment:function(){return this.pathSegments[this.pathSegments.length-1]},setLinear:function(e,t,n,r){return this.pathSegments=[],this.beginPath(e,t),this.addLineTo(n,r),this.endPath(),this},setQuadric:function(e,t,n,r,i,s){return this.beginPath(e,t),this.addQuadricTo(n,r,i,s),this.endPath(),this},setCubic:function(e,t,n,r,i,s,o,u){return this.beginPath(e,t),this.addCubicTo(n,r,i,s,o,u),this.endPath(),this},setRectangle:function(e,t,n,r){return this.beginPath(e,t),this.addRectangleTo(n,r),this.endPath(),this},setCatmullRom:function(e,t){t&&(e=e.slice(0),e.unshift(e[e.length-1]),e.push(e[1]),e.push(e[2]));for(var n=1;n<e.length-2;n++){var r=(new CAAT.PathUtil.CurvePath).setColor("#000").setParent(this),i=(new CAAT.Math.CatmullRom).setCurve(e[n-1],e[n],e[n+1],e[n+2]);r.curve=i,this.pathSegments.push(r)}return this},addSegment:function(e){return e.setParent(this),this.pathSegments.push(e),this},addArcTo:function(e,t,n,r,i,s,o){var u=new CAAT.PathUtil.ArcPath;return u.setArcTo(!0),u.setRadius(i),u.setInitialPosition(e,t).setFinalPosition(n,r),u.setParent(this),u.setColor(o),this.pathSegments.push(u),this},addRectangleTo:function(e,t,n,r){var i=new CAAT.PathUtil.RectPath;return i.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(e,t)]),i.setClockWise(n),i.setColor(r),i.setParent(this),this.pathSegments.push(i),this},addQuadricTo:function(e,t,n,r,i){var s=new CAAT.Math.Bezier;s.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(e,t),(new CAAT.Math.Point).set(n,r)]),this.trackPathX=n,this.trackPathY=r;var o=(new CAAT.PathUtil.CurvePath).setColor(i).setParent(this);return o.curve=s,this.pathSegments.push(o),this},addCubicTo:function(e,t,n,r,i,s,o){var u=new CAAT.Math.Bezier;u.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(e,t),(new CAAT.Math.Point).set(n,r),(new CAAT.Math.Point).set(i,s)]),this.trackPathX=i,this.trackPathY=s;var a=(new CAAT.PathUtil.CurvePath).setColor(o).setParent(this);return a.curve=u,this.pathSegments.push(a),this},addCatmullTo:function(e,t,n,r,i,s,o){var u=(new CAAT.Math.CatmullRom).setColor(o);u.setCurve(this.trackPathX,this.trackPathY,e,t,n,r,i,s),this.trackPathX=i,this.trackPathY=s;var a=(new CAAT.PathUtil.CurvePath).setParent(this);return a.curve=u,this.pathSegments.push(a),this},addLineTo:function(e,t,n){var r=(new CAAT.PathUtil.LinearPath).setColor(n);return r.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(e,t)]),r.setParent(this),this.trackPathX=e,this.trackPathY=t,this.pathSegments.push(r),this},beginPath:function(e,t){return this.trackPathX=e,this.trackPathY=t,this.beginPathX=e,this.beginPathY=t,this},closePath:function(){return this.getLastPathSegment().setPoint(this.getFirstPathSegment().startCurvePosition(),this.getLastPathSegment().numControlPoints()-1),this.trackPathX=this.beginPathX,this.trackPathY=this.beginPathY,this.closed=!0,this.endPath(),this},endPath:function(){return this.pathSegmentStartTime=[],this.pathSegmentDurationTime=[],this.updatePath(),this},getPosition:function(e,t){if(t&&(e>=1||e<=0)){var n,r,i,s;e>=1?(n=this.__getPositionImpl(.999),r=this.endCurvePosition(),s=Math.atan2(r.y-n.y,r.x-n.x),i=e%1):(n=this.__getPositionImpl(.001),r=this.startCurvePosition(),s=Math.atan2(r.y-n.y,r.x-n.x),i=-e);var o=this.newPosition,u=this.getLength();return o.x=r.x+i*u*Math.cos(s),o.y=r.y+i*u*Math.sin(s),o}return this.__getPositionImpl(e)},__getPositionImpl:function(e){if(e>1||e<0)e%=1;e<0&&(e=1+e);var t=this.pathSegments,n=this.pathSegmentStartTime,r=this.pathSegmentDurationTime,i=0,s=t.length,o,u=this.newPosition,a;while(i!==s){o=(s+i)/2|0,a=n[o];if(a<=e&&e<=a+r[o]){e=r[o]?(e-a)/r[o]:0,e>1?e=1:e<0&&(e=0);var f=t[o].getPosition(e);return u.x=f.x,u.y=f.y,u}e<a?s=o:i=o+1}return this.endCurvePosition()},getPositionFromLength:function(e){e%=this.getLength(),e<0&&(e+=this.getLength());var t=0;for(var n=0;n<this.pathSegments.length;n++){if(t<=e&&e<=this.pathSegments[n].getLength()+t){e-=t;var r=this.pathSegments[n].getPositionFromLength(e);this.newPosition.x=r.x,this.newPosition.y=r.y;break}t+=this.pathSegments[n].getLength()}return this.newPosition},paint:function(e){for(var t=0;t<this.pathSegments.length;t++)this.pathSegments[t].paint(e,this.interactive)},release:function(){this.ax=-1,this.ay=-1},isEmpty:function(){return!this.pathSegments.length},getNumSegments:function(){return this.pathSegments.length},getSegment:function(e){return this.pathSegments[e]},numControlPoints:function(){return this.points.length},getControlPoint:function(e){return this.points[e]},updatePath:function(e,t){var n,r;this.length=0,this.bbox.setEmpty(),this.points=[];var i=Number.MAX_VALUE,s=Number.MAX_VALUE;for(n=0;n<this.pathSegments.length;n++){this.pathSegments[n].updatePath(e),this.length+=this.pathSegments[n].getLength(),this.bbox.unionRectangle(this.pathSegments[n].bbox);for(r=0;r<this.pathSegments[n].numControlPoints();r++){var o=this.pathSegments[n].getControlPoint(r);this.points.push(o),o.x<i&&(i=o.x),o.y<s&&(s=o.y)}}this.clipOffsetX=-i,this.clipOffsetY=-s,this.width=this.bbox.width,this.height=this.bbox.height,this.setLocation(this.bbox.x,this.bbox.y),this.pathSegmentStartTime=[],this.pathSegmentDurationTime=[];var n;for(n=0;n<this.pathSegments.length;n++)this.pathSegmentStartTime.push(0),this.pathSegmentDurationTime.push(0);for(n=0;n<this.pathSegments.length;n++)this.pathSegmentDurationTime[n]=this.getLength()?this.pathSegments[n].getLength()/this.getLength():0,n>0?this.pathSegmentStartTime[n]=this.pathSegmentStartTime[n-1]+this.pathSegmentDurationTime[n-1]:this.pathSegmentStartTime[0]=0,this.pathSegments[n].endPath();return this.extractPathPoints(),t&&t(this),this},press:function(e,t){if(!this.interactive)return;var n=CAAT.Math.Curve.prototype.HANDLE_SIZE/2;for(var r=0;r<this.pathSegments.length;r++)for(var i=0;i<this.pathSegments[r].numControlPoints();i++){var s=this.pathSegments[r].getControlPoint(i);if(e>=s.x-n&&t>=s.y-n&&e<s.x+n&&t<s.y+n){this.point=s;return}}this.point=null},drag:function(e,t,n){if(!this.interactive)return;if(null===this.point)return;if(-1===this.ax||-1===this.ay)this.ax=e,this.ay=t;this.point.x+=e-this.ax,this.point.y+=t-this.ay,this.ax=e,this.ay=t,this.updatePath(this.point,n)},getContour:function(e){var t=[];for(var n=0;n<=e;n++)t.push((new CAAT.Math.Point).set(n/e,this.getPosition(n/e).y,0));return t},setPoints:function(e){if(this.points.length===e.length)for(var t=0;t<e.length;t++)this.points[t].x=e[t].x,this.points[t].y=e[t].y;return this},setPoint:function(e,t){return t>=0&&t<this.points.length&&(this.points[t].x=e.x,this.points[t].y=e.y),this},emptyBehaviorList:function(){return this.behaviorList=[],this},extractPathPoints:function(){if(!this.pathPoints){var e;this.pathPoints=[];for(e=0;e<this.numControlPoints();e++)this.pathPoints.push(this.getControlPoint(e).clone())}return this},addBehavior:function(e){return this.behaviorList.push(e),this},removeBehaviour:function(e){var t=this.behaviorList.length-1;while(t)if(this.behaviorList[t]===e)return this.behaviorList.splice(t,1),this;return this},removeBehaviorById:function(e){for(var t=0;t<this.behaviorList.length;t++)this.behaviorList[t].id===e&&this.behaviorList.splice(t,1);return this},applyBehaviors:function(e){for(var t=0;t<this.behaviorList.length;t++)this.behaviorList[t].apply(e,this);this.setATMatrix();for(t=0;t<this.numControlPoints();t++)this.setPoint(this.matrix.transformCoord(this.pathPoints[t].clone().translate(this.clipOffsetX,this.clipOffsetY)),t);return this},setATMatrix:function(){this.matrix.identity();var e=this.tmpMatrix.identity(),t=this.matrix.matrix,n,r,i,s,o,u,a,f,l,c,h,p,d=this.bbox,v=d.width,m=d.height,g=d.x,y=d.y;a=1,f=0,c=0,h=1,l=this.tb_x-g-this.tAnchorX*v,p=this.tb_y-y-this.tAnchorY*m;if(this.rb_angle){var b=this.rb_rotateAnchorX*v+g,w=this.rb_rotateAnchorY*m+y;l+=a*b+f*w,p+=c*b+h*w,n=Math.cos(this.rb_angle),r=Math.sin(this.rb_angle),i=a,s=f,o=c,u=h,a=i*n+s*r,f=-i*r+s*n,c=o*n+u*r,h=-o*r+u*n,l+=-a*b-f*w,p+=-c*b-h*w}if(this.sb_scaleX!=1||this.sb_scaleY!=1){var E=this.sb_scaleAnchorX*v+g,S=this.sb_scaleAnchorY*m+y;l+=a*E+f*S,p+=c*E+h*S,a*=this.sb_scaleX,f*=this.sb_scaleY,c*=this.sb_scaleX,h*=this.sb_scaleY,l+=-a*E-f*S,p+=-c*E-h*S}return t[0]=a,t[1]=f,t[2]=l,t[3]=c,t[4]=h,t[5]=p,this},setRotationAnchored:function(e,t,n){return this.rb_angle=e,this.rb_rotateAnchorX=t,this.rb_rotateAnchorY=n,this},setRotationAnchor:function(e,t){this.rb_rotateAnchorX=e,this.rb_rotateAnchorY=t},setRotation:function(e){this.rb_angle=e},setScaleAnchored:function(e,t,n,r){return this.sb_scaleX=e,this.sb_scaleAnchorX=n,this.sb_scaleY=t,this.sb_scaleAnchorY=r,this},setScale:function(e,t){return this.sb_scaleX=e,this.sb_scaleY=t,this},setScaleAnchor:function(e,t){return this.sb_scaleAnchorX=e,this.sb_scaleAnchorY=t,this},setPositionAnchor:function(e,t){return this.tAnchorX=e,this.tAnchorY=t,this},setPositionAnchored:function(e,t,n,r){return this.tb_x=e,this.tb_y=t,this.tAnchorX=n,this.tAnchorY=r,this},setPosition:function(e,t){return this.tb_x=e,this.tb_y=t,this},setLocation:function(e,t){return this.tb_x=e,this.tb_y=t,this},flatten:function(e,t){var n=this.getPositionFromLength(0),r=(new CAAT.PathUtil.Path).beginPath(n.x,n.y);for(var i=0;i<e;i++)n=this.getPositionFromLength(i/e*this.length),r.addLineTo(n.x,n.y);return t?r.closePath():r.endPath(),r}}}),CAAT.Module({defines:"CAAT.PathUtil.SVGPath",depends:["CAAT.PathUtil.Path"],extendsWith:function(){function r(e,t){var n=t;n<0&&(n=0),console.log("parse error near ..."+e.substr(n,20))}var e=0,t=1,n=2;return{__init:function(){},c:0,bezierInfo:null,__skipBlank:function(e,t){var n=e.charAt(t);while(t<e.length&&(n==" "||n=="\n"||n=="	"||n==",")){++t;var n=e.charAt(t)}return t},__maybeNumber:function(e,t){if(t<e.length-2){var n=e.charAt(t),r=e.charAt(t+1);return n=="-"||this.__isDigit(n)||n==="."&&this.__isDigit(r)}return!1},__isDigit:function(e){return e>="0"&&e<="9"},__getNumber:function(r,i,s,o){i=this.__skipBlank(r,i);if(i<r.length){var u=this.__findNumber(r,i);if(u!==-1){s.push(parseFloat(r.substr(i,u))),i=this.__skipBlank(r,u),o.pos=i,o.result=e;return}o.result=n;return}o.result=t},____getNumbers:function(t,n,r,i,s){for(var o=0;o<i;o++){this.__getNumber(t,n,r,s);if(s.result!=e)break;n=s.pos}return n},__findNumber:function(e,t){var n;(n=e.charAt(t))=="-"&&++t;if(!this.__isDigit(n=e.charAt(t)))if((n=e.charAt(t))!="."||!this.__isDigit(e.charAt(t+1)))return-1;while(this.__isDigit(n=e.charAt(t)))++t;if((n=e.charAt(t))=="."){++t;if(!this.__isDigit(n=e.charAt(t)))return t;while(this.__isDigit(n=e.charAt(t)))++t}return t},__parseMoveTo:function(t,n,r,i,s){var o=[];n=this.____getNumbers(t,n,o,2,s);if(s.result!==e)return;r||(o[0]+=i.trackPathX,o[1]+=i.trackPathY),i.beginPath(o[0],o[1]),this.__maybeNumber(t,n)&&(n=this.parseLine(t,n,r,i,s)),s.pos=n},__parseLine:function(e,t,n,r,i){var s=[];do t=this.____getNumbers(e,t,s,2,i),n||(s[0]+=r.trackPathX,s[1]+=r.trackPathY),r.addLineTo(s[0],s[1]);while(this.__maybeNumber(e,t));i.pos=t},__parseLineH:function(e,t,n,r,i){var s=[];do t=this.____getNumbers(e,t,s,1,i),n||(s[0]+=r.trackPathX),s[1].push(r.trackPathY),r.addLineTo(s[0],s[1]);while(this.__maybeNumber(e,t));i.pos=t},__parseLineV:function(e,t,n,r,i){var s=[r.trackPathX];do t=this.____getNumbers(e,t,s,1,i),n||(s[1]+=r.trackPathY),r.addLineTo(s[0],s[1]);while(this.__maybeNumber(e,t));i.pos=t},__parseCubic:function(t,n,r,i,s){var o=[];do{n=this.____getNumbers(t,n,o,6,s);if(s.result!==e)return;r||(o[0]+=i.trackPathX,o[1]+=i.trackPathY,o[2]+=i.trackPathX,o[3]+=i.trackPathY,o[4]+=i.trackPathX,o[5]+=i.trackPathY),i.addCubicTo(o[0],o[1],o[2],o[3],o[4],o[5]),o.shift(),o.shift(),this.bezierInfo=o}while(this.__maybeNumber(t,n));s.pos=n},__parseCubicS:function(t,n,r,i,s){var o=[];do{n=this.____getNumbers(t,n,o,4,s);if(s.result!=e)return;r||(o[0]+=i.trackPathX,o[1]+=i.trackPathY,o[2]+=i.trackPathX,o[3]+=i.trackPathY);var u,a;u=this.bezierInfo[2]+(this.bezierInfo[2]-this.bezierInfo[0]),a=this.bezierInfo[3]+(this.bezierInfo[3]-this.bezierInfo[1]),i.addCubicTo(u,a,o[0],o[1],o[2],o[3]),this.bezierInfo=o}while(this.__maybeNumber(n));s.pos=n},__parseQuadricS:function(t,n,r,i,s){var o=[];do{n=this.____getNumbers(t,n,o,4,s);if(s.result!==e)return;r||(o[0]+=i.trackPathX,o[1]+=i.trackPathY);var u,a;u=this.bezierInfo[2]+(this.bezierInfo[2]-this.bezierInfo[0]),a=this.bezierInfo[3]+(this.bezierInfo[3]-this.bezierInfo[1]),i.addQuadricTo(u,a,o[0],o[1]),this.bezierInfo=[],bezierInfo.push(u),bezierInfo.push(a),bezierInfo.push(o[0]),bezierInfo.push(o[1])}while(this.__maybeNumber(n));s.pos=n},__parseQuadric:function(t,n,r,i,s){var o=[];do{n=this.____getNumbers(t,n,o,4,s);if(s.result!==e)return;r||(o[0]+=i.trackPathX,o[1]+=i.trackPathY,o[2]+=i.trackPathX,o[3]+=i.trackPathY),i.addQuadricTo(o[0],o[1],o[2],o[3]),this.bezierInfo=o}while(this.__maybeNumber(n));s.pos=n},__parseClosePath:function(e,t,n,r){n.closePath(),r.pos=t},parsePath:function(t){this.c=0,this.contours=[];var n=new CAAT.PathUtil.Path;this.contours.push(n),this.c=this.__skipBlank(t,this.c);if(this.c===t.length)return n;var i={pos:0,result:0};while(this.c!=t.length){var s=t.charAt(this.c);switch(s){case"m":this.__parseMoveTo(t,this.c+1,!1,n,i);break;case"M":this.__parseMoveTo(t,this.c+1,!0,n,i);break;case"c":this.__parseCubic(t,this.c+1,!1,n,i);break;case"C":this.__parseCubic(t,this.c+1,!0,n,i);break;case"s":this.__parseCubicS(t,this.c+1,!1,n,i);break;case"S":this.__parseCubicS(t,this.c+1,!0,n,i);break;case"q":this.__parseQuadric(t,this.c+1,!1,n,i);break;case"Q":this.__parseQuadricS(t,this.c+1,!0,n,i);break;case"t":this.__parseQuadricS(t,this.c+1,!1,n,i);break;case"T":this.__parseQuadric(t,this.c+1,!0,n,i);break;case"l":this.__parseLine(t,this.c+1,!1,n,i);break;case"L":this.__parseLine(t,this.c+1,!0,n,i);break;case"h":this.__parseLineH(t,this.c+1,!1,n,i);break;case"H":this.__parseLineH(t,this.c+1,!0,n,i);break;case"v":this.__parseLineV(t,this.c+1,!1,n,i);break;case"V":this.__parseLineV(t,this.c+1,!0,n,i);break;case"z":case"Z":this.__parseClosePath(t,this.c+1,n,i),n=new CAAT.PathUtil.Path,this.contours.push(n);break;case 0:break;default:r(t,this.c)}if(i.result!=e){r(t,this.c);break}this.c=i.pos}var o=0,u=null;for(var a=0;a<this.contours.length;a++)this.contours[a].isEmpty()||(u=this.contours[a],u.closed||u.endPath(),o++);if(o===1)return u;n=new CAAT.PathUtil.Path;for(var a=0;a<this.contours.length;a++)this.contours[a].isEmpty()||n.addSegment(this.contours[a]);return n.endPath()}}}}),CAAT.Module({defines:"CAAT.WebGL.GLU",depends:["CAAT.Math.Matrix3"],constants:{makePerspective:function(e,t,n,r,i){var s=n*Math.tan(e*Math.PI/360),o=-s,u=o*t,a=s*t;return makeFrustum(u,a,o,s,n,r,i)},makeFrustum:function(e,t,n,r,i,s,o){var u=2*i/(t-e),a=2*i/(r-n),f=(t+e)/(t-e),l=(r+n)/(r-n),c=-(s+i)/(s-i),h=-2*s*i/(s-i);return(new CAAT.Math.Matrix3).initWithMatrix([[u,0,f,-o/2],[0,-a,l,o/2],[0,0,c,h],[0,0,-1,0]])},makeOrtho:function(e,t,n,r,i,s){var o=-(t+e)/(t-e),u=-(r+n)/(r-n),a=-(s+i)/(s-i);return(new CAAT.Math.Matrix3).initWithMatrix([[2/(t-e),0,0,o],[0,2/(r-n),0,u],[0,0,-2/(s-i),a],[0,0,0,1]])}}}),CAAT.Module({defines:"CAAT.WebGL.Program",extendsWith:{__init:function(e){return this.gl=e,this},shaderProgram:null,gl:null,setAlpha:function(e){},getShader:function(e,t,n){var r;if(t==="x-shader/x-fragment")r=e.createShader(e.FRAGMENT_SHADER);else{if(t!=="x-shader/x-vertex")return null;r=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(alert(e.getShaderInfoLog(r)),null)},getDomShader:function(e,t){var n=document.getElementById(t);if(!n)return null;var r="",i=n.firstChild;while(i)i.nodeType===3&&(r+=i.textContent),i=i.nextSibling;var s;if(n.type==="x-shader/x-fragment")s=e.createShader(e.FRAGMENT_SHADER);else{if(n.type!=="x-shader/x-vertex")return null;s=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(s,r),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS)?s:(alert(e.getShaderInfoLog(s)),null)},initialize:function(){return this},getFragmentShader:function(){return null},getVertexShader:function(){return null},create:function(){var e=this.gl;return this.shaderProgram=e.createProgram(),e.attachShader(this.shaderProgram,this.getVertexShader()),e.attachShader(this.shaderProgram,this.getFragmentShader()),e.linkProgram(this.shaderProgram),e.useProgram(this.shaderProgram),this},setMatrixUniform:function(e){this.gl.uniformMatrix4fv(this.shaderProgram.pMatrixUniform,!1,new Float32Array(e.flatten()))},useProgram:function(){return this.gl.useProgram(this.shaderProgram),this}}}),CAAT.Module({defines:"CAAT.WebGL.ColorProgram",aliases:["CAAT.ColorProgram"],extendsClass:"CAAT.WebGL.Program",depends:["CAAT.WebGL.Program"],extendsWith:{__init:function(e){return this.__super(e),this},colorBuffer:null,vertexPositionBuffer:null,vertexPositionArray:null,getFragmentShader:function(){return this.getShader(this.gl,"x-shader/x-fragment","#ifdef GL_ES \nprecision highp float; \n#endif \nvarying vec4 color; \nvoid main(void) { \n  gl_FragColor = color;\n}\n")},getVertexShader:function(){return this.getShader(this.gl,"x-shader/x-vertex","attribute vec3 aVertexPosition; \nattribute vec4 aColor; \nuniform mat4 uPMatrix; \nvarying vec4 color; \nvoid main(void) { \ngl_Position = uPMatrix * vec4(aVertexPosition, 1.0); \ncolor= aColor; \n}\n")},initialize:function(){this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition"),this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute),this.shaderProgram.vertexColorAttribute=this.gl.getAttribLocation(this.shaderProgram,"aColor"),this.gl.enableVertexAttribArray(this.shaderProgram.vertexColorAttribute),this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix"),this.useProgram(),this.colorBuffer=this.gl.createBuffer(),this.setColor([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);var e=512,t;return this.vertexPositionBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer),this.vertexPositionArray=new Float32Array(e*12),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexPositionArray,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,!1,0,0),CAAT.ColorProgram.superclass.initialize.call(this)},setColor:function(e){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(e),this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.shaderProgram.vertexColorAttribute,this.colorBuffer,this.gl.FLOAT,!1,0,0)}}}),CAAT.Module({defines:"CAAT.WebGL.TextureProgram",aliases:["CAAT.TextureProgram"],extendsClass:"CAAT.WebGL.Program",depends:["CAAT.WebGL.Program"],extendsWith:{__init:function(e){return this.__super(e),this},vertexPositionBuffer:null,vertexPositionArray:null,vertexUVBuffer:null,vertexUVArray:null,vertexIndexBuffer:null,linesBuffer:null,prevAlpha:-1,prevR:-1,prevG:-1,prevB:-1,prevA:-1,prevTexture:null,getFragmentShader:function(){return this.getShader(this.gl,"x-shader/x-fragment","#ifdef GL_ES \nprecision highp float; \n#endif \nvarying vec2 vTextureCoord; \nuniform sampler2D uSampler; \nuniform float alpha; \nuniform bool uUseColor;\nuniform vec4 uColor;\nvoid main(void) { \nif ( uUseColor ) {\n  gl_FragColor= vec4(uColor.r*alpha, uColor.g*alpha, uColor.b*alpha, uColor.a*alpha);\n} else { \n  vec4 textureColor= texture2D(uSampler, vec2(vTextureCoord)); \n  gl_FragColor = vec4(textureColor.r*alpha, textureColor.g*alpha, textureColor.b*alpha, textureColor.a * alpha ); \n}\n}\n")},getVertexShader:function(){return this.getShader(this.gl,"x-shader/x-vertex","attribute vec3 aVertexPosition; \nattribute vec2 aTextureCoord; \nuniform mat4 uPMatrix; \nvarying vec2 vTextureCoord; \nvoid main(void) { \ngl_Position = uPMatrix * vec4(aVertexPosition, 1.0); \nvTextureCoord = aTextureCoord;\n}\n")},useProgram:function(){CAAT.TextureProgram.superclass.useProgram.call(this),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexUVBuffer),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)},initialize:function(){var e;this.linesBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.linesBuffer);var t=[];for(e=0;e<1024;e++)t[e]=e;this.linesBufferArray=new Uint16Array(t),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.linesBufferArray,this.gl.DYNAMIC_DRAW),this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition"),this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute),this.shaderProgram.textureCoordAttribute=this.gl.getAttribLocation(this.shaderProgram,"aTextureCoord"),this.gl.enableVertexAttribArray(this.shaderProgram.textureCoordAttribute),this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix"),this.shaderProgram.samplerUniform=this.gl.getUniformLocation(this.shaderProgram,"uSampler"),this.shaderProgram.alphaUniform=this.gl.getUniformLocation(this.shaderProgram,"alpha"),this.shaderProgram.useColor=this.gl.getUniformLocation(this.shaderProgram,"uUseColor"),this.shaderProgram.color=this.gl.getUniformLocation(this.shaderProgram,"uColor"),this.setAlpha(1),this.setUseColor(!1);var n=4096;this.vertexPositionBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer),this.vertexPositionArray=new Float32Array(n*12),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexPositionArray,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,!1,0,0),this.vertexUVBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexUVBuffer),this.vertexUVArray=new Float32Array(n*8),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexUVArray,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.shaderProgram.textureCoordAttribute,2,this.gl.FLOAT,!1,0,0),this.vertexIndexBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer);var r=[];for(e=0;e<n;e++)r.push(0+e*4),r.push(1+e*4),r.push(2+e*4),r.push(0+e*4),r.push(2+e*4),r.push(3+e*4);return this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),this.gl.DYNAMIC_DRAW),CAAT.TextureProgram.superclass.initialize.call(this)},setUseColor:function(e,t,n,r,i){this.gl.uniform1i(this.shaderProgram.useColor,e?1:0),e&&(this.prevA!==i||this.prevR!==t||this.prevG!==n||this.prevB!==r)&&(this.gl.uniform4f(this.shaderProgram.color,t,n,r,i),this.prevA=i,this.prevR=t,this.prevG=n,this.prevB=r)},setTexture:function(e){if(this.prevTexture!==e){var t=this.gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.uniform1i(this.shaderProgram.samplerUniform,0),this.prevTexture=e}return this},updateVertexBuffer:function(e){var t=this.gl;return t.bindBuffer(t.ARRAY_BUFFER,this.vertexPositionBuffer),t.bufferSubData(t.ARRAY_BUFFER,0,e),this},updateUVBuffer:function(e){var t=this.gl;return t.bindBuffer(t.ARRAY_BUFFER,this.vertexUVBuffer),t.bufferSubData(t.ARRAY_BUFFER,0,e),this},setAlpha:function(e){return this.prevAlpha!==e&&(this.gl.uniform1f(this.shaderProgram.alphaUniform,e),this.prevAlpha=e),this},drawLines:function(e,t,n,r,i,s,o){var u=this.gl;this.setAlpha(s),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,this.linesBuffer),u.lineWidth(o),this.updateVertexBuffer(e),this.setUseColor(!0,n,r,i,1),u.drawElements(u.LINES,t,u.UNSIGNED_SHORT,0),this.setAlpha(1),this.setUseColor(!1),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)},drawPolylines:function(e,t,n,r,i,s,o){var u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,this.linesBuffer),u.lineWidth(o),this.setAlpha(s),this.updateVertexBuffer(e),this.setUseColor(!0,n,r,i,1),u.drawElements(u.LINE_STRIP,t,u.UNSIGNED_SHORT,0),this.setAlpha(1),this.setUseColor(!1),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)}}}),CAAT.Module({defines:"CAAT.Event.TouchInfo",aliases:["CAAT.TouchInfo"],extendsWith:{__init:function(e,t,n,r){return this.identifier=e,this.clientX=t,this.pageX=t,this.clientY=n,this.pageY=n,this.target=r,this.time=(new Date).getTime(),this}}}),CAAT.Module({defines:"CAAT.Event.TouchEvent",aliases:["CAAT.TouchEvent"],depends:["CAAT.Event.TouchInfo"],extendsWith:{__init:function(){return this.touches=[],this.changedTouches=[],this},time:0,source:null,sourceEvent:null,shift:!1,control:!1,alt:!1,meta:!1,touches:null,changedTouches:null,init:function(e,t,n){return this.source=t,this.alt=e.altKey,this.control=e.ctrlKey,this.shift=e.shiftKey,this.meta=e.metaKey,this.sourceEvent=e,this.time=n,this},addTouch:function(e){return-1===this.touches.indexOf(e)&&this.touches.push(e),this},addChangedTouch:function(e){return-1===this.changedTouches.indexOf(e)&&this.changedTouches.push(e),this},isAltDown:function(){return this.alt},isControlDown:function(){return this.control},isShiftDown:function(){return this.shift},isMetaDown:function(){return this.meta},getSourceEvent:function(){return this.sourceEvent}}}),CAAT.Module({defines:"CAAT.Event.MouseEvent",aliases:["CAAT.MouseEvent"],depends:["CAAT.Math.Point"],extendsWith:{__init:function(){return this.point=new CAAT.Math.Point(0,0,0),this.screenPoint=new CAAT.Math.Point(0,0,0),this.touches=[],this},screenPoint:null,point:null,time:0,source:null,shift:!1,control:!1,alt:!1,meta:!1,sourceEvent:null,touches:null,init:function(e,t,n,r,i,s){return this.point.set(e,t),this.source=r,this.screenPoint=i,this.alt=n.altKey,this.control=n.ctrlKey,this.shift=n.shiftKey,this.meta=n.metaKey,this.sourceEvent=n,this.x=e,this.y=t,this.time=s,this},isAltDown:function(){return this.alt},isControlDown:function(){return this.control},isShiftDown:function(){return this.shift},isMetaDown:function(){return this.meta},getSourceEvent:function(){return this.sourceEvent}}}),CAAT.Module({defines:"CAAT.Event.KeyEvent",aliases:"CAAT.KeyEvent",extendsWith:{__init:function(e,t,n,r){this.keyCode=e,this.action=t,this.modifiers=n,this.sourceEvent=r,this.preventDefault=function(){this.sourceEvent.preventDefault()},this.getKeyCode=function(){return this.keyCode},this.getAction=function(){return this.action},this.modifiers=function(){return this.modifiers},this.isShiftPressed=function(){return this.modifiers.shift},this.isControlPressed=function(){return this.modifiers.control},this.isAltPressed=function(){return this.modifiers.alt},this.getSourceEvent=function(){return this.sourceEvent}}},onCreate:function(){CAAT.KEYS={ENTER:13,BACKSPACE:8,TAB:9,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,SELECT:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMALPOINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145,SEMICOLON:186,EQUALSIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARDSLASH:191,GRAVEACCENT:192,OPENBRACKET:219,BACKSLASH:220,CLOSEBRAKET:221,SINGLEQUOTE:222},CAAT.Keys=CAAT.KEYS,CAAT.SHIFT_KEY=16,CAAT.CONTROL_KEY=17,CAAT.ALT_KEY=18,CAAT.ENTER_KEY=13,CAAT.KEY_MODIFIERS={alt:!1,control:!1,shift:!1}}}),CAAT.Module({defines:"CAAT.Event.Input",depends:["CAAT.Event.KeyEvent","CAAT.Event.MouseEvent","CAAT.Event.TouchEvent"],onCreate:function(){CAAT.setCursor=function(e){navigator.browser!=="iOS"&&(document.body.style.cursor=e)},CAAT.TOUCH_AS_MOUSE=1,CAAT.TOUCH_AS_MULTITOUCH=2,CAAT.TOUCH_BEHAVIOR=CAAT.TOUCH_AS_MOUSE,CAAT.windowResizeListeners=[],CAAT.registerResizeListener=function(e){CAAT.windowResizeListeners.push(e)},CAAT.unregisterResizeListener=function(e){for(var t=0;t<CAAT.windowResizeListeners.length;t++)if(e===CAAT.windowResizeListeners[t]){CAAT.windowResizeListeners.splice(t,1);return}},CAAT.keyListeners=[],CAAT.registerKeyListener=function(e){CAAT.keyListeners.push(e)},CAAT.accelerationIncludingGravity={x:0,y:0,z:0},CAAT.rotationRate={alpha:0,beta:0,gamma:0},CAAT.enableDeviceMotion=function(){function e(e){CAAT.rotationRate={alpha:0,beta:e[0],gamma:e[1]}}CAAT.prevOnDeviceMotion=null,CAAT.onDeviceMotion=null,window.DeviceOrientationEvent?window.addEventListener("deviceorientation",function(t){e([t.beta,t.gamma])},!0):window.DeviceMotionEvent?window.addEventListener("devicemotion",function(t){e([t.acceleration.x*2,t.acceleration.y*2])},!0):window.addEventListener("MozOrientation",function(t){e([-t.y*45,t.x*45])},!0)},window.addEventListener("keydown",function(e){var t=e.which?e.which:e.keyCode;if(t===CAAT.SHIFT_KEY)CAAT.KEY_MODIFIERS.shift=!0;else if(t===CAAT.CONTROL_KEY)CAAT.KEY_MODIFIERS.control=!0;else if(t===CAAT.ALT_KEY)CAAT.KEY_MODIFIERS.alt=!0;else for(var n=0;n<CAAT.keyListeners.length;n++)CAAT.keyListeners[n](new CAAT.KeyEvent(t,"down",{alt:CAAT.KEY_MODIFIERS.alt,control:CAAT.KEY_MODIFIERS.control,shift:CAAT.KEY_MODIFIERS.shift},e))},!1),window.addEventListener("keyup",function(e){var t=e.which?e.which:e.keyCode;if(t===CAAT.SHIFT_KEY)CAAT.KEY_MODIFIERS.shift=!1;else if(t===CAAT.CONTROL_KEY)CAAT.KEY_MODIFIERS.control=!1;else if(t===CAAT.ALT_KEY)CAAT.KEY_MODIFIERS.alt=!1;else for(var n=0;n<CAAT.keyListeners.length;n++)CAAT.keyListeners[n](new CAAT.KeyEvent(t,"up",{alt:CAAT.KEY_MODIFIERS.alt,control:CAAT.KEY_MODIFIERS.control,shift:CAAT.KEY_MODIFIERS.shift},e))},!1),window.addEventListener("resize",function(e){for(var t=0;t<CAAT.windowResizeListeners.length;t++)CAAT.windowResizeListeners[t].windowResized(window.innerWidth,window.innerHeight)},!1)},extendsWith:{}}),CAAT.Module({defines:"CAAT.Event.AnimationLoop",onCreate:function(){CAAT.ENDRAF=!1,CAAT.INTERVAL_ID=null,CAAT.renderEnabled=!1,CAAT.FPS=60,CAAT.NO_RAF=0,CAAT.FPS_REFRESH=500,CAAT.RAF=0,CAAT.REQUEST_ANIMATION_FRAME_TIME=0,CAAT.SET_INTERVAL=0,CAAT.FRAME_TIME=0,CAAT.currentDirector=null,CAAT.director=[],CAAT.RegisterDirector=function(e){CAAT.currentDirector||(CAAT.currentDirector=e),CAAT.director.push(e)},CAAT.getCurrentScene=function(){return CAAT.currentDirector.getCurrentScene()},CAAT.getCurrentSceneTime=function(){return CAAT.currentDirector.getCurrentScene().time},CAAT.endLoop=function(){CAAT.NO_RAF?CAAT.INTERVAL_ID!==null&&clearInterval(CAAT.INTERVAL_ID):CAAT.ENDRAF=!0,CAAT.renderEnabled=!1},CAAT.loop=function(e){if(CAAT.renderEnabled)return;for(var t=0,n=CAAT.director.length;t<n;t++)CAAT.director[t].timeline=(new Date).getTime();CAAT.FPS=e||60,CAAT.renderEnabled=!0,CAAT.NO_RAF?CAAT.INTERVAL_ID=setInterval(function(){var e=(new Date).getTime();for(var t=0,n=CAAT.director.length;t<n;t++){var r=CAAT.director[t];(r.renderMode===CAAT.Foundation.Director.RENDER_MODE_CONTINUOUS||r.needsRepaint)&&r.renderFrame()}CAAT.FRAME_TIME=e-CAAT.SET_INTERVAL,CAAT.RAF&&(CAAT.REQUEST_ANIMATION_FRAME_TIME=(new Date).getTime()-CAAT.RAF),CAAT.RAF=(new Date).getTime(),CAAT.SET_INTERVAL=e},1e3/CAAT.FPS):CAAT.renderFrameRAF()},CAAT.renderFrameRAF=function(e){var t=CAAT;if(t.ENDRAF){t.ENDRAF=!1;return}e||(e=(new Date).getTime());var n=(new Date).getTime();t.REQUEST_ANIMATION_FRAME_TIME=t.RAF?e-t.RAF:16;for(var r=0,i=t.director.length;r<i;r++)t.director[r].renderFrame();t.RAF=e,t.FRAME_TIME=(new Date).getTime()-n,window.requestAnimFrame(t.renderFrameRAF,0)},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,n){window.setTimeout(t,1e3/CAAT.FPS)}}()},extendsWith:function(){return{}}}),CAAT.Module({defines:"CAAT.Foundation.Timer.TimerTask",aliases:["CAAT.TimerTask"],extendsWith:{startTime:0,duration:0,callback_timeout:null,callback_tick:null,callback_cancel:null,owner:null,scene:null,taskId:0,remove:!1,create:function(e,t,n,r,i){return this.startTime=e,this.duration=t,this.callback_timeout=n,this.callback_tick=r,this.callback_cancel=i,this},checkTask:function(e){var t=e;return t-=this.startTime,t>=this.duration?(this.remove=!0,this.callback_timeout&&this.callback_timeout(e,t,this)):this.callback_tick&&this.callback_tick(e,t,this),this},remainingTime:function(){return this.duration-(this.scene.time-this.startTime)},reset:function(e){return this.remove=!1,this.startTime=e,this.owner.ensureTimerTask(this),this},cancel:function(){return this.remove=!0,null!=this.callback_cancel&&this.callback_cancel(this.scene.time,this.scene.time-this.startTime,this),this},addTime:function(e){return this.duration+=e,this}}}),CAAT.Module({defines:"CAAT.Foundation.Timer.TimerManager",aliases:["CAAT.TimerManager"],depends:["CAAT.Foundation.Timer.TimerTask"],extendsWith:{__init:function(){return this.timerList=[],this},timerList:null,timerSequence:0,checkTimers:function(e){var t=this.timerList,n=t.length-1;while(n>=0)t[n].remove||t[n].checkTask(e),n--},ensureTimerTask:function(e){return this.hasTimer(e)||this.timerList.push(e),this},hasTimer:function(e){var t=this.timerList,n=t.length-1;while(n>=0){if(t[n]===e)return!0;n--}return!1},createTimer:function(e,t,n,r,i,s){var o=(new CAAT.Foundation.Timer.TimerTask).create(e,t,n,r,i);return o.taskId=this.timerSequence++,o.sceneTime=s.time,o.owner=this,o.scene=s,this.timerList.push(o),o},removeExpiredTimers:function(){var e,t=this.timerList;for(e=0;e<t.length;e++)t[e].remove&&t.splice(e,1)}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Layout.LayoutManager",aliases:["CAAT.UI.LayoutManager"],depends:["CAAT.Behavior.Interpolator"],constants:{AXIS:{X:0,Y:1},ALIGNMENT:{LEFT:0,RIGHT:1,CENTER:2,TOP:3,BOTTOM:4,JUSTIFY:5}},extendsWith:function(){return{__init:function(){return this.newChildren=[],this.padding={left:2,right:2,top:2,bottom:2},this},newElementInterpolator:(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,.7),moveElementInterpolator:(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(2),padding:null,invalid:!0,hgap:2,vgap:2,animated:!1,newChildren:null,setAnimated:function(e){return this.animated=e,this},setHGap:function(e){return this.hgap=e,this.invalidateLayout(),this},setVGap:function(e){return this.vgap=e,this.invalidateLayout(),this},setAllPadding:function(e){return this.padding.left=e,this.padding.right=e,this.padding.top=e,this.padding.bottom=e,this.invalidateLayout(),this},setPadding:function(e,t,n,r){return this.padding.left=e,this.padding.right=t,this.padding.top=n,this.padding.bottom=r,this.invalidateLayout(),this},addChild:function(e,t){this.newChildren.push(e)},removeChild:function(e){},doLayout:function(e){this.newChildren=[],this.invalid=!1},invalidateLayout:function(e){this.invalid=!0},getMinimumLayoutSize:function(e){},getPreferredLayoutSize:function(e){},isValid:function(){return!this.invalid},isInvalidated:function(){return this.invalid}}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Layout.BoxLayout",aliases:["CAAT.UI.BoxLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:function(){return{axis:CAAT.Foundation.UI.Layout.LayoutManager.AXIS.Y,valign:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER,halign:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER,setAxis:function(e){return this.axis=e,this.invalidateLayout(),this},setHorizontalAlignment:function(e){return this.halign=e,this.invalidateLayout(),this},setVerticalAlignment:function(e){return this.valign=e,this.invalidateLayout(),this},doLayout:function(e){this.axis===CAAT.Foundation.UI.Layout.LayoutManager.AXIS.Y?this.doLayoutVertical(e):this.doLayoutHorizontal(e),CAAT.Foundation.UI.Layout.BoxLayout.superclass.doLayout.call(this,e)},doLayoutHorizontal:function(e){var t=0,n=0,r=0,i,s,o,u;for(s=0,o=e.getNumChildren();s<o;s+=1)u=e.getChildAt(s),!u.preventLayout&&u.isVisible()&&u.isInAnimationFrame(CAAT.getCurrentSceneTime())&&(n<u.height&&(n=u.height),t+=u.width,s>0&&(t+=this.hgap));switch(this.halign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT:i=this.padding.left;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT:i=e.width-t-this.padding.right;break;default:i=(e.width-t)/2}for(s=0,o=e.getNumChildren();s<o;s+=1){u=e.getChildAt(s);if(!u.preventLayout&&u.isVisible()&&u.isInAnimationFrame(CAAT.getCurrentSceneTime())){switch(this.valign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP:r=this.padding.top;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM:r=e.height-this.padding.bottom-u.height;break;default:r=(e.height-u.height)/2}this.__setActorPosition(u,i,r),i+=u.width+this.hgap}}},__setActorPosition:function(e,t,n){this.animated?this.newChildren.indexOf(e)!==-1?(e.setPosition(t,n),e.setScale(0,0),e.scaleTo(1,1,500,0,.5,.5,this.newElementInterpolator)):e.moveTo(t,n,500,0,this.moveElementInterpolator):e.setPosition(t,n)},doLayoutVertical:function(e){var t=0,n=0,r,i,s,o,u;for(s=0,o=e.getNumChildren();s<o;s+=1)u=e.getChildAt(s),!u.preventLayout&&u.isVisible()&&u.isInAnimationFrame(CAAT.getCurrentSceneTime())&&(t<u.width&&(t=u.width),n+=u.height,s>0&&(n+=this.vgap));switch(this.valign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP:r=this.padding.top;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM:r=e.height-n-this.padding.bottom;break;default:r=(e.height-n)/2}for(s=0,o=e.getNumChildren();s<o;s+=1){u=e.getChildAt(s);if(!u.preventLayout&&u.isVisible()&&u.isInAnimationFrame(CAAT.getCurrentSceneTime())){switch(this.halign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT:i=this.padding.left;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT:i=e.width-this.padding.right-u.width;break;default:i=(e.width-u.width)/2}this.__setActorPosition(u,i,r),r+=u.height+this.vgap}}},getPreferredLayoutSize:function(e){var t=new CAAT.Math.Dimension,n=0,r=0,i,s;for(i=0,s=e.getNumChildren();i<s;i+=1){var o=e.getChildAt(i);if(!o.preventLayout&&o.isVisible()&&o.isInAnimationFrame(CAAT.getCurrentSceneTime())){var u=o.getPreferredSize();r<u.height&&(r=u.height),n+=u.width}}return t.width=n,t.height=r,t},getMinimumLayoutSize:function(e){var t=new CAAT.Math.Dimension,n=0,r=0,i,s;for(i=0,s=e.getNumChildren();i<s;i+=1){var o=e.getChildAt(i);if(!o.preventLayout&&o.isVisible()&&o.isInAnimationFrame(CAAT.getCurrentSceneTime())){var u=o.getMinimumSize();r<u.height&&(r=u.height),n+=u.width}}return t.width=n,t.height=r,t}}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Layout.BorderLayout",aliases:["CAAT.UI.BorderLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:{__init:function(){return this.__super(),this},left:null,right:null,top:null,bottom:null,center:null,addChild:function(e,t){typeof t=="undefined"&&(t="center"),CAAT.Foundation.UI.Layout.BorderLayout.superclass.addChild.call(this,e,t),t==="left"?this.left=e:t==="right"?this.right=e:t==="top"?this.top=e:t==="bottom"?this.bottom=e:this.center=e},removeChild:function(e){this.center===e?this.center=null:this.left===e?this.left=null:this.right===e?this.right=null:this.top===e?this.top=null:this.bottom===e&&(this.bottom=null)},__getChild:function(e){if(e==="center")return this.center;if(e==="left")return this.left;if(e==="right")return this.right;if(e==="top")return this.top;if(e==="bottom")return this.bottom},getMinimumLayoutSize:function(e){var t,n,r=new CAAT.Math.Dimension;return(t=this.__getChild("right"))!=null&&(n=t.getMinimumSize(),r.width+=n.width+this.hgap,r.height=Math.max(n.height,r.height)),(t=this.__getChild("left"))!=null&&(n=t.getMinimumSize(),r.width+=n.width+this.hgap,r.height=Math.max(n.height,r.height)),(t=this.__getChild("center"))!=null&&(n=t.getMinimumSize(),r.width+=n.width,r.height=Math.max(n.height,r.height)),(t=this.__getChild("top"))!=null&&(n=t.getMinimumSize(),r.width=Math.max(n.width,r.width),r.height+=n.height+this.vgap),(t=this.__getChild("bottom"))!=null&&(n=t.getMinimumSize(),r.width=Math.max(n.width,r.width),r.height+=n.height+this.vgap),r.width+=this.padding.left+this.padding.right,r.height+=this.padding.top+this.padding.bottom,r},getPreferredLayoutSize:function(e){var t,n,r=new CAAT.Dimension;return(t=this.__getChild("left"))!=null&&(n=t.getPreferredSize(),r.width+=n.width+this.hgap,r.height=Math.max(n.height,r.height)),(t=this.__getChild("right"))!=null&&(n=t.getPreferredSize(),r.width+=n.width+this.hgap,r.height=Math.max(n.height,r.height)),(t=this.__getChild("center"))!=null&&(n=t.getPreferredSize(),r.width+=n.width,r.height=Math.max(n.height,r.height)),(t=this.__getChild("top"))!=null&&(n=t.getPreferredSize(),r.width=Math.max(n.width,r.width),r.height+=n.height+this.vgap),(t=this.__getChild("bottom"))!=null&&(n=t.getPreferredSize(),r.width=Math.max(n.width,r.width),r.height+=n.height+this.vgap),r.width+=this.padding.left+this.padding.right,r.height+=this.padding.top+this.padding.bottom,r},doLayout:function(e){var t=this.padding.top,n=e.height-this.padding.bottom,r=this.padding.left,i=e.width-this.padding.right,s,o;(s=this.__getChild("top"))!=null&&(s.setSize(i-r,s.height),o=s.getPreferredSize(),s.setBounds(r,t,i-r,o.height),t+=o.height+this.vgap),(s=this.__getChild("bottom"))!=null&&(s.setSize(i-r,s.height),o=s.getPreferredSize(),s.setBounds(r,n-o.height,i-r,o.height),n-=o.height+this.vgap),(s=this.__getChild("right"))!=null&&(s.setSize(s.width,n-t),o=s.getPreferredSize(),s.setBounds(i-o.width,t,o.width,n-t),i-=o.width+this.hgap),(s=this.__getChild("left"))!=null&&(s.setSize(s.width,n-t),o=s.getPreferredSize(),s.setBounds(r,t,o.width,n-t),r+=o.width+this.hgap),(s=this.__getChild("center"))!=null&&s.setBounds(r,t,i-r,n-t),CAAT.Foundation.UI.Layout.BorderLayout.superclass.doLayout.call(this,e)}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Layout.GridLayout",aliases:["CAAT.UI.GridLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:{__init:function(e,t){return this.__super(),this.rows=e,this.columns=t,this},rows:0,columns:2,doLayout:function(e){var t=[];for(var n=0;n<e.getNumChildren();n++){var r=e.getChildAt(n);!r.preventLayout&&r.isVisible()&&r.isInAnimationFrame(CAAT.getCurrentSceneTime())&&t.push(r)}var i=t.length;if(i.length===0)return;var s=this.rows,o=this.columns;s>0?o=Math.floor((i+s-1)/s):s=Math.floor((i+o-1)/o);var u=(o-1)*this.hgap,a=e.width-(this.padding.left+this.padding.right),f=Math.floor((a-u)/o),l=Math.floor((a-(f*o+u))/2),c=(s-1)*this.vgap,h=e.height-(this.padding.top+this.padding.bottom),p=Math.floor((h-c)/s),d=Math.floor((h-(p*s+c))/2);for(var v=0,m=this.padding.left+l;v<o;v++,m+=f+this.hgap)for(var g=0,y=this.padding.top+d;g<s;g++,y+=p+this.vgap){var n=g*o+v;if(n<t.length){var r=t[n];if(!r.preventLayout&&r.isVisible()&&r.isInAnimationFrame(CAAT.getCurrentSceneTime()))if(!this.animated)r.setBounds(m+(f-r.width)/2,y,f,p);else if(r.width!==f||r.height!==p)r.setSize(f,p),this.newChildren.indexOf(r)!==-1?(r.setPosition(m+(f-r.width)/2,y),r.setScale(.01,.01),r.scaleTo(1,1,500,0,.5,.5,this.newElementInterpolator)):r.moveTo(m+(f-r.width)/2,y,500,0,this.moveElementInterpolator)}}CAAT.Foundation.UI.Layout.GridLayout.superclass.doLayout.call(this,e)},getMinimumLayoutSize:function(e){var t=this.rows,n=this.columns,r=e.getNumChildren(),i=0,s=0,o;t>0?n=Math.ceil((r+t-1)/t):t=Math.ceil((r+n-1)/n);for(o=0;o<r;o+=1){var u=e.getChildAt(o);if(!u.preventLayout&&u.isVisible()&&u.isInAnimationFrame(CAAT.getCurrentSceneTime())){var a=u.getMinimumSize();i<a.width&&(i=a.width),s<a.height&&(s=a.height)}}return new CAAT.Math.Dimension(this.padding.left+this.padding.right+n*i+(n-1)*this.hgap,this.padding.top+this.padding.bottom+t*s+(t-1)*this.vgap)},getPreferredLayoutSize:function(e){var t=this.rows,n=this.columns,r=e.getNumChildren(),i=0,s=0,o;t>0?n=Math.ceil((r+t-1)/t):t=Math.ceil((r+n-1)/n);for(o=0;o<r;o+=1){var u=e.getChildAt(o);if(!u.preventLayout&&u.isVisible()&&u.isInAnimationFrame(CAAT.getCurrentSceneTime())){var a=u.getPreferredSize();i<a.width&&(i=a.width),s<a.height&&(s=a.height)}}return new CAAT.Math.Dimension(this.padding.left+this.padding.right+n*i+(n-1)*this.hgap,this.padding.top+this.padding.bottom+t*s+(t-1)*this.vgap)}}}),CAAT.Module({defines:"CAAT.Foundation.SpriteImageHelper",extendsWith:{__init:function(e,t,n,r,i,s){return this.x=parseFloat(e),this.y=parseFloat(t),this.width=parseFloat(n),this.height=parseFloat(r),this.setGL(e/i,t/s,(e+n-1)/i,(t+r-1)/s),this},x:0,y:0,width:0,height:0,u:0,v:0,u1:0,v1:0,setGL:function(e,t,n,r){return this.u=e,this.v=t,this.u1=n,this.v1=r,this}}}),CAAT.Module({defines:"CAAT.Foundation.SpriteImageAnimationHelper",extendsWith:function(){return{__init:function(e,t,n){return this.animation=e,this.time=t,this.onEndPlayCallback=n,this},animation:null,time:0,onEndPlayCallback:null}}}),CAAT.Module({defines:"CAAT.Foundation.SpriteImage",aliases:["CAAT.SpriteImage"],depends:["CAAT.Foundation.SpriteImageHelper","CAAT.Foundation.SpriteImageAnimationHelper","CAAT.Math.Rectangle"],constants:{TR_NONE:0,TR_FLIP_HORIZONTAL:1,TR_FLIP_VERTICAL:2,TR_FLIP_ALL:3,TR_FIXED_TO_SIZE:4,TR_FIXED_WIDTH_TO_SIZE:6,TR_TILE:5},extendsWith:function(){return{__init:function(){return this.paint=this.paintN,this.setAnimationImageIndex([0]),this.mapInfo={},this.animationsMap={},arguments.length===3&&this.initialize.apply(this,arguments),this},animationImageIndex:null,prevAnimationTime:-1,changeFPS:1e3,transformation:0,spriteIndex:0,prevIndex:0,currentAnimation:null,image:null,rows:1,columns:1,width:0,height:0,singleWidth:0,singleHeight:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0,parentOffsetX:0,parentOffsetY:0,ownerActor:null,mapInfo:null,map:null,animationsMap:null,callback:null,fontScale:1,getOwnerActor:function(){return this.ownerActor},addAnimation:function(e,t,n,r){return this.animationsMap[e]=new CAAT.Foundation.SpriteImageAnimationHelper(t,n,r),this},setAnimationEndCallback:function(e){this.callback=e},playAnimation:function(e){if(e===this.currentAnimation)return this;var t=this.animationsMap[e];return t?(this.currentAnimation=e,this.setAnimationImageIndex(t.animation),this.changeFPS=t.time,this.callback=t.onEndPlayCallback,this):this},setOwner:function(e){return this.ownerActor=e,this},getRows:function(){return this.rows},getColumns:function(){return this.columns},getWidth:function(){var e=this.mapInfo[this.spriteIndex];return e.width},getHeight:function(){var e=this.mapInfo[this.spriteIndex];return e.height},getWrappedImageWidth:function(){return this.image.width},getWrappedImageHeight:function(){return this.image.height},getRef:function(){var e=new CAAT.Foundation.SpriteImage;return e.image=this.image,e.rows=this.rows,e.columns=this.columns,e.width=this.width,e.height=this.height,e.singleWidth=this.singleWidth,e.singleHeight=this.singleHeight,e.mapInfo=this.mapInfo,e.offsetX=this.offsetX,e.offsetY=this.offsetY,e.scaleX=this.scaleX,e.scaleY=this.scaleY,e.animationsMap=this.animationsMap,e.parentOffsetX=this.parentOffsetX,e.parentOffsetY=this.parentOffsetY,e.scaleFont=this.scaleFont,e},setOffsetX:function(e){return this.offsetX=e,this},setOffsetY:function(e){return this.offsetY=e,this},setOffset:function(e,t){return this.offsetX=e,this.offsetY=t,this},initialize:function(e,t,n){e||console.log("Null image for SpriteImage."),isString(e)&&(e=CAAT.currentDirector.getImage(e)),this.parentOffsetX=0,this.parentOffsetY=0,this.rows=t,this.columns=n;if(e instanceof CAAT.Foundation.SpriteImage||e instanceof CAAT.SpriteImage){this.image=e.image;var r=e.mapInfo[0];this.width=r.width,this.height=r.height,this.parentOffsetX=r.x,this.parentOffsetY=r.y,this.width=e.mapInfo[0].width,this.height=e.mapInfo[0].height}else this.image=e,this.width=e.width,this.height=e.height,this.mapInfo={};this.singleWidth=Math.floor(this.width/n),this.singleHeight=Math.floor(this.height/t);var i,s,o,u;if(e.__texturePage){e.__du=this.singleWidth/e.__texturePage.width,e.__dv=this.singleHeight/e.__texturePage.height;var a=this.singleWidth,f=this.singleHeight,l=this.columns;if(e.inverted){var c=a;a=f,f=c,l=this.rows}var h=this.image.__tx,p=this.image.__ty,d=this.image.__texturePage;for(i=0;i<t*n;i++){var v=i%l>>0,m=i/l>>0,g=h+v*a,y=p+m*f,b=g+a,w=y+f;u=(new CAAT.Foundation.SpriteImageHelper(g,y,b-g,w-y,d.width,d.height)).setGL(g/d.width,y/d.height,b/d.width,w/d.height),this.mapInfo[i]=u}}else for(i=0;i<t*n;i++)s=(i%this.columns|0)*this.singleWidth+this.parentOffsetX,o=(i/this.columns|0)*this.singleHeight+this.parentOffsetY,u=new CAAT.Foundation.SpriteImageHelper(s,o,this.singleWidth,this.singleHeight,e.width,e.height),this.mapInfo[i]=u;return this},copy:function(e){return this.initialize(e,1,1),this.mapInfo=e.mapInfo,this},paintTiled:function(e,t,n,r){var i=this.mapInfo[this.spriteIndex],s=new CAAT.Math.Rectangle;this.ownerActor.AABB.intersect(e.AABB,s);var o=this.getWidth(),u=this.getHeight(),a=(this.offsetX-this.ownerActor.x)%o;a>0&&(a-=o);var f=(this.offsetY-this.ownerActor.y)%u;f>0&&(f-=u);var l=((s.width-a)/o>>0)+1,c=((s.height-f)/u>>0)+1,h,p,d=e.ctx;for(h=0;h<c;h++)for(p=0;p<l;p++)d.drawImage(this.image,i.x,i.y,i.width,i.height,s.x-this.ownerActor.x+a+p*i.width>>0,s.y-this.ownerActor.y+f+h*i.height>>0,i.width,i.height)},paintInvertedH:function(e,t,n,r){var i=this.mapInfo[this.spriteIndex],s=e.ctx;return s.save(),s.translate((n|0)+i.width,r|0),s.scale(-1,1),s.drawImage(this.image,i.x,i.y,i.width,i.height,this.offsetX>>0,this.offsetY>>0,i.width,i.height),s.restore(),this},paintInvertedV:function(e,t,n,r){var i=this.mapInfo[this.spriteIndex],s=e.ctx;return s.save(),s.translate(n|0,r+i.height|0),s.scale(1,-1),s.drawImage(this.image,i.x,i.y,i.width,i.height,this.offsetX>>0,this.offsetY>>0,i.width,i.height),s.restore(),this},paintInvertedHV:function(e,t,n,r){var i=this.mapInfo[this.spriteIndex],s=e.ctx;return s.save(),s.translate(n|0,r+i.height|0),s.scale(1,-1),s.translate(i.width,0),s.scale(-1,1),s.drawImage(this.image,i.x,i.y,i.width,i.height,this.offsetX>>0,this.offsetY>>0,i.width,i.height),s.restore(),this},paintN:function(e,t,n,r){var i=this.mapInfo[this.spriteIndex];return e.ctx.drawImage(this.image,i.x,i.y,i.width,i.height,this.offsetX+n>>0,this.offsetY+r>>0,i.width,i.height),this},paintAtRect:function(e,t,n,r,i,s){var o=this.mapInfo[this.spriteIndex];return e.ctx.drawImage(this.image,o.x,o.y,o.width,o.height,this.offsetX+n>>0,this.offsetY+r>>0,i,s),this},paintScaledWidth:function(e,t,n,r){var i=this.mapInfo[this.spriteIndex];return e.ctx.drawImage(this.image,i.x,i.y,i.width,i.height,this.offsetX+n>>0,this.offsetY+r>>0,this.ownerActor.width,i.height),this},paintChunk:function(e,t,n,r,i,s,o){e.drawImage(this.image,r,i,s,o,t,n,s,o)},paintTile:function(e,t,n,r){var i=this.mapInfo[t];return e.drawImage(this.image,i.x,i.y,i.width,i.height,this.offsetX+n>>0,this.offsetY+r>>0,i.width,i.height),this},paintScaled:function(e,t,n,r){var i=this.mapInfo[this.spriteIndex];return e.ctx.drawImage(this.image,i.x,i.y,i.width,i.height,this.offsetX+n>>0,this.offsetY+r>>0,this.ownerActor.width,this.ownerActor.height),this},getCurrentSpriteImageCSSPosition:function(){var e=this.mapInfo[this.spriteIndex],t=-(e.x+this.parentOffsetX-this.offsetX),n=-(e.y+this.parentOffsetY-this.offsetY);return""+t+"px "+n+"px "+(this.ownerActor.transformation===CAAT.Foundation.SpriteImage.TR_TILE?"repeat":"no-repeat")},getNumImages:function(){return this.rows*this.columns},setUV:function(e,t){var n=this.image;if(!n.__texturePage)return;var r=t,i=this.spriteIndex,s=this.mapInfo[this.spriteIndex],o=s.u,u=s.v,a=s.u1,f=s.v1;if(this.offsetX||this.offsetY){var l=this.ownerActor.width,c=this.ownerActor.height,h=n.__texturePage,p=-this.offsetX/h.width,d=-this.offsetY/h.height,v=(l-this.offsetX)/h.width,m=(c-this.offsetY)/h.height;o=p+n.__u,u=d+n.__v,a=v+n.__u,f=m+n.__v}n.inverted?(e[r++]=a,e[r++]=u,e[r++]=a,e[r++]=f,e[r++]=o,e[r++]=f,e[r++]=o,e[r++]=u):(e[r++]=o,e[r++]=u,e[r++]=a,e[r++]=u,e[r++]=a,e[r++]=f,e[r++]=o,e[r++]=f)},setChangeFPS:function(e){return this.changeFPS=e,this},setSpriteTransformation:function(e){this.transformation=e;var t=CAAT.Foundation.SpriteImage;switch(e){case t.TR_FLIP_HORIZONTAL:this.paint=this.paintInvertedH;break;case t.TR_FLIP_VERTICAL:this.paint=this.paintInvertedV;break;case t.TR_FLIP_ALL:this.paint=this.paintInvertedHV;break;case t.TR_FIXED_TO_SIZE:this.paint=this.paintScaled;break;case t.TR_FIXED_WIDTH_TO_SIZE:this.paint=this.paintScaledWidth;break;case t.TR_TILE:this.paint=this.paintTiled;break;default:this.paint=this.paintN}return this.ownerActor.invalidate(),this},resetAnimationTime:function(){return this.prevAnimationTime=-1,this},setAnimationImageIndex:function(e){return this.animationImageIndex=e,this.spriteIndex=e[0],this.prevAnimationTime=-1,this},setSpriteIndex:function(e){return this.spriteIndex=e,this},setSpriteIndexAtTime:function(e){if(this.animationImageIndex.length>1)if(this.prevAnimationTime===-1)this.prevAnimationTime=e,this.spriteIndex=this.animationImageIndex[0],this.prevIndex=0,this.ownerActor.invalidate();else{var t=e;t-=this.prevAnimationTime,t/=this.changeFPS,t%=this.animationImageIndex.length;var n=Math.floor(t);n<this.prevIndex&&this.callback&&this.callback(this,e),this.prevIndex=n,this.spriteIndex=this.animationImageIndex[n],this.ownerActor.invalidate()}},getMapInfo:function(e){return this.mapInfo[e]},initializeFromMap:function(e,t){this.initialize(e,1,1);var n,r,i=0;for(n in t){var s=t[n];r=new CAAT.Foundation.SpriteImageHelper(parseFloat(s.x)+this.parentOffsetX,parseFloat(s.y)+this.parentOffsetY,parseFloat(s.width),parseFloat(s.height),e.width,e.height),this.mapInfo[n]=r,i||this.setAnimationImageIndex([n]),i++}return this},addElement:function(e,t){var n=new CAAT.Foundation.SpriteImageHelper(parseFloat(t.x)+this.parentOffsetX,parseFloat(t.y)+this.parentOffsetY,parseFloat(t.width),parseFloat(t.height),this.image.width,this.image.height);return n.xoffset=typeof t.xoffset=="undefined"?0:parseFloat(t.xoffset),n.yoffset=typeof t.yoffset=="undefined"?0:parseFloat(t.yoffset),n.xadvance=typeof t.xadvance=="undefined"?t.width:parseFloat(t.xadvance),this.mapInfo[e]=n,this},initializeAsGlyphDesigner:function(e,t){this.initialize(e,1,1);var n,r,i=0;for(n in t){var s=t[n];r=new CAAT.Foundation.SpriteImageHelper(parseFloat(s.x)+this.parentOffsetX,parseFloat(s.y)+this.parentOffsetX,parseFloat(s.width),parseFloat(s.height),e.width,e.height),r.xoffset=typeof s.xoffset=="undefined"?0:s.xoffset,r.yoffset=typeof s.yoffset=="undefined"?0:s.yoffset,r.xadvance=typeof s.xadvance=="undefined"?s.width:s.xadvance,this.mapInfo[n]=r,i||this.setAnimationImageIndex([n]),i++}return this},initializeAsFontMap:function(e,t){this.initialize(e,1,1);var n,r=0;for(var i=0;i<t.length;i++){var s=t[i];n=new CAAT.Foundation.SpriteImageHelper(parseFloat(r)+this.parentOffsetX,0+this.parentOffsetY,parseFloat(s.width),e.height,e.width,e.height),n.xoffset=0,n.yoffset=0,n.xadvance=s.width,r+=s.width,this.mapInfo[t[i].c]=n,i||this.setAnimationImageIndex([t[i].c])}return this},initializeAsMonoTypeFontMap:function(e,t){var n=[],r=t.split(""),i=e.width/r.length>>0;for(var s=0;s<r.length;s++)n.push({c:r[s],width:i});return this.initializeAsFontMap(e,n)},stringWidth:function(e){var t,n,r=0,i;for(t=0,n=e.length;t<n;t++)i=this.mapInfo[e.charAt(t)],i&&(r+=i.xadvance*this.fontScale);return r},stringHeight:function(){if(this.fontHeight)return this.fontHeight*this.fontScale;var e=0;for(var t in this.mapInfo){var n=this.mapInfo[t],r=n.height+n.yoffset;r>e&&(e=r)}return this.fontHeight=e,this.fontHeight*this.fontScale},drawText:function(e,t,n,r){var i,s,o,u;for(i=0;i<e.length;i++)o=this.mapInfo[e.charAt(i)],o&&(u=o.width,u>0&&o.height>0&&t.drawImage(this.image,o.x,o.y,u,o.height,n+o.xoffset*this.fontScale,r+o.yoffset*this.fontScale,u*this.fontScale,o.height*this.fontScale),n+=o.xadvance*this.fontScale)},getFontData:function(){var e=this.stringHeight()*.8>>0;return{height:this.stringHeight(),ascent:e,descent:this.stringHeight()-e}}}}}),CAAT.Module({defines:"CAAT.Foundation.Actor",aliases:["CAAT.Actor"],depends:["CAAT.Event.AnimationLoop","CAAT.Foundation.SpriteImage","CAAT.Core.Constants","CAAT.Behavior.PathBehavior","CAAT.Behavior.RotateBehavior","CAAT.Behavior.ScaleBehavior","CAAT.Behavior.Scale1Behavior","CAAT.PathUtil.LinearPath","CAAT.Event.AnimationLoop"],constants:{ANCHOR_CENTER:0,ANCHOR_TOP:1,ANCHOR_BOTTOM:2,ANCHOR_LEFT:3,ANCHOR_RIGHT:4,ANCHOR_TOP_LEFT:5,ANCHOR_TOP_RIGHT:6,ANCHOR_BOTTOM_LEFT:7,ANCHOR_BOTTOM_RIGHT:8,ANCHOR_CUSTOM:9,CACHE_NONE:0,CACHE_SIMPLE:1,CACHE_DEEP:2},extendsWith:function(){var e=0;return{__init:function(){return this.behaviorList=[],this.lifecycleListenerList=[],this.AABB=new CAAT.Math.Rectangle,this.viewVertices=[new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0)],this.scaleAnchor=CAAT.Foundation.Actor.ANCHOR_CENTER,this.modelViewMatrix=new CAAT.Math.Matrix,this.worldModelViewMatrix=new CAAT.Math.Matrix,this.resetTransform(),this.setScale(1,1),this.setRotation(0),this.id=e++,this},__super:null,lifecycleListenerList:null,behaviorList:null,parent:null,x:0,y:0,width:0,height:0,preferredSize:null,minimumSize:null,start_time:0,duration:Number.MAX_VALUE,clip:!1,clipPath:null,tAnchorX:0,tAnchorY:0,scaleX:1,scaleY:1,scaleTX:.5,scaleTY:.5,scaleAnchor:0,rotationAngle:0,rotationY:.5,rotationX:.5,alpha:1,isGlobalAlpha:!1,frameAlpha:1,expired:!1,discardable:!1,pointed:!1,mouseEnabled:!0,visible:!0,fillStyle:null,strokeStyle:null,time:0,AABB:null,viewVertices:null,inFrame:!1,dirty:!0,wdirty:!0,oldX:-1,oldY:-1,modelViewMatrix:null,worldModelViewMatrix:null,modelViewMatrixI:null,worldModelViewMatrixI:null,glEnabled:!1,backgroundImage:null,id:null,size_active:1,size_total:1,__d_ax:-1,__d_ay:-1,gestureEnabled:!1,invalid:!0,cached:0,preventLayout:!1,isAA:!0,setPreventLayout:function(e){return this.preventLayout=e,this},invalidateLayout:function(){return this.parent&&!this.parent.layoutInvalidated&&this.parent.invalidateLayout(),this},__validateLayout:function(){},setPreferredSize:function(e,t){return this.preferredSize||(this.preferredSize=new CAAT.Math.Dimension),this.preferredSize.width=e,this.preferredSize.height=t,this},getPreferredSize:function(){return this.preferredSize?this.preferredSize:this.getMinimumSize()},setMinimumSize:function(e,t){return this.minimumSize||(this.minimumSize=new CAAT.Math.Dimension),this.minimumSize.width=e,this.minimumSize.height=t,this},getMinimumSize:function(){return this.minimumSize?this.minimumSize:new CAAT.Math.Dimension(this.width,this.height)},create:function(){return this},moveTo:function(e,t,n,r,i,s){if(e===this.x&&t===this.y)return;var o="__moveTo",u=this.getBehavior(o);return u||(u=(new CAAT.Behavior.PathBehavior).setId(o).setValues(new CAAT.PathUtil.LinearPath),this.addBehavior(u)),u.path.setInitialPosition(this.x,this.y).setFinalPosition(e,t),u.setDelayTime(r?r:0,n),i&&u.setInterpolator(i),s&&(u.lifecycleListenerList=[],u.addListener({behaviorExpired:function(e,t,n){s(e,t,n)}})),this},rotateTo:function(e,t,n,r,i,s){if(e===this.rotationAngle)return;var o="__rotateTo",u=this.getBehavior(o);return u||(u=(new CAAT.Behavior.RotateBehavior).setId(o).setValues(0,0,.5,.5),this.addBehavior(u)),u.setValues(this.rotationAngle,e,r,i).setDelayTime(n?n:0,t),s&&u.setInterpolator(s),this},scaleTo:function(e,t,n,r,i,s,o){if(this.scaleX===e&&this.scaleY===t)return;var u="__scaleTo",a=this.getBehavior(u);return a||(a=(new CAAT.Behavior.ScaleBehavior).setId(u).setValues(1,1,1,1,.5,.5),this.addBehavior(a)),a.setValues(this.scaleX,e,this.scaleY,t,i,s).setDelayTime(r?r:0,n),o&&a.setInterpolator(o),this},scaleXTo:function(e,t,n,r,i,s){return this.__scale1To(CAAT.Behavior.Scale1Behavior.AXIS_X,e,t,n,r,i,s)},scaleYTo:function(e,t,n,r,i,s){return this.__scale1To(CAAT.Behavior.Scale1Behavior.AXIS_Y,e,t,n,r,i,s)},__scale1To:function(e,t,n,r,i,s,o){if(e===CAAT.Behavior.Scale1Behavior.AXIS_X&&t===this.scaleX||e===CAAT.Behavior.Scale1Behavior.AXIS_Y&&t===this.scaleY)return;var u="__scaleXTo",a=this.getBehavior(u);return a||(a=(new CAAT.Behavior.Scale1Behavior).setId(u).setValues(1,1,e===CAAT.Behavior.Scale1Behavior.AXIS_X,.5,.5),this.addBehavior(a)),a.setValues(e?this.scaleX:this.scaleY,t,i,s).setDelayTime(r?r:0,n),o&&a.setInterpolator(o),this},touchStart:function(e){},touchMove:function(e){},touchEnd:function(e){},gestureStart:function(e,t,n){},gestureChange:function(e,t,n){return this.gestureEnabled&&(this.setRotation(e),this.setScale(t,n)),this},gestureEnd:function(e,t,n){},isVisible:function(){return this.visible},invalidate:function(){return this.invalid=!0,this},setGestureEnabled:function(e){return this.gestureEnabled=!!e,this},isGestureEnabled:function(){return this.gestureEnabled},getId:function(){return this.id},setId:function(e){return this.id=e,this},setParent:function(e){return this.parent=e,this},setBackgroundImage:function(e,t){if(e){e instanceof CAAT.Foundation.SpriteImage?e=e.getRef():isString(e)?e=(new CAAT.Foundation.SpriteImage).initialize(CAAT.currentDirector.getImage(e),1,1):e=(new CAAT.Foundation.SpriteImage).initialize(e,1,1),e.setOwner(this),this.backgroundImage=e;if(typeof t=="undefined"||t)this.width=e.getWidth(),this.height=e.getHeight();this.glEnabled=!0,this.invalidate()}else this.backgroundImage=null;return this},setSpriteIndex:function(e){return this.backgroundImage&&(this.backgroundImage.setSpriteIndex(e),this.invalidate()),this},setBackgroundImageOffset:function(e,t){return this.backgroundImage&&this.backgroundImage.setOffset(e,t),this},setAnimationImageIndex:function(e){return this.backgroundImage&&(this.backgroundImage.resetAnimationTime(),this.backgroundImage.setAnimationImageIndex(e),this.invalidate()),this},addAnimation:function(e,t,n,r){return this.backgroundImage&&this.backgroundImage.addAnimation(e,t,n,r),this},playAnimation:function(e){return this.backgroundImage&&this.backgroundImage.playAnimation(e),this},setAnimationEndCallback:function(e){return this.backgroundImage&&this.backgroundImage.setAnimationEndCallback(e),this},resetAnimationTime:function(){return this.backgroundImage&&(this.backgroundImage.resetAnimationTime(),this.invalidate()),this},setChangeFPS:function(e){return this.backgroundImage&&this.backgroundImage.setChangeFPS(e),this},setImageTransformation:function(e){return this.backgroundImage&&this.backgroundImage.setSpriteTransformation(e),this},centerOn:function(e,t){return this.setPosition(e-this.width/2,t-this.height/2),this},centerAt:function(e,t){return this.setPosition(e-this.width*(.5-this.tAnchorX),t-this.height*(.5-this.tAnchorY)),this},getTextureGLPage:function(){return this.backgroundImage.image.__texturePage},setVisible:function(e){return this.invalidate(),CAAT.currentDirector&&CAAT.currentDirector.dirtyRectsEnabled&&!e&&this.visible&&CAAT.currentDirector.scheduleDirtyRect(this.AABB),e&&!this.visible&&(this.dirty=!0),this.visible=e,this},setOutOfFrameTime:function(){return this.setFrameTime(-1,0),this},addListener:function(e){return this.lifecycleListenerList.push(e),this},removeListener:function(e){var t=this.lifecycleListenerList.length;while(t--)if(this.lifecycleListenerList[t]===e){this.lifecycleListenerList.splice(t,1);return}},setGlobalAlpha:function(e){return this.isGlobalAlpha=e,this},fireEvent:function(e,t){for(var n=0;n<this.lifecycleListenerList.length;n++)this.lifecycleListenerList[n].actorLifeCycleEvent(this,e,t)},setExpired:function(e){return this.expired=!0,this.fireEvent("expired",e),this},enableEvents:function(e){return this.mouseEnabled=e,this},emptyBehaviorList:function(){return this.behaviorList=[],this},setFillStyle:function(e){return this.fillStyle=e,this.invalidate(),this},setStrokeStyle:function(e){return this.strokeStyle=e,this.invalidate(),this},setPaint:function(e){return this.setFillStyle(e)},setAlpha:function(e){return this.alpha=e,this.invalidate(),this},resetTransform:function(){return this.rotationAngle=0,this.rotationX=.5,this.rotationY=.5,this.scaleX=1,this.scaleY=1,this.scaleTX=.5,this.scaleTY=.5,this.scaleAnchor=0,this.oldX=-1,this.oldY=-1,this.dirty=!0,this},setFrameTime:function(e,t){return this.start_time=e,this.duration=t,this.expired=!1,this.dirty=!0,this},paint:function(e,t){if(this.backgroundImage)this.backgroundImage.paint(e,t,0,0);else if(this.fillStyle){var n=e.ctx;n.fillStyle=this.fillStyle,n.fillRect(0,0,this.width,this.height)}},setScale:function(e,t){return this.scaleX=e,this.scaleY=t,this.dirty=!0,this},getAnchorPercent:function(e){var t=[.5,.5,.5,0,.5,1,0,.5,1,.5,0,0,1,0,0,1,1,1];return{x:t[e*2],y:t[e*2+1]}},getAnchor:function(e){var t=0,n=0,r=CAAT.Foundation.Actor;switch(e){case r.ANCHOR_CENTER:t=.5,n=.5;break;case r.ANCHOR_TOP:t=.5,n=0;break;case r.ANCHOR_BOTTOM:t=.5,n=1;break;case r.ANCHOR_LEFT:t=0,n=.5;break;case r.ANCHOR_RIGHT:t=1,n=.5;break;case r.ANCHOR_TOP_RIGHT:t=1,n=0;break;case r.ANCHOR_BOTTOM_LEFT:t=0,n=1;break;case r.ANCHOR_BOTTOM_RIGHT:t=1,n=1;break;case r.ANCHOR_TOP_LEFT:t=0,n=0}return{x:t,y:n}},setGlobalAnchor:function(e,t){return this.tAnchorX=e,this.rotationX=e,this.scaleTX=e,this.tAnchorY=t,this.rotationY=t,this.scaleTY=t,this.dirty=!0,this},setScaleAnchor:function(e,t){return this.scaleTX=e,this.scaleTY=t,this.dirty=!0,this},setScaleAnchored:function(e,t,n,r){return this.scaleTX=n,this.scaleTY=r,this.scaleX=e,this.scaleY=t,this.dirty=!0,this},setRotationAnchor:function(e,t){return this.rotationX=t,this.rotationY=e,this.dirty=!0,this},setRotation:function(e){return this.rotationAngle=e,this.dirty=!0,this},setRotationAnchored:function(e,t,n){return this.rotationAngle=e,this.rotationX=t,this.rotationY=n,this.dirty=!0,this},setSize:function(e,t){return this.width=e,this.height=t,this.dirty=!0,this},setBounds:function(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this.dirty=!0,this},setLocation:function(e,t){return this.x=e,this.y=t,this.oldX=e,this.oldY=t,this.dirty=!0,this},setPosition:function(e,t){return this.setLocation(e,t)},setPositionAnchor:function(e,t){return this.tAnchorX=e,this.tAnchorY=t,this},setPositionAnchored:function(e,t,n,r){return this.setLocation(e,t),this.tAnchorX=n,this.tAnchorY=r,this},isInAnimationFrame:function(e){return this.expired?!1:this.duration===Number.MAX_VALUE?this.start_time<=e:e>=this.start_time+this.duration?(this.expired||this.setExpired(e),!1):this.start_time<=e&&e<this.start_time+this.duration},contains:function(e,t){return e>=0&&t>=0&&e<this.width&&t<this.height},addBehavior:function(e){return this.behaviorList.push(e),this},removeBehaviour:function(e){var t=this.behaviorList,n=t.length-1;while(n)if(t[n]===e)return t.splice(n,1),this;return this},removeBehaviorById:function(e){var t=this.behaviorList;for(var n=0;n<t.length;n++)t[n].id===e&&t.splice(n,1);return this},getBehavior:function(e){var t=this.behaviorList;for(var n=0;n<t.length;n++){var r=t[n];if(r.id===e)return r}return null},setDiscardable:function(e){return this.discardable=e,this},destroy:function(e){this.parent&&this.parent.removeChild(this),this.backgroundImage=null,this.emptyBehaviorList(),this.fireEvent("destroyed",e),this.lifecycleListenerList=[]},modelToView:function(e){var t,n,r,i;this.dirty&&this.setModelViewMatrix(),i=this.worldModelViewMatrix.matrix;if(e instanceof Array)for(var s=0;s<e.length;s++)r=e[s],t=r.x,n=r.y,r.x=t*i[0]+n*i[1]+i[2],r.y=t*i[3]+n*i[4]+i[5];else t=e.x,n=e.y,e.x=t*i[0]+n*i[1]+i[2],e.y=t*i[3]+n*i[4]+i[5];return e},modelToModel:function(e,t){return this.dirty&&this.setModelViewMatrix(),t.viewToModel(this.modelToView(e))},viewToModel:function(e){return this.dirty&&this.setModelViewMatrix(),this.worldModelViewMatrixI=this.worldModelViewMatrix.getInverse(),this.worldModelViewMatrixI.transformCoord(e),e},findActorAtPosition:function(e){return this.scaleX===0||this.scaleY===0?null:!this.visible||!this.mouseEnabled||!this.isInAnimationFrame(this.time)?null:(this.modelViewMatrixI=this.modelViewMatrix.getInverse(),this.modelViewMatrixI.transformCoord(e),this.contains(e.x,e.y)?this:null)},enableDrag:function(){return this.ax=0,this.ay=0,this.asx=1,this.asy=1,this.ara=0,this.screenx=0,this.screeny=0,this.mouseEnter=function(e){this.__d_ax=-1,this.__d_ay=-1,this.pointed=!0,CAAT.setCursor("move")},this.mouseExit=function(e){this.__d_ax=-1,this.__d_ay=-1,this.pointed=!1,CAAT.setCursor("default")},this.mouseMove=function(e){},this.mouseUp=function(e){this.__d_ax=-1,this.__d_ay=-1},this.mouseDrag=function(e){var t;t=this.modelToView(new CAAT.Math.Point(e.x,e.y)),this.parent.viewToModel(t);if(this.__d_ax===-1||this.__d_ay===-1)this.__d_ax=t.x,this.__d_ay=t.y,this.__d_asx=this.scaleX,this.__d_asy=this.scaleY,this.__d_ara=this.rotationAngle,this.__d_screenx=e.screenPoint.x,this.__d_screeny=e.screenPoint.y;if(e.isShiftDown()){var n=(e.screenPoint.x-this.__d_screenx)/100,r=(e.screenPoint.y-this.__d_screeny)/100;if(!e.isAltDown()){var i=Math.max(n,r);n=i,r=i}this.setScale(n+this.__d_asx,r+this.__d_asy)}else if(e.isControlDown()){var s=e.screenPoint.x-this.__d_screenx,o=e.screenPoint.y-this.__d_screeny;this.setRotation(-Math.atan2(s,o)+this.__d_ara)}else this.x+=t.x-this.__d_ax,this.y+=t.y-this.__d_ay;this.__d_ax=t.x,this.__d_ay=t.y},this},disableDrag:function(){return this.mouseEnter=function(e){},this.mouseExit=function(e){},this.mouseMove=function(e){},this.mouseUp=function(e){},this.mouseDrag=function(e){},this},mouseClick:function(e){},mouseDblClick:function(e){},mouseEnter:function(e){this.pointed=!0},mouseExit:function(e){this.pointed=!1},mouseMove:function(e){},mouseDown:function(e){},mouseUp:function(e){},mouseOut:function(e){},mouseOver:function(e){},mouseDrag:function(e){},drawScreenBoundingBox:function(e,t){if(null!==this.AABB&&this.inFrame){var n=this.AABB,r=e.ctx;r.strokeStyle=CAAT.DEBUGAABBCOLOR,r.strokeRect(.5+(n.x|0),.5+(n.y|0),n.width|0,n.height|0);if(CAAT.DEBUGBB){var i=this.viewVertices;r.beginPath(),r.lineTo(i[0].x,i[0].y),r.lineTo(i[1].x,i[1].y),r.lineTo(i[2].x,i[2].y),r.lineTo(i[3].x,i[3].y),r.closePath(),r.strokeStyle=CAAT.DEBUGBBCOLOR,r.stroke()}}},animate:function(e,t){if(!this.visible)return!1;var n;if(!this.isInAnimationFrame(t))return this.inFrame=!1,this.dirty=!0,!1;if(this.x!==this.oldX||this.y!==this.oldY)this.dirty=!0,this.oldX=this.x,this.oldY=this.y;for(n=0;n<this.behaviorList.length;n++)this.behaviorList[n].apply(t,this);this.clipPath&&this.clipPath.applyBehaviors(t),this.setModelViewMatrix();if(this.dirty||this.wdirty||this.invalid)e.dirtyRectsEnabled&&e.addDirtyRect(this.AABB),this.setScreenBounds(),e.dirtyRectsEnabled&&e.addDirtyRect(this.AABB);return this.dirty=!1,this.invalid=!1,this.inFrame=!0,this.backgroundImage&&this.backgroundImage.setSpriteIndexAtTime(t),this.AABB.intersects(e.AABB)},setModelViewMatrix:function(){var e,t,n,r,i,s,o,u,a,f,l,c,h;this.wdirty=!1,h=this.modelViewMatrix.matrix;if(this.dirty){o=1,u=0,f=0,l=1,a=this.x-this.tAnchorX*this.width,c=this.y-this.tAnchorY*this.height;if(this.rotationAngle){var p=this.rotationX*this.width,d=this.rotationY*this.height;a+=o*p+u*d,c+=f*p+l*d,e=Math.cos(this.rotationAngle),t=Math.sin(this.rotationAngle),n=o,r=u,i=f,s=l,o=n*e+r*t,u=-n*t+r*e,f=i*e+s*t,l=-i*t+s*e,a+=-o*p-u*d,c+=-f*p-l*d}if(this.scaleX!=1||this.scaleY!=1){var v=this.scaleTX*this.width,m=this.scaleTY*this.height;a+=o*v+u*m,c+=f*v+l*m,o*=this.scaleX,u*=this.scaleY,f*=this.scaleX,l*=this.scaleY,a+=-o*v-u*m,c+=-f*v-l*m}h[0]=o,h[1]=u,h[2]=a,h[3]=f,h[4]=l,h[5]=c}if(this.parent){this.isAA=this.rotationAngle===0&&this.scaleX===1&&this.scaleY===1&&this.parent.isAA;if(this.dirty||this.parent.wdirty){this.worldModelViewMatrix.copy(this.parent.worldModelViewMatrix);if(this.isAA){var g=this.worldModelViewMatrix.matrix;g[2]+=h[2],g[5]+=h[5]}else this.worldModelViewMatrix.multiply(this.modelViewMatrix);this.wdirty=!0}}else this.dirty&&(this.wdirty=!0),this.worldModelViewMatrix.identity(),this.isAA=this.rotationAngle===0&&this.scaleX===1&&this.scaleY===1},setScreenBounds:function(){var e=this.AABB,t=this.viewVertices,n,r,i,s,o,u;if(this.isAA)return r=this.worldModelViewMatrix.matrix,i=r[2],s=r[5],o=this.width,u=this.height,e.x=i,e.y=s,e.x1=i+o,e.y1=s+u,e.width=o,e.height=u,CAAT.GLRENDER&&(n=t[0],n.x=i,n.y=s,n=t[1],n.x=i+o,n.y=s,n=t[2],n.x=i+o,n.y=s+u,n=t[3],n.x=i,n.y=s+u),this;n=t[0],n.x=0,n.y=0,n=t[1],n.x=this.width,n.y=0,n=t[2],n.x=this.width,n.y=this.height,n=t[3],n.x=0,n.y=this.height,this.modelToView(this.viewVertices);var a=Number.MAX_VALUE,f=-Number.MAX_VALUE,l=Number.MAX_VALUE,c=-Number.MAX_VALUE;return n=t[0],n.x<a&&(a=n.x),n.x>f&&(f=n.x),n.y<l&&(l=n.y),n.y>c&&(c=n.y),n=t[1],n.x<a&&(a=n.x),n.x>f&&(f=n.x),n.y<l&&(l=n.y),n.y>c&&(c=n.y),n=t[2],n.x<a&&(a=n.x),n.x>f&&(f=n.x),n.y<l&&(l=n.y),n.y>c&&(c=n.y),n=t[3],n.x<a&&(a=n.x),n.x>f&&(f=n.x),n.y<l&&(l=n.y),n.y>c&&(c=n.y),e.x=a,e.y=l,e.x1=f,e.y1=c,e.width=f-a,e.height=c-l,this},paintActor:function(e,t){if(!this.visible||!e.inDirtyRect(this))return!0;var n=e.ctx;return this.frameAlpha=this.parent?this.parent.frameAlpha*this.alpha:1,n.globalAlpha=this.frameAlpha,e.modelViewMatrix.transformRenderingContextSet(n),this.worldModelViewMatrix.transformRenderingContext(n),this.clip&&(n.beginPath(),this.clipPath?this.clipPath.applyAsPath(e):n.rect(0,0,this.width,this.height),n.clip()),this.paint(e,t),!0},__paintActor:function(e,t){if(!this.visible)return!0;var n=e.ctx;this.frameAlpha=this.alpha;var r=this.worldModelViewMatrix.matrix;return n.setTransform(r[0],r[3],r[1],r[4],r[2],r[5],this.frameAlpha),this.paint(e,t),!0},paintActorGL:function(e,t){this.frameAlpha=this.parent.frameAlpha*this.alpha;if(!this.glEnabled||!this.visible)return;if(this.glNeedsFlush(e)){e.glFlush(),this.glSetShader(e),this.__uv||(this.__uv=new Float32Array(8)),this.__vv||(this.__vv=new Float32Array(12)),this.setGLCoords(this.__vv,0),this.setUV(this.__uv,0),e.glRender(this.__vv,12,this.__uv);return}var n=e.coords,r=e.coordsIndex;this.setGLCoords(n,r),e.coordsIndex=r+12,this.setUV(e.uv,e.uvIndex),e.uvIndex+=8},setGLCoords:function(e,t){var n=this.viewVertices;e[t++]=n[0].x,e[t++]=n[0].y,e[t++]=0,e[t++]=n[1].x,e[t++]=n[1].y,e[t++]=0,e[t++]=n[2].x,e[t++]=n[2].y,e[t++]=0,e[t++]=n[3].x,e[t++]=n[3].y,e[t]=0},setUV:function(e,t){this.backgroundImage.setUV(e,t)},glNeedsFlush:function(e){return this.getTextureGLPage()!==e.currentTexturePage?!0:this.frameAlpha!==e.currentOpacity?!0:!1},glSetShader:function(e){var t=this.getTextureGLPage();t!==e.currentTexturePage&&e.setGLTexturePage(t),this.frameAlpha!==e.currentOpacity&&e.setGLCurrentOpacity(this.frameAlpha)},endAnimate:function(e,t){return this},initialize:function(e){if(e)for(var t in e)this[t]=e[t];return this},setClip:function(e,t){return this.clip=e,this.clipPath=t,this},isCached:function(){return this.cached},stopCacheAsBitmap:function(){this.cached&&(this.backgroundImage=null,this.cached=CAAT.Foundation.Actor.CACHE_NONE)},cacheAsBitmap:function(e,t){if(this.width<=0||this.height<=0)return this;e=e||0;var n=document.createElement("canvas");n.width=this.width,n.height=this.height;var r=n.getContext("2d");CAAT.Foundation.Actor.prototype.animate.call(this,CAAT.currentDirector,e);var i={ctx:r,modelViewMatrix:new CAAT.Math.Matrix,worldModelViewMatrix:new CAAT.Math.Matrix,dirtyRectsEnabled:!1,inDirtyRect:function(){return!0},AABB:new CAAT.Math.Rectangle(0,0,this.width,this.height)},s=this.modelViewMatrix,o=this.worldModelViewMatrix;return this.modelViewMatrix=new CAAT.Math.Matrix,this.worldModelViewMatrix=new CAAT.Math.Matrix,this.cached=CAAT.Foundation.Actor.CACHE_NONE,typeof t=="undefined"&&(t=CAAT.Foundation.Actor.CACHE_SIMPLE),t===CAAT.Foundation.Actor.CACHE_DEEP?(this.animate(i,e),this.paintActor(i,e)):this instanceof CAAT.Foundation.ActorContainer||this instanceof CAAT.ActorContainer?CAAT.Foundation.ActorContainer.superclass.paintActor.call(this,i,e):(this.animate(i,e),this.paintActor(i,e)),this.setBackgroundImage(n),this.cached=t,this.modelViewMatrix=s,this.worldModelViewMatrix=o,this},resetAsButton:function(){return this.actionPerformed=null,this.mouseEnter=function(){},this.mouseExit=function(){},this.mouseDown=function(){},this.mouseUp=function(){},this.mouseClick=function(){},this.mouseDrag=function(){},this},setAsButton:function(e,t,n,r,i,s){var o=this;return this.setBackgroundImage(e,!0),this.iNormal=t||0,this.iOver=n||this.iNormal,this.iPress=r||this.iNormal,this.iDisabled=i||this.iNormal,this.fnOnClick=s,this.enabled=!0,this.setSpriteIndex(t),this.setEnabled=function(e){return this.enabled=e,this.setSpriteIndex(this.enabled?this.iNormal:this.iDisabled),this},this.actionPerformed=function(e){this.enabled&&this.fnOnClick&&this.fnOnClick(this)},this.mouseEnter=function(e){if(!this.enabled)return;this.dragging?this.setSpriteIndex(this.iPress):this.setSpriteIndex(this.iOver),CAAT.setCursor("pointer")},this.mouseExit=function(e){if(!this.enabled)return;this.setSpriteIndex(this.iNormal),CAAT.setCursor("default")},this.mouseDown=function(e){if(!this.enabled)return;this.setSpriteIndex(this.iPress)},this.mouseUp=function(e){if(!this.enabled)return;this.setSpriteIndex(this.iNormal),this.dragging=!1},this.mouseClick=function(e){},this.mouseDrag=function(e){if(!this.enabled)return;this.dragging=!0},this.setButtonImageIndex=function(e,t,n,r){return this.iNormal=e||0,this.iOver=t||this.iNormal,this.iPress=n||this.iNormal,this.iDisabled=r||this.iNormal,this.setSpriteIndex(this.iNormal),this},this},findActorById:function(e){return this.id===e?this:null}}}}),CAAT.Module({defines:"CAAT.Foundation.ActorContainer",aliases:["CAAT.ActorContainer"],depends:["CAAT.Foundation.Actor","CAAT.Math.Point","CAAT.Math.Rectangle"],constants:{ADDHINT:{CONFORM:1},AddHint:{CONFORM:1}},extendsClass:"CAAT.Foundation.Actor",extendsWith:function(){var e=CAAT.Foundation.Actor.CACHE_DEEP,t=CAAT.Foundation.ActorContainer.superclass,n=t.drawScreenBoundingBox,r=t.paintActor,i=t.paintActorGL,s=t.animate,o=t.findActorAtPosition,u=t.destroy;return{__init:function(e){return this.__super(),this.childrenList=[],this.activeChildren=[],this.pendingChildrenList=[],typeof e!="undefined"&&(this.addHint=e,this.boundingBox=new CAAT.Math.Rectangle),this},childrenList:null,activeChildren:null,pendingChildrenList:null,addHint:0,boundingBox:null,runion:new CAAT.Math.Rectangle,layoutManager:null,layoutInvalidated:!0,setLayout:function(e){return this.layoutManager=e,this},setBounds:function(e,t,n,r){return CAAT.Foundation.ActorContainer.superclass.setBounds.call(this,e,t,n,r),CAAT.currentDirector&&!CAAT.currentDirector.inValidation&&this.invalidateLayout(),this},__validateLayout:function(){this.__validateTree(),this.layoutInvalidated=!1},__validateTree:function(){if(this.layoutManager&&this.layoutManager.isInvalidated()){CAAT.currentDirector.inValidation=!0,this.layoutManager.doLayout(this);for(var e=0;e<this.getNumChildren();e+=1)this.getChildAt(e).__validateLayout()}},invalidateLayout:function(){this.layoutInvalidated=!0;if(this.layoutManager){this.layoutManager.invalidateLayout(this);for(var e=0;e<this.getNumChildren();e+=1)this.getChildAt(e).invalidateLayout()}},getLayout:function(){return this.layoutManager},drawScreenBoundingBox:function(e,t){if(!this.inFrame)return;var r=this.activeChildren;for(var i=0;i<r.length;i++)r[i].drawScreenBoundingBox(e,t);n.call(this,e,t)},emptyChildren:function(){return this.childrenList=[],this},paintActor:function(t,n){if(!this.visible)return!1;var i=t.ctx;i.save();if(!r.call(this,t,n))return!1;if(this.cached===e)return!1;this.isGlobalAlpha||(this.frameAlpha=this.parent?this.parent.frameAlpha:1);for(var s=0,o=this.activeChildren.length;s<o;++s){var u=this.activeChildren[s];u.visible&&(i.save(),u.paintActor(t,n),i.restore())}return this.postPaint&&this.postPaint(t,n),i.restore(),!0},__paintActor:function(e,t){if(!this.visible)return!0;var n=e.ctx;this.frameAlpha=this.parent?this.parent.frameAlpha*this.alpha:1;var r=this.worldModelViewMatrix.matrix;n.setTransform(r[0],r[3],r[1],r[4],r[2],r[5],this.frameAlpha),this.paint(e,t),this.isGlobalAlpha||(this.frameAlpha=this.parent?this.parent.frameAlpha:1);for(var i=0,s=this.activeChildren.length;i<s;++i){var o=this.activeChildren[i];o.paintActor(e,t)}return!0},paintActorGL:function(e,t){var n,r,s;if(!this.visible)return!0;i.call(this,e,t),this.isGlobalAlpha||(this.frameAlpha=this.parent.frameAlpha);for(n=0,r=this.activeChildren.length;n<r;++n)s=this.activeChildren[n],s.paintActorGL(e,t)},animate:function(t,n){if(!this.visible)return!1;this.activeChildren=[];var r=null;if(!1===s.call(this,t,n))return!1;if(this.cached===e)return!0;this.__validateLayout(),CAAT.currentDirector.inValidation=!1;var i,o,u=this.pendingChildrenList;for(i=0;i<u.length;i++){var a=u[i];this.addChildImmediately(a.child,a.constraint)}this.pendingChildrenList=[];var f=[],l=this.childrenList;this.size_active=1,this.size_total=1;for(i=0;i<l.length;i++){var c=l[i];c.time=n,this.size_total+=c.size_total,c.animate(t,n)?(this.activeChildren.push(c),this.size_active+=c.size_active):c.expired&&c.discardable&&f.push(c)}for(i=0,o=f.length;i<o;i++){var h=f[i];h.destroy(n),t.dirtyRectsEnabled&&t.addDirtyRect(h.AABB)}return!0},endAnimate:function(e,t){},addChildImmediately:function(e,t){return this.addChild(e,t)},addChild:function(e,t){if(e.parent!=null)throw"adding to a container an element with parent.";return e.parent=this,this.childrenList.push(e),e.dirty=!0,this.layoutManager?(this.layoutManager.addChild(e,t),this.invalidateLayout()):this.addHint===CAAT.Foundation.ActorContainer.AddHint.CONFORM&&this.recalcSize(),this},recalcSize:function(){var e=this.boundingBox;e.setEmpty();var t=this.childrenList,n;for(var r=0;r<t.length;r++)n=t[r],this.runion.setBounds(n.x<0?0:n.x,n.y<0?0:n.y,n.width,n.height),e.unionRectangle(this.runion);return this.setSize(e.x1,e.y1),this},addChildDelayed:function(e,t){return this.pendingChildrenList.push({child:e,constraint:t}),this},addChildAt:function(e,t){return t<=0?(e.parent=this,e.dirty=!0,this.childrenList.splice(0,0,e),this.invalidateLayout(),this):(t>=this.childrenList.length&&(t=this.childrenList.length),e.parent=this,e.dirty=!0,this.childrenList.splice(t,0,e),this.invalidateLayout(),this)},findActorById:function(e){if(CAAT.Foundation.ActorContainer.superclass.findActorById.call(this,e))return this;var t=this.childrenList;for(var n=0,r=t.length;n<r;n++){var i=t[n].findActorById(e);if(null!=i)return i}return null},findChild:function(e){var t=this.childrenList,n,r=t.length;for(n=0;n<r;n++)if(t[n]===e)return n;return-1},removeChildAt:function(e){var t=this.childrenList,n;return-1!==e&&e>=0&&e<this.childrenList.length?(t[e].setParent(null),n=t.splice(e,1),n[0].isVisible()&&CAAT.currentDirector.dirtyRectsEnabled&&CAAT.currentDirector.scheduleDirtyRect(n[0].AABB),this.invalidateLayout(),n[0]):null},removeChild:function(e){var t=this.findChild(e),n=this.removeChildAt(t);return n},removeFirstChild:function(){var e=this.childrenList.shift();return e.parent=null,e.isVisible()&&CAAT.currentDirector.dirtyRectsEnabled&&CAAT.currentDirector.scheduleDirtyRect(e.AABB),this.invalidateLayout(),e},removeLastChild:function(){if(this.childrenList.length){var e=this.childrenList.pop();return e.parent=null,e.isVisible()&&CAAT.currentDirector.dirtyRectsEnabled&&CAAT.currentDirector.scheduleDirtyRect(e.AABB),this.invalidateLayout(),e}return null},findActorAtPosition:function(e){if(null===o.call(this,e))return null;var t=this.childrenList;for(var n=t.length-1;n>=0;n--){var r=this.childrenList[n],i=new CAAT.Math.Point(e.x,e.y,0),s=r.findActorAtPosition(i);if(null!==s)return s}return this},destroy:function(){var e=this.childrenList;for(var t=e.length-1;t>=0;t--)e[t].destroy();return u.call(this),this},getNumChildren:function(){return this.childrenList.length},getNumActiveChildren:function(){return this.activeChildren.length},getChildAt:function(e){return this.childrenList[e]},setZOrder:function(e,t){var n=this.findChild(e);if(-1!==n){var r=this.childrenList;if(t===n)return;if(t>=r.length)r.splice(n,1),r.push(e);else{var i=r.splice(n,1);t<0?t=0:t>r.length&&(t=r.length),r.splice(t,0,i[0])}this.invalidateLayout()}}}}}),CAAT.Module({defines:"CAAT.Foundation.Scene",depends:["CAAT.Math.Point","CAAT.Math.Matrix","CAAT.PathUtil.Path","CAAT.Behavior.GenericBehavior","CAAT.Behavior.ContainerBehavior","CAAT.Behavior.ScaleBehavior","CAAT.Behavior.AlphaBehavior","CAAT.Behavior.RotateBehavior","CAAT.Behavior.PathBehavior","CAAT.Foundation.ActorContainer","CAAT.Foundation.Timer.TimerManager"],aliases:["CAAT.Scene"],extendsClass:"CAAT.Foundation.ActorContainer",constants:{EASE_ROTATION:1,EASE_SCALE:2,EASE_TRANSLATE:3},extendsWith:function(){return{__init:function(){return this.__super(),this.timerManager=new CAAT.TimerManager,this.fillStyle=null,this.isGlobalAlpha=!0,this},easeContainerBehaviour:null,easeContainerBehaviourListener:null,easeIn:!1,paused:!1,timerManager:null,isPaused:function(){return this.paused},setPaused:function(e){this.paused=e},createTimer:function(e,t,n,r,i){return this.timerManager.createTimer(e,t,n,r,i,this)},setTimeout:function(e,t,n,r){return this.timerManager.createTimer(this.time,e,t,n,r,this)},createAlphaBehaviour:function(e,t){var n=new CAAT.Behavior.AlphaBehavior;n.setFrameTime(0,e),n.startAlpha=t?0:1,n.endAlpha=t?1:0,this.easeContainerBehaviour.addBehavior(n)},easeTranslationIn:function(e,t,n,r){this.easeTranslation(e,t,n,!0,r)},easeTranslationOut:function(e,t,n,r){this.easeTranslation(e,t,n,!1,r)},easeTranslation:function(e,t,n,r,i){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior,this.easeIn=r;var s=new CAAT.Behavior.PathBehavior;i&&s.setInterpolator(i),s.setFrameTime(0,e),n<1?n=1:n>4&&(n=4);switch(n){case CAAT.Foundation.Actor.ANCHOR_TOP:r?(s.setPath((new CAAT.PathUtil.Path).setLinear(0,-this.height+1,0,0)),this.setPosition(0,-this.height+1)):(s.setPath((new CAAT.PathUtil.Path).setLinear(0,0,0,-this.height+1)),this.setPosition(0,0));break;case CAAT.Foundation.Actor.ANCHOR_BOTTOM:r?(s.setPath((new CAAT.PathUtil.Path).setLinear(0,this.height-1,0,0)),this.setPosition(0,this.height-1)):(s.setPath((new CAAT.PathUtil.Path).setLinear(0,0,0,this.height-1)),this.setPosition(0,0));break;case CAAT.Foundation.Actor.ANCHOR_LEFT:r?(s.setPath((new CAAT.PathUtil.Path).setLinear(-this.width+1,0,0,0)),this.setPosition(-this.width+1,0)):(s.setPath((new CAAT.PathUtil.Path).setLinear(0,0,-this.width+1,0)),this.setPosition(0,0));break;case CAAT.Foundation.Actor.ANCHOR_RIGHT:r?(s.setPath((new CAAT.PathUtil.Path).setLinear(this.width-1,0,0,0)),this.setPosition(this.width-1,0)):(s.setPath((new CAAT.PathUtil.Path).setLinear(0,0,this.width-1,0)),this.setPosition(0,0))}t&&this.createAlphaBehaviour(e,r),this.easeContainerBehaviour.addBehavior(s),this.easeContainerBehaviour.setFrameTime(this.time,e),this.easeContainerBehaviour.addListener(this),this.emptyBehaviorList(),CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},easeScaleIn:function(e,t,n,r,i){this.easeScale(e,t,n,r,!0,i),this.easeIn=!0},easeScaleOut:function(e,t,n,r,i){this.easeScale(e,t,n,r,!1,i),this.easeIn=!1},easeScale:function(e,t,n,r,i,s){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior;var o=0,u=0,a=0,f=0;switch(r){case CAAT.Foundation.Actor.ANCHOR_TOP_LEFT:case CAAT.Foundation.Actor.ANCHOR_TOP_RIGHT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_LEFT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_RIGHT:case CAAT.Foundation.Actor.ANCHOR_CENTER:a=1,f=1;break;case CAAT.Foundation.Actor.ANCHOR_TOP:case CAAT.Foundation.Actor.ANCHOR_BOTTOM:o=1,a=1,u=0,f=1;break;case CAAT.Foundation.Actor.ANCHOR_LEFT:case CAAT.Foundation.Actor.ANCHOR_RIGHT:u=1,f=1,o=0,a=1;break;default:alert("scale anchor ?? "+r)}if(!i){var l;l=o,o=a,a=l,l=u,u=f,f=l}n&&this.createAlphaBehaviour(t,i);var c=this.getAnchorPercent(r),h=(new CAAT.Behavior.ScaleBehavior).setFrameTime(e,t).setValues(o,a,u,f,c.x,c.y);s&&h.setInterpolator(s),this.easeContainerBehaviour.addBehavior(h),this.easeContainerBehaviour.setFrameTime(this.time,t),this.easeContainerBehaviour.addListener(this),this.emptyBehaviorList(),CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},addBehavior:function(e){return this},easeRotationIn:function(e,t,n,r){this.easeRotation(e,t,n,!0,r),this.easeIn=!0},easeRotationOut:function(e,t,n,r){this.easeRotation(e,t,n,!1,r),this.easeIn=!1},easeRotation:function(e,t,n,r,i){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior;var s=0,o=0;n==CAAT.Foundation.Actor.ANCHOR_CENTER&&(n=CAAT.Foundation.Actor.ANCHOR_TOP);switch(n){case CAAT.Foundation.Actor.ANCHOR_TOP:case CAAT.Foundation.Actor.ANCHOR_BOTTOM:case CAAT.Foundation.Actor.ANCHOR_LEFT:case CAAT.Foundation.Actor.ANCHOR_RIGHT:s=Math.PI*(Math.random()<.5?1:-1);break;case CAAT.Foundation.Actor.ANCHOR_TOP_LEFT:case CAAT.Foundation.Actor.ANCHOR_TOP_RIGHT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_LEFT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_RIGHT:s=Math.PI/2*(Math.random()<.5?1:-1);break;default:alert("rot anchor ?? "+n)}if(!1===r){var u=s;s=o,o=u}t&&this.createAlphaBehaviour(e,r);var a=this.getAnchorPercent(n),f=(new CAAT.Behavior.RotateBehavior).setFrameTime(0,e).setValues(s,o,a.x,a.y);i&&f.setInterpolator(i),this.easeContainerBehaviour.addBehavior(f),this.easeContainerBehaviour.setFrameTime(this.time,e),this.easeContainerBehaviour.addListener(this),this.emptyBehaviorList(),CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},setEaseListener:function(e){this.easeContainerBehaviourListener=e},behaviorExpired:function(e){this.easeContainerBehaviourListener.easeEnd(this,this.easeIn)},activated:function(){},setExpired:function(e){this.expired=e},paint:function(e,t){if(this.fillStyle){var n=e.ctx;n.fillStyle=this.fillStyle,n.fillRect(0,0,this.width,this.height)}},findActorAtPosition:function(e){var t,n,r=new CAAT.Math.Point;if(this.inputList){var i=this.inputList;for(t=0;t<i.length;t++){var s=i[t];for(n=0;n<s.length;n++)if(s[n].visible){r.set(e.x,e.y);var o=s[n].worldModelViewMatrix.getInverse();o.transformCoord(r);if(s[n].contains(r.x,r.y))return s[n]}}}return r.set(e.x,e.y),CAAT.Foundation.Scene.superclass.findActorAtPosition.call(this,r)},enableInputList:function(e){this.inputList=[];for(var t=0;t<e;t++)this.inputList.push([]);return this},addActorToInputList:function(e,t,n){t<0?t=0:t>=this.inputList.length&&(t=this.inputList.length-1);var r=this.inputList[t];return typeof n=="undefined"||n>=r.length?r.push(e):n<=0?r.unshift(e):r.splice(n,0,e),this},emptyInputList:function(e){return e<0?e=0:e>=this.inputList.length&&(e=this.inputList.length-1),this.inputList[e]=[],this},removeActorFromInputList:function(e,t){if(typeof t=="undefined"){var n,r;for(n=0;n<this.inputList.length;n++){var i=this.inputList[n];for(r=0;r<i.length;r++)i[r]==e&&i.splice(r,1)}return this}t<0?t=0:t>=this.inputList.length&&(t=this.inputList.length-1);var i=this.inputList[t];for(r=0;r<i.length;r++)i[r]==e&&i.splice(r,1);return this},getIn:function(e){},goOut:function(e){}}}}),CAAT.Module({defines:"CAAT.Foundation.Director",aliases:["CAAT.Director"],extendsClass:"CAAT.Foundation.ActorContainer",depends:["CAAT.Core.Class","CAAT.Core.Constants","CAAT.Foundation.ActorContainer","CAAT.Module.Audio.AudioManager","CAAT.Module.Runtime.BrowserInfo","CAAT.Module.Debug.Debug","CAAT.Math.Point","CAAT.Math.Rectangle","CAAT.Math.Matrix","CAAT.Foundation.Timer.TimerManager","CAAT.Foundation.Actor","CAAT.Foundation.Scene","CAAT.Event.AnimationLoop","CAAT.Event.Input","CAAT.Event.KeyEvent","CAAT.Event.MouseEvent","CAAT.Event.TouchEvent","CAAT.WebGL.Program","CAAT.WebGL.ColorProgram","CAAT.WebGL.TextureProgram","CAAT.WebGL.GLU","CAAT.Module.TexturePacker.TexturePageManager"],constants:{RENDER_MODE_CONTINUOUS:1,RENDER_MODE_DIRTY:2,CLEAR_DIRTY_RECTS:1,CLEAR_ALL:!0,CLEAR_NONE:!1,RESIZE_NONE:1,RESIZE_WIDTH:2,RESIZE_HEIGHT:4,RESIZE_BOTH:8,RESIZE_PROPORTIONAL:16},extendsWith:function(){return{__init:function(){this.__super(),this.browserInfo=CAAT.Module.Runtime.BrowserInfo,this.audioManager=(new CAAT.Module.Audio.AudioManager).initialize(8),this.scenes=[],this.imagesCache=[],this.mousePoint=new CAAT.Math.Point(0,0,0),this.prevMousePoint=new CAAT.Math.Point(0,0,0),this.screenMousePoint=new CAAT.Math.Point(0,0,0),this.isMouseDown=!1,this.lastSelectedActor=null,this.dragging=!1,this.cDirtyRects=[],this.sDirtyRects=[],this.dirtyRects=[];for(var e=0;e<64;e++)this.dirtyRects.push(new CAAT.Math.Rectangle);return this.dirtyRectsIndex=0,this.touches={},this.timerManager=new CAAT.Foundation.Timer.TimerManager,this.__map={},this},debug:!1,renderMode:CAAT.Foundation.Director.RENDER_MODE_CONTINUOUS,onRenderStart:null,onRenderEnd:null,mousePoint:null,prevMousePoint:null,screenMousePoint:null,isMouseDown:!1,lastSelectedActor:null,dragging:!1,scenes:null,currentScene:null,canvas:null,ctx:null,time:0,timeline:0,imagesCache:null,audioManager:null,clear:CAAT.Foundation.Director.CLEAR_ALL,transitionScene:null,browserInfo:null,gl:null,glEnabled:!1,glTextureManager:null,glTtextureProgram:null,glColorProgram:null,pMatrix:null,coords:null,coordsIndex:0,uv:null,uvIndex:0,front_to_back:!1,statistics:{size_total:0,size_active:0,size_dirtyRects:0,draws:0,size_discarded_by_dirty_rects:0},currentTexturePage:0,currentOpacity:1,intervalId:null,frameCounter:0,resize:1,onResizeCallback:null,__gestureScale:0,__gestureRotation:0,dirtyRects:null,cDirtyRects:null,sDirtyRects:null,dirtyRectsIndex:0,dirtyRectsEnabled:!1,nDirtyRects:0,drDiscarded:0,stopped:!1,needsRepaint:!1,touches:null,timerManager:null,SCREEN_RATIO:1,__map:null,clean:function(){return this.scenes=null,this.currentScene=null,this.imagesCache=null,this.audioManager=null,this.isMouseDown=!1,this.lastSelectedActor=null,this.dragging=!1,this.__gestureScale=0,this.__gestureRotation=0,this.dirty=!0,this.dirtyRects=null,this.cDirtyRects=null,this.dirtyRectsIndex=0,this.dirtyRectsEnabled=!1,this.nDirtyRects=0,this.onResizeCallback=null,this.__map={},this},cancelPlay:function(e){return this.audioManager.cancelPlay(e)},cancelPlayByChannel:function(e){return this.audioManager.cancelPlayByChannel(e)},setValueForKey:function(e,t){return this.__map[e]=t,this},getValueForKey:function(e){return this.__map[e]},createTimer:function(e,t,n,r,i){return this.timerManager.createTimer(e,t,n,r,i,this)},requestRepaint:function(){this.needsRepaint=!0},getCurrentScene:function(){return this.currentScene},checkDebug:function(){if(!navigator.isCocoonJS&&CAAT.DEBUG){var e=(new CAAT.Module.Debug.Debug).initialize(this.width,60);this.debugInfo=e.debugInfo.bind(e)}},getRenderType:function(){return this.glEnabled?"WEBGL":"CANVAS"},windowResized:function(e,t){var n=CAAT.Foundation.Director;switch(this.resize){case n.RESIZE_WIDTH:this.setBounds(0,0,e,this.height);break;case n.RESIZE_HEIGHT:this.setBounds(0,0,this.width,t);break;case n.RESIZE_BOTH:this.setBounds(0,0,e,t);break;case n.RESIZE_PROPORTIONAL:this.setScaleProportional(e,t)}this.glEnabled&&this.glReset(),this.onResizeCallback&&this.onResizeCallback(this,e,t)},setScaleProportional:function(e,t){var n=Math.min(e/this.referenceWidth,t/this.referenceHeight);this.canvas.width=this.referenceWidth*n,this.canvas.height=this.referenceHeight*n,this.ctx=this.canvas.getContext(this.glEnabled?"experimental-webgl":"2d"),this.__setupRetina(),this.setScaleAnchored(n*this.scaleX,n*this.scaleY,0,0),this.glEnabled&&this.glReset()},enableResizeEvents:function(e,t){var n=CAAT.Foundation.Director;return e===n.RESIZE_BOTH||e===n.RESIZE_WIDTH||e===n.RESIZE_HEIGHT||e===n.RESIZE_PROPORTIONAL?(this.referenceWidth=this.width,this.referenceHeight=this.height,this.resize=e,CAAT.registerResizeListener(this),this.onResizeCallback=t,this.windowResized(window.innerWidth,window.innerHeight)):(CAAT.unregisterResizeListener(this),this.onResizeCallback=null),this},__setupRetina:function(){if(CAAT.RETINA_DISPLAY_ENABLED){var e=CAAT.Module.Runtime.BrowserInfo.DevicePixelRatio,t=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,n=e/t;if(e!==t){var r=this.canvas.width,i=this.canvas.height;this.canvas.width=r*n,this.canvas.height=i*n,this.canvas.style.width=r+"px",this.canvas.style.height=i+"px",this.setScaleAnchored(n,n,0,0)}else this.setScaleAnchored(1,1,0,0);this.SCREEN_RATIO=n}else this.setScaleAnchored(1,1,0,0);for(var s=0;s<this.scenes.length;s++)this.scenes[s].setBounds(0,0,this.width,this.height)},setBounds:function(e,t,n,r){return CAAT.Foundation.Director.superclass.setBounds.call(this,e,t,n,r),this.canvas.width!==n&&(this.canvas.width=n),this.canvas.height!==r&&(this.canvas.height=r),this.ctx=this.canvas.getContext(this.glEnabled?"experimental-webgl":"2d"),this.__setupRetina(),this.glEnabled&&this.glReset(),this},initialize:function(e,t,n,r){typeof n!="undefined"&&(isString(n)?n=document.getElementById(n):n instanceof HTMLCanvasElement||console.log("Canvas is a: "+n+" ???")),n||(n=document.createElement("canvas"),document.body.appendChild(n)),this.canvas=n,typeof r=="undefined"&&(r=n),this.setBounds(0,0,e,t),this.enableEvents(r),this.timeline=(new Date).getTime();if(CAAT.CACHE_SCENE_ON_CHANGE){this.transitionScene=(new CAAT.Foundation.Scene).setBounds(0,0,e,t);var i=document.createElement("canvas");i.width=e,i.height=t;var s=(new CAAT.Foundation.Actor).setBackgroundImage(i);this.transitionScene.ctx=i.getContext("2d"),this.transitionScene.addChildImmediately(s),this.transitionScene.setEaseListener(this)}return this.checkDebug(),this},glReset:function(){this.pMatrix=CAAT.WebGL.GLU.makeOrtho(0,this.referenceWidth,this.referenceHeight,0,-1,1),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.glColorProgram.setMatrixUniform(this.pMatrix),this.glTextureProgram.setMatrixUniform(this.pMatrix),this.gl.viewportWidth=this.canvas.width,this.gl.viewportHeight=this.canvas.height},initializeGL:function(e,t,n,r){n||(n=document.createElement("canvas"),document.body.appendChild(n)),n.width=e,n.height=t,typeof r=="undefined"&&(r=n),this.referenceWidth=e,this.referenceHeight=t;var i;try{this.gl=n.getContext("experimental-webgl"),this.gl.viewportWidth=e,this.gl.viewportHeight=t,CAAT.GLRENDER=!0}catch(s){}if(!this.gl)return this.initialize(e,t,n);this.canvas=n,this.setBounds(0,0,e,t),this.enableEvents(n),this.timeline=(new Date).getTime(),this.glColorProgram=(new CAAT.WebGL.ColorProgram(this.gl)).create().initialize(),this.glTextureProgram=(new CAAT.WebGL.TextureProgram(this.gl)).create().initialize(),this.glTextureProgram.useProgram(),this.glReset();var o=512;return this.coords=new Float32Array(o*12),this.uv=new Float32Array(o*8),this.gl.clearColor(0,0,0,255),this.front_to_back?(this.gl.clearDepth(1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LESS)):this.gl.disable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.glEnabled=!0,this.checkDebug(),this},createScene:function(){var e=new CAAT.Scene;return this.addScene(e),e},setImagesCache:function(e,t,n){if(!e||!e.length)return this;var r;null!==this.glTextureManager&&(this.glTextureManager.deletePages(),this.glTextureManager=null);if(this.imagesCache){var i=[];for(r=0;r<this.imagesCache.length;r++)i.push(this.imagesCache[r].id);for(r=0;r<i.length;r++)delete this.imagesCache[i[r]]}this.imagesCache=e;if(e)for(r=0;r<e.length;r++)this.imagesCache[e[r].id]=e[r].image;return this.tpW=t||2048,this.tpH=n||2048,this.updateGLPages(),this},updateGLPages:function(){this.glEnabled&&(this.glTextureManager=new CAAT.Module.TexturePacker.TexturePageManager,this.glTextureManager.createPages(this.gl,this.tpW,this.tpH,this.imagesCache),this.currentTexturePage=this.glTextureManager.pages[0],this.glTextureProgram.setTexture(this.currentTexturePage.texture))},setGLTexturePage:function(e){return this.currentTexturePage=e,this.glTextureProgram.setTexture(e.texture),this},addImage:function(e,t,n){if(this.getImage(e)){for(var r in this.imagesCache)if(this.imagesCache[r].id===e){this.imagesCache[r].image=t;break}this.imagesCache[e]=t}else this.imagesCache.push({id:e,image:t}),this.imagesCache[e]=t;n||this.updateGLPages()},deleteImage:function(e,t){for(var n=0;n<this.imagesCache.length;n++)if(this.imagesCache[n].id===e){delete this.imagesCache[e],this.imagesCache.splice(n,1);break}t||this.updateGLPages()},setGLCurrentOpacity:function(e){this.currentOpacity=e,this.glTextureProgram.setAlpha(e)},glRender:function(e,t,n){e=e||this.coords,n=n||this.uv,t=t||this.coordsIndex;var r=this.gl,i=t/12*2,s=t/3;this.glTextureProgram.updateVertexBuffer(e),this.glTextureProgram.updateUVBuffer(n),r.drawElements(r.TRIANGLES,3*i,r.UNSIGNED_SHORT,0)},glFlush:function(){this.coordsIndex!==0&&this.glRender(this.coords,this.coordsIndex,this.uv),this.coordsIndex=0,this.uvIndex=0,this.statistics.draws++},findActorAtPosition:function(e){var t=this.childrenList;for(var n=t.length-1;n>=0;n--){var r=this.childrenList[n],i=new CAAT.Math.Point(e.x,e.y,0),s=r.findActorAtPosition(i);if(null!==s)return s}return this},resetStats:function(){this.statistics.size_total=0,this.statistics.size_active=0,this.statistics.draws=0,this.statistics.size_discarded_by_dirty_rects=0},render:function(e){if(this.currentScene&&this.currentScene.isPaused())return;this.time+=e;for(i=0,l=this.childrenList.length;i<l;i++){var t=this.childrenList[i];if(t.isInAnimationFrame(this.time)&&!t.isPaused()){var n=t.time-t.start_time;t.timerManager.checkTimers(n),t.timerManager.removeExpiredTimers()}}this.animate(this,this.time),!navigator.isCocoonJS&&CAAT.DEBUG&&this.resetStats();var r=this.childrenList.length,i,n,t,s=this.ctx;if(this.glEnabled){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.coordsIndex=0,this.uvIndex=0;for(i=0;i<r;i++)t=this.childrenList[i],t.isInAnimationFrame(this.time)&&(n=t.time-t.start_time,t.onRenderStart&&t.onRenderStart(n),t.paintActorGL(this,n),t.onRenderEnd&&t.onRenderEnd(n),t.isPaused()||(t.time+=e),!navigator.isCocoonJS&&CAAT.DEBUG&&(this.statistics.size_total+=t.size_total,this.statistics.size_active+=t.size_active));this.glFlush()}else{s.globalAlpha=1,s.globalCompositeOperation="source-over",s.save();if(this.dirtyRectsEnabled){this.modelViewMatrix.transformRenderingContext(s);if(!CAAT.DEBUG_DIRTYRECTS){s.beginPath(),this.nDirtyRects=0;var o=this.cDirtyRects;for(i=0;i<o.length;i++){var u=o[i];u.isEmpty()||(s.rect(u.x|0,u.y|0,1+(u.width|0),1+(u.height|0)),this.nDirtyRects++)}s.clip()}else s.clearRect(0,0,this.canvas.width,this.canvas.height)}else this.clear===CAAT.Foundation.Director.CLEAR_ALL&&s.clearRect(0,0,this.canvas.width,this.canvas.height);for(i=0;i<r;i++)t=this.childrenList[i],t.isInAnimationFrame(this.time)&&(n=t.time-t.start_time,s.save(),t.onRenderStart&&t.onRenderStart(n),!CAAT.DEBUG_DIRTYRECTS&&this.dirtyRectsEnabled?this.nDirtyRects&&t.paintActor(this,n):t.paintActor(this,n),t.onRenderEnd&&t.onRenderEnd(n),s.restore(),CAAT.DEBUGAABB&&(s.globalAlpha=1,s.globalCompositeOperation="source-over",this.modelViewMatrix.transformRenderingContextSet(s),t.drawScreenBoundingBox(this,n)),t.isPaused()||(t.time+=e),!navigator.isCocoonJS&&CAAT.DEBUG&&(this.statistics.size_total+=t.size_total,this.statistics.size_active+=t.size_active,this.statistics.size_dirtyRects=this.nDirtyRects));if(this.nDirtyRects>0&&!navigator.isCocoonJS&&CAAT.DEBUG&&CAAT.DEBUG_DIRTYRECTS){s.beginPath(),this.nDirtyRects=0;var o=this.cDirtyRects;for(i=0;i<o.length;i++){var u=o[i];u.isEmpty()||(s.rect(u.x|0,u.y|0,1+(u.width|0),1+(u.height|0)),this.nDirtyRects++)}s.clip(),s.fillStyle="rgba(160,255,150,.4)",s.fillRect(0,0,this.canvas.width,this.canvas.height)}s.restore()}this.frameCounter++},inDirtyRect:function(e){if(!this.dirtyRectsEnabled||CAAT.DEBUG_DIRTYRECTS)return!0;var t=this.cDirtyRects,n,r=e.AABB;for(n=0;n<t.length;n++)if(t[n].intersects(r))return!0;return this.statistics.size_discarded_by_dirty_rects+=e.size_total,!1},animate:function(e,t){this.timerManager.checkTimers(t),this.setModelViewMatrix(this),this.modelViewMatrixI=this.modelViewMatrix.getInverse(),this.setScreenBounds(),this.dirty=!1,this.invalid=!1,this.dirtyRectsIndex=-1,this.cDirtyRects=[];var n=this.childrenList,r,i,s;if(this.dirtyRectsEnabled){var o=this.sDirtyRects;if(o.length){for(i=0,s=o.length;i<s;i++)this.addDirtyRect(o[i]);this.sDirtyRects=[]}}for(i=0;i<n.length;i++){r=n[i];var u=r.time-r.start_time;r.animate(this,u)}return this.timerManager.removeExpiredTimers(),this},scheduleDirtyRect:function(e){this.sDirtyRects.push(e)},addDirtyRect:function(e){if(e.isEmpty())return;var t,n,r,i,s=this.cDirtyRects;for(t=0;t<s.length;t++){n=s[t];if(!n.isEmpty()&&n.intersects(e)){var o=!0;while(o){n.unionRectangle(e);for(r=0;r<s.length;r++)if(r!==t){i=s[r];if(!i.isEmpty()&&i.intersects(n)){n.unionRectangle(i),i.setEmpty();break}}r==s.length&&(o=!1)}for(r=0;r<s.length;r++)s[r].isEmpty()&&s.splice(r,1);return}}this.dirtyRectsIndex++;if(this.dirtyRectsIndex>=this.dirtyRects.length)for(t=0;t<32;t++)this.dirtyRects.push(new CAAT.Math.Rectangle);var u=this.dirtyRects[this.dirtyRectsIndex];u.x=e.x,u.y=e.y,u.x1=e.x1,u.y1=e.y1,u.width=e.width,u.height=e.height,this.cDirtyRects.push(u)},renderToContext:function(e,t){if(t.isInAnimationFrame(this.time)){e.setTransform(1,0,0,1,0,0),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.clearRect(0,0,this.width,this.height);var n=this.ctx;this.ctx=e,e.save();var r=this.modelViewMatrix,i=this.worldModelViewMatrix;this.worldModelViewMatrix=new CAAT.Math.Matrix,this.modelViewMatrix=this.worldModelViewMatrix,this.wdirty=!0,t.animate(this,t.time),t.onRenderStart&&t.onRenderStart(t.time),t.paintActor(this,t.time),t.onRenderEnd&&t.onRenderEnd(t.time),this.worldModelViewMatrix=i,this.modelViewMatrix=r,e.restore(),this.ctx=n}},addScene:function(e){e.setBounds(0,0,this.width,this.height),this.scenes.push(e),e.setEaseListener(this),null===this.currentScene&&this.setScene(0)},getNumScenes:function(){return this.scenes.length},easeInOut:function(e,t,n,r,i,s,o,u,a,f){if(e===this.getCurrentSceneIndex())return;var l=this.scenes[e],c=this.scenes[r];!CAAT.__CSS__&&CAAT.CACHE_SCENE_ON_CHANGE&&(this.renderToContext(this.transitionScene.ctx,c),c=this.transitionScene),l.setExpired(!1),c.setExpired(!1),l.mouseEnabled=!1,c.mouseEnabled=!1,l.resetTransform(),c.resetTransform(),l.setLocation(0,0),c.setLocation(0,0),l.alpha=1,c.alpha=1,t===CAAT.Foundation.Scene.EASE_ROTATION?l.easeRotationIn(o,u,n,a):t===CAAT.Foundation.Scene.EASE_SCALE?l.easeScaleIn(0,o,u,n,a):l.easeTranslationIn(o,u,n,a),i===CAAT.Foundation.Scene.EASE_ROTATION?c.easeRotationOut(o,u,s,f):i===CAAT.Foundation.Scene.EASE_SCALE?c.easeScaleOut(0,o,u,s,f):c.easeTranslationOut(o,u,s,f),this.childrenList=[],c.goOut(l),l.getIn(c),this.addChild(c),this.addChild(l)},easeInOutRandom:function(e,t,n,r){var i=Math.random(),s=Math.random(),o,u;i<.33?(o=CAAT.Foundation.Scene.EASE_ROTATION,u=(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4)):i<.66?(o=CAAT.Foundation.Scene.EASE_SCALE,u=(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,.4)):(o=CAAT.Foundation.Scene.EASE_TRANSLATE,u=(new CAAT.Behavior.Interpolator).createBounceOutInterpolator());var a,f;s<.33?(a=CAAT.Foundation.Scene.EASE_ROTATION,f=(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4)):s<.66?(a=CAAT.Foundation.Scene.EASE_SCALE,f=(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(4)):(a=CAAT.Foundation.Scene.EASE_TRANSLATE,f=(new CAAT.Behavior.Interpolator).createBounceOutInterpolator()),this.easeInOut(e,o,Math.random()*8.99>>0,t,a,Math.random()*8.99>>0,n,r,u,f)},easeIn:function(e,t,n,r,i,s){var o=this.scenes[e];t===CAAT.Foundation.Scene.EASE_ROTATION?o.easeRotationIn(n,r,i,s):t===CAAT.Foundation.Scene.EASE_SCALE?o.easeScaleIn(0,n,r,i,s):o.easeTranslationIn(n,r,i,s),this.childrenList=[],this.addChild(o),o.resetTransform(),o.setLocation(0,0),o.alpha=1,o.mouseEnabled=!1,o.setExpired(!1)},setScene:function(e){var t=this.scenes[e];this.childrenList=[],this.addChild(t),this.currentScene=t,t.setExpired(!1),t.mouseEnabled=!0,t.resetTransform(),t.setLocation(0,0),t.alpha=1,t.getIn(),t.activated()},switchToScene:function(e,t,n,r){var i=this.getSceneIndex(this.currentScene);r?this.easeInOutRandom(e,i,t,n):this.setScene(e)},switchToPrevScene:function(e,t,n){var r=this.getSceneIndex(this.currentScene);if(this.getNumScenes()<=1||r===0)return;n?this.easeInOutRandom(r-1,r,e,t):this.setScene(r-1)},switchToNextScene:function(e,t,n){var r=this.getSceneIndex(this.currentScene);if(this.getNumScenes()<=1||r===this.getNumScenes()-1)return;n?this.easeInOutRandom(r+1,r,e,t):this.setScene(r+1)},mouseEnter:function(e){},mouseExit:function(e){},mouseMove:function(e){},mouseDown:function(e){},mouseUp:function(e){},mouseDrag:function(e){},easeEnd:function(e,t){t?(this.currentScene=e,this.currentScene.activated()):e.setExpired(!0),e.mouseEnabled=!0,e.emptyBehaviorList()},getSceneIndex:function(e){for(var t=0;t<this.scenes.length;t++)if(this.scenes[t]===e)return t;return-1},getScene:function(e){return this.scenes[e]},getSceneById:function(e){for(var t=0;t<this.scenes.length;t++)if(this.scenes[t].id===e)return this.scenes[t];return null},getCurrentSceneIndex:function(){return this.getSceneIndex(this.currentScene)},getBrowserName:function(){return this.browserInfo.browser},getBrowserVersion:function(){return this.browserInfo.version},getOSName:function(){return this.browserInfo.OS},getImage:function(e){var t=this.imagesCache[e];if(t)return t;for(var n in this.imagesCache)if(this.imagesCache[n].id===e)return this.imagesCache[n].image;return null},musicPlay:function(e){return this.audioManager.playMusic(e)},musicStop:function(){this.audioManager.stopMusic()},addAudio:function(e,t){return this.audioManager.addAudio(e,t),this},audioPlay:function(e){return this.audioManager.play(e)},audioLoop:function(e){return this.audioManager.loop(e)},endSound:function(){return this.audioManager.endSound()},setSoundEffectsEnabled:function(e){return this.audioManager.setSoundEffectsEnabled(e)},setMusicEnabled:function(e){return this.audioManager.setMusicEnabled(e)},isMusicEnabled:function(){return this.audioManager.isMusicEnabled()},isSoundEffectsEnabled:function(){return this.audioManager.isSoundEffectsEnabled()},setVolume:function(e,t){return this.audioManager.setVolume(e,t)},emptyScenes:function(){this.scenes=[]},addChild:function(e){e.parent=this,this.childrenList.push(e)},loop:function(e,t,n){n?(this.onRenderStart=t,this.onRenderEnd=n):t&&(this.onRenderEnd=t),CAAT.loop()},renderFrame:function(){CAAT.currentDirector=this;if(this.stopped)return;var e=(new Date).getTime(),t=e-this.timeline;t>500&&(t=500),this.onRenderStart&&this.onRenderStart(t),this.render(t),this.debugInfo&&this.debugInfo(this.statistics),this.timeline=e,this.onRenderEnd&&this.onRenderEnd(t),this.needsRepaint=!1},resetTimeline:function(){this.timeline=(new Date).getTime()},endLoop:function(){},setClear:function(e){return this.clear=e,this.clear===CAAT.Foundation.Director.CLEAR_DIRTY_RECTS?this.dirtyRectsEnabled=!0:this.dirtyRectsEnabled=!1,this},getAudioManager:function(){return this.audioManager},cumulateOffset:function(e,t,n){var r=n+"Left",i=n+"Top",s=0,o=0,u;while(navigator.browser!=="iOS"&&e&&e.style){e.currentStyle?u=e.currentStyle.position:(u=(e.ownerDocument.defaultView||e.ownerDocument.parentWindow).getComputedStyle(e,null),u=u?u.getPropertyValue("position"):null);if(!!/^(fixed)$/.test(u))break;s+=e[r],o+=e[i],e=e[t]}return{x:s,y:o,style:u}},getOffset:function(e){var t=this.cumulateOffset(e,"offsetParent","offset");if(t.style==="fixed"){var n=this.cumulateOffset(e,e.parentNode?"parentNode":"parentElement","scroll");return{x:t.x+n.x,y:t.y+n.y}}return{x:t.x,y:t.y}},getCanvasCoord:function(e,t){var n=new CAAT.Math.Point,r=0,i=0;t||(t=window.event);if(t.pageX||t.pageY)r=t.pageX,i=t.pageY;else if(t.clientX||t.clientY)r=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=t.clientY+document.body.scrollTop+document.documentElement.scrollTop;var s=this.getOffset(this.canvas);r-=s.x,i-=s.y,r*=this.SCREEN_RATIO,i*=this.SCREEN_RATIO,n.x=r,n.y=i,this.modelViewMatrixI||(this.modelViewMatrixI=this.modelViewMatrix.getInverse()),this.modelViewMatrixI.transformCoord(n),r=n.x,i=n.y,e.set(r,i),this.screenMousePoint.set(r,i)},__mouseDownHandler:function(e){if(this.dragging&&this.lastSelectedActor){this.__mouseUpHandler(e);return}this.getCanvasCoord(this.mousePoint,e),this.isMouseDown=!0;var t=this.findActorAtPosition(this.mousePoint);if(null!==t){var n=t.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));t.mouseDown((new CAAT.Event.MouseEvent).init(n.x,n.y,e,t,new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y)))}this.lastSelectedActor=t},__mouseUpHandler:function(e){this.isMouseDown=!1,this.getCanvasCoord(this.mousePoint,e);var t=null,n=this.lastSelectedActor;null!==n&&(t=n.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),n.actionPerformed&&n.contains(t.x,t.y)&&n.actionPerformed(e),n.mouseUp((new CAAT.Event.MouseEvent).init(t.x,t.y,e,n,this.screenMousePoint,this.currentScene.time))),!this.dragging&&null!==n&&n.contains(t.x,t.y)&&n.mouseClick((new CAAT.Event.MouseEvent).init(t.x,t.y,e,n,this.screenMousePoint,this.currentScene.time)),this.dragging=!1,this.in_=!1},__mouseMoveHandler:function(e){var t,n,r=this.currentScene?this.currentScene.time:0;if(this.isMouseDown&&null!==this.lastSelectedActor){t=this.lastSelectedActor,n=t.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));if(!this.dragging&&Math.abs(this.prevMousePoint.x-n.x)<CAAT.DRAG_THRESHOLD_X&&Math.abs(this.prevMousePoint.y-n.y)<CAAT.DRAG_THRESHOLD_Y)return;this.dragging=!0;var i=t.x,s=t.y;t.mouseDrag((new CAAT.Event.MouseEvent).init(n.x,n.y,e,t,new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y),r)),this.prevMousePoint.x=n.x,this.prevMousePoint.y=n.y;if(i===t.x&&s===t.y){var o=t.contains(n.x,n.y);this.in_&&!o&&(t.mouseExit((new CAAT.Event.MouseEvent).init(n.x,n.y,e,t,this.screenMousePoint,r)),this.in_=!1),!this.in_&&o&&(t.mouseEnter((new CAAT.Event.MouseEvent).init(n.x,n.y,e,t,this.screenMousePoint,r)),this.in_=!0)}return}this.in_=!0,t=this.findActorAtPosition(this.mousePoint),t!==this.lastSelectedActor&&(null!==this.lastSelectedActor&&(n=this.lastSelectedActor.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),this.lastSelectedActor.mouseExit((new CAAT.Event.MouseEvent).init(n.x,n.y,e,this.lastSelectedActor,this.screenMousePoint,r))),null!==t&&(n=t.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),t.mouseEnter((new CAAT.Event.MouseEvent).init(n.x,n.y,e,t,this.screenMousePoint,r)))),n=t.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),null!==t&&t.mouseMove((new CAAT.Event.MouseEvent).init(n.x,n.y,e,t,this.screenMousePoint,r)),this.prevMousePoint.x=n.x,this.prevMousePoint.y=n.y,this.lastSelectedActor=t},__mouseOutHandler:function(e){if(this.dragging)return;if(null!==this.lastSelectedActor){this.getCanvasCoord(this.mousePoint,e);var t=new CAAT.Math.Point(this.mousePoint.x,this.mousePoint.y,0);this.lastSelectedActor.viewToModel(t);var n=(new CAAT.Event.MouseEvent).init(t.x,t.y,e,this.lastSelectedActor,this.screenMousePoint,this.currentScene.time);this.lastSelectedActor.mouseExit(n),this.lastSelectedActor.mouseOut(n),this.dragging||(this.lastSelectedActor=null)}else this.isMouseDown=!1,this.in_=!1},__mouseOverHandler:function(e){if(this.dragging)return;var t,n,r;null==this.lastSelectedActor?(t=this.findActorAtPosition(this.mousePoint),null!==t&&(n=t.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),r=(new CAAT.Event.MouseEvent).init(n.x,n.y,e,t,this.screenMousePoint,this.currentScene?this.currentScene.time:0),t.mouseOver(r),t.mouseEnter(r)),this.lastSelectedActor=t):(t=this.lastSelectedActor,n=t.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),r=(new CAAT.Event.MouseEvent).init(n.x,n.y,e,t,this.screenMousePoint,this.currentScene.time),t.mouseOver(r),t.mouseEnter(r))},__mouseDBLClickHandler:function(e){this.getCanvasCoord(this.mousePoint,e),null!==this.lastSelectedActor&&this.lastSelectedActor.mouseDblClick((new CAAT.Event.MouseEvent).init(this.mousePoint.x,this.mousePoint.y,e,this.lastSelectedActor,this.screenMousePoint,this.currentScene.time))},__touchStartHandler:function(e){if(e.target===this.canvas){e.preventDefault(),e.returnValue=!1,e=e.targetTouches[0];var t=this.mousePoint;this.getCanvasCoord(t,e);if(t.x<0||t.y<0||t.x>=this.width||t.y>=this.height)return;this.touching=!0,this.__mouseDownHandler(e)}},__touchEndHandler:function(e){if(this.touching){e.preventDefault(),e.returnValue=!1,e=e.changedTouches[0];var t=this.mousePoint;this.getCanvasCoord(t,e),this.touching=!1,this.__mouseUpHandler(e)}},__touchMoveHandler:function(e){if(this.touching){e.preventDefault(),e.returnValue=!1;if(this.gesturing)return;for(var t=0;t<e.targetTouches.length;t++){var n=e.targetTouches[t],r=this.mousePoint;this.getCanvasCoord(r,n),this.__mouseMoveHandler(n)}}},__gestureStart:function(e,t){this.gesturing=!0,this.__gestureRotation=this.lastSelectedActor.rotationAngle,this.__gestureSX=this.lastSelectedActor.scaleX-1,this.__gestureSY=this.lastSelectedActor.scaleY-1},__gestureChange:function(e,t){if(typeof e=="undefined"||typeof t=="undefined")return;this.lastSelectedActor!==null&&this.lastSelectedActor.isGestureEnabled()&&(this.lastSelectedActor.setRotation(t*Math.PI/180+this.__gestureRotation),this.lastSelectedActor.setScale(this.__gestureSX+e,this.__gestureSY+e))},__gestureEnd:function(e,t){this.gesturing=!1,this.__gestureRotation=0,this.__gestureScale=0},__touchEndHandlerMT:function(e){e.preventDefault(),e.returnValue=!1;var t,n,r=[];for(t=0;t<e.changedTouches.length;t++){var i=e.changedTouches[t],s=i.identifier;r.push(s)}var o={};for(t=0;t<r.length;t++){var u=r[t];if(this.touches[u]){var a=this.touches[u].actor;o[a.id]||(o[a.id]={actor:a,touch:(new CAAT.Event.TouchEvent).init(e,a,this.currentScene.time)});var f=o[a.id].touch;f.addChangedTouch(this.touches[u].touch)}}for(t=0;t<e.changedTouches.length;t++){var l=e.changedTouches[t],s=l.identifier;delete this.touches[s]}for(var c in o){var h=o[c],a=h.actor,l=h.touch;for(var p in this.touches){var d=this.touches[p];d.actor.id===a.id&&l.addTouch(d.touch)}a.touchEnd(l)}},__touchMoveHandlerMT:function(e){e.preventDefault(),e.returnValue=!1;var t,n=[];for(t=0;t<e.changedTouches.length;t++){var r=e.changedTouches[t],i=r.identifier;if(this.touches[i]){var s=this.mousePoint;this.getCanvasCoord(s,r);var o=this.touches[i].actor;s=o.viewToModel(s),this.touches[i]={actor:o,touch:new CAAT.Event.TouchInfo(i,s.x,s.y,o)},n.push(i)}}var u={};for(t=0;t<n.length;t++){var a=n[t],o=this.touches[a].actor;u[o.id]||(u[o.id]={actor:o,touch:(new CAAT.Event.TouchEvent).init(e,o,this.currentScene.time)});var f=u[o.id].touch;f.addTouch(this.touches[a].touch),f.addChangedTouch(this.touches[a].touch)}for(var l in u){var c=u[l],o=c.actor,r=c.touch;for(var h in this.touches){var p=this.touches[h];p.actor.id===o.id&&r.addTouch(p.touch)}o.touchMove(r)}},__touchCancelHandleMT:function(e){this.__touchEndHandlerMT(e)},__touchStartHandlerMT:function(e){e.preventDefault(),e.returnValue=!1;var t,n=[],r=!0;for(t=0;t<e.changedTouches.length;t++){var i=e.changedTouches[t],s=i.identifier,o=this.mousePoint;this.getCanvasCoord(o,i);if(o.x<0||o.y<0||o.x>=this.width||o.y>=this.height){r=!1;continue}var u=this.findActorAtPosition(o);u!==null&&(o=u.viewToModel(o),this.touches[s]||(this.touches[s]={actor:u,touch:new CAAT.Event.TouchInfo(s,o.x,o.y,u)},n.push(s)))}var a={};for(t=0;t<n.length;t++){var f=n[t],u=this.touches[f].actor;a[u.id]||(a[u.id]={actor:u,touch:(new CAAT.Event.TouchEvent).init(e,u,this.currentScene.time)});var l=a[u.id].touch;l.addTouch(this.touches[f].touch),l.addChangedTouch(this.touches[f].touch)}for(var c in a){var h=a[c],u=h.actor,i=h.touch;for(var p in this.touches){var d=this.touches[p];d.actor.id===u.id&&i.addTouch(d.touch)}u.touchStart(i)}},__findTouchFirstActor:function(){var e=Number.MAX_VALUE,t=null;for(var n in this.touches){var r=this.touches[n];r.touch.time&&r.touch.time<e&&r.actor.isGestureEnabled()&&(t=r.actor,e=r.touch.time)}return t},__gesturedActor:null,__touchGestureStartHandleMT:function(e){var t=this.__findTouchFirstActor();t!==null&&t.isGestureEnabled()&&(this.__gesturedActor=t,this.__gestureRotation=t.rotationAngle,this.__gestureSX=t.scaleX-1,this.__gestureSY=t.scaleY-1,t.gestureStart(e.rotation*Math.PI/180,e.scale+this.__gestureSX,e.scale+this.__gestureSY))},__touchGestureEndHandleMT:function(e){null!==this.__gesturedActor&&this.__gesturedActor.isGestureEnabled()&&this.__gesturedActor.gestureEnd(e.rotation*Math.PI/180,e.scale+this.__gestureSX,e.scale+this.__gestureSY),this.__gestureRotation=0,this.__gestureScale=0},__touchGestureChangeHandleMT:function(e){this.__gesturedActor!==null&&this.__gesturedActor.isGestureEnabled()&&this.__gesturedActor.gestureChange(e.rotation*Math.PI/180,this.__gestureSX+e.scale,this.__gestureSY+e.scale)},addHandlers:function(e){var t=this;window.addEventListener("mouseup",function(e){if(t.touching){e.preventDefault(),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation();var n=t.mousePoint;t.getCanvasCoord(n,e),t.__mouseUpHandler(e),t.touching=!1}},!1),window.addEventListener("mousedown",function(n){if(n.target===e){n.preventDefault(),n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation();var r=t.mousePoint;t.getCanvasCoord(r,n);if(r.x<0||r.y<0||r.x>=t.width||r.y>=t.height)return;t.touching=!0,t.__mouseDownHandler(n)}},!1),window.addEventListener("mouseover",function(n){if(n.target===e&&!t.dragging){n.preventDefault(),n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation();var r=t.mousePoint;t.getCanvasCoord(r,n);if(r.x<0||r.y<0||r.x>=t.width||r.y>=t.height)return;t.__mouseOverHandler(n)}},!1),window.addEventListener("mouseout",function(n){if(n.target===e&&!t.dragging){n.preventDefault(),n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation();var r=t.mousePoint;t.getCanvasCoord(r,n),t.__mouseOutHandler(n)}},!1),window.addEventListener("mousemove",function(e){e.preventDefault(),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation();var n=t.mousePoint;t.getCanvasCoord(n,e);if(!t.dragging&&(n.x<0||n.y<0||n.x>=t.width||n.y>=t.height))return;t.__mouseMoveHandler(e)},!1),window.addEventListener("dblclick",function(n){if(n.target===e){n.preventDefault(),n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation();var r=t.mousePoint;t.getCanvasCoord(r,n);if(r.x<0||r.y<0||r.x>=t.width||r.y>=t.height)return;t.__mouseDBLClickHandler(n)}},!1),CAAT.TOUCH_BEHAVIOR===CAAT.TOUCH_AS_MOUSE?(e.addEventListener("touchstart",this.__touchStartHandler.bind(this),!1),e.addEventListener("touchmove",this.__touchMoveHandler.bind(this),!1),e.addEventListener("touchend",this.__touchEndHandler.bind(this),!1),e.addEventListener("gesturestart",function(n){n.target===e&&(n.preventDefault(),n.returnValue=!1,t.__gestureStart(n.scale,n.rotation))},!1),e.addEventListener("gestureend",function(n){n.target===e&&(n.preventDefault(),n.returnValue=!1,t.__gestureEnd(n.scale,n.rotation))},!1),e.addEventListener("gesturechange",function(n){n.target===e&&(n.preventDefault(),n.returnValue=!1,t.__gestureChange(n.scale,n.rotation))},!1)):CAAT.TOUCH_BEHAVIOR===CAAT.TOUCH_AS_MULTITOUCH&&(e.addEventListener("touchstart",this.__touchStartHandlerMT.bind(this),!1),e.addEventListener("touchmove",this.__touchMoveHandlerMT.bind(this),!1),e.addEventListener("touchend",this.__touchEndHandlerMT.bind(this),!1),e.addEventListener("touchcancel",this.__touchCancelHandleMT.bind(this),!1),e.addEventListener("gesturestart",this.__touchGestureStartHandleMT.bind(this),!1),e.addEventListener("gestureend",this.__touchGestureEndHandleMT.bind(this),!1),e.addEventListener("gesturechange",this.__touchGestureChangeHandleMT.bind(this),!1))},enableEvents:function(e){CAAT.RegisterDirector(this),this.in_=!1,this.createEventHandler(e)},createEventHandler:function(e){this.in_=!1,this.addHandlers(e)}}},onCreate:function(){typeof CAAT.__CSS__!="undefined"&&(CAAT.Foundation.Director.prototype.clip=!0,CAAT.Foundation.Director.prototype.glEnabled=!1,CAAT.Foundation.Director.prototype.getRenderType=function(){return"CSS"},CAAT.Foundation.Director.prototype.setScaleProportional=function(e,t){var n=Math.min(e/this.referenceWidth,t/this.referenceHeight);this.setScaleAnchored(n,n,0,0),this.eventHandler.style.width=""+this.referenceWidth+"px",this.eventHandler.style.height=""+this.referenceHeight+"px"},CAAT.Foundation.Director.prototype.setBounds=function(e,t,n,r){CAAT.Foundation.Director.superclass.setBounds.call(this,e,t,n,r);for(var i=0;i<this.scenes.length;i++)this.scenes[i].setBounds(0,0,n,r);return this.eventHandler.style.width=n+"px",this.eventHandler.style.height=r+"px",this},CAAT.Foundation.Director.prototype.initialize=function(e,t,n,r){return this.timeline=(new Date).getTime(),this.domElement=n,this.style("position","absolute"),this.style("width",""+e+"px"),this.style("height",""+t+"px"),this.style("overflow","hidden"),this.enableEvents(n),this.setBounds(0,0,e,t),this.checkDebug(),this},CAAT.Foundation.Director.prototype.render=function(e){this.time+=e,this.animate(this,e);var t,n,r;!navigator.isCocoonJS&&CAAT.DEBUG&&this.resetStats();for(t=0,n=this.childrenList.length;t<n;t++){var i=this.childrenList[t];i.isInAnimationFrame(this.time)&&!i.isPaused()&&(r=i.time-i.start_time,i.timerManager.checkTimers(r),i.timerManager.removeExpiredTimers())}for(t=0,n=this.childrenList.length;t<n;t++){var i=this.childrenList[t];i.isInAnimationFrame(this.time)&&(r=i.time-i.start_time,i.onRenderStart&&i.onRenderStart(r),i.paintActor(this,r),i.onRenderEnd&&i.onRenderEnd(r),i.isPaused()||(i.time+=e),!navigator.isCocoonJS&&CAAT.DEBUG&&(this.statistics.size_discarded_by_dirtyRects+=this.drDiscarded,this.statistics.size_total+=i.size_total,this.statistics.size_active+=i.size_active,this.statistics.size_dirtyRects=this.nDirtyRects))}this.frameCounter++},CAAT.Foundation.Director.prototype.addScene=function(e){e.setVisible(!0),e.setBounds(0,0,this.width,this.height),this.scenes.push(e),e.setEaseListener(this),null===this.currentScene&&this.setScene(0),this.domElement.appendChild(e.domElement)},CAAT.Foundation.Director.prototype.emptyScenes=function(){this.scenes=[],this.domElement.innerHTML="",this.createEventHandler()},CAAT.Foundation.Director.prototype.setClear=function(e){return this},CAAT.Foundation.Director.prototype.createEventHandler=function(){this.eventHandler=document.createElement("div"),this.domElement.appendChild(this.eventHandler),this.eventHandler.style.position="absolute",this.eventHandler.style.left="0",this.eventHandler.style.top="0",this.eventHandler.style.zIndex=999999,this.eventHandler.style.width=""+this.width+"px",this.eventHandler.style.height=""+this.height+"px",this.canvas=this.eventHandler,this.in_=!1,this.addHandlers(this.canvas)},CAAT.Foundation.Director.prototype.inDirtyRect=function(){return!0})}}),CAAT.Module({defines:"CAAT.Foundation.UI.Dock",aliases:["CAAT.Dock"],extendsClass:"CAAT.Foundation.ActorContainer",depends:["CAAT.Foundation.ActorContainer","CAAT.Behavior.GenericBehavior"],constants:{OP_LAYOUT_BOTTOM:0,OP_LAYOUT_TOP:1,OP_LAYOUT_LEFT:2,OP_LAYOUT_RIGHT:3},extendsWith:{scene:null,ttask:null,minSize:0,maxSize:0,range:2,layoutOp:0,initialize:function(e){return this.scene=e,this},setApplicationRange:function(e){return this.range=e,this},setLayoutOp:function(e){return this.layoutOp=e,this},setSizes:function(e,t){this.minSize=e,this.maxSize=t;for(var n=0;n<this.childrenList.length;n++)this.childrenList[n].width=e,this.childrenList[n].height=e;return this},layout:function(){var e,t,n=CAAT.Foundation.UI.Dock;if(this.layoutOp===n.OP_LAYOUT_BOTTOM||this.layoutOp===n.OP_LAYOUT_TOP){var r=0,i=0;for(e=0;e<this.getNumChildren();e++)r+=this.getChildAt(e).width;i=(this.width-r)/2;for(e=0;e<this.getNumChildren();e++)t=this.getChildAt(e),t.x=i,i+=t.width,this.layoutOp===n.OP_LAYOUT_BOTTOM?t.y=this.maxSize-t.height:t.y=0}else{var s=0,o=0;for(e=0;e<this.getNumChildren();e++)s+=this.getChildAt(e).height;o=(this.height-s)/2;for(e=0;e<this.getNumChildren();e++)t=this.getChildAt(e),t.y=o,o+=t.height,this.layoutOp===n.OP_LAYOUT_LEFT?t.x=0:t.x=this.width-t.width}},mouseMove:function(e){this.actorNotPointed()},mouseExit:function(e){this.actorNotPointed()},actorNotPointed:function(){var e,t=this;for(e=0;e<this.getNumChildren();e++){var n=this.getChildAt(e);n.emptyBehaviorList(),n.addBehavior((new CAAT.Behavior.GenericBehavior).setValues(n.width,this.minSize,n,"width").setFrameTime(this.scene.time,250)).addBehavior((new CAAT.Behavior.GenericBehavior).setValues(n.height,this.minSize,n,"height").setFrameTime(this.scene.time,250)),e===this.getNumChildren()-1&&n.behaviorList[0].addListener({behaviorApplied:function(e,t,n,r,i){r.parent.layout()},behaviorExpired:function(r,s,o){for(e=0;e<t.getNumChildren();e++)n=t.getChildAt(e),n.width=t.minSize,n.height=t.minSize;o.parent.layout()}})}},actorPointed:function(e,t,n){var r=this.findChild(n),i=CAAT.Foundation.UI.Dock,s=0;this.layoutOp===i.OP_LAYOUT_BOTTOM||this.layoutOp===i.OP_LAYOUT_TOP?s=e/n.width:s=t/n.height;var o;for(o=0;o<this.childrenList.length;o++){var u=this.childrenList[o];u.emptyBehaviorList();var a=0;o<r-this.range||o>r+this.range?a=this.minSize:o===r?a=this.maxSize:o<r?a=this.minSize+(this.maxSize-this.minSize)*(Math.cos((o-r-s+1)/this.range*Math.PI)+1)/2:a=this.minSize+(this.maxSize-this.minSize)*(Math.cos((o-r-s)/this.range*Math.PI)+1)/2,u.height=a,u.width=a}this.layout()},actorMouseExit:function(e){null!==this.ttask&&this.ttask.cancel();var t=this;this.ttask=this.scene.createTimer(this.scene.time,100,function(n,r,i){t.actorNotPointed()},null,null)},actorMouseEnter:function(e){null!==this.ttask&&(this.ttask.cancel(),this.ttask=null)},addChild:function(e){var t=this;return e.__Dock_mouseEnter=e.mouseEnter,e.__Dock_mouseExit=e.mouseExit,e.__Dock_mouseMove=e.mouseMove,e.mouseEnter=function(e){t.actorMouseEnter(e),this.__Dock_mouseEnter(e)},e.mouseExit=function(e){t.actorMouseExit(e),this.__Dock_mouseExit(e)},e.mouseMove=function(e){t.actorPointed(e.point.x,e.point.y,e.source),this.__Dock_mouseMove(e)},e.width=this.minSize,e.height=this.minSize,CAAT.Foundation.UI.Dock.superclass.addChild.call(this,e)}}}),CAAT.Module({defines:"CAAT.Foundation.UI.InterpolatorActor",aliases:["CAAT.InterpolatorActor"],depends:["CAAT.Foundation.Actor"],extendsClass:"CAAT.Foundation.Actor",extendsWith:{interpolator:null,contour:null,S:50,gap:5,setGap:function(e){return this.gap=e,this},setInterpolator:function(e,t){return this.interpolator=e,this.contour=e.getContour(t||this.S),this},paint:function(e,t){CAAT.InterpolatorActor.superclass.paint.call(this,e,t);if(this.backgroundImage)return this;if(this.interpolator){var n=e.ctx,r=this.width-2*this.gap,i=this.height-2*this.gap;n.beginPath(),n.moveTo(this.gap+r*this.contour[0].x,-this.gap+this.height-i*this.contour[0].y);for(var s=1;s<this.contour.length;s++)n.lineTo(this.gap+r*this.contour[s].x,-this.gap+this.height-i*this.contour[s].y);n.strokeStyle=this.strokeStyle,n.stroke()}},getInterpolator:function(){return this.interpolator}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Label",depends:["CAAT.Foundation.Actor","CAAT.Foundation.SpriteImage","CAAT.Module.Font.Font"],aliases:["CAAT.UI.Label"],extendsClass:"CAAT.Foundation.Actor",extendsWith:function(){var e=0,t=.6,n=function(e){return this.ctx=e,this};n.prototype={ctx:null,defaultFS:null,font:null,fontSize:null,fill:null,stroke:null,filled:null,stroked:null,strokeSize:null,italic:null,bold:null,alignment:null,tabSize:null,shadow:null,shadowBlur:null,shadowColor:null,sfont:null,chain:null,setDefault:function(e){this.defaultFS=24,this.font="Arial",this.fontSize=this.defaultFS,this.fill="#000",this.stroke="#f00",this.filled=!0,this.stroked=!1,this.strokeSize=1,this.italic=!1,this.bold=!1,this.alignment="left",this.tabSize=75,this.shadow=!1,this.shadowBlur=0,this.shadowColor="#000";for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);return this.__setFont(),this},setStyle:function(e){if(typeof e!="undefined")for(var t in e)this[t]=e[t];return this},applyStyle:function(){return this.__setFont(),this},clone:function(){var e=new n(this.ctx),t;for(t in this)this.hasOwnProperty(t)&&(e[t]=this[t]);var r=this;while(r.chain){r=r.chain;for(t in r)e[t]===null&&r.hasOwnProperty(t)&&(e[t]=r[t])}return e.__setFont(),e},__getProperty:function(e){var t=this,n;do{n=t[e];if(n!==null)return n;t=t.chain}while(t);return null},image:function(e){this.__setShadow(e)},text:function(e,t,n,r){this.__setShadow(e),e.font=this.__getProperty("sfont"),this.filled&&this.__fillText(e,t,n,r),this.stroked&&this.__strokeText(e,t,n,r)},__setShadow:function(e){this.__getProperty("shadow")&&(e.shadowBlur=this.__getProperty("shadowBlur"),e.shadowColor=this.__getProperty("shadowColor"))},__fillText:function(e,t,n,r){e.fillStyle=this.__getProperty("fill"),e.fillText(t,n,r)},__strokeText:function(e,t,n,r){e.strokeStyle=this.__getProperty("stroke"),e.lineWidth=this.__getProperty("strokeSize"),e.beginPath(),e.strokeText(t,n,r)},__setFont:function(){var e=this.__getProperty("italic"),t=this.__getProperty("bold"),n=this.__getProperty("fontSize"),r=this.__getProperty("font");this.sfont=(e?"italic ":"")+(t?"bold ":"")+n+"px "+r,this.ctx.font=this.__getProperty("sfont")},setBold:function(e){e!=this.bold&&(this.bold=e,this.__setFont())},setItalic:function(e){e!=this.italic&&(this.italic=e,this.__setFont())},setStroked:function(e){this.stroked=e},setFilled:function(e){this.filled=e},getTabPos:function(e){var t=this.__getProperty("tabSize");return((e/t>>0)+1)*t},setFillStyle:function(e){this.fill=e},setStrokeStyle:function(e){this.stroke=e},setStrokeSize:function(e){this.strokeSize=e},setAlignment:function(e){this.alignment=e},setFontSize:function(e){e!==this.fontSize&&(this.fontSize=e,this.__setFont())}};var r=function(){return this.text="",this};r.prototype={x:0,y:0,width:0,text:null,crcs:null,rcs:null,styles:null,images:null,lines:null,documentHeight:0,anchorStack:null,__nextLine:function(){this.x=0,this.currentLine=new u(CAAT.Module.Font.Font.getFontMetrics(this.crcs.sfont)),this.lines.push(this.currentLine)},__image:function(e,t,n){var r;t&&n?r=e.getWidth():r=e.getWrappedImageWidth(),this.width&&r+this.x>this.width&&this.x>0&&this.__nextLine(),this.currentLine.addElementImage(new s(this.x,e,t,n,this.crcs.clone(),this.__getCurrentAnchor())),this.x+=r},__text:function(){if(this.text.length===0)return;var e=this.ctx.measureText(this.text).width;this.width&&e+this.x>this.width&&this.x>0&&this.__nextLine(),this.currentLine.addElement(new o(this.text,this.x,e,0,this.crcs.clone(),this.__getCurrentAnchor())),this.x+=e,this.text=""},fchar:function(e){e===" "?(this.__text(),this.x+=this.ctx.measureText(e).width,this.width&&this.x>this.width&&this.__nextLine()):this.text+=e},end:function(){this.text.length>0&&this.__text();var e=0,t=0;for(var n=0;n<this.lines.length;n++){var r=this.lines[n].getHeight();r===0&&(r=this.styles["default"].fontSize),e+=r,n===this.lines.length-1&&(t=r*.25>>0),this.lines[n].setY(e)}this.documentHeight=e+t},getDocumentHeight:function(){return this.documentHeight},__getCurrentAnchor:function(){return this.anchorStack.length?this.anchorStack[this.anchorStack.length-1]:null},__resetAppliedStyles:function(){this.rcs=[],this.__pushDefaultStyles()},__pushDefaultStyles:function(){this.crcs=(new n(this.ctx)).setDefault(this.styles["default"]),this.rcs.push(this.crcs)},__pushStyle:function(e){var t=this.crcs;this.crcs=new n(this.ctx),this.crcs.chain=t,this.crcs.setStyle(e),this.crcs.applyStyle(),this.rcs.push(this.crcs)},__popStyle:function(){this.rcs.length>1&&(this.rcs.pop(),this.crcs=this.rcs[this.rcs.length-1],this.crcs.applyStyle())},__popAnchor:function(){this.anchorStack.length>0&&this.anchorStack.pop()},__pushAnchor:function(e){this.anchorStack.push(e)},start:function(e,t,n,r){this.x=0,this.y=0,this.width=typeof r!="undefined"?r:0,this.ctx=e,this.lines=[],this.styles=t,this.images=n,this.anchorStack=[],this.__resetAppliedStyles(),this.__nextLine()},setTag:function(e){var t,n;this.__text(),e=e.toLowerCase();if(e==="b")this.crcs.setBold(!0);else if(e==="/b")this.crcs.setBold(!1);else if(e==="i")this.crcs.setItalic(!0);else if(e==="/i")this.crcs.setItalic(!1);else if(e==="stroked")this.crcs.setStroked(!0);else if(e==="/stroked")this.crcs.setStroked(!1);else if(e==="filled")this.crcs.setFilled(!0);else if(e==="/filled")this.crcs.setFilled(!1);else if(e==="tab")this.x=this.crcs.getTabPos(this.x);else if(e==="br")this.__nextLine();else if(e==="/a")this.__popAnchor();else if(e==="/style")this.rcs.length>1&&this.__popStyle();else if(e.indexOf("fillcolor")===0)t=e.split("="),this.crcs.setFillStyle(t[1]);else if(e.indexOf("strokecolor")===0)t=e.split("="),this.crcs.setStrokeStyle(t[1]);else if(e.indexOf("strokesize")===0)t=e.split("="),this.crcs.setStrokeSize(t[1]|0);else if(e.indexOf("fontsize")===0)t=e.split("="),this.crcs.setFontSize(t[1]|0);else if(e.indexOf("style")===0)t=e.split("="),n=this.styles[t[1]],n&&this.__pushStyle(n);else if(e.indexOf("image")===0){t=e.split("=")[1].split(",");var r=t[0];if(this.images[r]){var i=0,s=0;t.length>=3&&(i=t[1]|0,s=t[2]|0),this.__image(this.images[r],i,s)}}else e.indexOf("a=")===0&&(t=e.split("="),this.__pushAnchor(t[1]))}};var i=function(e,t){return this.link=e,this.style=t,this};i.prototype={x:null,y:null,width:null,height:null,style:null,link:null,isLink:function(){return this.link},setLink:function(e){return this.link=e,this},getLink:function(){return this.link},contains:function(e,t){return!1}};var s=function(e,t,n,r,i,o){s.superclass.constructor.call(this,o,i),this.x=e,this.image=t,this.row=n,this.column=r,this.width=t.getWidth(),this.height=t.getHeight();if(this.image instanceof CAAT.SpriteImage||this.image instanceof CAAT.Foundation.SpriteImage)this.spriteIndex=n*t.columns+r,this.paint=this.paintSI;return this};s.prototype={image:null,row:null,column:null,spriteIndex:null,paint:function(t){this.style.image(t),t.drawImage(this.image,this.x,-this.height+1),e&&t.strokeRect(this.x,-this.height+1,this.width,this.height)},paintSI:function(t){this.style.image(t),this.image.setSpriteIndex(this.spriteIndex),this.image.paint({ctx:t},0,this.x,-this.height+1),e&&t.strokeRect(this.x,-this.height+1,this.width,this.height)},getHeight:function(){return this.image instanceof CAAT.Foundation.SpriteImage?this.image.singleHeight:this.image.height},getFontMetrics:function(){return null},contains:function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<this.y+this.height},setYPosition:function(e){this.y=e-this.height+1}};var o=function(e,t,n,r,i,s){return o.superclass.constructor.call(this,s,i),this.x=t,this.y=0,this.width=n,this.text=e,this.style=i,this.fm=CAAT.Module.Font.Font.getFontMetrics(i.sfont),this.height=this.fm.height,this};o.prototype={text:null,style:null,fm:null,bl:null,paint:function(t){this.style.text(t,this.text,this.x,0),e&&t.strokeRect(this.x,-this.fm.ascent,this.width,this.height)},getHeight:function(){return this.fm.height},getFontMetrics:function(){return this.fm},contains:function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height},setYPosition:function(e){this.bl=e,this.y=e-this.fm.ascent}},extend(s,i),extend(o,i);var u=function(e){return this.elements=[],this.defaultFontMetrics=e,this};return u.prototype={elements:null,width:0,height:0,defaultHeight:0,y:0,x:0,alignment:null,baselinePos:0,addElement:function(e){this.width=Math.max(this.width,e.x+e.width),this.height=Math.max(this.height,e.height),this.elements.push(e),this.alignment=e.style.__getProperty("alignment")},addElementImage:function(e){this.width=Math.max(this.width,e.x+e.width),this.height=Math.max(this.height,e.height),this.elements.push(e)},getHeight:function(){return this.height},setY:function(e){this.y=e},getY:function(){return this.y},paint:function(e){e.save(),e.translate(this.x,this.y+this.baselinePos);for(var t=0;t<this.elements.length;t++)this.elements[t].paint(e);e.restore()},setAlignment:function(e){var n;if(this.alignment==="center")this.x=(e-this.width)/2;else if(this.alignment==="right")this.x=e-this.width;else if(this.alignment==="justify"&&this.width/e>=t&&this.elements.length>1){var r=e-this.width,i=r/(this.elements.length-1)|0;for(n=1;n<this.elements.length;n++)this.elements[n].x+=n*i;r=e-this.width-i*(this.elements.length-1);for(n=0;n<r;n++)this.elements[this.elements.length-1-n].x+=r-n}},adjustHeight:function(){var e=null,t=null,n;for(n=0;n<this.elements.length;n+=1){var r=this.elements[n],i=r.getFontMetrics();null!=i?e?i.ascent>e.ascent&&(e=i):e=i:t?r.getHeight()>r.getHeight()&&(t=r):t=r}this.baselinePos=Math.max(e?e.ascent:this.defaultFontMetrics.ascent,t?t.getHeight():this.defaultFontMetrics.ascent),this.height=this.baselinePos+(e!=null?e.descent:this.defaultFontMetrics.descent);for(n=0;n<this.elements.length;n++)this.elements[n].setYPosition(this.baselinePos);return this.height},__getElementAt:function(e,t){for(var n=0;n<this.elements.length;n++){var r=this.elements[n];if(r.contains(e,t))return r}return null}},{__init:function(){return this.__super(),this.rc=new r,this.lines=[],this.styles={},this.images={},this},halignment:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT,valignment:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP,text:null,rc:null,styles:null,documentWidth:0,documentHeight:0,documentX:0,documentY:0,reflow:!0,lines:null,images:null,clickCallback:null,setStyle:function(e,t){return this.styles[e]=t,this},addImage:function(e,t){return this.images[e]=t,this},setSize:function(e,t){return CAAT.Foundation.UI.Label.superclass.setSize.call(this,e,t),this.setText(this.text,this.width),this},setBounds:function(e,t,n,r){return CAAT.Foundation.UI.Label.superclass.setBounds.call(this,e,t,n,r),this.setText(this.text,this.width),this},setText:function(e,t){if(null===e)return;var n=this.cached;n&&this.stopCacheAsBitmap(),this.documentWidth=0,this.documentHeight=0,this.text=e;var r,i,s,o,u,a,f=CAAT.currentDirector.ctx;f.save(),s=this.text,r=0,i=s.length,this.rc.start(f,this.styles,this.images,t);while(r<i)a=s.charAt(r),a==="\\"?(r+=1,this.rc.fchar(s.charAt(r)),r+=1):a==="<"?(o=s.indexOf(">",r+1),-1!==o&&(u=s.substr(r+1,o-r-1),u.indexOf("<")!==-1?(this.rc.fchar(a),r+=1):(this.rc.setTag(u),r=o+1))):(this.rc.fchar(a),r+=1);return this.rc.end(),this.lines=this.rc.lines,this.__calculateDocumentDimension(typeof t=="undefined"?0:t),this.setLinesAlignment(),f.restore(),this.setPreferredSize(this.documentWidth,this.documentHeight),this.invalidateLayout(),this.setDocumentPosition(),n&&this.cacheAsBitmap(0,n),this},setVerticalAlignment:function(e){return this.valignment=e,this.setDocumentPosition(),this},setHorizontalAlignment:function(e){return this.halignment=e,this.setDocumentPosition(),this},setDocumentPosition:function(){var e=0,t=0;this.valignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER?t=(this.height-this.documentHeight)/2:this.valignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM&&(t=this.height-this.documentHeight),this.halignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER?e=(this.width-this.documentWidth)/2:this.halignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT&&(e=this.width-this.documentWidth),this.documentX=e,this.documentY=t},__calculateDocumentDimension:function(e){var t,n=0;this.documentWidth=0,this.documentHeight=0;for(t=0;t<this.lines.length;t++)this.lines[t].y=n,this.documentWidth=Math.max(this.documentWidth,this.lines[t].width),this.documentHeight+=this.lines[t].adjustHeight(),n+=this.lines[t].getHeight();return this.documentWidth=Math.max(this.documentWidth,e),this},setLinesAlignment:function(){for(var e=0;e<this.lines.length;e++)this.lines[e].setAlignment(this.documentWidth)},paint:function(t,n){if(this.cached===CAAT.Foundation.Actor.CACHE_NONE){var r=t.ctx;r.save(),r.textBaseline="alphabetic",r.translate(this.documentX,this.documentY);for(var i=0;i<this.lines.length;i++){var s=this.lines[i];s.paint(t.ctx),e&&r.strokeRect(s.x,s.y,s.width,s.height)}r.restore()}else this.backgroundImage&&this.backgroundImage.paint(t,n,0,0)},__getDocumentElementAt:function(e,t){e-=this.documentX,t-=this.documentY;for(var n=0;n<this.lines.length;n++){var r=this.lines[n];if(r.x<=e&&r.y<=t&&r.x+r.width>=e&&r.y+r.height>=t)return r.__getElementAt(e-r.x,t-r.y)}return null},mouseExit:function(e){CAAT.setCursor("default")},mouseMove:function(e){var t=this.__getDocumentElementAt(e.x,e.y);t&&t.getLink()?CAAT.setCursor("pointer"):CAAT.setCursor("default")},mouseClick:function(e){if(this.clickCallback){var t=this.__getDocumentElementAt(e.x,e.y);t.getLink()&&this.clickCallback(t.getLink())}},setClickCallback:function(e){return this.clickCallback=e,this}}}}),CAAT.Module({defines:"CAAT.Foundation.UI.PathActor",aliases:["CAAT.PathActor"],depends:["CAAT.Foundation.Actor"],extendsClass:"CAAT.Foundation.Actor",extendsWith:{path:null,pathBoundingRectangle:null,bOutline:!1,outlineColor:"black",onUpdateCallback:null,interactive:!1,getPath:function(){return this.path},setPath:function(e){return this.path=e,e!=null&&(this.pathBoundingRectangle=e.getBoundingBox(),this.setInteractive(this.interactive)),this},paint:function(e,t){CAAT.Foundation.UI.PathActor.superclass.paint.call(this,e,t);if(!this.path)return;var n=e.ctx;n.strokeStyle="#000",this.path.paint(e,this.interactive),this.bOutline&&(n.strokeStyle=this.outlineColor,n.strokeRect(this.pathBoundingRectangle.x,this.pathBoundingRectangle.y,this.pathBoundingRectangle.width,this.pathBoundingRectangle.height))},showBoundingBox:function(e,t){return this.bOutline=e,e&&t&&(this.outlineColor=t),this},setInteractive:function(e){return this.interactive=e,this.path&&this.path.setInteractive(e),this},setOnUpdateCallback:function(e){return this.onUpdateCallback=e,this},mouseDrag:function(e){this.path.drag(e.point.x,e.point.y,this.onUpdateCallback)},mouseDown:function(e){this.path.press(e.point.x,e.point.y)},mouseUp:function(e){this.path.release()}}}),CAAT.Module({defines:"CAAT.Foundation.UI.ShapeActor",aliases:["CAAT.ShapeActor"],extendsClass:"CAAT.Foundation.ActorContainer",depends:["CAAT.Foundation.ActorContainer"],constants:{SHAPE_CIRCLE:0,SHAPE_RECTANGLE:1},extendsWith:{__init:function(){return this.__super(),this.compositeOp="source-over",this.setShape(CAAT.Foundation.UI.ShapeActor.SHAPE_CIRCLE),this},shape:0,compositeOp:null,lineWidth:1,lineCap:null,lineJoin:null,miterLimit:null,setLineWidth:function(e){return this.lineWidth=e,this},setLineCap:function(e){return this.lineCap=e,this},setLineJoin:function(e){return this.lineJoin=e,this},setMiterLimit:function(e){return this.miterLimit=e,this},getLineCap:function(){return this.lineCap},getLineJoin:function(){return this.lineJoin},getMiterLimit:function(){return this.miterLimit},getLineWidth:function(){return this.lineWidth},setShape:function(e){return this.shape=e,this.paint=this.shape===CAAT.Foundation.UI.ShapeActor.SHAPE_CIRCLE?this.paintCircle:this.paintRectangle,this},setCompositeOp:function(e){return this.compositeOp=e,this},paint:function(e,t){},paintCircle:function(e,t){if(this.cached){CAAT.Foundation.ActorContainer.prototype.paint.call(this,e,t);return}var n=e.ctx;n.lineWidth=this.lineWidth,n.globalCompositeOperation=this.compositeOp,null!==this.fillStyle&&(n.fillStyle=this.fillStyle,n.beginPath(),n.arc(this.width/2,this.height/2,Math.min(this.width,this.height)/2-this.lineWidth/2,0,2*Math.PI,!1),n.fill()),null!==this.strokeStyle&&(n.strokeStyle=this.strokeStyle,n.beginPath(),n.arc(this.width/2,this.height/2,Math.min(this.width,this.height)/2-this.lineWidth/2,0,2*Math.PI,!1),n.stroke())},paintRectangle:function(e,t){if(this.cached){CAAT.Foundation.ActorContainer.prototype.paint.call(this,e,t);return}var n=e.ctx;n.lineWidth=this.lineWidth,this.lineCap&&(n.lineCap=this.lineCap),this.lineJoin&&(n.lineJoin=this.lineJoin),this.miterLimit&&(n.miterLimit=this.miterLimit),n.globalCompositeOperation=this.compositeOp,null!==this.fillStyle&&(n.fillStyle=this.fillStyle,n.beginPath(),n.fillRect(0,0,this.width,this.height),n.fill()),null!==this.strokeStyle&&(n.strokeStyle=this.strokeStyle,n.beginPath(),n.strokeRect(0,0,this.width,this.height),n.stroke())}}}),CAAT.Module({defines:"CAAT.Foundation.UI.StarActor",aliases:["CAAT.StarActor"],depends:["CAAT.Foundation.ActorContainer"],extendsClass:"CAAT.Foundation.ActorContainer",extendsWith:{__init:function(){return this.__super(),this.compositeOp="source-over",this},nPeaks:0,maxRadius:0,minRadius:0,initialAngle:0,compositeOp:null,lineWidth:1,lineCap:null,lineJoin:null,miterLimit:null,setLineWidth:function(e){return this.lineWidth=e,this},setLineCap:function(e){return this.lineCap=e,this},setLineJoin:function(e){return this.lineJoin=e,this},setMiterLimit:function(e){return this.miterLimit=e,this},getLineCap:function(){return this.lineCap},getLineJoin:function(){return this.lineJoin},getMiterLimit:function(){return this.miterLimit},getLineWidth:function(){return this.lineWidth},setFilled:function(e){return this},setOutlined:function(e){return this},setCompositeOp:function(e){return this.compositeOp=e,this},setInitialAngle:function(e){return this.initialAngle=e,this},initialize:function(e,t,n){return this.setSize(2*t,2*t),this.nPeaks=e,this.maxRadius=t,this.minRadius=n,this},paint:function(e,t){var n=e.ctx,r=this.width/2,i=this.height/2,s=this.maxRadius,o=this.minRadius,u=r+s*Math.cos(this.initialAngle),a=i+s*Math.sin(this.initialAngle);n.lineWidth=this.lineWidth,this.lineCap&&(n.lineCap=this.lineCap),this.lineJoin&&(n.lineJoin=this.lineJoin),this.miterLimit&&(n.miterLimit=this.miterLimit),n.globalCompositeOperation=this.compositeOp,n.beginPath(),n.moveTo(u,a);for(var f=1;f<this.nPeaks*2;f++){var l=Math.PI/this.nPeaks*f+this.initialAngle,c=f%2===0?s:o,h=r+c*Math.cos(l),p=i+c*Math.sin(l);n.lineTo(h,p)}n.lineTo(r+s*Math.cos(this.initialAngle),i+s*Math.sin(this.initialAngle)),n.closePath(),this.fillStyle&&(n.fillStyle=this.fillStyle,n.fill()),this.strokeStyle&&(n.strokeStyle=this.strokeStyle,n.stroke())}}}),CAAT.Module({defines:"CAAT.Foundation.UI.TextActor",aliases:["CAAT.TextActor"],extendsClass:"CAAT.Foundation.Actor",constants:{TRAVERSE_PATH_FORWARD:1,TRAVERSE_PATH_BACKWARD:-1},depends:["CAAT.Foundation.Actor","CAAT.Foundation.SpriteImage","CAAT.Module.Font.Font","CAAT.Math.Point","CAAT.Behavior.Interpolator"],extendsWith:{__init:function(){return this.__super(),this.font="10px sans-serif",this.textAlign="left",this.outlineColor="black",this.clip=!1,this.__calcFontData(),this},font:null,fontData:null,textAlign:null,textBaseline:"top",fill:!0,textFillStyle:"#eee",text:null,textWidth:0,textHeight:0,outline:!1,outlineColor:null,lineWidth:1,path:null,pathInterpolator:null,pathDuration:1e4,sign:1,lx:0,ly:0,setFill:function(e){return this.stopCacheAsBitmap(),this.fill=e,this},setLineWidth:function(e){return this.stopCacheAsBitmap(),this.lineWidth=e,this},setTextFillStyle:function(e){return this.stopCacheAsBitmap(),this.textFillStyle=e,this},setOutline:function(e){return this.stopCacheAsBitmap(),this.outline=e,this},setPathTraverseDirection:function(e){return this.sign=e,this},setOutlineColor:function(e){return this.stopCacheAsBitmap(),this.outlineColor=e,this},setText:function(e){this.stopCacheAsBitmap(),this.text=e;if(null===this.text||this.text==="")this.width=this.height=0;return this.calcTextSize(CAAT.currentDirector),this.invalidate(),this},setTextAlign:function(e){return this.textAlign=e,this.__setLocation(),this},setAlign:function(e){return this.setTextAlign(e)},setTextBaseline:function(e){return this.stopCacheAsBitmap(),this.textBaseline=e,this},setBaseline:function(e){return this.stopCacheAsBitmap(),this.setTextBaseline(e)},setFont:function(e){return this.stopCacheAsBitmap(),e||(e="10px sans-serif"),e instanceof CAAT.Module.Font.Font?e.setAsSpriteImage():e instanceof CAAT.Foundation.SpriteImage,this.font=e,this.__calcFontData(),this.calcTextSize(CAAT.director[0]),this},setLocation:function(e,t){return this.lx=e,this.ly=t,this.__setLocation(),this},setPosition:function(e,t){return this.lx=e,this.ly=t,this.__setLocation(),this},setBounds:function(e,t,n,r){return this.lx=e,this.ly=t,this.setSize(n,r),this.__setLocation(),this},setSize:function(e,t){return CAAT.Foundation.UI.TextActor.superclass.setSize.call(this,e,t),this.__setLocation(),this},__setLocation:function(){var e,t;this.textAlign==="center"?e=this.lx-this.width/2:this.textAlign==="right"||this.textAlign==="end"?e=this.lx-this.width:e=this.lx,this.textBaseline==="bottom"?t=this.ly-this.height:this.textBaseline==="middle"?t=this.ly-this.height/2:this.textBaseline==="alphabetic"?t=this.ly-this.fontData.ascent:t=this.ly,CAAT.Foundation.UI.TextActor.superclass.setLocation.call(this,e,t)},centerAt:function(e,t){return this.textAlign="left",this.textBaseline="top",CAAT.Foundation.UI.TextActor.superclass.centerAt.call(this,e,t)},calcTextSize:function(e){if(typeof this.text=="undefined"||null===this.text||""===this.text)return this.textWidth=0,this.textHeight=0,this;if(e.glEnabled)return this;if(this.font instanceof CAAT.Foundation.SpriteImage)return this.textWidth=this.font.stringWidth(this.text),this.textHeight=this.font.stringHeight(),this.width=this.textWidth,this.height=this.textHeight,this.fontData=this.font.getFontData(),this;if(this.font instanceof CAAT.Module.Font.Font)return this.textWidth=this.font.stringWidth(this.text),this.textHeight=this.font.stringHeight(),this.width=this.textWidth,this.height=this.textHeight,this.fontData=this.font.getFontData(),this;var t=e.ctx;return t.save(),t.font=this.font,this.textWidth=t.measureText(this.text).width,this.width===0&&(this.width=this.textWidth),this.textHeight=this.fontData.height,this.setSize(this.textWidth,this.textHeight),t.restore(),this},__calcFontData:function(){this.fontData=CAAT.Module.Font.Font.getFontMetrics(this.font)},paint:function(e,t){if(!this.text)return;CAAT.Foundation.UI.TextActor.superclass.paint.call(this,e,t);if(this.cached)return;if(null===this.text)return;(this.textWidth===0||this.textHeight===0)&&this.calcTextSize(e);var n=e.ctx;if(this.font instanceof CAAT.Module.Font.Font||this.font instanceof CAAT.Foundation.SpriteImage){this.drawSpriteText(e,t);return}null!==this.font&&(n.font=this.font),n.textBaseline="alphabetic";if(null===this.path){null!==this.textAlign&&(n.textAlign=this.textAlign);var r=0;this.textAlign==="center"?r=this.width/2|0:this.textAlign==="right"&&(r=this.width),this.fill&&(null!==this.textFillStyle&&(n.fillStyle=this.textFillStyle),n.fillText(this.text,r,this.fontData.ascent)),this.outline&&(null!==this.outlineColor&&(n.strokeStyle=this.outlineColor),n.lineWidth=this.lineWidth,n.beginPath(),n.strokeText(this.text,r,this.fontData.ascent))}else this.drawOnPath(e,t)},drawOnPath:function(e,t){var n=e.ctx;this.fill&&null!==this.textFillStyle&&(n.fillStyle=this.textFillStyle),this.outline&&null!==this.outlineColor&&(n.strokeStyle=this.outlineColor);var r=this.sign*this.pathInterpolator.getPosition(t%this.pathDuration/this.pathDuration).y*this.path.getLength(),i=new CAAT.Math.Point(0,0,0),s=new CAAT.Math.Point(0,0,0);for(var o=0;o<this.text.length;o++){var u=this.text[o].toString(),a=n.measureText(u).width,f=r;i=this.path.getPositionFromLength(f).clone(),s=this.path.getPositionFromLength(f-.1).clone();var l=Math.atan2(i.y-s.y,i.x-s.x);n.save(),CAAT.CLAMP?n.translate(i.x>>0,i.y>>0):n.translate(i.x,i.y),n.rotate(l),this.fill&&n.fillText(u,0,0),this.outline&&(n.beginPath(),n.lineWidth=this.lineWidth,n.strokeText(u,0,0)),n.restore(),r+=a}},drawSpriteText:function(e,t){null===this.path?this.font.drawText(this.text,e.ctx,0,0):this.drawSpriteTextOnPath(e,t)},drawSpriteTextOnPath:function(e,t){var n=e.ctx,r=this.sign*this.pathInterpolator.getPosition(t%this.pathDuration/this.pathDuration).y*this.path.getLength(),i=new CAAT.Math.Point(0,0,0),s=new CAAT.Math.Point(0,0,0);for(var o=0;o<this.text.length;o++){var u=this.text[o].toString(),a=this.font.stringWidth(u),f=a/2+r;i=this.path.getPositionFromLength(f).clone(),s=this.path.getPositionFromLength(f-.1).clone();var l=Math.atan2(i.y-s.y,i.x-s.x);n.save(),CAAT.CLAMP?n.translate(i.x|0,i.y|0):n.translate(i.x,i.y),n.rotate(l);var c=this.textBaseline==="bottom"?0-this.font.getHeight():0;this.font.drawText(u,n,0,c),n.restore(),r+=a}},setPath:function(e,t,n){return this.path=e,this.pathInterpolator=t||(new CAAT.Behavior.Interpolator).createLinearInterpolator(),this.pathDuration=n||1e4,this.mouseEnabled=!1,this}}}),CAAT.ModuleManager.solveAll(),define("sge/vendor/caat",function(e){return function(){var t,n;return t||e.CAAT}}(this)),define("sge/lib/class",[],function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;return this.Class=function(){},Class.extend=function(n){function o(){!e&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;e=!0;var i=new this;e=!1;for(var s in n)i[s]=typeof n[s]=="function"&&typeof r[s]=="function"&&t.test(n[s])?function(e,t){return function(){var n=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=n,i}}(s,n[s]):n[s];return o.prototype=i,o.prototype.constructor=o,o.extend=arguments.callee,o},Class}),define("sge/renderer",["sge/vendor/underscore","sge/vendor/caat","sge/lib/class"],function(e,t,n){var r={SPRITESHEETS:{}};return r}),define("sge/engine",["sge/lib/class"],function(e){var t=e.extend({init:function(){this.interval=null,this.entities={},this._ids=[],this._lastTick=0,this._debug=0,this._debugTick=!1},run:function(e){e==undefined&&(e=30),this._lastTick=Date.now(),this.interval=setInterval(this.tickCallback.bind(this),1e3/e)},stop:function(){clearInterval(this.interval),this.interval=null},tickCallback:function(){var e=Date.now(),t=e-this._lastTick;this._lastTick=e,this.tick(t/1e3)}});return t}),define("sge/observable",["sge/lib/class"],function(e){var t=e.extend({init:function(){this._listeners={}},addListener:function(e,t){return this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t),t},fireEvent:function(){args=Array.prototype.slice.call(arguments),event=args.shift(),typeof event=="string"&&(event={type:event}),event.target||(event.target=this);if(!event.type)throw new Error("Event object missing 'type' property.");if(this._listeners[event.type]){var e=this._listeners[event.type].slice(0);for(var t=0,n=e.length;t<n;t++)try{e[t].apply(this,args)}catch(r){console.log("SandboxObservableError: "+r),console.log(r.stack),console.trace()}}},removeListener:function(e,t){if(this._listeners[e]instanceof Array){var n=this._listeners[e];for(var r=0,i=n.length;r<i;r++)if(n[r]===t){var s=n.splice(r,1);break}}}});return t}),define("sge/component",["sge/lib/class"],function(e){var t={},n=e.extend({init:function(e,t){this.entity=e,this.data={},this._listeners={}},get:function(e){var t=null;return this["_get_"+e]!==undefined?t=this["_get_"+e]():t=this.data[e],t},set:function(e,t,n){var r=null;return this["_set_"+e]!==undefined?r=this["_set_"+e](t,n):r=this.__set_value(e,t,n),r},__set_value:function(e,t,n){switch(n){case"add":var r=this.get(e);newValue=this.data[e]=r+t;break;case"subtract":var r=this.get(e);newValue=this.data[e]=r-t;break;case"set":default:newValue=this.data[e]=t}return newValue},register:function(e){this.state=e},deregister:function(e){this.state=null},createInputListener:function(e,t){this._listeners[t]=t.bind(this)}});return n.register=function(e,n){t[e]=n},n.Factory=function(e,n,r){return new t[e](n,r)},n}),define("sge/spritesheet",[],function(){var e=function(t,n,r){r===undefined&&(r=n),this.ready=!1,this.spriteWidth=n,this.spriteHeight=r,this.offsetX=this.spriteWidth/-2,this.offsetY=this.spriteHeight/-2,e.SpriteSheetImages[t]===undefined?(this.image=new Image,this.buffer=this.image,this.image.onload=this.onLoadImage.bind(this),this.image.src=t,e.SpriteSheetImages[t]=this.image):(this.image=e.SpriteSheetImages[t],this.buffer=this.image,this.onLoadImage())};return e.SpriteSheetImages={},e.prototype.onLoadImage=function(){this.imageWidth=this.image.width,this.imageHeight=this.image.height,this.horzSprites=this.imageWidth/this.spriteWidth,this.vertSprites=this.imageHeight/this.spriteHeight,this._image_tint=document.createElement("canvas"),this._image_tint.width=this.image.width,this._image_tint.height=this.image.height,this._image_buffer=document.createElement("canvas"),this._image_buffer.width=this.image.width,this._image_buffer.height=this.image.height,this.buffer=this.image,this.ready=!0},e.prototype.getSrcRect=function(e){var t=null,n=null;e[0]!=undefined?(t=e[0],n=e[1]):(t=e%this.horzSprites,n=Math.floor(e/this.horzSprites));var r=t*this.spriteWidth,i=n*this.spriteHeight;return[r,i,this.spriteWidth,this.spriteHeight]},e.prototype.tint=function(e){e===undefined?this.buffer=this.image:(ctx=this._image_tint.getContext("2d"),ctx.fillStyle=e,ctx.fillRect(0,0,this._image_tint.width,this._image_tint.height),ctx.globalCompositeOperation="destination-atop",ctx.drawImage(this.image,0,0),ctx=this._image_buffer.getContext("2d"),ctx.drawImage(this.image,0,0),this.tint_alpha>0&&(ctx.globalAlpha=this.tint_alpha,ctx.drawImage(this._image_tint,0,0),ctx.globalAlpha=1),this.buffer=this._image_tint)},e}),define("sge/components/sprite",["sge/component","sge/spritesheet","sge/config","sge/renderer"],function(e,t,n,r){var i=e.extend({init:function(e,t){this._super(e,t),this.data.frame=t.frame||0,this.data.scale=t.scale||1,this.data.mirror=!0,this.data.offsetX=t.offsetX||0,this.data.offsetY=t.offsetY||0;var n=t.src.split("/"),i=n[n.length-1].split(".")[0];this.spriteSheet=r.SPRITESHEETS[i],this.tintCallback=function(e,t){this.setBackground(i+"_tint_red");var n=this.entity.state.createTimeout(t,function(){this.setBackground(i)}.bind(this))}.bind(this),this.entity.addListener("tint",this.tintCallback)},setBackground:function(e){var t=r.SPRITESHEETS[e];this.actor.setBackgroundImage(t)},register:function(e){this._super(e),this.actor=(new CAAT.Actor).setLocation(this.get("offsetX"),this.get("offsetY")).setBackgroundImage(this.spriteSheet).setSpriteIndex(0),this.entity.get("xform.container").addChild(this.actor)},deregister:function(e){this.entity.get("xform.container").removeChild(this.actor),this._super(e)},render:function(e,t){this.actor.setSpriteIndex(this.get("frame"))}});return e.register("sprite",i),i}),define("sge/components/anim",["sge/component"],function(e){var t=e.extend({init:function(e,t){this._super(e,t),this.data.play=!1,this.frame=0;var n=Object.keys(t.frames);this.animData={};for(var r=n.length-1;r>=0;r--){var i=n[r],s=t.frames[i];s.frames===undefined&&(s={frames:s}),this.animData[i]=s}this.current=null,this.currentAnim=null,this.frameLength=null,this.setAnim("walk_right")},tick:function(){this.data.play&&(this.frame++,this.frame>=this.frameLength&&(this.frame=0),this.entity.set("sprite.frame",this.currentAnim[this.frame]))},_set_anim:function(e){e!=this.current&&this.setAnim(e)},setAnim:function(e){this.current=e;var t=this.animData[e].mirror===!0;this.entity.set("sprite.mirror",t),this.currentAnim=this.animData[e].frames,this.frameLength=this.currentAnim.length,this.data.anim=e}});return e.register("anim",t),t}),define("sge/components/xform",["sge/component"],function(e){var t=e.extend({init:function(e,t){this._super(e,t),this.data.tx=t.tx||0,this.data.ty=t.ty||0,this.data.vx=0,t.vx!==undefined&&(this.data.vx=t.vx),this.data.vy=0,t.vy!==undefined&&(this.data.vy=t.vy),this.data.container=t.container||"scene",this.data.dir=t.dir||"down",this.container=new CAAT.ActorContainer},_get_container:function(){return this.container},_set_t:function(e,t){return this.data.tx=e,this.data.ty=t,this.entity.fireEvent("xform.move"),[e,t]},_set_tx:function(e,t){return this.data.tx=this.__set_value("tx",e,t),this.entity.fireEvent("xform.move"),this.data.tx},_set_ty:function(e,t){return this.data.ty=this.__set_value("ty",e,t),this.entity.fireEvent("xform.move"),this.data.ty},_set_v:function(e,t){return this.data.vx=e,this.data.vy=t,this.entity.fireEvent("xform.update"),[e,t]},_set_vx:function(e,t){return this.data.vx=this.__set_value("vx",e,t),this.entity.fireEvent("xform.update"),this.data.vx},_set_vy:function(e,t){return this.data.vy=this.__set_value("vy",e,t),this.entity.fireEvent("xform.update"),this.data.vy},register:function(e){this._super(e);var t=this.data.container;this.scene=this.state[t],this.scene.addChild(this.container);var n=this.entity.get("xform.tx"),r=this.entity.get("xform.ty");this.container.setLocation(n,r)},deregister:function(e){this.scene.removeChild(this.container),this._super(e)},render:function(e,t){var n=this.entity.get("xform.tx"),r=this.entity.get("xform.ty");this.container.setLocation(n,r)}});return e.register("xform",t),t}),define("sge/components/movement",["sge/component"],function(e){var t=e.extend({init:function(e,t){this._super(e,t),this.data.speed=8,this.data.width=t.width||640,this.data.height=t.height||480,this.data.map=t.map||null,this._isKeyDown={}},tick:function(e){var t=this.entity.get("xform.vx")*e,n=this.entity.get("xform.vy")*e;Math.abs(t)>0||Math.abs(n)>0?(this.entity.set("anim.play",!0),Math.abs(t)>Math.abs(n)?t>0?(this.entity.set("anim.anim","walk_right"),this.entity.set("xform.dir","right")):(this.entity.set("anim.anim","walk_left"),this.entity.set("xform.dir","left")):n<0?(this.entity.set("anim.anim","walk_up"),this.entity.set("xform.dir","up")):(this.entity.set("anim.anim","walk_down"),this.entity.set("xform.dir","down"))):this.entity.set("anim.play",!1)}});return e.register("movement",t),t}),define("sge/components/controls",["sge/component"],function(e){var t=e.extend({init:function(e,t){this._super(e,t),this.data.speed=t.speed||128},register:function(e){this.input=e.input},deregister:function(e){this.input=undefined},tick:function(e){if(this.input===undefined)return;var t=0,n=0;(this.input.isPressed("down")||this.input.isPressed("S")||this.input.joystick.down())&&n++,(this.input.isPressed("up")||this.input.isPressed("W")||this.input.joystick.up())&&n--,(this.input.isPressed("right")||this.input.isPressed("D")||this.input.joystick.right())&&t++,(this.input.isPressed("left")||this.input.isPressed("A")||this.input.joystick.left())&&t--,vx=this.entity.set("xform.vx",t*this.data.speed),vy=this.entity.set("xform.vy",n*this.data.speed)}});return e.register("controls",t),t}),define("sge/components/physics",["sge/component"],function(e){var t=e.extend({init:function(e,t){this._super(e,t),this.data.width=t.width||16,this.data.height=t.height||16,this.data.type=t.type||0,this.data.fast=t.fast||!1,this._wait=!0}});return e.register("physics",t),t}),define("sge/components/eventmgr",["sge/component"],function(e){var t=e.extend({init:function(e,t){this._super(e,t);var n=Object.keys(t.callbacks);for(var r=n.length-1;r>=0;r--){var i=n[r];this.entity.addListener(i,t.callbacks[i])}}});return e.register("eventmgr",t),t}),define("sge/entity",["sge/lib/class","sge/observable","sge/component","sge/components/sprite","sge/components/anim","sge/components/xform","sge/components/movement","sge/components/controls","sge/components/physics","sge/components/eventmgr"],function(e,t,n){var r=t.extend({init:function(e){this._super(),this._tick_callbacks=[],this.id=null,this.components={},this.tags=[],this.active=!0;var t=Object.keys(e);t.reverse();for(var r=t.length-1;r>=0;r--){var i=t[r],s=n.Factory(i,this,e[i]);this.components[i]=s}},componentCall:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),n=Object.keys(this.components);for(var r=n.length-1;r>=0;r--){var i=this.components[n[r]];i[t]!==undefined&&i[t].apply(i,e)}},get:function(e){var t=e.split("."),n=t.shift(),r=this.components[n];return t.length?r.get(t.join(".")):r},set:function(e,t,n){var r=e.split("."),i=r.shift(),s=this.components[i];return s.set(r.join("."),t,n)},hasTag:function(e){return this.tags.indexOf(e)>=0},register:function(e){this.componentCall("register",e),this._hack()},deregister:function(e){this.componentCall("deregister",e)},_hack:function(){this._tick_callbacks=[];var e=Object.keys(this.components);for(var t=e.length-1;t>=0;t--){var n=this.components[e[t]];n.tick!==undefined&&this._tick_callbacks.push(n.tick.bind(n))}},tick:function(e){for(var t=this._tick_callbacks.length-1;t>=0;t--)this._tick_callbacks[t](e)}});return r}),function(e){var t={VERSION:"2.2.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(e,n){var r=typeof e.initial=="string"?{state:e.initial}:e.initial,i=e.terminal||e["final"],s=n||e.target||{},o=e.events||[],u=e.callbacks||{},a={},f=function(e){var n=e.from instanceof Array?e.from:e.from?[e.from]:[t.WILDCARD];a[e.name]=a[e.name]||{};for(var r=0;r<n.length;r++)a[e.name][n[r]]=e.to||n[r]};r&&(r.event=r.event||"startup",f({name:r.event,from:"none",to:r.state}));for(var l=0;l<o.length;l++)f(o[l]);for(var c in a)a.hasOwnProperty(c)&&(s[c]=t.buildEvent(c,a[c]));for(var c in u)u.hasOwnProperty(c)&&(s[c]=u[c]);return s.current="none",s.is=function(e){return e instanceof Array?e.indexOf(this.current)>=0:this.current===e},s.can=function(e){return!this.transition&&(a[e].hasOwnProperty(this.current)||a[e].hasOwnProperty(t.WILDCARD))},s.cannot=function(e){return!this.can(e)},s.error=e.error||function(e,t,n,r,i,s,o){throw o||s},s.isFinished=function(){return this.is(i)},r&&!r.defer&&s[r.event](),s},doCallback:function(e,n,r,i,s,o){if(n)try{return n.apply(e,[r,i,s].concat(o))}catch(u){return e.error(r,i,s,o,t.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",u)}},beforeAnyEvent:function(e,n,r,i,s){return t.doCallback(e,e.onbeforeevent,n,r,i,s)},afterAnyEvent:function(e,n,r,i,s){return t.doCallback(e,e.onafterevent||e.onevent,n,r,i,s)},leaveAnyState:function(e,n,r,i,s){return t.doCallback(e,e.onleavestate,n,r,i,s)},enterAnyState:function(e,n,r,i,s){return t.doCallback(e,e.onenterstate||e.onstate,n,r,i,s)},changeState:function(e,n,r,i,s){return t.doCallback(e,e.onchangestate,n,r,i,s)},beforeThisEvent:function(e,n,r,i,s){return t.doCallback(e,e["onbefore"+n],n,r,i,s)},afterThisEvent:function(e,n,r,i,s){return t.doCallback(e,e["onafter"+n]||e["on"+n],n,r,i,s)},leaveThisState:function(e,n,r,i,s){return t.doCallback(e,e["onleave"+r],n,r,i,s)},enterThisState:function(e,n,r,i,s){return t.doCallback(e,e["onenter"+i]||e["on"+i],n,r,i,s)},beforeEvent:function(e,n,r,i,s){if(!1===t.beforeThisEvent(e,n,r,i,s)||!1===t.beforeAnyEvent(e,n,r,i,s))return!1},afterEvent:function(e,n,r,i,s){t.afterThisEvent(e,n,r,i,s),t.afterAnyEvent(e,n,r,i,s)},leaveState:function(e,n,r,i,s){var o=t.leaveThisState(e,n,r,i,s),u=t.leaveAnyState(e,n,r,i,s);if(!1===o||!1===u)return!1;if(t.ASYNC===o||t.ASYNC===u)return t.ASYNC},enterState:function(e,n,r,i,s){t.enterThisState(e,n,r,i,s),t.enterAnyState(e,n,r,i,s)},buildEvent:function(e,n){return function(){var r=this.current,i=n[r]||n[t.WILDCARD]||r,s=Array.prototype.slice.call(arguments);if(this.transition)return this.error(e,r,i,s,t.Error.PENDING_TRANSITION,"event "+e+" inappropriate because previous transition did not complete");if(this.cannot(e))return this.error(e,r,i,s,t.Error.INVALID_TRANSITION,"event "+e+" inappropriate in current state "+this.current);if(!1===t.beforeEvent(this,e,r,i,s))return t.Result.CANCELLED;if(r===i)return t.afterEvent(this,e,r,i,s),t.Result.NOTRANSITION;var o=this;this.transition=function(){return o.transition=null,o.current=i,t.enterState(o,e,r,i,s),t.changeState(o,e,r,i,s),t.afterEvent(o,e,r,i,s),t.Result.SUCCEEDED},this.transition.cancel=function(){o.transition=null,t.afterEvent(o,e,r,i,s)};var u=t.leaveState(this,e,r,i,s);if(!1===u)return this.transition=null,t.Result.CANCELLED;if(t.ASYNC===u)return t.Result.PENDING;if(this.transition)return this.transition()}}};"function"==typeof define?define("sge/vendor/state-machine",["require"],function(e){return t}):e.StateMachine=t}(this),define("sge/gamestate",["sge/lib/class","sge/vendor/underscore"],function(e,t,n){var r=e.extend({init:function(e,t){this._length=e,this.callback=t},tick:function(e){return this._length=this._length-e,this._length<=0?(this.callback(),!1):!0}}),i=e.extend({init:function(e,t,n){this.game=e,this._keepScene=!1,this._sceneIndex=e.renderer.scenes.length;var r=e.renderer.createScene();this.scene=new CAAT.ActorContainer,r.addChild(this.scene);var i=0;this.scene.setBounds(-i,-i,e.renderer.width+i,e.renderer.height+i),this.input=e.input.createProxy(),this.entities={},this._name=t,this._entity_ids=[],this.initState(n),this._timeouts=[]},createTimeout:function(e,t){var n=new r(e,t);this._timeouts.push(n)},tickTimeouts:function(e){this._timeouts=t.filter(this._timeouts,function(t){return t.tick(e)})},initState:function(){},startState:function(){this.input.enable=!0,this._keepScene||this.game.renderer.setScene(this._sceneIndex)},endState:function(){this.input.enable=!1},destroyState:function(){},tick:function(e){this.tickTimeouts(e),t.each(this._entity_ids,function(t){var n=this.entities[t];n.tick(e)}.bind(this)),t.each(this._entity_ids,function(e){var t=this.entities[e];t.componentCall("render",this.game.renderer,"main")}.bind(this))},getNextId:function(){var e=0;while(this._entity_ids.indexOf(e)>-1)e++;return e},addEntity:function(e){var t=this.getNextId();return e.id=t,this._entity_ids.push(t),this.entities[t]=e,e.state=this,e.register(this),e},getEntity:function(e){return this.entities[e]},getEntities:function(){var e=[];return t.each(this._entity_ids,function(t){e.push(this.entities[t])}.bind(this)),e},getEntitiesWithTag:function(e){return t.filter(this.getEntities(),function(n){return t.include(n.tags,e)})},getEntityWithTag:function(e){return t.filter(this.getEntities(),function(n){return t.include(n.tags,e)})[0]},getEntitiesWithComponent:function(e){return t.filter(this.getEntities(),function(t){return t.components[e]!==undefined})},removeEntity:function(e){var n=e.id;return this._entity_ids=t.without(this._entity_ids,n),this.entities[n]=undefined,e.deregister(),e.id=null,e.state=null,e}});return i}),function(e,t){function r(){if(n.READY)return;n.event.determineEventTypes();for(var e in n.gestures)n.gestures.hasOwnProperty(e)&&n.detection.register(n.gestures[e]);n.event.onTouch(n.DOCUMENT,n.EVENT_MOVE,n.detection.detect),n.event.onTouch(n.DOCUMENT,n.EVENT_END,n.detection.detect),n.READY=!0}var n=function(e,t){return new n.Instance(e,t||{})};n.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},n.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,n.HAS_TOUCHEVENTS="ontouchstart"in e,n.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i,n.NO_MOUSEEVENTS=n.HAS_TOUCHEVENTS&&navigator.userAgent.match(n.MOBILE_REGEX),n.EVENT_TYPES={},n.DIRECTION_DOWN="down",n.DIRECTION_LEFT="left",n.DIRECTION_UP="up",n.DIRECTION_RIGHT="right",n.POINTER_MOUSE="mouse",n.POINTER_TOUCH="touch",n.POINTER_PEN="pen",n.EVENT_START="start",n.EVENT_MOVE="move",n.EVENT_END="end",n.DOCUMENT=document,n.plugins={},n.READY=!1,n.Instance=function(e,t){var i=this;return r(),this.element=e,this.enabled=!0,this.options=n.utils.extend(n.utils.extend({},n.defaults),t||{}),this.options.stop_browser_behavior&&n.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),n.event.onTouch(e,n.EVENT_START,function(e){i.enabled&&n.detection.startDetect(i,e)}),this},n.Instance.prototype={on:function(t,n){var r=t.split(" ");for(var i=0;i<r.length;i++)this.element.addEventListener(r[i],n,!1);return this},off:function(t,n){var r=t.split(" ");for(var i=0;i<r.length;i++)this.element.removeEventListener(r[i],n,!1);return this},trigger:function(t,r){var i=n.DOCUMENT.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=r;var s=this.element;return n.utils.hasParent(r.target,s)&&(s=r.target),s.dispatchEvent(i),this},enable:function(t){return this.enabled=t,this}};var i=null,s=!1,o=!1;n.event={bindDom:function(e,t,n){var r=t.split(" ");for(var i=0;i<r.length;i++)e.addEventListener(r[i],n,!1)},onTouch:function(t,r,u){var a=this;this.bindDom(t,n.EVENT_TYPES[r],function(f){var l=f.type.toLowerCase();if(l.match(/mouse/)&&o)return;l.match(/touch/)||l.match(/pointerdown/)||l.match(/mouse/)&&f.which===1?s=!0:l.match(/mouse/)&&f.which!==1&&(s=!1),l.match(/touch|pointer/)&&(o=!0);var c=0;s&&(n.HAS_POINTEREVENTS&&r!=n.EVENT_END?c=n.PointerEvent.updatePointer(r,f):l.match(/touch/)?c=f.touches.length:o||(c=l.match(/up/)?0:1),c>0&&r==n.EVENT_END?r=n.EVENT_MOVE:c||(r=n.EVENT_END),!c&&i!==null?f=i:i=f,u.call(n.detection,a.collectEventData(t,r,f)),n.HAS_POINTEREVENTS&&r==n.EVENT_END&&(c=n.PointerEvent.updatePointer(r,f))),c||(i=null,s=!1,o=!1,n.PointerEvent.reset())})},determineEventTypes:function(){var t;n.HAS_POINTEREVENTS?t=n.PointerEvent.getEvents():n.NO_MOUSEEVENTS?t=["touchstart","touchmove","touchend touchcancel"]:t=["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],n.EVENT_TYPES[n.EVENT_START]=t[0],n.EVENT_TYPES[n.EVENT_MOVE]=t[1],n.EVENT_TYPES[n.EVENT_END]=t[2]},getTouchList:function(t){return n.HAS_POINTEREVENTS?n.PointerEvent.getTouchList():t.touches?t.touches:[{identifier:1,pageX:t.pageX,pageY:t.pageY,target:t.target}]},collectEventData:function(t,r,i){var s=this.getTouchList(i,r),o=n.POINTER_TOUCH;if(i.type.match(/mouse/)||n.PointerEvent.matchType(n.POINTER_MOUSE,i))o=n.POINTER_MOUSE;return{center:n.utils.getCenter(s),timeStamp:(new Date).getTime(),target:i.target,touches:s,eventType:r,pointerType:o,srcEvent:i,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return n.detection.stopDetect()}}}},n.PointerEvent={pointers:{},getTouchList:function(){var e=this,t=[];return Object.keys(e.pointers).sort().forEach(function(n){t.push(e.pointers[n])}),t},updatePointer:function(e,t){return e==n.EVENT_END?this.pointers={}:(t.identifier=t.pointerId,this.pointers[t.pointerId]=t),Object.keys(this.pointers).length},matchType:function(e,t){if(!t.pointerType)return!1;var r={};return r[n.POINTER_MOUSE]=t.pointerType==t.MSPOINTER_TYPE_MOUSE||t.pointerType==n.POINTER_MOUSE,r[n.POINTER_TOUCH]=t.pointerType==t.MSPOINTER_TYPE_TOUCH||t.pointerType==n.POINTER_TOUCH,r[n.POINTER_PEN]=t.pointerType==t.MSPOINTER_TYPE_PEN||t.pointerType==n.POINTER_PEN,r[e]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},n.utils={extend:function(n,r,i){for(var s in r){if(n[s]!==t&&i)continue;n[s]=r[s]}return n},hasParent:function(e,t){while(e){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(t){var n=[],r=[];for(var i=0,s=t.length;i<s;i++)n.push(t[i].pageX),r.push(t[i].pageY);return{pageX:(Math.min.apply(Math,n)+Math.max.apply(Math,n))/2,pageY:(Math.min.apply(Math,r)+Math.max.apply(Math,r))/2}},getVelocity:function(t,n,r){return{x:Math.abs(n/t)||0,y:Math.abs(r/t)||0}},getAngle:function(t,n){var r=n.pageY-t.pageY,i=n.pageX-t.pageX;return Math.atan2(r,i)*180/Math.PI},getDirection:function(t,r){var i=Math.abs(t.pageX-r.pageX),s=Math.abs(t.pageY-r.pageY);return i>=s?t.pageX-r.pageX>0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT:t.pageY-r.pageY>0?n.DIRECTION_UP:n.DIRECTION_DOWN},getDistance:function(t,n){var r=n.pageX-t.pageX,i=n.pageY-t.pageY;return Math.sqrt(r*r+i*i)},getScale:function(t,n){return t.length>=2&&n.length>=2?this.getDistance(n[0],n[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,n){return t.length>=2&&n.length>=2?this.getAngle(n[1],n[0])-this.getAngle(t[1],t[0]):0},isVertical:function(t){return t==n.DIRECTION_UP||t==n.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(t,n){var r,i=["webkit","khtml","moz","ms","o",""];if(!n||!t.style)return;for(var s=0;s<i.length;s++)for(var o in n)n.hasOwnProperty(o)&&(r=o,i[s]&&(r=i[s]+r.substring(0,1).toUpperCase()+r.substring(1)),t.style[r]=n[o]);n.userSelect=="none"&&(t.onselectstart=function(){return!1})}},n.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,r){if(this.current)return;this.stopped=!1,this.current={inst:t,startEvent:n.utils.extend({},r),lastEvent:!1,name:""},this.detect(r)},detect:function(t){if(!this.current||this.stopped)return;t=this.extendEventData(t);var r=this.current.inst.options;for(var i=0,s=this.gestures.length;i<s;i++){var o=this.gestures[i];if(!this.stopped&&r[o.name]!==!1&&o.handler.call(o,t,this.current.inst)===!1){this.stopDetect();break}}return this.current&&(this.current.lastEvent=t),t.eventType==n.EVENT_END&&!t.touches.length-1&&this.stopDetect(),t},stopDetect:function(){this.previous=n.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(t){var r=this.current.startEvent;if(r&&(t.touches.length!=r.touches.length||t.touches===r.touches)){r.touches=[];for(var i=0,s=t.touches.length;i<s;i++)r.touches.push(n.utils.extend({},t.touches[i]))}var o=t.timeStamp-r.timeStamp,u=t.center.pageX-r.center.pageX,a=t.center.pageY-r.center.pageY,f=n.utils.getVelocity(o,u,a);return n.utils.extend(t,{deltaTime:o,deltaX:u,deltaY:a,velocityX:f.x,velocityY:f.y,distance:n.utils.getDistance(r.center,t.center),angle:n.utils.getAngle(r.center,t.center),direction:n.utils.getDirection(r.center,t.center),scale:n.utils.getScale(r.touches,t.touches),rotation:n.utils.getRotation(r.touches,t.touches),startEvent:r}),t},register:function(r){var i=r.defaults||{};return i[r.name]===t&&(i[r.name]=!0),n.utils.extend(n.defaults,i,!0),r.index=r.index||1e3,this.gestures.push(r),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}},n.gestures=n.gestures||{},n.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(t,r){switch(t.eventType){case n.EVENT_START:clearTimeout(this.timer),n.detection.current.name=this.name,this.timer=setTimeout(function(){n.detection.current.name=="hold"&&r.trigger("hold",t)},r.options.hold_timeout);break;case n.EVENT_MOVE:t.distance>r.options.hold_threshold&&clearTimeout(this.timer);break;case n.EVENT_END:clearTimeout(this.timer)}}},n.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(t,r){if(t.eventType==n.EVENT_END){var i=n.detection.previous,s=!1;if(t.deltaTime>r.options.tap_max_touchtime||t.distance>r.options.tap_max_distance)return;i&&i.name=="tap"&&t.timeStamp-i.lastEvent.timeStamp<r.options.doubletap_interval&&t.distance<r.options.doubletap_distance&&(r.trigger("doubletap",t),s=!0);if(!s||r.options.tap_always)n.detection.current.name="tap",r.trigger(n.detection.current.name,t)}}},n.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.7},handler:function(t,r){if(t.eventType==n.EVENT_END){if(r.options.swipe_max_touches>0&&t.touches.length>r.options.swipe_max_touches)return;if(t.velocityX>r.options.swipe_velocity||t.velocityY>r.options.swipe_velocity)r.trigger(this.name,t),r.trigger(this.name+t.direction,t)}}},n.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(t,r){if(n.detection.current.name!=this.name&&this.triggered){r.trigger(this.name+"end",t),this.triggered=!1;return}if(r.options.drag_max_touches>0&&t.touches.length>r.options.drag_max_touches)return;switch(t.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:if(t.distance<r.options.drag_min_distance&&n.detection.current.name!=this.name)return;n.detection.current.name=this.name;if(n.detection.current.lastEvent.drag_locked_to_axis||r.options.drag_lock_to_axis&&r.options.drag_lock_min_distance<=t.distance)t.drag_locked_to_axis=!0;var i=n.detection.current.lastEvent.direction;t.drag_locked_to_axis&&i!==t.direction&&(n.utils.isVertical(i)?t.direction=t.deltaY<0?n.DIRECTION_UP:n.DIRECTION_DOWN:t.direction=t.deltaX<0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT),this.triggered||(r.trigger(this.name+"start",t),this.triggered=!0),r.trigger(this.name,t),r.trigger(this.name+t.direction,t),(r.options.drag_block_vertical&&n.utils.isVertical(t.direction)||r.options.drag_block_horizontal&&!n.utils.isVertical(t.direction))&&t.preventDefault();break;case n.EVENT_END:this.triggered&&r.trigger(this.name+"end",t),this.triggered=!1}}},n.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(t,r){if(n.detection.current.name!=this.name&&this.triggered){r.trigger(this.name+"end",t),this.triggered=!1;return}if(t.touches.length<2)return;r.options.transform_always_block&&t.preventDefault();switch(t.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:var i=Math.abs(1-t.scale),s=Math.abs(t.rotation);if(i<r.options.transform_min_scale&&s<r.options.transform_min_rotation)return;n.detection.current.name=this.name,this.triggered||(r.trigger(this.name+"start",t),this.triggered=!0),r.trigger(this.name,t),s>r.options.transform_min_rotation&&r.trigger("rotate",t),i>r.options.transform_min_scale&&(r.trigger("pinch",t),r.trigger("pinch"+(t.scale<1?"in":"out"),t));break;case n.EVENT_END:this.triggered&&r.trigger(this.name+"end",t),this.triggered=!1}}},n.gestures.Touch={name:"touch",index:-Infinity,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(t,r){if(r.options.prevent_mouseevents&&t.pointerType==n.POINTER_MOUSE){t.stopDetect();return}r.options.prevent_default&&t.preventDefault(),t.eventType==n.EVENT_START&&r.trigger(this.name,t)}},n.gestures.Release={name:"release",index:Infinity,handler:function(t,r){t.eventType==n.EVENT_END&&r.trigger(this.name,t)}},typeof module=="object"&&typeof module.exports=="object"?module.exports=n:(e.Hammer=n,typeof e.define=="function"&&e.define.amd&&e.define("hammer",[],function(){return n}))}(this),define("sge/vendor/hammer",function(e){return function(){var t,n;return t||e.Hammer}}(this)),define("sge/input",["sge/lib/class","sge/observable","sge/vendor/hammer"],function(e,t,n){var r={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"left-window-key":91,"right-window-key":92,select:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,"decimal-point":110,divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,numlock:144,scrolllock:145,"semi-colon":186,equals:187,comma:188,dash:189,period:190,slash:191,accent:192,lbracket:219,backslash:220,rbraket:221,singlequote:222},i={},s=Object.keys(r);for(var o=0;o<s.length;o++){var u=s[o],a=r[u];i[a]=u}var f=t.extend({init:function(e){this._super(),this._input=e,this.enable=!1,this.joystick=e.joystick},fireEvent:function(){var e=Array.prototype.slice.call(arguments);this.enable&&this._super.apply(this,e)},isPressed:function(e){return this._input.isPressed(e)}}),l=t.extend({init:function(e){this._elem=e||document,console.log(this._elem),this._super(),this._isNewKeyDown={},this._isKeyDown={},this._proxies=[],this._events=[],this.joystick=new VirtualJoystick({container:this._elem}),document.onkeydown=this.keyDownCallback.bind(this),document.onkeyup=this.keyUpCallback.bind(this),n(this._elem).on("tap",this.tapCallback.bind(this))},tapCallback:function(e){this._events.push("tap")},keyDownCallback:function(e){console.log("keydown:"+i[e.keyCode]),this._isKeyDown[e.keyCode]||(this._isNewKeyDown[e.keyCode]=!0)},keyUpCallback:function(e){delete this._isNewKeyDown[e.keyCode],this._isKeyDown[e.keyCode]=undefined},isPressed:function(e){return this._isKeyDown[r[e]]===!0},tick:function(){var e=Object.keys(this._isNewKeyDown);for(var t=e.length-1;t>=0;t--){var n=e[t];this._isKeyDown[n]=!0,delete this._isNewKeyDown[n],this.fireEvent("keydown:"+i[n])}for(var r=this._events.length-1;r>=0;r--)this.fireEvent(this._events[r]);this._events=[]},createProxy:function(){var e=new f(this);return this._proxies.push(e),e},fireEvent:function(){var e=Array.prototype.slice.call(arguments);this._super.apply(this,e);var t=_.filter(this._proxies,function(e){return e.enable});for(var n=t.length-1;n>=0;n--)t[n].fireEvent.apply(t[n],e)}});return l});var VirtualJoystick=function(e){e=e||{},this._container=e.container||document.body,this._strokeStyle=e.strokeStyle||"cyan",this._stickEl=e.stickElement||this._buildJoystickStick(),this._baseEl=e.baseElement||this._buildJoystickBase(),this._mouseSupport=e.mouseSupport!==undefined?e.mouseSupport:!1,this._container.style.position="relative",this._container.appendChild(this._baseEl),this._baseEl.style.position="absolute",this._baseEl.style.display="none",this._container.appendChild(this._stickEl),this._stickEl.style.position="absolute",this._stickEl.style.display="none",this._pressed=!1,this._touchIdx=null,this._baseX=0,this._baseY=0,this._stickX=0,this._stickY=0;var t=function(e,t){return function(){return e.apply(t,arguments)}};this._$onTouchStart=t(this._onTouchStart,this),this._$onTouchEnd=t(this._onTouchEnd,this),this._$onTouchMove=t(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=t(this._onMouseDown,this),this._$onMouseUp=t(this._onMouseUp,this),this._$onMouseMove=t(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))};VirtualJoystick.prototype.destroy=function(){this._container.removeChild(this._baseEl),this._container.removeChild(this._stickEl),this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))},VirtualJoystick.touchScreenAvailable=function(){return"createTouch"in document?!0:!1},function(e){e.addEventListener=function(e,t){return this._events===undefined&&(this._events={}),this._events[e]=this._events[e]||[],this._events[e].push(t),t},e.removeEventListener=function(e,t){this._events===undefined&&(this._events={});if(e in this._events==0)return;this._events[e].splice(this._events[e].indexOf(t),1)},e.dispatchEvent=function(e){this._events===undefined&&(this._events={});if(this._events[e]===undefined)return;var t=this._events[e].slice();for(var n=0;n<t.length;n++){var r=t[n].apply(this,Array.prototype.slice.call(arguments,1));if(r!==undefined)return r}return undefined}}(VirtualJoystick.prototype),VirtualJoystick.prototype.deltaX=function(){return this._stickX-this._baseX},VirtualJoystick.prototype.deltaY=function(){return this._stickY-this._baseY},VirtualJoystick.prototype.up=function(){if(this._pressed===!1)return!1;var e=this.deltaX(),t=this.deltaY();return t>=0?!1:Math.abs(e)>2*Math.abs(t)?!1:!0},VirtualJoystick.prototype.down=function(){if(this._pressed===!1)return!1;var e=this.deltaX(),t=this.deltaY();return t<=0?!1:Math.abs(e)>2*Math.abs(t)?!1:!0},VirtualJoystick.prototype.right=function(){if(this._pressed===!1)return!1;var e=this.deltaX(),t=this.deltaY();return e<=0?!1:Math.abs(t)>2*Math.abs(e)?!1:!0},VirtualJoystick.prototype.left=function(){if(this._pressed===!1)return!1;var e=this.deltaX(),t=this.deltaY();return e>=0?!1:Math.abs(t)>2*Math.abs(e)?!1:!0},VirtualJoystick.prototype._onUp=function(){this._pressed=!1,this._stickEl.style.display="none",this._baseEl.style.display="none",this._baseX=this._baseY=0,this._stickX=this._stickY=0},VirtualJoystick.prototype._onDown=function(e,t){this._pressed=!0,this._baseX=e,this._baseY=t,this._stickX=e,this._stickY=t,this._stickEl.style.display="",this._stickEl.style.left=e-this._stickEl.width/2+"px",this._stickEl.style.top=t-this._stickEl.height/2+"px",this._baseEl.style.display="",this._baseEl.style.left=e-this._baseEl.width/2+"px",this._baseEl.style.top=t-this._baseEl.height/2+"px"},VirtualJoystick.prototype._onMove=function(e,t){this._pressed===!0&&(this._stickX=e,this._stickY=t,this._stickEl.style.left=e-this._stickEl.width/2+"px",this._stickEl.style.top=t-this._stickEl.height/2+"px")},VirtualJoystick.prototype._onMouseUp=function(e){return this._onUp()},VirtualJoystick.prototype._onMouseDown=function(e){var t=e.clientX,n=e.clientY;return this._onDown(t,n)},VirtualJoystick.prototype._onMouseMove=function(e){var t=e.clientX,n=e.clientY;return this._onMove(t,n)},VirtualJoystick.prototype._onTouchStart=function(e){if(this._touchIdx!==null)return;var t=this.dispatchEvent("touchStartValidation",e);if(t===!1)return;e.preventDefault();var n=e.changedTouches[0];this._touchIdx=n.identifier;var r=n.pageX,i=n.pageY;return this._onDown(r,i)},VirtualJoystick.prototype._onTouchEnd=function(e){if(this._touchIdx===null)return;var t=e.changedTouches;for(var n=0;n<t.length&&t[n].identifier!==this._touchIdx;n++);if(n===t.length)return;return this._touchIdx=null,e.preventDefault(),this._onUp()},VirtualJoystick.prototype._onTouchMove=function(e){if(this._touchIdx===null)return;var t=e.changedTouches;for(var n=0;n<t.length&&t[n].identifier!==this._touchIdx;n++);if(n===t.length)return;var r=t[n];e.preventDefault();var i=r.pageX,s=r.pageY;return this._onMove(i,s)},VirtualJoystick.prototype._buildJoystickBase=function(){var e=document.createElement("canvas");e.width=126,e.height=126;var t=e.getContext("2d");return t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=6,t.arc(e.width/2,e.width/2,40,0,Math.PI*2,!0),t.stroke(),t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=2,t.arc(e.width/2,e.width/2,60,0,Math.PI*2,!0),t.stroke(),e},VirtualJoystick.prototype._buildJoystickStick=function(){var e=document.createElement("canvas");e.width=86,e.height=86;var t=e.getContext("2d");return t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=6,t.arc(e.width/2,e.width/2,40,0,Math.PI*2,!0),t.stroke(),e},define("sge/vendor/virtualjoystick",function(){}),define("sge/vendor/pxloader",[],function(){function e(e){e=e||{},this.settings=e,e.statusInterval==null&&(e.statusInterval=5e3),e.loggingDelay==null&&(e.loggingDelay=2e4),e.noProgressTimeout==null&&(e.noProgressTimeout=Infinity);var n=[],r=[],i,s=Date.now(),o={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},u=function(e){return e==null?[]:Array.isArray(e)?e:[e]};this.add=function(e){e.tags=new t(e.tags),e.priority==null&&(e.priority=Infinity),n.push({resource:e,status:o.QUEUED})},this.addProgressListener=function(e,n){r.push({callback:e,tags:new t(n)})},this.addCompletionListener=function(e,n){r.push({tags:new t(n),callback:function(t){t.completedCount===t.totalCount&&e(t)}})};var a=function(e){e=u(e);var t=function(t){var n=t.resource,r=Infinity;for(var i=0;i<n.tags.length;i++)for(var s=0;s<Math.min(e.length,r);s++){if(n.tags[i]===e[s]&&s<r){r=s;if(r===0)break}if(r===0)break}return r};return function(e,n){var r=t(e),i=t(n);return r<i?-1:r>i?1:e.priority<n.priority?-1:e.priority>n.priority?1:0}};this.start=function(e){i=Date.now();var t=a(e);n.sort(t);for(var r=0,s=n.length;r<s;r++){var u=n[r];u.status=o.WAITING,u.resource.start(this)}setTimeout(f,100)};var f=function(){var t=!1,r=Date.now()-s,i=r>=e.noProgressTimeout,u=r>=e.loggingDelay;for(var a=0,l=n.length;a<l;a++){var c=n[a];if(c.status!==o.WAITING)continue;c.resource.checkStatus&&c.resource.checkStatus(),c.status===o.WAITING&&(i?c.resource.onTimeout():t=!0)}u&&t&&h(),t&&setTimeout(f,e.statusInterval)};this.isBusy=function(){for(var e=0,t=n.length;e<t;e++)if(n[e].status===o.QUEUED||n[e].status===o.WAITING)return!0;return!1};var l=function(e,t){var i=null,u,a,f,l,h;for(u=0,a=n.length;u<a;u++)if(n[u].resource===e){i=n[u];break}if(i==null||i.status!==o.WAITING)return;i.status=t,s=Date.now(),f=e.tags.length;for(u=0,a=r.length;u<a;u++)l=r[u],l.tags.length===0?h=!0:h=e.tags.contains(l.tags),h&&c(i,l)};this.onLoad=function(e){l(e,o.LOADED)},this.onError=function(e){l(e,o.ERROR)},this.onTimeout=function(e){l(e,o.TIMEOUT)};var c=function(e,t){var r=0,i=0,s,u,a,f;for(s=0,u=n.length;s<u;s++)a=n[s],f=!1,t.tags.length===0?f=!0:f=a.resource.tags.contains(t.tags),f&&(i++,(a.status===o.LOADED||a.status===o.ERROR||a.status===o.TIMEOUT)&&r++);t.callback({resource:e.resource,loaded:e.status===o.LOADED,error:e.status===o.ERROR,timeout:e.status===o.TIMEOUT,completedCount:r,totalCount:i})},h=this.log=function(e){if(!window.console)return;var t=Math.round((Date.now()-i)/1e3);window.console.log("PxLoader elapsed: "+t+" sec");for(var r=0,s=n.length;r<s;r++){var u=n[r];if(!e&&u.status!==o.WAITING)continue;var a="PxLoader: #"+r+" "+u.resource.getName();switch(u.status){case o.QUEUED:a+=" (Not Started)";break;case o.WAITING:a+=" (Waiting)";break;case o.LOADED:a+=" (Loaded)";break;case o.ERROR:a+=" (Error)";break;case o.TIMEOUT:a+=" (Timeout)"}u.resource.tags.length>0&&(a+=" Tags: ["+u.resource.tags.array.join(",")+"]"),window.console.log(a)}}}function t(e){this.array=[],this.object={},this.value=null,this.length=0;if(e!==null&&e!==undefined){if(Array.isArray(e))this.array=e;else if(typeof e=="object")for(var t in e)this.array.push(t);else this.array.push(e),this.value=e;this.length=this.array.length;for(var n=0;n<this.length;n++)this.object[this.array[n]]=!0}}function n(e,t,n){var r=this,i=null;this.img=new Image,this.tags=t,this.priority=n;var s=function(){r.img.readyState==="complete"&&(a(),i.onLoad(r))},o=function(){a(),i.onLoad(r)},u=function(){a(),i.onError(r)},a=function(){r.unbind("load",o),r.unbind("readystatechange",s),r.unbind("error",u)};this.start=function(t){i=t,r.bind("load",o),r.bind("readystatechange",s),r.bind("error",u),r.img.src=e},this.checkStatus=function(){r.img.complete&&(a(),i.onLoad(r))},this.onTimeout=function(){a(),r.img.complete?i.onLoad(r):i.onTimeout(r)},this.getName=function(){return e},this.bind=function(e,t){r.img.addEventListener?r.img.addEventListener(e,t,!1):r.img.attachEvent&&r.img.attachEvent("on"+e,t)},this.unbind=function(e,t){r.img.removeEventListener?r.img.removeEventListener(e,t,!1):r.img.detachEvent&&r.img.detachEvent("on"+e,t)}}return t.prototype.contains=function(e){if(this.length===0||e.length===0)return!1;if(this.length===1&&this.value!==null)return e.length===1?this.value===e.value:e.object.hasOwnProperty(this.value);if(e.length<this.length)return e.contains(this);for(var t in this.object)if(e.object[t])return!0;return!1},e.prototype.addImage=function(e,t,r){var i=new n(e,t,r);return this.add(i),i.img},e}),Date.now||(Date.now=function(){return(new Date).getTime()}),Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"}),define("sge/game",["sge/vendor/underscore","sge/lib/class","sge/vendor/caat","sge/vendor/state-machine","sge/engine","sge/gamestate","sge/input","sge/renderer","sge/vendor/virtualjoystick","sge/vendor/pxloader"],function(e,t,n,r,i,s,o,u,a,f,l){var c=s.extend({initState:function(){var e=this.game.renderer.width,t=this.game.renderer.height,r=(new n.TextActor).setText("Loading").setLocation(e/2,t/2);this.scene.addChild(r)},startState:function(){this._super(),this.elem&&this.elem.fadeIn()},endState:function(){this._super(),this.elem&&this.elem.fadeOut()}}),h=s.extend({initState:function(){var e=this.game.renderer.width,t=this.game.renderer.height,r=(new n.TextActor).setText("Game").setLocation(e/2,t/2),i=(new n.TextActor).setText("Press Enter to Start");this.scene.addChild(r),this.scene.addChild(i),this.startGame=function(){this.game._states.game=new this.game._gameState(this.game,"Game"),this.game.fsm.startLoad()}.bind(this),this.startState(),this.input.addListener("keydown:enter",this.startGame),this.input.addListener("tap",this.startGame)},startState:function(){this._super(),this.elem&&this.elem.fadeIn()},endState:function(){this._super(),this.elem&&this.elem.fadeOut()},tick:function(e){}}),p=s.extend({initState:function(){var e=this.game.renderer.width,t=this.game.renderer.height,r=(new n.TextActor).setText("Game Over").setLocation(e/2,t/2);this.scene.addChild(r),this.startGame=function(){this.game._states.game=new this.game._gameState(this.game),this.game.fsm.loadMainMenu()}.bind(this),this.input.addListener("keydown:enter",this.startGame),this.input.addListener("tap",this.startGame)},startState:function(){this._super(),this.elem&&this.elem.fadeIn()},endState:function(){this._super(),this.elem&&this.elem.fadeOut()},tick:function(e){}}),d=s.extend({initState:function(){var e=this.game.renderer.width,t=this.game.renderer.height,r=(new n.TextActor).setText("Win").setLocation(e/2,t/2);this.scene.addChild(r),this.startGame=function(){this.game._states.game=new this.game._gameState(this.game),this.game.fsm.loadMainMenu()}.bind(this),this.input.addListener("keydown:enter",this.startGame),this.input.addListener("tap",this.startGame)},startState:function(){this._super(),this.elem&&this.elem.fadeIn()},endState:function(){this._super(),this.elem&&this.elem.fadeOut()},tick:function(e){}}),v=s.extend({initState:function(){var e=this.game.renderer.width,t=this.game.renderer.height,r=(new n.TextActor).setText("Paused").setLocation(e/2,t/2),i=(new n.TextActor).setText("Press Enter to Start").setLocation(e/2,t/2)+32;this.scene.addChild(r),this.unpause=function(){this.game.fsm.unpause()}.bind(this),this.input.addListener("keydown:space",this.unpause),this.input.addListener("tap",this.unpause)},startState:function(){this._super(),this.elem&&this.elem.fadeIn()},endState:function(){this._super(),this.elem&&this.elem.fadeOut()},tick:function(e){func=this.game._states.game._paused_tick,func&&func.call(this.game._states.game,e)}}),m=s.extend({initState:function(){setTimeout(function(){this.game.fsm.finishLoad(),setTimeout(function(){this.game.fsm.gameWin()}.bind(this),5e3)}.bind(this),1e3)}}),g=t.extend({init:function(t){this.options=e.extend({elem:null,pauseState:v,mainMenuState:h,width:720,height:540,fps:60},t||{}),this.engine=new i,this.loader=new f,this.input=new o(document.getElementById("game")),this.data={},this._tick=0,this._last=0,this._lastRender=0,this._gameState=m,this.renderer=(new n.Director).initialize(this.options.width,this.options.height,document.getElementById("game")),this.engine.tick=function(e){this.tick(e)}.bind(this),this.fsm=r.create({initial:"mainmenu",events:[{name:"startLoad",from:["game","menu","mainmenu"],to:"loading"},{name:"finishLoad",from:"loading",to:"game"},{name:"pause",from:"game",to:"paused"},{name:"unpause",from:["paused","menu"],to:"game"},{name:"loadMainMenu",from:["game","gameover","gamewin","menu","pause"],to:"mainmenu"},{name:"gameOver",from:"game",to:"gameover"},{name:"gameWin",from:"game",to:"gamewin"},{name:"startDialog",from:"game",to:"dialog"},{name:"endDialog",from:"dialog",to:"game"}],callbacks:{onleavestate:function(e,t,n){if(t=="none")return;this._states[t].endState(e,t,n)}.bind(this),onenterstate:function(e,t,n){if(t=="none")return;this._states[n].startState(e,t,n),this.state=this._states[n]}.bind(this)}}),this._states={game:null,mainmenu:new this.options.mainMenuState(this,"Main Menu"),loading:new c(this,"Loading"),paused:new this.options.pauseState(this,"Paused"),gameover:new p(this,"Game Over"),gamewin:new d(this,"Game Win")},this.state=this._states.loading,this.initGame(t)},setGameState:function(e){this._gameState=e},addState:function(e,t){return this._states[e]=t,t},finishLoad:function(){setTimeout(function(){this.fsm.finishLoad()}.bind(this),250)},initGame:function(){},preRender:function(){},postRender:function(){},tick:function(e){this.input.tick(),this.state!=null&&this.state.tick(e)},start:function(){window.onblur=function(){this.fsm.pause()}.bind(this),this.engine.run(this.options.fps),n.loop(this.options.fps)}});return g}),define("sge/lib/random",[],function(){var e=function(){return Math.random()},t=function(e,t){var n=t-e;return Math.random()*n+e},n=function(e,n){return Math.round(t(e,n))},r=function(e){var t=e.length-1;return e[Math.round(Math.random()*t)]};return{unit:e,range:t,rangeInt:n,item:r}}),define("sge/lib/collision",[],function(){var e=function(e,t,n,r,i,s,o,u){var a=((e*r-t*n)*(i-o)-(e-n)*(i*u-s*o))/((e-n)*(s-u)-(t-r)*(i-o)),f=((e*r-t*n)*(s-u)-(t-r)*(i*u-s*o))/((e-n)*(s-u)-(t-r)*(i-o));if(isNaN(a)||isNaN(f))return!1;if(e>=n){if(!(n<=a&&a<=e))return!1}else if(!(e<=a&&a<=n))return!1;if(t>=r){if(!(r<=f&&f<=t))return!1}else if(!(t<=f&&f<=r))return!1;if(i>=o){if(!(o<=a&&a<=i))return!1}else if(!(i<=a&&a<=o))return!1;if(s>=u){if(!(u<=f&&f<=s))return!1}else if(!(s<=f&&f<=u))return!1;var l=Math.sqrt((a-e)*(a-e)+(f-t)*(f-t));return[a,f,l]},t=function(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)},n=function(t,n,r,i,s){coords=[[s.left,s.top,s.right,s.top],[s.left,s.bottom,s.right,s.bottom],[s.left,s.top,s.left,s.bottom],[s.right,s.top,s.right,s.bottom]];var o=!1,u=1e6;for(var a=coords.length-1;a>=0;a--){var f=coords[a],l=e(t,n,r,i,f[0],f[1],f[2],f[3]);l&&u>l[2]&&(u=l[2],o=l)}return o};return pointRectIntersect=function(e,t,n){return n.left<e&&n.right>e&&n.top<t&&n.bottom>t},{lineIntersect:e,rectIntersect:t,lineRectIntersect:n,pointRectIntersect:pointRectIntersect}}),define("sge/lib/util",[],function(){var e=function(t,n){for(var r in n)t[r]&&typeof t[r]=="object"&&t[r].toString()=="[object Object]"&&n[r]?e(t[r],n[r]):t[r]=n[r];return t};return{extend:e}}),define("sge/physics",["sge/lib/class","sge/lib/collision"],function(e,t){TYPES={KINETIC:0,STATIC:1,PASS:2};var n=e.extend({init:function(e){this.state=e,this.map=e.map,this._contactList=[],this._newContactList=[]},intersectRect:function(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)},moveGameObject:function(e,t,n){var r=Math.round(e.get("xform.tx")),i=Math.round(e.get("xform.ty")),s=Math.round(r+t),o=Math.round(i+n);return e.active?(s!=r||o!=i)&&e.set("xform.t",s,o):(s=r,o=i),[s,o]},resolveCollisions:function(e,t){var n=[],r=[];t===undefined&&(t=!0),_.each(this.state.getEntitiesWithComponent("physics"),function(r){if(r.get("physics.type")&TYPES.STATIC)return;if(r.get("physics")._wait){r.get("physics")._wait=!1;return}if(t){var i=r.get("xform.vx")*e,s=r.get("xform.vy")*e;this.moveGameObject(r,i,s)}r.active&&n.push(r)}.bind(this));var i=0;while(n.length>1){var s=n.shift(),o=Boolean(s.get("physics.type")&TYPES.STATIC),u=s.get("xform.tx"),a=s.get("xform.ty"),f=s.get("physics.width"),l=s.get("physics.height"),c={top:a-l/2,bottom:a+l/2,left:u-f/2,right:u+f/2};for(var h=n.length-1;h>=0;h--){i++;var p=n[h],d=Boolean(p.get("physics.type")&TYPES.STATIC);if(o&d)continue;var v=p.get("xform.tx"),m=p.get("xform.ty"),g=p.get("physics.width"),y=p.get("physics.height"),b={top:m-y/2,bottom:m+y/2,left:v-g/2,right:v+g/2};if(this.intersectRect(c,b)){var w=s.id+"."+p.id;s.id>p.id&&(w=p.id+"."+s.id),r.push(w);if(!_.contains(this._contactList,w)){var E=w.split("."),s=this.state.getEntity(E[0]),p=this.state.getEntity(E[1]);s.fireEvent("contact.start",p),p.fireEvent("contact.start",s)}if(s.get("physics.type")==TYPES.PASS||p.get("physics.type")==TYPES.PASS)continue;var S=b.right-c.left,x=b.left-c.right,T=b.top-c.bottom,N=b.bottom-c.top,C=0,k=0;Math.abs(S)>Math.abs(x)?C=x:C=S,Math.abs(T)>Math.abs(N)?k=N:k=T,Math.abs(C)>Math.abs(k)?C=0:k=0;var L=0,A=0,O=0,M=0;s.get("physics.type")&TYPES.STATIC?(O=-C,M=-k):p.get("physics.type")&TYPES.STATIC?(L=C,A=k):(L=C/2,A=k/2,O=C/-2,M=k/-2),this.moveGameObject(s,L,A),this.moveGameObject(p,O,M)}}}for(var h=this._contactList.length-1;h>=0;h--)if(!_.contains(r,this._contactList[h])){var E=this._contactList[h].split("."),s=this.state.getEntity(E[0]),p=this.state.getEntity(E[1]);s&&s.fireEvent("contact.end",p),p&&p.fireEvent("contact.end",s)}this._contactList=r}});return n}),define("sge/main",["sge/config","sge/renderer","sge/engine","sge/entity","sge/component","sge/game","sge/gamestate","sge/vendor/pxloader","sge/vendor/virtualjoystick","sge/vendor/hammer","sge/lib/class","sge/lib/random","sge/lib/collision","sge/lib/util","sge/spritesheet","sge/physics"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){return{config:e,Renderer:t,Engine:n,Entity:r,Component:i,Game:s,GameState:o,vendor:{PxLoader:u,VirtualJoystick:a,Hammer:f},Class:l,random:c,util:p,collision:h,SpriteSheet:d,Physics:v}}),define("sge",["sge/main"],function(e){return e});